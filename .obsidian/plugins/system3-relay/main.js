/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var M0=Object.create;var la=Object.defineProperty;var F0=Object.getOwnPropertyDescriptor;var R0=Object.getOwnPropertyNames;var O0=Object.getPrototypeOf,U0=Object.prototype.hasOwnProperty;var $0=(o,e,t)=>e in o?la(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var wi=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),zf=(o,e)=>{for(var t in e)la(o,t,{get:e[t],enumerable:!0})},Fm=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of R0(e))!U0.call(o,n)&&n!==t&&la(o,n,{get:()=>e[n],enumerable:!(r=F0(e,n))||r.enumerable});return o};var es=(o,e,t)=>(t=o!=null?M0(O0(o)):{},Fm(e||!o||!o.__esModule?la(t,"default",{value:o,enumerable:!0}):t,o)),B0=o=>Fm(la({},"__esModule",{value:!0}),o);var mt=(o,e,t)=>($0(o,typeof e!="symbol"?e+"":e,t),t);var _i=wi((ME,Om)=>{"use strict";function ro(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function Rm(o,e){for(var t="",r=0,n=-1,s=0,a,i=0;i<=o.length;++i){if(i<o.length)a=o.charCodeAt(i);else{if(a===47)break;a=47}if(a===47){if(!(n===i-1||s===1))if(n!==i-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),n=i,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,n=i,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(n+1,i):t=o.slice(n+1,i),r=i-n-1;n=i,s=0}else a===46&&s!==-1?++s:s=-1}return t}function N0(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var ts={resolve:function(){for(var e="",t=!1,r,n=arguments.length-1;n>=-1&&!t;n--){var s;n>=0?s=arguments[n]:(r===void 0&&(r=process.cwd()),s=r),ro(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=Rm(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(ro(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=Rm(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return ro(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];ro(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":ts.normalize(e)},relative:function(e,t){if(ro(e),ro(t),e===t||(e=ts.resolve(e),t=ts.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var n=e.length,s=n-r,a=1;a<t.length&&t.charCodeAt(a)===47;++a);for(var i=t.length,l=i-a,c=s<l?s:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(t.charCodeAt(a+d)===47)return t.slice(a+d+1);if(d===0)return t.slice(a+d)}else s>c&&(e.charCodeAt(r+d)===47?u=d:d===0&&(u=0));break}var m=e.charCodeAt(r+d),x=t.charCodeAt(a+d);if(m!==x)break;m===47&&(u=d)}var h="";for(d=r+u+1;d<=n;++d)(d===n||e.charCodeAt(d)===47)&&(h.length===0?h+="..":h+="/..");return h.length>0?h+t.slice(a+u):(a+=u,t.charCodeAt(a)===47&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(ro(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,n=-1,s=!0,a=e.length-1;a>=1;--a)if(t=e.charCodeAt(a),t===47){if(!s){n=a;break}}else s=!1;return n===-1?r?"/":".":r&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');ro(e);var r=0,n=-1,s=!0,a;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var i=t.length-1,l=-1;for(a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(c===47){if(!s){r=a+1;break}}else l===-1&&(s=!1,l=a+1),i>=0&&(c===t.charCodeAt(i)?--i===-1&&(n=a):(i=-1,n=l))}return r===n?n=l:n===-1&&(n=e.length),e.slice(r,n)}else{for(a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===47){if(!s){r=a+1;break}}else n===-1&&(s=!1,n=a+1);return n===-1?"":e.slice(r,n)}},extname:function(e){ro(e);for(var t=-1,r=0,n=-1,s=!0,a=0,i=e.length-1;i>=0;--i){var l=e.charCodeAt(i);if(l===47){if(!s){r=i+1;break}continue}n===-1&&(s=!1,n=i+1),l===46?t===-1?t=i:a!==1&&(a=1):t!==-1&&(a=-1)}return t===-1||n===-1||a===0||a===1&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return N0("/",e)},parse:function(e){ro(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),n=r===47,s;n?(t.root="/",s=1):s=0;for(var a=-1,i=0,l=-1,c=!0,u=e.length-1,d=0;u>=s;--u){if(r=e.charCodeAt(u),r===47){if(!c){i=u+1;break}continue}l===-1&&(c=!1,l=u+1),r===46?a===-1?a=u:d!==1&&(d=1):a!==-1&&(d=-1)}return a===-1||l===-1||d===0||d===1&&a===l-1&&a===i+1?l!==-1&&(i===0&&n?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(i,l)):(i===0&&n?(t.name=e.slice(1,a),t.base=e.slice(1,l)):(t.name=e.slice(i,a),t.base=e.slice(i,l)),t.ext=e.slice(a,l)),i>0?t.dir=e.slice(0,i-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};ts.posix=ts;Om.exports=ts});var td=wi((GU,zs)=>{var ne=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},st=-1,at=1,$e=0;ne.Diff=function(o,e){return[o,e]};ne.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var n=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new ne.Diff($e,o)]:[];typeof t=="undefined"&&(t=!0);var s=t,a=this.diff_commonPrefix(o,e),i=o.substring(0,a);o=o.substring(a),e=e.substring(a),a=this.diff_commonSuffix(o,e);var l=o.substring(o.length-a);o=o.substring(0,o.length-a),e=e.substring(0,e.length-a);var c=this.diff_compute_(o,e,s,n);return i&&c.unshift(new ne.Diff($e,i)),l&&c.push(new ne.Diff($e,l)),this.diff_cleanupMerge(c),c};ne.prototype.diff_compute_=function(o,e,t,r){var n;if(!o)return[new ne.Diff(at,e)];if(!e)return[new ne.Diff(st,o)];var s=o.length>e.length?o:e,a=o.length>e.length?e:o,i=s.indexOf(a);if(i!=-1)return n=[new ne.Diff(at,s.substring(0,i)),new ne.Diff($e,a),new ne.Diff(at,s.substring(i+a.length))],o.length>e.length&&(n[0][0]=n[2][0]=st),n;if(a.length==1)return[new ne.Diff(st,o),new ne.Diff(at,e)];var l=this.diff_halfMatch_(o,e);if(l){var c=l[0],u=l[1],d=l[2],m=l[3],x=l[4],h=this.diff_main(c,d,t,r),_=this.diff_main(u,m,t,r);return h.concat([new ne.Diff($e,x)],_)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};ne.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var n=r.lineArray,s=this.diff_main(o,e,!1,t);this.diff_charsToLines_(s,n),this.diff_cleanupSemantic(s),s.push(new ne.Diff($e,""));for(var a=0,i=0,l=0,c="",u="";a<s.length;){switch(s[a][0]){case at:l++,u+=s[a][1];break;case st:i++,c+=s[a][1];break;case $e:if(i>=1&&l>=1){s.splice(a-i-l,i+l),a=a-i-l;for(var d=this.diff_main(c,u,!1,t),m=d.length-1;m>=0;m--)s.splice(a,0,d[m]);a=a+d.length}l=0,i=0,c="",u="";break}a++}return s.pop(),s};ne.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,n=e.length,s=Math.ceil((r+n)/2),a=s,i=2*s,l=new Array(i),c=new Array(i),u=0;u<i;u++)l[u]=-1,c[u]=-1;l[a+1]=0,c[a+1]=0;for(var d=r-n,m=d%2!=0,x=0,h=0,_=0,b=0,v=0;v<s&&!(new Date().getTime()>t);v++){for(var D=-v+x;D<=v-h;D+=2){var B=a+D,A;D==-v||D!=v&&l[B-1]<l[B+1]?A=l[B+1]:A=l[B-1]+1;for(var F=A-D;A<r&&F<n&&o.charAt(A)==e.charAt(F);)A++,F++;if(l[B]=A,A>r)h+=2;else if(F>n)x+=2;else if(m){var O=a+d-D;if(O>=0&&O<i&&c[O]!=-1){var M=r-c[O];if(A>=M)return this.diff_bisectSplit_(o,e,A,F,t)}}}for(var E=-v+_;E<=v-b;E+=2){var O=a+E,M;E==-v||E!=v&&c[O-1]<c[O+1]?M=c[O+1]:M=c[O-1]+1;for(var R=M-E;M<r&&R<n&&o.charAt(r-M-1)==e.charAt(n-R-1);)M++,R++;if(c[O]=M,M>r)b+=2;else if(R>n)_+=2;else if(!m){var B=a+d-E;if(B>=0&&B<i&&l[B]!=-1){var A=l[B],F=a+A-B;if(M=r-M,A>=M)return this.diff_bisectSplit_(o,e,A,F,t)}}}}return[new ne.Diff(st,o),new ne.Diff(at,e)]};ne.prototype.diff_bisectSplit_=function(o,e,t,r,n){var s=o.substring(0,t),a=e.substring(0,r),i=o.substring(t),l=e.substring(r),c=this.diff_main(s,a,!1,n),u=this.diff_main(i,l,!1,n);return c.concat(u)};ne.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function n(l){for(var c="",u=0,d=-1,m=t.length;d<l.length-1;){d=l.indexOf(`
`,u),d==-1&&(d=l.length-1);var x=l.substring(u,d+1);(r.hasOwnProperty?r.hasOwnProperty(x):r[x]!==void 0)?c+=String.fromCharCode(r[x]):(m==s&&(x=l.substring(u),d=l.length),c+=String.fromCharCode(m),r[x]=m,t[m++]=x),u=d+1}return c}var s=4e4,a=n(o);s=65535;var i=n(e);return{chars1:a,chars2:i,lineArray:t}};ne.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],n=[],s=0;s<r.length;s++)n[s]=e[r.charCodeAt(s)];o[t][1]=n.join("")}};ne.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(s,n)==e.substring(s,n)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};ne.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(o.length-n,o.length-s)==e.substring(e.length-n,e.length-s)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};ne.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var n=Math.min(t,r);if(o==e)return n;for(var s=0,a=1;;){var i=o.substring(n-a),l=e.indexOf(i);if(l==-1)return s;a+=l,(l==0||o.substring(n-a)==e.substring(0,a))&&(s=a,a++)}};ne.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var n=this;function s(h,_,b){for(var v=h.substring(b,b+Math.floor(h.length/4)),D=-1,B="",A,F,O,M;(D=_.indexOf(v,D+1))!=-1;){var E=n.diff_commonPrefix(h.substring(b),_.substring(D)),R=n.diff_commonSuffix(h.substring(0,b),_.substring(0,D));B.length<R+E&&(B=_.substring(D-R,D)+_.substring(D,D+E),A=h.substring(0,b-R),F=h.substring(b+E),O=_.substring(0,D-R),M=_.substring(D+E))}return B.length*2>=h.length?[A,F,O,M,B]:null}var a=s(t,r,Math.ceil(t.length/4)),i=s(t,r,Math.ceil(t.length/2)),l;if(!a&&!i)return null;i?a?l=a[4].length>i[4].length?a:i:l=i:l=a;var c,u,d,m;o.length>e.length?(c=l[0],u=l[1],d=l[2],m=l[3]):(d=l[0],m=l[1],c=l[2],u=l[3]);var x=l[4];return[c,u,d,m,x]};ne.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,n=null,s=0,a=0,i=0,l=0,c=0;s<o.length;)o[s][0]==$e?(t[r++]=s,a=l,i=c,l=0,c=0,n=o[s][1]):(o[s][0]==at?l+=o[s][1].length:c+=o[s][1].length,n&&n.length<=Math.max(a,i)&&n.length<=Math.max(l,c)&&(o.splice(t[r-1],0,new ne.Diff(st,n)),o[t[r-1]+1][0]=at,r--,r--,s=r>0?t[r-1]:-1,a=0,i=0,l=0,c=0,n=null,e=!0)),s++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),s=1;s<o.length;){if(o[s-1][0]==st&&o[s][0]==at){var u=o[s-1][1],d=o[s][1],m=this.diff_commonOverlap_(u,d),x=this.diff_commonOverlap_(d,u);m>=x?(m>=u.length/2||m>=d.length/2)&&(o.splice(s,0,new ne.Diff($e,d.substring(0,m))),o[s-1][1]=u.substring(0,u.length-m),o[s+1][1]=d.substring(m),s++):(x>=u.length/2||x>=d.length/2)&&(o.splice(s,0,new ne.Diff($e,u.substring(0,x))),o[s-1][0]=at,o[s-1][1]=d.substring(0,d.length-x),o[s+1][0]=st,o[s+1][1]=u.substring(x),s++),s++}s++}};ne.prototype.diff_cleanupSemanticLossless=function(o){function e(x,h){if(!x||!h)return 6;var _=x.charAt(x.length-1),b=h.charAt(0),v=_.match(ne.nonAlphaNumericRegex_),D=b.match(ne.nonAlphaNumericRegex_),B=v&&_.match(ne.whitespaceRegex_),A=D&&b.match(ne.whitespaceRegex_),F=B&&_.match(ne.linebreakRegex_),O=A&&b.match(ne.linebreakRegex_),M=F&&x.match(ne.blanklineEndRegex_),E=O&&h.match(ne.blanklineStartRegex_);return M||E?5:F||O?4:v&&!B&&A?3:B||A?2:v||D?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==$e&&o[t+1][0]==$e){var r=o[t-1][1],n=o[t][1],s=o[t+1][1],a=this.diff_commonSuffix(r,n);if(a){var i=n.substring(n.length-a);r=r.substring(0,r.length-a),n=i+n.substring(0,n.length-a),s=i+s}for(var l=r,c=n,u=s,d=e(r,n)+e(n,s);n.charAt(0)===s.charAt(0);){r+=n.charAt(0),n=n.substring(1)+s.charAt(0),s=s.substring(1);var m=e(r,n)+e(n,s);m>=d&&(d=m,l=r,c=n,u=s)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=c,u?o[t+1][1]=u:(o.splice(t+1,1),t--))}t++}};ne.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;ne.whitespaceRegex_=/\s/;ne.linebreakRegex_=/[\r\n]/;ne.blanklineEndRegex_=/\n\r?\n$/;ne.blanklineStartRegex_=/^\r?\n\r?\n/;ne.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,n=null,s=0,a=!1,i=!1,l=!1,c=!1;s<o.length;)o[s][0]==$e?(o[s][1].length<this.Diff_EditCost&&(l||c)?(t[r++]=s,a=l,i=c,n=o[s][1]):(r=0,n=null),l=c=!1):(o[s][0]==st?c=!0:l=!0,n&&(a&&i&&l&&c||n.length<this.Diff_EditCost/2&&a+i+l+c==3)&&(o.splice(t[r-1],0,new ne.Diff(st,n)),o[t[r-1]+1][0]=at,r--,n=null,a&&i?(l=c=!0,r=0):(r--,s=r>0?t[r-1]:-1,l=c=!1),e=!0)),s++;e&&this.diff_cleanupMerge(o)};ne.prototype.diff_cleanupMerge=function(o){o.push(new ne.Diff($e,""));for(var e=0,t=0,r=0,n="",s="",a;e<o.length;)switch(o[e][0]){case at:r++,s+=o[e][1],e++;break;case st:t++,n+=o[e][1],e++;break;case $e:t+r>1?(t!==0&&r!==0&&(a=this.diff_commonPrefix(s,n),a!==0&&(e-t-r>0&&o[e-t-r-1][0]==$e?o[e-t-r-1][1]+=s.substring(0,a):(o.splice(0,0,new ne.Diff($e,s.substring(0,a))),e++),s=s.substring(a),n=n.substring(a)),a=this.diff_commonSuffix(s,n),a!==0&&(o[e][1]=s.substring(s.length-a)+o[e][1],s=s.substring(0,s.length-a),n=n.substring(0,n.length-a))),e-=t+r,o.splice(e,t+r),n.length&&(o.splice(e,0,new ne.Diff(st,n)),e++),s.length&&(o.splice(e,0,new ne.Diff(at,s)),e++),e++):e!==0&&o[e-1][0]==$e?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,n="",s="";break}o[o.length-1][1]===""&&o.pop();var i=!1;for(e=1;e<o.length-1;)o[e-1][0]==$e&&o[e+1][0]==$e&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),i=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),i=!0)),e++;i&&this.diff_cleanupMerge(o)};ne.prototype.diff_xIndex=function(o,e){var t=0,r=0,n=0,s=0,a;for(a=0;a<o.length&&(o[a][0]!==at&&(t+=o[a][1].length),o[a][0]!==st&&(r+=o[a][1].length),!(t>e));a++)n=t,s=r;return o.length!=a&&o[a][0]===st?s:s+(e-n)};ne.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,n=/>/g,s=/\n/g,a=0;a<o.length;a++){var i=o[a][0],l=o[a][1],c=l.replace(t,"&amp;").replace(r,"&lt;").replace(n,"&gt;").replace(s,"&para;<br>");switch(i){case at:e[a]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case st:e[a]='<del style="background:#ffe6e6;">'+c+"</del>";break;case $e:e[a]="<span>"+c+"</span>";break}}return e.join("")};ne.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==at&&(e[t]=o[t][1]);return e.join("")};ne.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==st&&(e[t]=o[t][1]);return e.join("")};ne.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,n=0;n<o.length;n++){var s=o[n][0],a=o[n][1];switch(s){case at:t+=a.length;break;case st:r+=a.length;break;case $e:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};ne.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case at:e[t]="+"+encodeURI(o[t][1]);break;case st:e[t]="-"+o[t][1].length;break;case $e:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};ne.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,n=0,s=e.split(/\t/g),a=0;a<s.length;a++){var i=s[a].substring(1);switch(s[a].charAt(0)){case"+":try{t[r++]=new ne.Diff(at,decodeURI(i))}catch(u){throw new Error("Illegal escape in diff_fromDelta: "+i)}break;case"-":case"=":var l=parseInt(i,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+i);var c=o.substring(n,n+=l);s[a].charAt(0)=="="?t[r++]=new ne.Diff($e,c):t[r++]=new ne.Diff(st,c);break;default:if(s[a])throw new Error("Invalid diff operation in diff_fromDelta: "+s[a])}}if(n!=o.length)throw new Error("Delta length ("+n+") does not equal source text length ("+o.length+").");return t};ne.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};ne.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),n=this;function s(A,F){var O=A/e.length,M=Math.abs(t-F);return n.Match_Distance?O+M/n.Match_Distance:M?1:O}var a=this.Match_Threshold,i=o.indexOf(e,t);i!=-1&&(a=Math.min(s(0,i),a),i=o.lastIndexOf(e,t+e.length),i!=-1&&(a=Math.min(s(0,i),a)));var l=1<<e.length-1;i=-1;for(var c,u,d=e.length+o.length,m,x=0;x<e.length;x++){for(c=0,u=d;c<u;)s(x,t+u)<=a?c=u:d=u,u=Math.floor((d-c)/2+c);d=u;var h=Math.max(1,t-u+1),_=Math.min(t+u,o.length)+e.length,b=Array(_+2);b[_+1]=(1<<x)-1;for(var v=_;v>=h;v--){var D=r[o.charAt(v-1)];if(x===0?b[v]=(b[v+1]<<1|1)&D:b[v]=(b[v+1]<<1|1)&D|((m[v+1]|m[v])<<1|1)|m[v+1],b[v]&l){var B=s(x,v-1);if(B<=a)if(a=B,i=v-1,i>t)h=Math.max(1,2*t-i);else break}}if(s(x+1,t)>a)break;m=b}return i};ne.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};ne.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var n=e.substring(o.start2-r,o.start2);n&&o.diffs.unshift(new ne.Diff($e,n));var s=e.substring(o.start2+o.length1,o.start2+o.length1+r);s&&o.diffs.push(new ne.Diff($e,s)),o.start1-=n.length,o.start2-=n.length,o.length1+=n.length+s.length,o.length2+=n.length+s.length}};ne.prototype.patch_make=function(o,e,t){var r,n;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,n=this.diff_main(r,e,!0),n.length>2&&(this.diff_cleanupSemantic(n),this.diff_cleanupEfficiency(n));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")n=o,r=this.diff_text1(n);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,n=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,n=t;else throw new Error("Unknown call format to patch_make.");if(n.length===0)return[];for(var s=[],a=new ne.patch_obj,i=0,l=0,c=0,u=r,d=r,m=0;m<n.length;m++){var x=n[m][0],h=n[m][1];switch(!i&&x!==$e&&(a.start1=l,a.start2=c),x){case at:a.diffs[i++]=n[m],a.length2+=h.length,d=d.substring(0,c)+h+d.substring(c);break;case st:a.length1+=h.length,a.diffs[i++]=n[m],d=d.substring(0,c)+d.substring(c+h.length);break;case $e:h.length<=2*this.Patch_Margin&&i&&n.length!=m+1?(a.diffs[i++]=n[m],a.length1+=h.length,a.length2+=h.length):h.length>=2*this.Patch_Margin&&i&&(this.patch_addContext_(a,u),s.push(a),a=new ne.patch_obj,i=0,u=d,l=c);break}x!==at&&(l+=h.length),x!==st&&(c+=h.length)}return i&&(this.patch_addContext_(a,u),s.push(a)),s};ne.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],n=new ne.patch_obj;n.diffs=[];for(var s=0;s<r.diffs.length;s++)n.diffs[s]=new ne.Diff(r.diffs[s][0],r.diffs[s][1]);n.start1=r.start1,n.start2=r.start2,n.length1=r.length1,n.length2=r.length2,e[t]=n}return e};ne.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,n=[],s=0;s<o.length;s++){var a=o[s].start2+r,i=this.diff_text1(o[s].diffs),l,c=-1;if(i.length>this.Match_MaxBits?(l=this.match_main(e,i.substring(0,this.Match_MaxBits),a),l!=-1&&(c=this.match_main(e,i.substring(i.length-this.Match_MaxBits),a+i.length-this.Match_MaxBits),(c==-1||l>=c)&&(l=-1))):l=this.match_main(e,i,a),l==-1)n[s]=!1,r-=o[s].length2-o[s].length1;else{n[s]=!0,r=l-a;var u;if(c==-1?u=e.substring(l,l+i.length):u=e.substring(l,c+this.Match_MaxBits),i==u)e=e.substring(0,l)+this.diff_text2(o[s].diffs)+e.substring(l+i.length);else{var d=this.diff_main(i,u,!1);if(i.length>this.Match_MaxBits&&this.diff_levenshtein(d)/i.length>this.Patch_DeleteThreshold)n[s]=!1;else{this.diff_cleanupSemanticLossless(d);for(var m=0,x,h=0;h<o[s].diffs.length;h++){var _=o[s].diffs[h];_[0]!==$e&&(x=this.diff_xIndex(d,m)),_[0]===at?e=e.substring(0,l+x)+_[1]+e.substring(l+x):_[0]===st&&(e=e.substring(0,l+x)+e.substring(l+this.diff_xIndex(d,m+_[1].length))),_[0]!==st&&(m+=_[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,n]};ne.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var n=o[0],s=n.diffs;if(s.length==0||s[0][0]!=$e)s.unshift(new ne.Diff($e,t)),n.start1-=e,n.start2-=e,n.length1+=e,n.length2+=e;else if(e>s[0][1].length){var a=e-s[0][1].length;s[0][1]=t.substring(s[0][1].length)+s[0][1],n.start1-=a,n.start2-=a,n.length1+=a,n.length2+=a}if(n=o[o.length-1],s=n.diffs,s.length==0||s[s.length-1][0]!=$e)s.push(new ne.Diff($e,t)),n.length1+=e,n.length2+=e;else if(e>s[s.length-1][1].length){var a=e-s[s.length-1][1].length;s[s.length-1][1]+=t.substring(0,a),n.length1+=a,n.length2+=a}return t};ne.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var n=r.start1,s=r.start2,a="";r.diffs.length!==0;){var i=new ne.patch_obj,l=!0;for(i.start1=n-a.length,i.start2=s-a.length,a!==""&&(i.length1=i.length2=a.length,i.diffs.push(new ne.Diff($e,a)));r.diffs.length!==0&&i.length1<e-this.Patch_Margin;){var c=r.diffs[0][0],u=r.diffs[0][1];c===at?(i.length2+=u.length,s+=u.length,i.diffs.push(r.diffs.shift()),l=!1):c===st&&i.diffs.length==1&&i.diffs[0][0]==$e&&u.length>2*e?(i.length1+=u.length,n+=u.length,l=!1,i.diffs.push(new ne.Diff(c,u)),r.diffs.shift()):(u=u.substring(0,e-i.length1-this.Patch_Margin),i.length1+=u.length,n+=u.length,c===$e?(i.length2+=u.length,s+=u.length):l=!1,i.diffs.push(new ne.Diff(c,u)),u==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(u.length))}a=this.diff_text2(i.diffs),a=a.substring(a.length-this.Patch_Margin);var d=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);d!==""&&(i.length1+=d.length,i.length2+=d.length,i.diffs.length!==0&&i.diffs[i.diffs.length-1][0]===$e?i.diffs[i.diffs.length-1][1]+=d:i.diffs.push(new ne.Diff($e,d))),l||o.splice(++t,0,i)}}};ne.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};ne.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var s=t[r].match(n);if(!s)throw new Error("Invalid patch string: "+t[r]);var a=new ne.patch_obj;for(e.push(a),a.start1=parseInt(s[1],10),s[2]===""?(a.start1--,a.length1=1):s[2]=="0"?a.length1=0:(a.start1--,a.length1=parseInt(s[2],10)),a.start2=parseInt(s[3],10),s[4]===""?(a.start2--,a.length2=1):s[4]=="0"?a.length2=0:(a.start2--,a.length2=parseInt(s[4],10)),r++;r<t.length;){var i=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(c){throw new Error("Illegal escape in patch_fromText: "+l)}if(i=="-")a.diffs.push(new ne.Diff(st,l));else if(i=="+")a.diffs.push(new ne.Diff(at,l));else if(i==" ")a.diffs.push(new ne.Diff($e,l));else{if(i=="@")break;if(i!=="")throw new Error('Invalid patch mode "'+i+'" in: '+l)}r++}}return e};ne.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};ne.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case at:r="+";break;case st:r="-";break;case $e:r=" ";break}t[n+1]=r+encodeURI(this.diffs[n][1])+`
`}return t.join("").replace(/%20/g," ")};zs.exports=ne;zs.exports.diff_match_patch=ne;zs.exports.DIFF_DELETE=st;zs.exports.DIFF_INSERT=at;zs.exports.DIFF_EQUAL=$e});var dy=wi((I8,uy)=>{var iy=require("url").parse,Z2=require("events"),eT=require("https"),tT=require("http"),rT=require("util"),oT=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],cy=[239,187,191],nT=58,sT=32,ly=10,aT=13,fy=1024*256,iT=/^(cookie|authorization)$/i;function lT(o){return cy.every(function(e,t){return o[t]===e})}function yt(o,e){var t=yt.CONNECTING,r=e&&e.headers,n=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var s=this;s.reconnectInterval=1e3,s.connectionInProgress=!1;function a(b){t!==yt.CLOSED&&(t=yt.CONNECTING,h("error",new Ga("error",{message:b})),m&&(o=m,m=null,n=!1),setTimeout(function(){t!==yt.CONNECTING||s.connectionInProgress||(s.connectionInProgress=!0,x())},s.reconnectInterval))}var i,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var c=!1,u="",d="",m=null;function x(){var b=iy(o),v=b.protocol==="https:";if(b.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(b.headers["Last-Event-ID"]=l),r){var D=n?cT(r):r;for(var B in D){var A=D[B];A&&(b.headers[B]=A)}}b.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(b.createConnection=e.createConnection);var F=e&&e.proxy;if(F){var O=iy(e.proxy);v=O.protocol==="https:",b.protocol=v?"https:":"http:",b.path=o,b.headers.Host=b.host,b.hostname=O.hostname,b.host=O.host,b.port=O.port}if(e&&e.https){for(var M in e.https)if(oT.indexOf(M)!==-1){var E=e.https[M];E!==void 0&&(b[M]=E)}}e&&e.withCredentials!==void 0&&(b.withCredentials=e.withCredentials),i=(v?eT:tT).request(b,function(R){if(s.connectionInProgress=!1,R.statusCode===500||R.statusCode===502||R.statusCode===503||R.statusCode===504){h("error",new Ga("error",{status:R.statusCode,message:R.statusMessage})),a();return}if(R.statusCode===301||R.statusCode===302||R.statusCode===307){var G=R.headers.location;if(!G){h("error",new Ga("error",{status:R.statusCode,message:R.statusMessage}));return}var le=new URL(o).origin,j=new URL(G).origin;n=le!==j,R.statusCode===307&&(m=o),o=G,process.nextTick(x);return}if(R.statusCode!==200)return h("error",new Ga("error",{status:R.statusCode,message:R.statusMessage})),s.close();t=yt.OPEN,R.on("close",function(){R.removeAllListeners("close"),R.removeAllListeners("end"),a()}),R.on("end",function(){R.removeAllListeners("close"),R.removeAllListeners("end"),a()}),h("open",new Ga("open"));var ae,V,Z=0,Ee=-1,Re=0,Pe=0;R.on("data",function(Ke){ae?(Ke.length>ae.length-Pe&&(Re=ae.length*2+Ke.length,Re>fy&&(Re=ae.length+Ke.length+fy),V=Buffer.alloc(Re),ae.copy(V,0,0,Pe),ae=V),Ke.copy(ae,Pe),Pe+=Ke.length):(ae=Ke,lT(ae)&&(ae=ae.slice(cy.length)),Pe=ae.length);for(var qe=0,fe=Pe;qe<fe;){c&&(ae[qe]===ly&&++qe,c=!1);for(var Ce=-1,te=Ee,ze,kt=Z;Ce<0&&kt<fe;++kt)ze=ae[kt],ze===nT?te<0&&(te=kt-qe):ze===aT?(c=!0,Ce=kt-qe):ze===ly&&(Ce=kt-qe);if(Ce<0){Z=fe-qe,Ee=te;break}else Z=0,Ee=-1;_(ae,qe,te,Ce),qe+=Ce+1}qe===fe?(ae=void 0,Pe=0):qe>0&&(ae=ae.slice(qe,Pe),Pe=ae.length)})}),i.on("error",function(R){s.connectionInProgress=!1,a(R.message)}),i.setNoDelay&&i.setNoDelay(!0),i.end()}x();function h(){s.listeners(arguments[0]).length>0&&s.emit.apply(s,arguments)}this._close=function(){t!==yt.CLOSED&&(t=yt.CLOSED,i.abort&&i.abort(),i.xhr&&i.xhr.abort&&i.xhr.abort())};function _(b,v,D,B){if(B===0){if(u.length>0){var A=d||"message";h(A,new fT(A,{data:u.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),u=""}d=void 0}else if(D>0){var F=D<0,O=0,M=b.slice(v,v+(F?B:D)).toString();F?O=B:b[v+D+1]!==sT?O=D+1:O=D+2,v+=O;var E=B-O,R=b.slice(v,v+E).toString();if(M==="data")u+=R+`
`;else if(M==="event")d=R;else if(M==="id")l=R;else if(M==="retry"){var G=parseInt(R,10);Number.isNaN(G)||(s.reconnectInterval=G)}}}}uy.exports=yt;rT.inherits(yt,Z2.EventEmitter);yt.prototype.constructor=yt;["open","error","message"].forEach(function(o){Object.defineProperty(yt.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(yt,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(yt,"OPEN",{enumerable:!0,value:1});Object.defineProperty(yt,"CLOSED",{enumerable:!0,value:2});yt.prototype.CONNECTING=0;yt.prototype.OPEN=1;yt.prototype.CLOSED=2;yt.prototype.close=function(){this._close()};yt.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};yt.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};yt.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function Ga(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function fT(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function cT(o){var e={};for(var t in o)iT.test(t)||(e[t]=o[t]);return e}});var Hy=wi((ap,Ys)=>{(function(o,e){typeof ap=="object"&&typeof Ys!="undefined"?Ys.exports=e():typeof define=="function"&&define.amd?define(e):o.moment=e()})(ap,function(){"use strict";var o;function e(){return o.apply(null,arguments)}function t(f){o=f}function r(f){return f instanceof Array||Object.prototype.toString.call(f)==="[object Array]"}function n(f){return f!=null&&Object.prototype.toString.call(f)==="[object Object]"}function s(f,p){return Object.prototype.hasOwnProperty.call(f,p)}function a(f){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(f).length===0;var p;for(p in f)if(s(f,p))return!1;return!0}function i(f){return f===void 0}function l(f){return typeof f=="number"||Object.prototype.toString.call(f)==="[object Number]"}function c(f){return f instanceof Date||Object.prototype.toString.call(f)==="[object Date]"}function u(f,p){var g=[],y,S=f.length;for(y=0;y<S;++y)g.push(p(f[y],y));return g}function d(f,p){for(var g in p)s(p,g)&&(f[g]=p[g]);return s(p,"toString")&&(f.toString=p.toString),s(p,"valueOf")&&(f.valueOf=p.valueOf),f}function m(f,p,g,y){return dm(f,p,g,y,!0).utc()}function x(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function h(f){return f._pf==null&&(f._pf=x()),f._pf}var _;Array.prototype.some?_=Array.prototype.some:_=function(f){var p=Object(this),g=p.length>>>0,y;for(y=0;y<g;y++)if(y in p&&f.call(this,p[y],y,p))return!0;return!1};function b(f){if(f._isValid==null){var p=h(f),g=_.call(p.parsedDateParts,function(S){return S!=null}),y=!isNaN(f._d.getTime())&&p.overflow<0&&!p.empty&&!p.invalidEra&&!p.invalidMonth&&!p.invalidWeekday&&!p.weekdayMismatch&&!p.nullInput&&!p.invalidFormat&&!p.userInvalidated&&(!p.meridiem||p.meridiem&&g);if(f._strict&&(y=y&&p.charsLeftOver===0&&p.unusedTokens.length===0&&p.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(f))f._isValid=y;else return y}return f._isValid}function v(f){var p=m(NaN);return f!=null?d(h(p),f):h(p).userInvalidated=!0,p}var D=e.momentProperties=[],B=!1;function A(f,p){var g,y,S,U=D.length;if(i(p._isAMomentObject)||(f._isAMomentObject=p._isAMomentObject),i(p._i)||(f._i=p._i),i(p._f)||(f._f=p._f),i(p._l)||(f._l=p._l),i(p._strict)||(f._strict=p._strict),i(p._tzm)||(f._tzm=p._tzm),i(p._isUTC)||(f._isUTC=p._isUTC),i(p._offset)||(f._offset=p._offset),i(p._pf)||(f._pf=h(p)),i(p._locale)||(f._locale=p._locale),U>0)for(g=0;g<U;g++)y=D[g],S=p[y],i(S)||(f[y]=S);return f}function F(f){A(this,f),this._d=new Date(f._d!=null?f._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),B===!1&&(B=!0,e.updateOffset(this),B=!1)}function O(f){return f instanceof F||f!=null&&f._isAMomentObject!=null}function M(f){e.suppressDeprecationWarnings===!1&&typeof console!="undefined"&&console.warn&&console.warn("Deprecation warning: "+f)}function E(f,p){var g=!0;return d(function(){if(e.deprecationHandler!=null&&e.deprecationHandler(null,f),g){var y=[],S,U,q,ke=arguments.length;for(U=0;U<ke;U++){if(S="",typeof arguments[U]=="object"){S+=`
[`+U+"] ";for(q in arguments[0])s(arguments[0],q)&&(S+=q+": "+arguments[0][q]+", ");S=S.slice(0,-2)}else S=arguments[U];y.push(S)}M(f+`
Arguments: `+Array.prototype.slice.call(y).join("")+`
`+new Error().stack),g=!1}return p.apply(this,arguments)},p)}var R={};function G(f,p){e.deprecationHandler!=null&&e.deprecationHandler(f,p),R[f]||(M(p),R[f]=!0)}e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;function le(f){return typeof Function!="undefined"&&f instanceof Function||Object.prototype.toString.call(f)==="[object Function]"}function j(f){var p,g;for(g in f)s(f,g)&&(p=f[g],le(p)?this[g]=p:this["_"+g]=p);this._config=f,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function ae(f,p){var g=d({},f),y;for(y in p)s(p,y)&&(n(f[y])&&n(p[y])?(g[y]={},d(g[y],f[y]),d(g[y],p[y])):p[y]!=null?g[y]=p[y]:delete g[y]);for(y in f)s(f,y)&&!s(p,y)&&n(f[y])&&(g[y]=d({},g[y]));return g}function V(f){f!=null&&this.set(f)}var Z;Object.keys?Z=Object.keys:Z=function(f){var p,g=[];for(p in f)s(f,p)&&g.push(p);return g};var Ee={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function Re(f,p,g){var y=this._calendar[f]||this._calendar.sameElse;return le(y)?y.call(p,g):y}function Pe(f,p,g){var y=""+Math.abs(f),S=p-y.length,U=f>=0;return(U?g?"+":"":"-")+Math.pow(10,Math.max(0,S)).toString().substr(1)+y}var Ke=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,qe=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,fe={},Ce={};function te(f,p,g,y){var S=y;typeof y=="string"&&(S=function(){return this[y]()}),f&&(Ce[f]=S),p&&(Ce[p[0]]=function(){return Pe(S.apply(this,arguments),p[1],p[2])}),g&&(Ce[g]=function(){return this.localeData().ordinal(S.apply(this,arguments),f)})}function ze(f){return f.match(/\[[\s\S]/)?f.replace(/^\[|\]$/g,""):f.replace(/\\/g,"")}function kt(f){var p=f.match(Ke),g,y;for(g=0,y=p.length;g<y;g++)Ce[p[g]]?p[g]=Ce[p[g]]:p[g]=ze(p[g]);return function(S){var U="",q;for(q=0;q<y;q++)U+=le(p[q])?p[q].call(S,f):p[q];return U}}function Oe(f,p){return f.isValid()?(p=pt(p,f.localeData()),fe[p]=fe[p]||kt(p),fe[p](f)):f.localeData().invalidDate()}function pt(f,p){var g=5;function y(S){return p.longDateFormat(S)||S}for(qe.lastIndex=0;g>=0&&qe.test(f);)f=f.replace(qe,y),qe.lastIndex=0,g-=1;return f}var gt={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function Rt(f){var p=this._longDateFormat[f],g=this._longDateFormat[f.toUpperCase()];return p||!g?p:(this._longDateFormat[f]=g.match(Ke).map(function(y){return y==="MMMM"||y==="MM"||y==="DD"||y==="dddd"?y.slice(1):y}).join(""),this._longDateFormat[f])}var Ko="Invalid date";function kr(){return this._invalidDate}var Ur="%d",bo=/\d{1,2}/;function jo(f){return this._ordinal.replace("%d",f)}var Lr={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function Zr(f,p,g,y){var S=this._relativeTime[g];return le(S)?S(f,p,g,y):S.replace(/%d/i,f)}function Yo(f,p){var g=this._relativeTime[f>0?"future":"past"];return le(g)?g(p):g.replace(/%s/i,p)}var sr={};function it(f,p){var g=f.toLowerCase();sr[g]=sr[g+"s"]=sr[p]=f}function vt(f){return typeof f=="string"?sr[f]||sr[f.toLowerCase()]:void 0}function eo(f){var p={},g,y;for(y in f)s(f,y)&&(g=vt(y),g&&(p[g]=f[y]));return p}var pr={};function re(f,p){pr[f]=p}function Ve(f){var p=[],g;for(g in f)s(f,g)&&p.push({unit:g,priority:pr[g]});return p.sort(function(y,S){return y.priority-S.priority}),p}function K(f){return f%4===0&&f%100!==0||f%400===0}function be(f){return f<0?Math.ceil(f)||0:Math.floor(f)}function ce(f){var p=+f,g=0;return p!==0&&isFinite(p)&&(g=be(p)),g}function Je(f,p){return function(g){return g!=null?(zt(this,f,g),e.updateOffset(this,p),this):Xe(this,f)}}function Xe(f,p){return f.isValid()?f._d["get"+(f._isUTC?"UTC":"")+p]():NaN}function zt(f,p,g){f.isValid()&&!isNaN(g)&&(p==="FullYear"&&K(f.year())&&f.month()===1&&f.date()===29?(g=ce(g),f._d["set"+(f._isUTC?"UTC":"")+p](g,f.month(),li(g,f.month()))):f._d["set"+(f._isUTC?"UTC":"")+p](g))}function oi(f){return f=vt(f),le(this[f])?this[f]():this}function Jo(f,p){if(typeof f=="object"){f=eo(f);var g=Ve(f),y,S=g.length;for(y=0;y<S;y++)this[g[y].unit](f[g[y].unit])}else if(f=vt(f),le(this[f]))return this[f](p);return this}var Ot=/\d/,Vt=/\d\d/,bn=/\d{3}/,ar=/\d{4}/,Tt=/[+-]?\d{6}/,tt=/\d\d?/,Ie=/\d\d\d\d?/,xt=/\d\d\d\d\d\d?/,wn=/\d{1,3}/,Sf=/\d{1,4}/,ni=/[+-]?\d{1,6}/,jn=/\d+/,si=/[+-]?\d+/,Zw=/Z|[+-]\d\d:?\d\d/gi,ai=/Z|[+-]\d\d(?::?\d\d)?/gi,e_=/[+-]?\d+(\.\d{1,3})?/,ea=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,ii;ii={};function ue(f,p,g){ii[f]=le(p)?p:function(y,S){return y&&g?g:p}}function t_(f,p){return s(ii,f)?ii[f](p._strict,p._locale):new RegExp(r_(f))}function r_(f){return mr(f.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(p,g,y,S,U){return g||y||S||U}))}function mr(f){return f.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var kf={};function rt(f,p){var g,y=p,S;for(typeof f=="string"&&(f=[f]),l(p)&&(y=function(U,q){q[p]=ce(U)}),S=f.length,g=0;g<S;g++)kf[f[g]]=y}function ta(f,p){rt(f,function(g,y,S,U){S._w=S._w||{},p(g,S._w,S,U)})}function o_(f,p,g){p!=null&&s(kf,f)&&kf[f](p,g._a,g,f)}var qt=0,wo=1,to=2,Lt=3,$r=4,_o=5,_n=6,n_=7,s_=8;function a_(f,p){return(f%p+p)%p}var bt;Array.prototype.indexOf?bt=Array.prototype.indexOf:bt=function(f){var p;for(p=0;p<this.length;++p)if(this[p]===f)return p;return-1};function li(f,p){if(isNaN(f)||isNaN(p))return NaN;var g=a_(p,12);return f+=(p-g)/12,g===1?K(f)?29:28:31-g%7%2}te("M",["MM",2],"Mo",function(){return this.month()+1}),te("MMM",0,0,function(f){return this.localeData().monthsShort(this,f)}),te("MMMM",0,0,function(f){return this.localeData().months(this,f)}),it("month","M"),re("month",8),ue("M",tt),ue("MM",tt,Vt),ue("MMM",function(f,p){return p.monthsShortRegex(f)}),ue("MMMM",function(f,p){return p.monthsRegex(f)}),rt(["M","MM"],function(f,p){p[wo]=ce(f)-1}),rt(["MMM","MMMM"],function(f,p,g,y){var S=g._locale.monthsParse(f,y,g._strict);S!=null?p[wo]=S:h(g).invalidMonth=f});var i_="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Xp="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Qp=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,l_=ea,f_=ea;function c_(f,p){return f?r(this._months)?this._months[f.month()]:this._months[(this._months.isFormat||Qp).test(p)?"format":"standalone"][f.month()]:r(this._months)?this._months:this._months.standalone}function u_(f,p){return f?r(this._monthsShort)?this._monthsShort[f.month()]:this._monthsShort[Qp.test(p)?"format":"standalone"][f.month()]:r(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function d_(f,p,g){var y,S,U,q=f.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],y=0;y<12;++y)U=m([2e3,y]),this._shortMonthsParse[y]=this.monthsShort(U,"").toLocaleLowerCase(),this._longMonthsParse[y]=this.months(U,"").toLocaleLowerCase();return g?p==="MMM"?(S=bt.call(this._shortMonthsParse,q),S!==-1?S:null):(S=bt.call(this._longMonthsParse,q),S!==-1?S:null):p==="MMM"?(S=bt.call(this._shortMonthsParse,q),S!==-1?S:(S=bt.call(this._longMonthsParse,q),S!==-1?S:null)):(S=bt.call(this._longMonthsParse,q),S!==-1?S:(S=bt.call(this._shortMonthsParse,q),S!==-1?S:null))}function p_(f,p,g){var y,S,U;if(this._monthsParseExact)return d_.call(this,f,p,g);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),y=0;y<12;y++){if(S=m([2e3,y]),g&&!this._longMonthsParse[y]&&(this._longMonthsParse[y]=new RegExp("^"+this.months(S,"").replace(".","")+"$","i"),this._shortMonthsParse[y]=new RegExp("^"+this.monthsShort(S,"").replace(".","")+"$","i")),!g&&!this._monthsParse[y]&&(U="^"+this.months(S,"")+"|^"+this.monthsShort(S,""),this._monthsParse[y]=new RegExp(U.replace(".",""),"i")),g&&p==="MMMM"&&this._longMonthsParse[y].test(f))return y;if(g&&p==="MMM"&&this._shortMonthsParse[y].test(f))return y;if(!g&&this._monthsParse[y].test(f))return y}}function Zp(f,p){var g;if(!f.isValid())return f;if(typeof p=="string"){if(/^\d+$/.test(p))p=ce(p);else if(p=f.localeData().monthsParse(p),!l(p))return f}return g=Math.min(f.date(),li(f.year(),p)),f._d["set"+(f._isUTC?"UTC":"")+"Month"](p,g),f}function em(f){return f!=null?(Zp(this,f),e.updateOffset(this,!0),this):Xe(this,"Month")}function m_(){return li(this.year(),this.month())}function h_(f){return this._monthsParseExact?(s(this,"_monthsRegex")||tm.call(this),f?this._monthsShortStrictRegex:this._monthsShortRegex):(s(this,"_monthsShortRegex")||(this._monthsShortRegex=l_),this._monthsShortStrictRegex&&f?this._monthsShortStrictRegex:this._monthsShortRegex)}function g_(f){return this._monthsParseExact?(s(this,"_monthsRegex")||tm.call(this),f?this._monthsStrictRegex:this._monthsRegex):(s(this,"_monthsRegex")||(this._monthsRegex=f_),this._monthsStrictRegex&&f?this._monthsStrictRegex:this._monthsRegex)}function tm(){function f(q,ke){return ke.length-q.length}var p=[],g=[],y=[],S,U;for(S=0;S<12;S++)U=m([2e3,S]),p.push(this.monthsShort(U,"")),g.push(this.months(U,"")),y.push(this.months(U,"")),y.push(this.monthsShort(U,""));for(p.sort(f),g.sort(f),y.sort(f),S=0;S<12;S++)p[S]=mr(p[S]),g[S]=mr(g[S]);for(S=0;S<24;S++)y[S]=mr(y[S]);this._monthsRegex=new RegExp("^("+y.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+g.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+p.join("|")+")","i")}te("Y",0,0,function(){var f=this.year();return f<=9999?Pe(f,4):"+"+f}),te(0,["YY",2],0,function(){return this.year()%100}),te(0,["YYYY",4],0,"year"),te(0,["YYYYY",5],0,"year"),te(0,["YYYYYY",6,!0],0,"year"),it("year","y"),re("year",1),ue("Y",si),ue("YY",tt,Vt),ue("YYYY",Sf,ar),ue("YYYYY",ni,Tt),ue("YYYYYY",ni,Tt),rt(["YYYYY","YYYYYY"],qt),rt("YYYY",function(f,p){p[qt]=f.length===2?e.parseTwoDigitYear(f):ce(f)}),rt("YY",function(f,p){p[qt]=e.parseTwoDigitYear(f)}),rt("Y",function(f,p){p[qt]=parseInt(f,10)});function ra(f){return K(f)?366:365}e.parseTwoDigitYear=function(f){return ce(f)+(ce(f)>68?1900:2e3)};var rm=Je("FullYear",!0);function x_(){return K(this.year())}function y_(f,p,g,y,S,U,q){var ke;return f<100&&f>=0?(ke=new Date(f+400,p,g,y,S,U,q),isFinite(ke.getFullYear())&&ke.setFullYear(f)):ke=new Date(f,p,g,y,S,U,q),ke}function oa(f){var p,g;return f<100&&f>=0?(g=Array.prototype.slice.call(arguments),g[0]=f+400,p=new Date(Date.UTC.apply(null,g)),isFinite(p.getUTCFullYear())&&p.setUTCFullYear(f)):p=new Date(Date.UTC.apply(null,arguments)),p}function fi(f,p,g){var y=7+p-g,S=(7+oa(f,0,y).getUTCDay()-p)%7;return-S+y-1}function om(f,p,g,y,S){var U=(7+g-y)%7,q=fi(f,y,S),ke=1+7*(p-1)+U+q,Be,ot;return ke<=0?(Be=f-1,ot=ra(Be)+ke):ke>ra(f)?(Be=f+1,ot=ke-ra(f)):(Be=f,ot=ke),{year:Be,dayOfYear:ot}}function na(f,p,g){var y=fi(f.year(),p,g),S=Math.floor((f.dayOfYear()-y-1)/7)+1,U,q;return S<1?(q=f.year()-1,U=S+vo(q,p,g)):S>vo(f.year(),p,g)?(U=S-vo(f.year(),p,g),q=f.year()+1):(q=f.year(),U=S),{week:U,year:q}}function vo(f,p,g){var y=fi(f,p,g),S=fi(f+1,p,g);return(ra(f)-y+S)/7}te("w",["ww",2],"wo","week"),te("W",["WW",2],"Wo","isoWeek"),it("week","w"),it("isoWeek","W"),re("week",5),re("isoWeek",5),ue("w",tt),ue("ww",tt,Vt),ue("W",tt),ue("WW",tt,Vt),ta(["w","ww","W","WW"],function(f,p,g,y){p[y.substr(0,1)]=ce(f)});function b_(f){return na(f,this._week.dow,this._week.doy).week}var w_={dow:0,doy:6};function __(){return this._week.dow}function v_(){return this._week.doy}function S_(f){var p=this.localeData().week(this);return f==null?p:this.add((f-p)*7,"d")}function k_(f){var p=na(this,1,4).week;return f==null?p:this.add((f-p)*7,"d")}te("d",0,"do","day"),te("dd",0,0,function(f){return this.localeData().weekdaysMin(this,f)}),te("ddd",0,0,function(f){return this.localeData().weekdaysShort(this,f)}),te("dddd",0,0,function(f){return this.localeData().weekdays(this,f)}),te("e",0,0,"weekday"),te("E",0,0,"isoWeekday"),it("day","d"),it("weekday","e"),it("isoWeekday","E"),re("day",11),re("weekday",11),re("isoWeekday",11),ue("d",tt),ue("e",tt),ue("E",tt),ue("dd",function(f,p){return p.weekdaysMinRegex(f)}),ue("ddd",function(f,p){return p.weekdaysShortRegex(f)}),ue("dddd",function(f,p){return p.weekdaysRegex(f)}),ta(["dd","ddd","dddd"],function(f,p,g,y){var S=g._locale.weekdaysParse(f,y,g._strict);S!=null?p.d=S:h(g).invalidWeekday=f}),ta(["d","e","E"],function(f,p,g,y){p[y]=ce(f)});function L_(f,p){return typeof f!="string"?f:isNaN(f)?(f=p.weekdaysParse(f),typeof f=="number"?f:null):parseInt(f,10)}function I_(f,p){return typeof f=="string"?p.weekdaysParse(f)%7||7:isNaN(f)?null:f}function Lf(f,p){return f.slice(p,7).concat(f.slice(0,p))}var C_="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),nm="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),T_="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),P_=ea,D_=ea,A_=ea;function E_(f,p){var g=r(this._weekdays)?this._weekdays:this._weekdays[f&&f!==!0&&this._weekdays.isFormat.test(p)?"format":"standalone"];return f===!0?Lf(g,this._week.dow):f?g[f.day()]:g}function M_(f){return f===!0?Lf(this._weekdaysShort,this._week.dow):f?this._weekdaysShort[f.day()]:this._weekdaysShort}function F_(f){return f===!0?Lf(this._weekdaysMin,this._week.dow):f?this._weekdaysMin[f.day()]:this._weekdaysMin}function R_(f,p,g){var y,S,U,q=f.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],y=0;y<7;++y)U=m([2e3,1]).day(y),this._minWeekdaysParse[y]=this.weekdaysMin(U,"").toLocaleLowerCase(),this._shortWeekdaysParse[y]=this.weekdaysShort(U,"").toLocaleLowerCase(),this._weekdaysParse[y]=this.weekdays(U,"").toLocaleLowerCase();return g?p==="dddd"?(S=bt.call(this._weekdaysParse,q),S!==-1?S:null):p==="ddd"?(S=bt.call(this._shortWeekdaysParse,q),S!==-1?S:null):(S=bt.call(this._minWeekdaysParse,q),S!==-1?S:null):p==="dddd"?(S=bt.call(this._weekdaysParse,q),S!==-1||(S=bt.call(this._shortWeekdaysParse,q),S!==-1)?S:(S=bt.call(this._minWeekdaysParse,q),S!==-1?S:null)):p==="ddd"?(S=bt.call(this._shortWeekdaysParse,q),S!==-1||(S=bt.call(this._weekdaysParse,q),S!==-1)?S:(S=bt.call(this._minWeekdaysParse,q),S!==-1?S:null)):(S=bt.call(this._minWeekdaysParse,q),S!==-1||(S=bt.call(this._weekdaysParse,q),S!==-1)?S:(S=bt.call(this._shortWeekdaysParse,q),S!==-1?S:null))}function O_(f,p,g){var y,S,U;if(this._weekdaysParseExact)return R_.call(this,f,p,g);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),y=0;y<7;y++){if(S=m([2e3,1]).day(y),g&&!this._fullWeekdaysParse[y]&&(this._fullWeekdaysParse[y]=new RegExp("^"+this.weekdays(S,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[y]=new RegExp("^"+this.weekdaysShort(S,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[y]=new RegExp("^"+this.weekdaysMin(S,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[y]||(U="^"+this.weekdays(S,"")+"|^"+this.weekdaysShort(S,"")+"|^"+this.weekdaysMin(S,""),this._weekdaysParse[y]=new RegExp(U.replace(".",""),"i")),g&&p==="dddd"&&this._fullWeekdaysParse[y].test(f))return y;if(g&&p==="ddd"&&this._shortWeekdaysParse[y].test(f))return y;if(g&&p==="dd"&&this._minWeekdaysParse[y].test(f))return y;if(!g&&this._weekdaysParse[y].test(f))return y}}function U_(f){if(!this.isValid())return f!=null?this:NaN;var p=this._isUTC?this._d.getUTCDay():this._d.getDay();return f!=null?(f=L_(f,this.localeData()),this.add(f-p,"d")):p}function $_(f){if(!this.isValid())return f!=null?this:NaN;var p=(this.day()+7-this.localeData()._week.dow)%7;return f==null?p:this.add(f-p,"d")}function B_(f){if(!this.isValid())return f!=null?this:NaN;if(f!=null){var p=I_(f,this.localeData());return this.day(this.day()%7?p:p-7)}else return this.day()||7}function N_(f){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||If.call(this),f?this._weekdaysStrictRegex:this._weekdaysRegex):(s(this,"_weekdaysRegex")||(this._weekdaysRegex=P_),this._weekdaysStrictRegex&&f?this._weekdaysStrictRegex:this._weekdaysRegex)}function H_(f){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||If.call(this),f?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(s(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=D_),this._weekdaysShortStrictRegex&&f?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function z_(f){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||If.call(this),f?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(s(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=A_),this._weekdaysMinStrictRegex&&f?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function If(){function f(Kt,Co){return Co.length-Kt.length}var p=[],g=[],y=[],S=[],U,q,ke,Be,ot;for(U=0;U<7;U++)q=m([2e3,1]).day(U),ke=mr(this.weekdaysMin(q,"")),Be=mr(this.weekdaysShort(q,"")),ot=mr(this.weekdays(q,"")),p.push(ke),g.push(Be),y.push(ot),S.push(ke),S.push(Be),S.push(ot);p.sort(f),g.sort(f),y.sort(f),S.sort(f),this._weekdaysRegex=new RegExp("^("+S.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+y.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+g.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+p.join("|")+")","i")}function Cf(){return this.hours()%12||12}function V_(){return this.hours()||24}te("H",["HH",2],0,"hour"),te("h",["hh",2],0,Cf),te("k",["kk",2],0,V_),te("hmm",0,0,function(){return""+Cf.apply(this)+Pe(this.minutes(),2)}),te("hmmss",0,0,function(){return""+Cf.apply(this)+Pe(this.minutes(),2)+Pe(this.seconds(),2)}),te("Hmm",0,0,function(){return""+this.hours()+Pe(this.minutes(),2)}),te("Hmmss",0,0,function(){return""+this.hours()+Pe(this.minutes(),2)+Pe(this.seconds(),2)});function sm(f,p){te(f,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),p)})}sm("a",!0),sm("A",!1),it("hour","h"),re("hour",13);function am(f,p){return p._meridiemParse}ue("a",am),ue("A",am),ue("H",tt),ue("h",tt),ue("k",tt),ue("HH",tt,Vt),ue("hh",tt,Vt),ue("kk",tt,Vt),ue("hmm",Ie),ue("hmmss",xt),ue("Hmm",Ie),ue("Hmmss",xt),rt(["H","HH"],Lt),rt(["k","kk"],function(f,p,g){var y=ce(f);p[Lt]=y===24?0:y}),rt(["a","A"],function(f,p,g){g._isPm=g._locale.isPM(f),g._meridiem=f}),rt(["h","hh"],function(f,p,g){p[Lt]=ce(f),h(g).bigHour=!0}),rt("hmm",function(f,p,g){var y=f.length-2;p[Lt]=ce(f.substr(0,y)),p[$r]=ce(f.substr(y)),h(g).bigHour=!0}),rt("hmmss",function(f,p,g){var y=f.length-4,S=f.length-2;p[Lt]=ce(f.substr(0,y)),p[$r]=ce(f.substr(y,2)),p[_o]=ce(f.substr(S)),h(g).bigHour=!0}),rt("Hmm",function(f,p,g){var y=f.length-2;p[Lt]=ce(f.substr(0,y)),p[$r]=ce(f.substr(y))}),rt("Hmmss",function(f,p,g){var y=f.length-4,S=f.length-2;p[Lt]=ce(f.substr(0,y)),p[$r]=ce(f.substr(y,2)),p[_o]=ce(f.substr(S))});function q_(f){return(f+"").toLowerCase().charAt(0)==="p"}var W_=/[ap]\.?m?\.?/i,G_=Je("Hours",!0);function K_(f,p,g){return f>11?g?"pm":"PM":g?"am":"AM"}var im={calendar:Ee,longDateFormat:gt,invalidDate:Ko,ordinal:Ur,dayOfMonthOrdinalParse:bo,relativeTime:Lr,months:i_,monthsShort:Xp,week:w_,weekdays:C_,weekdaysMin:T_,weekdaysShort:nm,meridiemParse:W_},ct={},sa={},aa;function j_(f,p){var g,y=Math.min(f.length,p.length);for(g=0;g<y;g+=1)if(f[g]!==p[g])return g;return y}function lm(f){return f&&f.toLowerCase().replace("_","-")}function Y_(f){for(var p=0,g,y,S,U;p<f.length;){for(U=lm(f[p]).split("-"),g=U.length,y=lm(f[p+1]),y=y?y.split("-"):null;g>0;){if(S=ci(U.slice(0,g).join("-")),S)return S;if(y&&y.length>=g&&j_(U,y)>=g-1)break;g--}p++}return aa}function J_(f){return f.match("^[^/\\\\]*$")!=null}function ci(f){var p=null,g;if(ct[f]===void 0&&typeof Ys!="undefined"&&Ys&&Ys.exports&&J_(f))try{p=aa._abbr,g=require,g("./locale/"+f),Xo(p)}catch(y){ct[f]=null}return ct[f]}function Xo(f,p){var g;return f&&(i(p)?g=So(f):g=Tf(f,p),g?aa=g:typeof console!="undefined"&&console.warn&&console.warn("Locale "+f+" not found. Did you forget to load it?")),aa._abbr}function Tf(f,p){if(p!==null){var g,y=im;if(p.abbr=f,ct[f]!=null)G("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),y=ct[f]._config;else if(p.parentLocale!=null)if(ct[p.parentLocale]!=null)y=ct[p.parentLocale]._config;else if(g=ci(p.parentLocale),g!=null)y=g._config;else return sa[p.parentLocale]||(sa[p.parentLocale]=[]),sa[p.parentLocale].push({name:f,config:p}),null;return ct[f]=new V(ae(y,p)),sa[f]&&sa[f].forEach(function(S){Tf(S.name,S.config)}),Xo(f),ct[f]}else return delete ct[f],null}function X_(f,p){if(p!=null){var g,y,S=im;ct[f]!=null&&ct[f].parentLocale!=null?ct[f].set(ae(ct[f]._config,p)):(y=ci(f),y!=null&&(S=y._config),p=ae(S,p),y==null&&(p.abbr=f),g=new V(p),g.parentLocale=ct[f],ct[f]=g),Xo(f)}else ct[f]!=null&&(ct[f].parentLocale!=null?(ct[f]=ct[f].parentLocale,f===Xo()&&Xo(f)):ct[f]!=null&&delete ct[f]);return ct[f]}function So(f){var p;if(f&&f._locale&&f._locale._abbr&&(f=f._locale._abbr),!f)return aa;if(!r(f)){if(p=ci(f),p)return p;f=[f]}return Y_(f)}function Q_(){return Z(ct)}function Pf(f){var p,g=f._a;return g&&h(f).overflow===-2&&(p=g[wo]<0||g[wo]>11?wo:g[to]<1||g[to]>li(g[qt],g[wo])?to:g[Lt]<0||g[Lt]>24||g[Lt]===24&&(g[$r]!==0||g[_o]!==0||g[_n]!==0)?Lt:g[$r]<0||g[$r]>59?$r:g[_o]<0||g[_o]>59?_o:g[_n]<0||g[_n]>999?_n:-1,h(f)._overflowDayOfYear&&(p<qt||p>to)&&(p=to),h(f)._overflowWeeks&&p===-1&&(p=n_),h(f)._overflowWeekday&&p===-1&&(p=s_),h(f).overflow=p),f}var Z_=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,ev=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,tv=/Z|[+-]\d\d(?::?\d\d)?/,ui=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],Df=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],rv=/^\/?Date\((-?\d+)/i,ov=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,nv={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function fm(f){var p,g,y=f._i,S=Z_.exec(y)||ev.exec(y),U,q,ke,Be,ot=ui.length,Kt=Df.length;if(S){for(h(f).iso=!0,p=0,g=ot;p<g;p++)if(ui[p][1].exec(S[1])){q=ui[p][0],U=ui[p][2]!==!1;break}if(q==null){f._isValid=!1;return}if(S[3]){for(p=0,g=Kt;p<g;p++)if(Df[p][1].exec(S[3])){ke=(S[2]||" ")+Df[p][0];break}if(ke==null){f._isValid=!1;return}}if(!U&&ke!=null){f._isValid=!1;return}if(S[4])if(tv.exec(S[4]))Be="Z";else{f._isValid=!1;return}f._f=q+(ke||"")+(Be||""),Ef(f)}else f._isValid=!1}function sv(f,p,g,y,S,U){var q=[av(f),Xp.indexOf(p),parseInt(g,10),parseInt(y,10),parseInt(S,10)];return U&&q.push(parseInt(U,10)),q}function av(f){var p=parseInt(f,10);return p<=49?2e3+p:p<=999?1900+p:p}function iv(f){return f.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function lv(f,p,g){if(f){var y=nm.indexOf(f),S=new Date(p[0],p[1],p[2]).getDay();if(y!==S)return h(g).weekdayMismatch=!0,g._isValid=!1,!1}return!0}function fv(f,p,g){if(f)return nv[f];if(p)return 0;var y=parseInt(g,10),S=y%100,U=(y-S)/100;return U*60+S}function cm(f){var p=ov.exec(iv(f._i)),g;if(p){if(g=sv(p[4],p[3],p[2],p[5],p[6],p[7]),!lv(p[1],g,f))return;f._a=g,f._tzm=fv(p[8],p[9],p[10]),f._d=oa.apply(null,f._a),f._d.setUTCMinutes(f._d.getUTCMinutes()-f._tzm),h(f).rfc2822=!0}else f._isValid=!1}function cv(f){var p=rv.exec(f._i);if(p!==null){f._d=new Date(+p[1]);return}if(fm(f),f._isValid===!1)delete f._isValid;else return;if(cm(f),f._isValid===!1)delete f._isValid;else return;f._strict?f._isValid=!1:e.createFromInputFallback(f)}e.createFromInputFallback=E("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(f){f._d=new Date(f._i+(f._useUTC?" UTC":""))});function Yn(f,p,g){return f!=null?f:p!=null?p:g}function uv(f){var p=new Date(e.now());return f._useUTC?[p.getUTCFullYear(),p.getUTCMonth(),p.getUTCDate()]:[p.getFullYear(),p.getMonth(),p.getDate()]}function Af(f){var p,g,y=[],S,U,q;if(!f._d){for(S=uv(f),f._w&&f._a[to]==null&&f._a[wo]==null&&dv(f),f._dayOfYear!=null&&(q=Yn(f._a[qt],S[qt]),(f._dayOfYear>ra(q)||f._dayOfYear===0)&&(h(f)._overflowDayOfYear=!0),g=oa(q,0,f._dayOfYear),f._a[wo]=g.getUTCMonth(),f._a[to]=g.getUTCDate()),p=0;p<3&&f._a[p]==null;++p)f._a[p]=y[p]=S[p];for(;p<7;p++)f._a[p]=y[p]=f._a[p]==null?p===2?1:0:f._a[p];f._a[Lt]===24&&f._a[$r]===0&&f._a[_o]===0&&f._a[_n]===0&&(f._nextDay=!0,f._a[Lt]=0),f._d=(f._useUTC?oa:y_).apply(null,y),U=f._useUTC?f._d.getUTCDay():f._d.getDay(),f._tzm!=null&&f._d.setUTCMinutes(f._d.getUTCMinutes()-f._tzm),f._nextDay&&(f._a[Lt]=24),f._w&&typeof f._w.d!="undefined"&&f._w.d!==U&&(h(f).weekdayMismatch=!0)}}function dv(f){var p,g,y,S,U,q,ke,Be,ot;p=f._w,p.GG!=null||p.W!=null||p.E!=null?(U=1,q=4,g=Yn(p.GG,f._a[qt],na(lt(),1,4).year),y=Yn(p.W,1),S=Yn(p.E,1),(S<1||S>7)&&(Be=!0)):(U=f._locale._week.dow,q=f._locale._week.doy,ot=na(lt(),U,q),g=Yn(p.gg,f._a[qt],ot.year),y=Yn(p.w,ot.week),p.d!=null?(S=p.d,(S<0||S>6)&&(Be=!0)):p.e!=null?(S=p.e+U,(p.e<0||p.e>6)&&(Be=!0)):S=U),y<1||y>vo(g,U,q)?h(f)._overflowWeeks=!0:Be!=null?h(f)._overflowWeekday=!0:(ke=om(g,y,S,U,q),f._a[qt]=ke.year,f._dayOfYear=ke.dayOfYear)}e.ISO_8601=function(){},e.RFC_2822=function(){};function Ef(f){if(f._f===e.ISO_8601){fm(f);return}if(f._f===e.RFC_2822){cm(f);return}f._a=[],h(f).empty=!0;var p=""+f._i,g,y,S,U,q,ke=p.length,Be=0,ot,Kt;for(S=pt(f._f,f._locale).match(Ke)||[],Kt=S.length,g=0;g<Kt;g++)U=S[g],y=(p.match(t_(U,f))||[])[0],y&&(q=p.substr(0,p.indexOf(y)),q.length>0&&h(f).unusedInput.push(q),p=p.slice(p.indexOf(y)+y.length),Be+=y.length),Ce[U]?(y?h(f).empty=!1:h(f).unusedTokens.push(U),o_(U,y,f)):f._strict&&!y&&h(f).unusedTokens.push(U);h(f).charsLeftOver=ke-Be,p.length>0&&h(f).unusedInput.push(p),f._a[Lt]<=12&&h(f).bigHour===!0&&f._a[Lt]>0&&(h(f).bigHour=void 0),h(f).parsedDateParts=f._a.slice(0),h(f).meridiem=f._meridiem,f._a[Lt]=pv(f._locale,f._a[Lt],f._meridiem),ot=h(f).era,ot!==null&&(f._a[qt]=f._locale.erasConvertYear(ot,f._a[qt])),Af(f),Pf(f)}function pv(f,p,g){var y;return g==null?p:f.meridiemHour!=null?f.meridiemHour(p,g):(f.isPM!=null&&(y=f.isPM(g),y&&p<12&&(p+=12),!y&&p===12&&(p=0)),p)}function mv(f){var p,g,y,S,U,q,ke=!1,Be=f._f.length;if(Be===0){h(f).invalidFormat=!0,f._d=new Date(NaN);return}for(S=0;S<Be;S++)U=0,q=!1,p=A({},f),f._useUTC!=null&&(p._useUTC=f._useUTC),p._f=f._f[S],Ef(p),b(p)&&(q=!0),U+=h(p).charsLeftOver,U+=h(p).unusedTokens.length*10,h(p).score=U,ke?U<y&&(y=U,g=p):(y==null||U<y||q)&&(y=U,g=p,q&&(ke=!0));d(f,g||p)}function hv(f){if(!f._d){var p=eo(f._i),g=p.day===void 0?p.date:p.day;f._a=u([p.year,p.month,g,p.hour,p.minute,p.second,p.millisecond],function(y){return y&&parseInt(y,10)}),Af(f)}}function gv(f){var p=new F(Pf(um(f)));return p._nextDay&&(p.add(1,"d"),p._nextDay=void 0),p}function um(f){var p=f._i,g=f._f;return f._locale=f._locale||So(f._l),p===null||g===void 0&&p===""?v({nullInput:!0}):(typeof p=="string"&&(f._i=p=f._locale.preparse(p)),O(p)?new F(Pf(p)):(c(p)?f._d=p:r(g)?mv(f):g?Ef(f):xv(f),b(f)||(f._d=null),f))}function xv(f){var p=f._i;i(p)?f._d=new Date(e.now()):c(p)?f._d=new Date(p.valueOf()):typeof p=="string"?cv(f):r(p)?(f._a=u(p.slice(0),function(g){return parseInt(g,10)}),Af(f)):n(p)?hv(f):l(p)?f._d=new Date(p):e.createFromInputFallback(f)}function dm(f,p,g,y,S){var U={};return(p===!0||p===!1)&&(y=p,p=void 0),(g===!0||g===!1)&&(y=g,g=void 0),(n(f)&&a(f)||r(f)&&f.length===0)&&(f=void 0),U._isAMomentObject=!0,U._useUTC=U._isUTC=S,U._l=g,U._i=f,U._f=p,U._strict=y,gv(U)}function lt(f,p,g,y){return dm(f,p,g,y,!1)}var yv=E("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var f=lt.apply(null,arguments);return this.isValid()&&f.isValid()?f<this?this:f:v()}),bv=E("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var f=lt.apply(null,arguments);return this.isValid()&&f.isValid()?f>this?this:f:v()});function pm(f,p){var g,y;if(p.length===1&&r(p[0])&&(p=p[0]),!p.length)return lt();for(g=p[0],y=1;y<p.length;++y)(!p[y].isValid()||p[y][f](g))&&(g=p[y]);return g}function wv(){var f=[].slice.call(arguments,0);return pm("isBefore",f)}function _v(){var f=[].slice.call(arguments,0);return pm("isAfter",f)}var vv=function(){return Date.now?Date.now():+new Date},ia=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Sv(f){var p,g=!1,y,S=ia.length;for(p in f)if(s(f,p)&&!(bt.call(ia,p)!==-1&&(f[p]==null||!isNaN(f[p]))))return!1;for(y=0;y<S;++y)if(f[ia[y]]){if(g)return!1;parseFloat(f[ia[y]])!==ce(f[ia[y]])&&(g=!0)}return!0}function kv(){return this._isValid}function Lv(){return Br(NaN)}function di(f){var p=eo(f),g=p.year||0,y=p.quarter||0,S=p.month||0,U=p.week||p.isoWeek||0,q=p.day||0,ke=p.hour||0,Be=p.minute||0,ot=p.second||0,Kt=p.millisecond||0;this._isValid=Sv(p),this._milliseconds=+Kt+ot*1e3+Be*6e4+ke*1e3*60*60,this._days=+q+U*7,this._months=+S+y*3+g*12,this._data={},this._locale=So(),this._bubble()}function pi(f){return f instanceof di}function Mf(f){return f<0?Math.round(-1*f)*-1:Math.round(f)}function Iv(f,p,g){var y=Math.min(f.length,p.length),S=Math.abs(f.length-p.length),U=0,q;for(q=0;q<y;q++)(g&&f[q]!==p[q]||!g&&ce(f[q])!==ce(p[q]))&&U++;return U+S}function mm(f,p){te(f,0,0,function(){var g=this.utcOffset(),y="+";return g<0&&(g=-g,y="-"),y+Pe(~~(g/60),2)+p+Pe(~~g%60,2)})}mm("Z",":"),mm("ZZ",""),ue("Z",ai),ue("ZZ",ai),rt(["Z","ZZ"],function(f,p,g){g._useUTC=!0,g._tzm=Ff(ai,f)});var Cv=/([\+\-]|\d\d)/gi;function Ff(f,p){var g=(p||"").match(f),y,S,U;return g===null?null:(y=g[g.length-1]||[],S=(y+"").match(Cv)||["-",0,0],U=+(S[1]*60)+ce(S[2]),U===0?0:S[0]==="+"?U:-U)}function Rf(f,p){var g,y;return p._isUTC?(g=p.clone(),y=(O(f)||c(f)?f.valueOf():lt(f).valueOf())-g.valueOf(),g._d.setTime(g._d.valueOf()+y),e.updateOffset(g,!1),g):lt(f).local()}function Of(f){return-Math.round(f._d.getTimezoneOffset())}e.updateOffset=function(){};function Tv(f,p,g){var y=this._offset||0,S;if(!this.isValid())return f!=null?this:NaN;if(f!=null){if(typeof f=="string"){if(f=Ff(ai,f),f===null)return this}else Math.abs(f)<16&&!g&&(f=f*60);return!this._isUTC&&p&&(S=Of(this)),this._offset=f,this._isUTC=!0,S!=null&&this.add(S,"m"),y!==f&&(!p||this._changeInProgress?ym(this,Br(f-y,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?y:Of(this)}function Pv(f,p){return f!=null?(typeof f!="string"&&(f=-f),this.utcOffset(f,p),this):-this.utcOffset()}function Dv(f){return this.utcOffset(0,f)}function Av(f){return this._isUTC&&(this.utcOffset(0,f),this._isUTC=!1,f&&this.subtract(Of(this),"m")),this}function Ev(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var f=Ff(Zw,this._i);f!=null?this.utcOffset(f):this.utcOffset(0,!0)}return this}function Mv(f){return this.isValid()?(f=f?lt(f).utcOffset():0,(this.utcOffset()-f)%60===0):!1}function Fv(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Rv(){if(!i(this._isDSTShifted))return this._isDSTShifted;var f={},p;return A(f,this),f=um(f),f._a?(p=f._isUTC?m(f._a):lt(f._a),this._isDSTShifted=this.isValid()&&Iv(f._a,p.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function Ov(){return this.isValid()?!this._isUTC:!1}function Uv(){return this.isValid()?this._isUTC:!1}function hm(){return this.isValid()?this._isUTC&&this._offset===0:!1}var $v=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,Bv=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Br(f,p){var g=f,y=null,S,U,q;return pi(f)?g={ms:f._milliseconds,d:f._days,M:f._months}:l(f)||!isNaN(+f)?(g={},p?g[p]=+f:g.milliseconds=+f):(y=$v.exec(f))?(S=y[1]==="-"?-1:1,g={y:0,d:ce(y[to])*S,h:ce(y[Lt])*S,m:ce(y[$r])*S,s:ce(y[_o])*S,ms:ce(Mf(y[_n]*1e3))*S}):(y=Bv.exec(f))?(S=y[1]==="-"?-1:1,g={y:vn(y[2],S),M:vn(y[3],S),w:vn(y[4],S),d:vn(y[5],S),h:vn(y[6],S),m:vn(y[7],S),s:vn(y[8],S)}):g==null?g={}:typeof g=="object"&&("from"in g||"to"in g)&&(q=Nv(lt(g.from),lt(g.to)),g={},g.ms=q.milliseconds,g.M=q.months),U=new di(g),pi(f)&&s(f,"_locale")&&(U._locale=f._locale),pi(f)&&s(f,"_isValid")&&(U._isValid=f._isValid),U}Br.fn=di.prototype,Br.invalid=Lv;function vn(f,p){var g=f&&parseFloat(f.replace(",","."));return(isNaN(g)?0:g)*p}function gm(f,p){var g={};return g.months=p.month()-f.month()+(p.year()-f.year())*12,f.clone().add(g.months,"M").isAfter(p)&&--g.months,g.milliseconds=+p-+f.clone().add(g.months,"M"),g}function Nv(f,p){var g;return f.isValid()&&p.isValid()?(p=Rf(p,f),f.isBefore(p)?g=gm(f,p):(g=gm(p,f),g.milliseconds=-g.milliseconds,g.months=-g.months),g):{milliseconds:0,months:0}}function xm(f,p){return function(g,y){var S,U;return y!==null&&!isNaN(+y)&&(G(p,"moment()."+p+"(period, number) is deprecated. Please use moment()."+p+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),U=g,g=y,y=U),S=Br(g,y),ym(this,S,f),this}}function ym(f,p,g,y){var S=p._milliseconds,U=Mf(p._days),q=Mf(p._months);f.isValid()&&(y=y==null?!0:y,q&&Zp(f,Xe(f,"Month")+q*g),U&&zt(f,"Date",Xe(f,"Date")+U*g),S&&f._d.setTime(f._d.valueOf()+S*g),y&&e.updateOffset(f,U||q))}var Hv=xm(1,"add"),zv=xm(-1,"subtract");function bm(f){return typeof f=="string"||f instanceof String}function Vv(f){return O(f)||c(f)||bm(f)||l(f)||Wv(f)||qv(f)||f===null||f===void 0}function qv(f){var p=n(f)&&!a(f),g=!1,y=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],S,U,q=y.length;for(S=0;S<q;S+=1)U=y[S],g=g||s(f,U);return p&&g}function Wv(f){var p=r(f),g=!1;return p&&(g=f.filter(function(y){return!l(y)&&bm(f)}).length===0),p&&g}function Gv(f){var p=n(f)&&!a(f),g=!1,y=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],S,U;for(S=0;S<y.length;S+=1)U=y[S],g=g||s(f,U);return p&&g}function Kv(f,p){var g=f.diff(p,"days",!0);return g<-6?"sameElse":g<-1?"lastWeek":g<0?"lastDay":g<1?"sameDay":g<2?"nextDay":g<7?"nextWeek":"sameElse"}function jv(f,p){arguments.length===1&&(arguments[0]?Vv(arguments[0])?(f=arguments[0],p=void 0):Gv(arguments[0])&&(p=arguments[0],f=void 0):(f=void 0,p=void 0));var g=f||lt(),y=Rf(g,this).startOf("day"),S=e.calendarFormat(this,y)||"sameElse",U=p&&(le(p[S])?p[S].call(this,g):p[S]);return this.format(U||this.localeData().calendar(S,this,lt(g)))}function Yv(){return new F(this)}function Jv(f,p){var g=O(f)?f:lt(f);return this.isValid()&&g.isValid()?(p=vt(p)||"millisecond",p==="millisecond"?this.valueOf()>g.valueOf():g.valueOf()<this.clone().startOf(p).valueOf()):!1}function Xv(f,p){var g=O(f)?f:lt(f);return this.isValid()&&g.isValid()?(p=vt(p)||"millisecond",p==="millisecond"?this.valueOf()<g.valueOf():this.clone().endOf(p).valueOf()<g.valueOf()):!1}function Qv(f,p,g,y){var S=O(f)?f:lt(f),U=O(p)?p:lt(p);return this.isValid()&&S.isValid()&&U.isValid()?(y=y||"()",(y[0]==="("?this.isAfter(S,g):!this.isBefore(S,g))&&(y[1]===")"?this.isBefore(U,g):!this.isAfter(U,g))):!1}function Zv(f,p){var g=O(f)?f:lt(f),y;return this.isValid()&&g.isValid()?(p=vt(p)||"millisecond",p==="millisecond"?this.valueOf()===g.valueOf():(y=g.valueOf(),this.clone().startOf(p).valueOf()<=y&&y<=this.clone().endOf(p).valueOf())):!1}function e1(f,p){return this.isSame(f,p)||this.isAfter(f,p)}function t1(f,p){return this.isSame(f,p)||this.isBefore(f,p)}function r1(f,p,g){var y,S,U;if(!this.isValid())return NaN;if(y=Rf(f,this),!y.isValid())return NaN;switch(S=(y.utcOffset()-this.utcOffset())*6e4,p=vt(p),p){case"year":U=mi(this,y)/12;break;case"month":U=mi(this,y);break;case"quarter":U=mi(this,y)/3;break;case"second":U=(this-y)/1e3;break;case"minute":U=(this-y)/6e4;break;case"hour":U=(this-y)/36e5;break;case"day":U=(this-y-S)/864e5;break;case"week":U=(this-y-S)/6048e5;break;default:U=this-y}return g?U:be(U)}function mi(f,p){if(f.date()<p.date())return-mi(p,f);var g=(p.year()-f.year())*12+(p.month()-f.month()),y=f.clone().add(g,"months"),S,U;return p-y<0?(S=f.clone().add(g-1,"months"),U=(p-y)/(y-S)):(S=f.clone().add(g+1,"months"),U=(p-y)/(S-y)),-(g+U)||0}e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function o1(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function n1(f){if(!this.isValid())return null;var p=f!==!0,g=p?this.clone().utc():this;return g.year()<0||g.year()>9999?Oe(g,p?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):le(Date.prototype.toISOString)?p?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",Oe(g,"Z")):Oe(g,p?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function s1(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var f="moment",p="",g,y,S,U;return this.isLocal()||(f=this.utcOffset()===0?"moment.utc":"moment.parseZone",p="Z"),g="["+f+'("]',y=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",S="-MM-DD[T]HH:mm:ss.SSS",U=p+'[")]',this.format(g+y+S+U)}function a1(f){f||(f=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var p=Oe(this,f);return this.localeData().postformat(p)}function i1(f,p){return this.isValid()&&(O(f)&&f.isValid()||lt(f).isValid())?Br({to:this,from:f}).locale(this.locale()).humanize(!p):this.localeData().invalidDate()}function l1(f){return this.from(lt(),f)}function f1(f,p){return this.isValid()&&(O(f)&&f.isValid()||lt(f).isValid())?Br({from:this,to:f}).locale(this.locale()).humanize(!p):this.localeData().invalidDate()}function c1(f){return this.to(lt(),f)}function wm(f){var p;return f===void 0?this._locale._abbr:(p=So(f),p!=null&&(this._locale=p),this)}var _m=E("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(f){return f===void 0?this.localeData():this.locale(f)});function vm(){return this._locale}var hi=1e3,Jn=60*hi,gi=60*Jn,Sm=(365*400+97)*24*gi;function Xn(f,p){return(f%p+p)%p}function km(f,p,g){return f<100&&f>=0?new Date(f+400,p,g)-Sm:new Date(f,p,g).valueOf()}function Lm(f,p,g){return f<100&&f>=0?Date.UTC(f+400,p,g)-Sm:Date.UTC(f,p,g)}function u1(f){var p,g;if(f=vt(f),f===void 0||f==="millisecond"||!this.isValid())return this;switch(g=this._isUTC?Lm:km,f){case"year":p=g(this.year(),0,1);break;case"quarter":p=g(this.year(),this.month()-this.month()%3,1);break;case"month":p=g(this.year(),this.month(),1);break;case"week":p=g(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":p=g(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":p=g(this.year(),this.month(),this.date());break;case"hour":p=this._d.valueOf(),p-=Xn(p+(this._isUTC?0:this.utcOffset()*Jn),gi);break;case"minute":p=this._d.valueOf(),p-=Xn(p,Jn);break;case"second":p=this._d.valueOf(),p-=Xn(p,hi);break}return this._d.setTime(p),e.updateOffset(this,!0),this}function d1(f){var p,g;if(f=vt(f),f===void 0||f==="millisecond"||!this.isValid())return this;switch(g=this._isUTC?Lm:km,f){case"year":p=g(this.year()+1,0,1)-1;break;case"quarter":p=g(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":p=g(this.year(),this.month()+1,1)-1;break;case"week":p=g(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":p=g(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":p=g(this.year(),this.month(),this.date()+1)-1;break;case"hour":p=this._d.valueOf(),p+=gi-Xn(p+(this._isUTC?0:this.utcOffset()*Jn),gi)-1;break;case"minute":p=this._d.valueOf(),p+=Jn-Xn(p,Jn)-1;break;case"second":p=this._d.valueOf(),p+=hi-Xn(p,hi)-1;break}return this._d.setTime(p),e.updateOffset(this,!0),this}function p1(){return this._d.valueOf()-(this._offset||0)*6e4}function m1(){return Math.floor(this.valueOf()/1e3)}function h1(){return new Date(this.valueOf())}function g1(){var f=this;return[f.year(),f.month(),f.date(),f.hour(),f.minute(),f.second(),f.millisecond()]}function x1(){var f=this;return{years:f.year(),months:f.month(),date:f.date(),hours:f.hours(),minutes:f.minutes(),seconds:f.seconds(),milliseconds:f.milliseconds()}}function y1(){return this.isValid()?this.toISOString():null}function b1(){return b(this)}function w1(){return d({},h(this))}function _1(){return h(this).overflow}function v1(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}te("N",0,0,"eraAbbr"),te("NN",0,0,"eraAbbr"),te("NNN",0,0,"eraAbbr"),te("NNNN",0,0,"eraName"),te("NNNNN",0,0,"eraNarrow"),te("y",["y",1],"yo","eraYear"),te("y",["yy",2],0,"eraYear"),te("y",["yyy",3],0,"eraYear"),te("y",["yyyy",4],0,"eraYear"),ue("N",Uf),ue("NN",Uf),ue("NNN",Uf),ue("NNNN",M1),ue("NNNNN",F1),rt(["N","NN","NNN","NNNN","NNNNN"],function(f,p,g,y){var S=g._locale.erasParse(f,y,g._strict);S?h(g).era=S:h(g).invalidEra=f}),ue("y",jn),ue("yy",jn),ue("yyy",jn),ue("yyyy",jn),ue("yo",R1),rt(["y","yy","yyy","yyyy"],qt),rt(["yo"],function(f,p,g,y){var S;g._locale._eraYearOrdinalRegex&&(S=f.match(g._locale._eraYearOrdinalRegex)),g._locale.eraYearOrdinalParse?p[qt]=g._locale.eraYearOrdinalParse(f,S):p[qt]=parseInt(f,10)});function S1(f,p){var g,y,S,U=this._eras||So("en")._eras;for(g=0,y=U.length;g<y;++g){switch(typeof U[g].since){case"string":S=e(U[g].since).startOf("day"),U[g].since=S.valueOf();break}switch(typeof U[g].until){case"undefined":U[g].until=1/0;break;case"string":S=e(U[g].until).startOf("day").valueOf(),U[g].until=S.valueOf();break}}return U}function k1(f,p,g){var y,S,U=this.eras(),q,ke,Be;for(f=f.toUpperCase(),y=0,S=U.length;y<S;++y)if(q=U[y].name.toUpperCase(),ke=U[y].abbr.toUpperCase(),Be=U[y].narrow.toUpperCase(),g)switch(p){case"N":case"NN":case"NNN":if(ke===f)return U[y];break;case"NNNN":if(q===f)return U[y];break;case"NNNNN":if(Be===f)return U[y];break}else if([q,ke,Be].indexOf(f)>=0)return U[y]}function L1(f,p){var g=f.since<=f.until?1:-1;return p===void 0?e(f.since).year():e(f.since).year()+(p-f.offset)*g}function I1(){var f,p,g,y=this.localeData().eras();for(f=0,p=y.length;f<p;++f)if(g=this.clone().startOf("day").valueOf(),y[f].since<=g&&g<=y[f].until||y[f].until<=g&&g<=y[f].since)return y[f].name;return""}function C1(){var f,p,g,y=this.localeData().eras();for(f=0,p=y.length;f<p;++f)if(g=this.clone().startOf("day").valueOf(),y[f].since<=g&&g<=y[f].until||y[f].until<=g&&g<=y[f].since)return y[f].narrow;return""}function T1(){var f,p,g,y=this.localeData().eras();for(f=0,p=y.length;f<p;++f)if(g=this.clone().startOf("day").valueOf(),y[f].since<=g&&g<=y[f].until||y[f].until<=g&&g<=y[f].since)return y[f].abbr;return""}function P1(){var f,p,g,y,S=this.localeData().eras();for(f=0,p=S.length;f<p;++f)if(g=S[f].since<=S[f].until?1:-1,y=this.clone().startOf("day").valueOf(),S[f].since<=y&&y<=S[f].until||S[f].until<=y&&y<=S[f].since)return(this.year()-e(S[f].since).year())*g+S[f].offset;return this.year()}function D1(f){return s(this,"_erasNameRegex")||$f.call(this),f?this._erasNameRegex:this._erasRegex}function A1(f){return s(this,"_erasAbbrRegex")||$f.call(this),f?this._erasAbbrRegex:this._erasRegex}function E1(f){return s(this,"_erasNarrowRegex")||$f.call(this),f?this._erasNarrowRegex:this._erasRegex}function Uf(f,p){return p.erasAbbrRegex(f)}function M1(f,p){return p.erasNameRegex(f)}function F1(f,p){return p.erasNarrowRegex(f)}function R1(f,p){return p._eraYearOrdinalRegex||jn}function $f(){var f=[],p=[],g=[],y=[],S,U,q=this.eras();for(S=0,U=q.length;S<U;++S)p.push(mr(q[S].name)),f.push(mr(q[S].abbr)),g.push(mr(q[S].narrow)),y.push(mr(q[S].name)),y.push(mr(q[S].abbr)),y.push(mr(q[S].narrow));this._erasRegex=new RegExp("^("+y.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+p.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+f.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+g.join("|")+")","i")}te(0,["gg",2],0,function(){return this.weekYear()%100}),te(0,["GG",2],0,function(){return this.isoWeekYear()%100});function xi(f,p){te(0,[f,f.length],0,p)}xi("gggg","weekYear"),xi("ggggg","weekYear"),xi("GGGG","isoWeekYear"),xi("GGGGG","isoWeekYear"),it("weekYear","gg"),it("isoWeekYear","GG"),re("weekYear",1),re("isoWeekYear",1),ue("G",si),ue("g",si),ue("GG",tt,Vt),ue("gg",tt,Vt),ue("GGGG",Sf,ar),ue("gggg",Sf,ar),ue("GGGGG",ni,Tt),ue("ggggg",ni,Tt),ta(["gggg","ggggg","GGGG","GGGGG"],function(f,p,g,y){p[y.substr(0,2)]=ce(f)}),ta(["gg","GG"],function(f,p,g,y){p[y]=e.parseTwoDigitYear(f)});function O1(f){return Im.call(this,f,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function U1(f){return Im.call(this,f,this.isoWeek(),this.isoWeekday(),1,4)}function $1(){return vo(this.year(),1,4)}function B1(){return vo(this.isoWeekYear(),1,4)}function N1(){var f=this.localeData()._week;return vo(this.year(),f.dow,f.doy)}function H1(){var f=this.localeData()._week;return vo(this.weekYear(),f.dow,f.doy)}function Im(f,p,g,y,S){var U;return f==null?na(this,y,S).year:(U=vo(f,y,S),p>U&&(p=U),z1.call(this,f,p,g,y,S))}function z1(f,p,g,y,S){var U=om(f,p,g,y,S),q=oa(U.year,0,U.dayOfYear);return this.year(q.getUTCFullYear()),this.month(q.getUTCMonth()),this.date(q.getUTCDate()),this}te("Q",0,"Qo","quarter"),it("quarter","Q"),re("quarter",7),ue("Q",Ot),rt("Q",function(f,p){p[wo]=(ce(f)-1)*3});function V1(f){return f==null?Math.ceil((this.month()+1)/3):this.month((f-1)*3+this.month()%3)}te("D",["DD",2],"Do","date"),it("date","D"),re("date",9),ue("D",tt),ue("DD",tt,Vt),ue("Do",function(f,p){return f?p._dayOfMonthOrdinalParse||p._ordinalParse:p._dayOfMonthOrdinalParseLenient}),rt(["D","DD"],to),rt("Do",function(f,p){p[to]=ce(f.match(tt)[0])});var Cm=Je("Date",!0);te("DDD",["DDDD",3],"DDDo","dayOfYear"),it("dayOfYear","DDD"),re("dayOfYear",4),ue("DDD",wn),ue("DDDD",bn),rt(["DDD","DDDD"],function(f,p,g){g._dayOfYear=ce(f)});function q1(f){var p=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return f==null?p:this.add(f-p,"d")}te("m",["mm",2],0,"minute"),it("minute","m"),re("minute",14),ue("m",tt),ue("mm",tt,Vt),rt(["m","mm"],$r);var W1=Je("Minutes",!1);te("s",["ss",2],0,"second"),it("second","s"),re("second",15),ue("s",tt),ue("ss",tt,Vt),rt(["s","ss"],_o);var G1=Je("Seconds",!1);te("S",0,0,function(){return~~(this.millisecond()/100)}),te(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),te(0,["SSS",3],0,"millisecond"),te(0,["SSSS",4],0,function(){return this.millisecond()*10}),te(0,["SSSSS",5],0,function(){return this.millisecond()*100}),te(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3}),te(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4}),te(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5}),te(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6}),it("millisecond","ms"),re("millisecond",16),ue("S",wn,Ot),ue("SS",wn,Vt),ue("SSS",wn,bn);var Qo,Tm;for(Qo="SSSS";Qo.length<=9;Qo+="S")ue(Qo,jn);function K1(f,p){p[_n]=ce(("0."+f)*1e3)}for(Qo="S";Qo.length<=9;Qo+="S")rt(Qo,K1);Tm=Je("Milliseconds",!1),te("z",0,0,"zoneAbbr"),te("zz",0,0,"zoneName");function j1(){return this._isUTC?"UTC":""}function Y1(){return this._isUTC?"Coordinated Universal Time":""}var se=F.prototype;se.add=Hv,se.calendar=jv,se.clone=Yv,se.diff=r1,se.endOf=d1,se.format=a1,se.from=i1,se.fromNow=l1,se.to=f1,se.toNow=c1,se.get=oi,se.invalidAt=_1,se.isAfter=Jv,se.isBefore=Xv,se.isBetween=Qv,se.isSame=Zv,se.isSameOrAfter=e1,se.isSameOrBefore=t1,se.isValid=b1,se.lang=_m,se.locale=wm,se.localeData=vm,se.max=bv,se.min=yv,se.parsingFlags=w1,se.set=Jo,se.startOf=u1,se.subtract=zv,se.toArray=g1,se.toObject=x1,se.toDate=h1,se.toISOString=n1,se.inspect=s1,typeof Symbol!="undefined"&&Symbol.for!=null&&(se[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),se.toJSON=y1,se.toString=o1,se.unix=m1,se.valueOf=p1,se.creationData=v1,se.eraName=I1,se.eraNarrow=C1,se.eraAbbr=T1,se.eraYear=P1,se.year=rm,se.isLeapYear=x_,se.weekYear=O1,se.isoWeekYear=U1,se.quarter=se.quarters=V1,se.month=em,se.daysInMonth=m_,se.week=se.weeks=S_,se.isoWeek=se.isoWeeks=k_,se.weeksInYear=N1,se.weeksInWeekYear=H1,se.isoWeeksInYear=$1,se.isoWeeksInISOWeekYear=B1,se.date=Cm,se.day=se.days=U_,se.weekday=$_,se.isoWeekday=B_,se.dayOfYear=q1,se.hour=se.hours=G_,se.minute=se.minutes=W1,se.second=se.seconds=G1,se.millisecond=se.milliseconds=Tm,se.utcOffset=Tv,se.utc=Dv,se.local=Av,se.parseZone=Ev,se.hasAlignedHourOffset=Mv,se.isDST=Fv,se.isLocal=Ov,se.isUtcOffset=Uv,se.isUtc=hm,se.isUTC=hm,se.zoneAbbr=j1,se.zoneName=Y1,se.dates=E("dates accessor is deprecated. Use date instead.",Cm),se.months=E("months accessor is deprecated. Use month instead",em),se.years=E("years accessor is deprecated. Use year instead",rm),se.zone=E("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",Pv),se.isDSTShifted=E("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Rv);function J1(f){return lt(f*1e3)}function X1(){return lt.apply(null,arguments).parseZone()}function Pm(f){return f}var Qe=V.prototype;Qe.calendar=Re,Qe.longDateFormat=Rt,Qe.invalidDate=kr,Qe.ordinal=jo,Qe.preparse=Pm,Qe.postformat=Pm,Qe.relativeTime=Zr,Qe.pastFuture=Yo,Qe.set=j,Qe.eras=S1,Qe.erasParse=k1,Qe.erasConvertYear=L1,Qe.erasAbbrRegex=A1,Qe.erasNameRegex=D1,Qe.erasNarrowRegex=E1,Qe.months=c_,Qe.monthsShort=u_,Qe.monthsParse=p_,Qe.monthsRegex=g_,Qe.monthsShortRegex=h_,Qe.week=b_,Qe.firstDayOfYear=v_,Qe.firstDayOfWeek=__,Qe.weekdays=E_,Qe.weekdaysMin=F_,Qe.weekdaysShort=M_,Qe.weekdaysParse=O_,Qe.weekdaysRegex=N_,Qe.weekdaysShortRegex=H_,Qe.weekdaysMinRegex=z_,Qe.isPM=q_,Qe.meridiem=K_;function yi(f,p,g,y){var S=So(),U=m().set(y,p);return S[g](U,f)}function Dm(f,p,g){if(l(f)&&(p=f,f=void 0),f=f||"",p!=null)return yi(f,p,g,"month");var y,S=[];for(y=0;y<12;y++)S[y]=yi(f,y,g,"month");return S}function Bf(f,p,g,y){typeof f=="boolean"?(l(p)&&(g=p,p=void 0),p=p||""):(p=f,g=p,f=!1,l(p)&&(g=p,p=void 0),p=p||"");var S=So(),U=f?S._week.dow:0,q,ke=[];if(g!=null)return yi(p,(g+U)%7,y,"day");for(q=0;q<7;q++)ke[q]=yi(p,(q+U)%7,y,"day");return ke}function Q1(f,p){return Dm(f,p,"months")}function Z1(f,p){return Dm(f,p,"monthsShort")}function e0(f,p,g){return Bf(f,p,g,"weekdays")}function t0(f,p,g){return Bf(f,p,g,"weekdaysShort")}function r0(f,p,g){return Bf(f,p,g,"weekdaysMin")}Xo("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(f){var p=f%10,g=ce(f%100/10)===1?"th":p===1?"st":p===2?"nd":p===3?"rd":"th";return f+g}}),e.lang=E("moment.lang is deprecated. Use moment.locale instead.",Xo),e.langData=E("moment.langData is deprecated. Use moment.localeData instead.",So);var ko=Math.abs;function o0(){var f=this._data;return this._milliseconds=ko(this._milliseconds),this._days=ko(this._days),this._months=ko(this._months),f.milliseconds=ko(f.milliseconds),f.seconds=ko(f.seconds),f.minutes=ko(f.minutes),f.hours=ko(f.hours),f.months=ko(f.months),f.years=ko(f.years),this}function Am(f,p,g,y){var S=Br(p,g);return f._milliseconds+=y*S._milliseconds,f._days+=y*S._days,f._months+=y*S._months,f._bubble()}function n0(f,p){return Am(this,f,p,1)}function s0(f,p){return Am(this,f,p,-1)}function Em(f){return f<0?Math.floor(f):Math.ceil(f)}function a0(){var f=this._milliseconds,p=this._days,g=this._months,y=this._data,S,U,q,ke,Be;return f>=0&&p>=0&&g>=0||f<=0&&p<=0&&g<=0||(f+=Em(Nf(g)+p)*864e5,p=0,g=0),y.milliseconds=f%1e3,S=be(f/1e3),y.seconds=S%60,U=be(S/60),y.minutes=U%60,q=be(U/60),y.hours=q%24,p+=be(q/24),Be=be(Mm(p)),g+=Be,p-=Em(Nf(Be)),ke=be(g/12),g%=12,y.days=p,y.months=g,y.years=ke,this}function Mm(f){return f*4800/146097}function Nf(f){return f*146097/4800}function i0(f){if(!this.isValid())return NaN;var p,g,y=this._milliseconds;if(f=vt(f),f==="month"||f==="quarter"||f==="year")switch(p=this._days+y/864e5,g=this._months+Mm(p),f){case"month":return g;case"quarter":return g/3;case"year":return g/12}else switch(p=this._days+Math.round(Nf(this._months)),f){case"week":return p/7+y/6048e5;case"day":return p+y/864e5;case"hour":return p*24+y/36e5;case"minute":return p*1440+y/6e4;case"second":return p*86400+y/1e3;case"millisecond":return Math.floor(p*864e5)+y;default:throw new Error("Unknown unit "+f)}}function l0(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+ce(this._months/12)*31536e6:NaN}function Lo(f){return function(){return this.as(f)}}var f0=Lo("ms"),c0=Lo("s"),u0=Lo("m"),d0=Lo("h"),p0=Lo("d"),m0=Lo("w"),h0=Lo("M"),g0=Lo("Q"),x0=Lo("y");function y0(){return Br(this)}function b0(f){return f=vt(f),this.isValid()?this[f+"s"]():NaN}function Sn(f){return function(){return this.isValid()?this._data[f]:NaN}}var w0=Sn("milliseconds"),_0=Sn("seconds"),v0=Sn("minutes"),S0=Sn("hours"),k0=Sn("days"),L0=Sn("months"),I0=Sn("years");function C0(){return be(this.days()/7)}var Io=Math.round,Qn={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function T0(f,p,g,y,S){return S.relativeTime(p||1,!!g,f,y)}function P0(f,p,g,y){var S=Br(f).abs(),U=Io(S.as("s")),q=Io(S.as("m")),ke=Io(S.as("h")),Be=Io(S.as("d")),ot=Io(S.as("M")),Kt=Io(S.as("w")),Co=Io(S.as("y")),Zo=U<=g.ss&&["s",U]||U<g.s&&["ss",U]||q<=1&&["m"]||q<g.m&&["mm",q]||ke<=1&&["h"]||ke<g.h&&["hh",ke]||Be<=1&&["d"]||Be<g.d&&["dd",Be];return g.w!=null&&(Zo=Zo||Kt<=1&&["w"]||Kt<g.w&&["ww",Kt]),Zo=Zo||ot<=1&&["M"]||ot<g.M&&["MM",ot]||Co<=1&&["y"]||["yy",Co],Zo[2]=p,Zo[3]=+f>0,Zo[4]=y,T0.apply(null,Zo)}function D0(f){return f===void 0?Io:typeof f=="function"?(Io=f,!0):!1}function A0(f,p){return Qn[f]===void 0?!1:p===void 0?Qn[f]:(Qn[f]=p,f==="s"&&(Qn.ss=p-1),!0)}function E0(f,p){if(!this.isValid())return this.localeData().invalidDate();var g=!1,y=Qn,S,U;return typeof f=="object"&&(p=f,f=!1),typeof f=="boolean"&&(g=f),typeof p=="object"&&(y=Object.assign({},Qn,p),p.s!=null&&p.ss==null&&(y.ss=p.s-1)),S=this.localeData(),U=P0(this,!g,y,S),g&&(U=S.pastFuture(+this,U)),S.postformat(U)}var Hf=Math.abs;function Zn(f){return(f>0)-(f<0)||+f}function bi(){if(!this.isValid())return this.localeData().invalidDate();var f=Hf(this._milliseconds)/1e3,p=Hf(this._days),g=Hf(this._months),y,S,U,q,ke=this.asSeconds(),Be,ot,Kt,Co;return ke?(y=be(f/60),S=be(y/60),f%=60,y%=60,U=be(g/12),g%=12,q=f?f.toFixed(3).replace(/\.?0+$/,""):"",Be=ke<0?"-":"",ot=Zn(this._months)!==Zn(ke)?"-":"",Kt=Zn(this._days)!==Zn(ke)?"-":"",Co=Zn(this._milliseconds)!==Zn(ke)?"-":"",Be+"P"+(U?ot+U+"Y":"")+(g?ot+g+"M":"")+(p?Kt+p+"D":"")+(S||y||f?"T":"")+(S?Co+S+"H":"")+(y?Co+y+"M":"")+(f?Co+q+"S":"")):"P0D"}var je=di.prototype;je.isValid=kv,je.abs=o0,je.add=n0,je.subtract=s0,je.as=i0,je.asMilliseconds=f0,je.asSeconds=c0,je.asMinutes=u0,je.asHours=d0,je.asDays=p0,je.asWeeks=m0,je.asMonths=h0,je.asQuarters=g0,je.asYears=x0,je.valueOf=l0,je._bubble=a0,je.clone=y0,je.get=b0,je.milliseconds=w0,je.seconds=_0,je.minutes=v0,je.hours=S0,je.days=k0,je.weeks=C0,je.months=L0,je.years=I0,je.humanize=E0,je.toISOString=bi,je.toString=bi,je.toJSON=bi,je.locale=wm,je.localeData=vm,je.toIsoString=E("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",bi),je.lang=_m,te("X",0,0,"unix"),te("x",0,0,"valueOf"),ue("x",si),ue("X",e_),rt("X",function(f,p,g){g._d=new Date(parseFloat(f)*1e3)}),rt("x",function(f,p,g){g._d=new Date(ce(f))});return e.version="2.29.4",t(lt),e.fn=se,e.min=wv,e.max=_v,e.now=vv,e.utc=m,e.unix=J1,e.months=Q1,e.isDate=c,e.locale=Xo,e.invalid=v,e.duration=Br,e.isMoment=O,e.weekdays=e0,e.parseZone=X1,e.localeData=So,e.isDuration=pi,e.monthsShort=Z1,e.weekdaysMin=r0,e.defineLocale=Tf,e.updateLocale=X_,e.locales=Q_,e.weekdaysShort=t0,e.normalizeUnits=vt,e.relativeTimeRounding=D0,e.relativeTimeThreshold=A0,e.calendarFormat=Kv,e.prototype=se,e.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},e})});var AE={};zf(AE,{default:()=>vf});module.exports=B0(AE);var Ft=require("obsidian"),Jw=require("obsidian"),Xw=es(_i());var Pt=()=>new Map,vi=o=>{let e=Pt();return o.forEach((t,r)=>{e.set(r,t)}),e},Nr=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Um=(o,e)=>{let t=[];for(let[r,n]of o)t.push(e(n,r));return t},$m=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var oo=()=>new Set;var Si=o=>o[o.length-1];var Bm=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},Hr=Array.from;var qf=Array.isArray;var ki=class{constructor(){this._observers=Pt()}on(e,t){return Nr(this._observers,e,oo).add(t),t}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Hr((this._observers.get(e)||Pt()).values()).forEach(r=>r(...t))}destroy(){this._observers=Pt()}},rs=class{constructor(){this._observers=Pt()}on(e,t){Nr(this._observers,e,oo).add(t)}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Hr((this._observers.get(e)||Pt()).values()).forEach(r=>r(...t))}destroy(){this._observers=Pt()}};var ir=Math.floor;var os=Math.abs;var ns=(o,e)=>o<e?o:e,zr=(o,e)=>o>e?o:e,RE=Number.isNaN;var Li=o=>o!==0?o<0:1/o<0;var Gf=Number.MAX_SAFE_INTEGER,OE=Number.MIN_SAFE_INTEGER,UE=1<<31;var Nm=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&ir(o)===o),$E=Number.isNaN,BE=Number.parseInt;var H0=String.fromCharCode,NE=String.fromCodePoint,HE=H0(65535),z0=o=>o.toLowerCase(),V0=/^\s*/g,q0=o=>o.replace(V0,""),W0=/([A-Z])/g,Kf=(o,e)=>q0(o.replace(W0,t=>`${e}${z0(t)}`));var G0=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},is=typeof TextEncoder!="undefined"?new TextEncoder:null,K0=o=>is.encode(o),zm=is?K0:G0;var as=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});as&&as.decode(new Uint8Array).length===1&&(as=null);var kn=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},In=()=>new kn;var j0=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var hr=o=>{let e=new Uint8Array(j0(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},Y0=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(zr(t,e)*2),o.cpos=0)},Dt=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var Ci=Dt;var Me=(o,e)=>{for(;e>127;)Dt(o,128|127&e),e=ir(e/128);Dt(o,127&e)},Ti=(o,e)=>{let t=Li(e);for(t&&(e=-e),Dt(o,(e>63?128:0)|(t?64:0)|63&e),e=ir(e/64);e>0;)Dt(o,(e>127?128:0)|127&e),e=ir(e/128)},Yf=new Uint8Array(3e4),J0=Yf.length/3,X0=(o,e)=>{if(e.length<J0){let t=is.encodeInto(e,Yf).written||0;Me(o,t);for(let r=0;r<t;r++)Dt(o,Yf[r])}else At(o,zm(e))},Q0=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Me(o,r);for(let n=0;n<r;n++)Dt(o,t.codePointAt(n))},To=is&&is.encodeInto?X0:Q0;var ua=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=ns(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(zr(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},At=(o,e)=>{Me(o,e.byteLength),ua(o,e)},Jf=(o,e)=>{Y0(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},Z0=(o,e)=>Jf(o,4).setFloat32(0,e,!1),eS=(o,e)=>Jf(o,8).setFloat64(0,e,!1),tS=(o,e)=>Jf(o,8).setBigInt64(0,e,!1);var qm=new DataView(new ArrayBuffer(4)),rS=o=>(qm.setFloat32(0,o),qm.getFloat32(0)===o),fs=(o,e)=>{switch(typeof e){case"string":Dt(o,119),To(o,e);break;case"number":Nm(e)&&os(e)<=2147483647?(Dt(o,125),Ti(o,e)):rS(e)?(Dt(o,124),Z0(o,e)):(Dt(o,123),eS(o,e));break;case"bigint":Dt(o,122),tS(o,e);break;case"object":if(e===null)Dt(o,126);else if(qf(e)){Dt(o,117),Me(o,e.length);for(let t=0;t<e.length;t++)fs(o,e[t])}else if(e instanceof Uint8Array)Dt(o,116),At(o,e);else{Dt(o,118);let t=Object.keys(e);Me(o,t.length);for(let r=0;r<t.length;r++){let n=t[r];To(o,n),fs(o,e[n])}}break;case"boolean":Dt(o,e?120:121);break;default:Dt(o,127)}},ca=class extends kn{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Me(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var Wm=o=>{o.count>0&&(Ti(o.encoder,o.count===1?o.s:-o.s),o.count>1&&Me(o.encoder,o.count-2))},Ln=class{constructor(){this.encoder=new kn,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Wm(this),this.count=1,this.s=e)}toUint8Array(){return Wm(this),hr(this.encoder)}};var Gm=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);Ti(o.encoder,e),o.count>1&&Me(o.encoder,o.count-2)}},cs=class{constructor(){this.encoder=new kn,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Gm(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Gm(this),hr(this.encoder)}},Ii=class{constructor(){this.sarr=[],this.s="",this.lensE=new Ln}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new kn;return this.sarr.push(this.s),this.s="",To(e,this.sarr.join("")),ua(e,this.lensE.toUint8Array()),hr(e)}};var Cr=o=>new Error(o),Vr=()=>{throw Cr("Method unimplemented")},Tr=()=>{throw Cr("Unexpected case")};var Km=Cr("Unexpected end of array"),jm=Cr("Integer out of Range"),us=class{constructor(e){this.arr=e,this.pos=0}},Wr=o=>new us(o),Ym=o=>o.pos!==o.arr.length;var oS=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},Ut=o=>oS(o,De(o));var Cn=o=>o.arr[o.pos++];var De=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&127)*t,t*=128,n<128)return e;if(e>Gf)throw jm}throw Km},Di=o=>{let e=o.arr[o.pos++],t=e&63,r=64,n=(e&64)>0?-1:1;if(!(e&128))return n*t;let s=o.arr.length;for(;o.pos<s;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return n*t;if(t>Gf)throw jm}throw Km};var nS=o=>{let e=De(o);if(e===0)return"";{let t=String.fromCodePoint(Cn(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(Cn(o));else for(;e>0;){let r=e<1e4?e:1e4,n=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,n),e-=r}return decodeURIComponent(escape(t))}},sS=o=>as.decode(Ut(o)),qr=as?sS:nS;var Zf=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},aS=o=>Zf(o,4).getFloat32(0,!1),iS=o=>Zf(o,8).getFloat64(0,!1),lS=o=>Zf(o,8).getBigInt64(0,!1);var fS=[o=>{},o=>null,Di,aS,iS,lS,o=>!1,o=>!0,qr,o=>{let e=De(o),t={};for(let r=0;r<e;r++){let n=qr(o);t[n]=ds(o)}return t},o=>{let e=De(o),t=[];for(let r=0;r<e;r++)t.push(ds(o));return t},Ut],ds=o=>fS[127-Cn(o)](o),da=class extends us{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Ym(this)?this.count=De(this)+1:this.count=-1),this.count--,this.s}};var Tn=class extends us{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Di(this);let e=Li(this.s);this.count=1,e&&(this.s=-this.s,this.count=De(this)+2)}return this.count--,this.s}};var ps=class extends us{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=Di(this),t=e&1;this.diff=ir(e/2),this.count=1,t&&(this.count=De(this)+2)}return this.s+=this.diff,this.count--,this.s}},Pi=class{constructor(e){this.decoder=new Tn(e),this.str=qr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var qE=crypto.subtle,Jm=crypto.getRandomValues.bind(crypto);var pa=()=>Jm(new Uint32Array(1))[0];var cS=[1e7]+-1e3+-4e3+-8e3+-1e11,Ei=()=>cS.replace(/[018]/g,o=>(o^pa()&15>>o/4).toString(16));var Pn=Date.now;var Po=o=>new Promise(o);var uS=Promise.all.bind(Promise);var tc=o=>o===void 0?null:o;var rc=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Zm=new rc,pS=!0;try{typeof localStorage!="undefined"&&localStorage&&(Zm=localStorage,pS=!1)}catch(o){}var eh=Zm;var th=Object.assign,hS=Object.keys,rh=(o,e)=>{for(let t in o)e(o[t],t)};var ma=o=>hS(o).length;var oh=o=>{for(let e in o)return!1;return!0},gS=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},oc=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),nc=(o,e)=>o===e||ma(o)===ma(e)&&gS(o,(t,r)=>(t!==void 0||oc(e,r))&&e[r]===t);var ha=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&ha(o,e,t+1)}};var sh=o=>o,xS=(o,e)=>o===e;var ms=(o,e)=>{if(o==null||e==null)return xS(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!ms(o.get(t),e.get(t)))return!1;break}case Object:if(ma(o)!==ma(e))return!1;for(let t in o)if(!oc(o,t)||!ms(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!ms(o[t],e[t]))return!1;break;default:return!1}return!0},ah=(o,e)=>e.includes(o);var ga=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var KE=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,no,yS=[],bS=()=>{if(no===void 0)if(ga){no=Pt();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&no.set(e,""),e=r):e!==null?(no.set(e,r),e=null):yS.push(r)}e!==null&&no.set(e,"")}else typeof location=="object"?(no=Pt(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");no.set(`--${Kf(e,"-")}`,t),no.set(`-${Kf(e,"-")}`,t)}})):no=Pt();return no},ac=o=>bS().has(o);var ic=o=>ga?tc(process.env[o.toUpperCase().replaceAll("-","_")]):tc(eh.getItem(o));var wS=o=>ac("--"+o)||ic(o)!==null,jE=wS("production"),ih=ga&&ah(process.env.FORCE_COLOR,["true","1","2"]),lh=!ac("no-colors")&&(!ga||process.stdout.isTTY||ih)&&(!ga||ac("color")||ih||ic("COLORTERM")!==null||(ic("TERM")||"").includes("color"));var vS=o=>new Uint8Array(o);var fh=o=>{let e=vS(o.byteLength);return e.set(o),e};var lc=class{constructor(e,t){this.left=e,this.right=t}},jt=(o,e)=>new lc(o,e);var ch=(o,e)=>o.forEach(t=>e(t.left,t.right));var so=typeof document!="undefined"?document:{},kS=o=>so.createElement(o),LS=()=>so.createDocumentFragment(),IS=o=>so.createTextNode(o),YE=typeof DOMParser!="undefined"?new DOMParser:null;var CS=(o,e)=>(ch(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var TS=o=>{let e=LS();for(let t=0;t<o.length;t++)ph(e,o[t]);return e},uh=(o,e)=>(ph(o,TS(e)),o);var xa=(o,e=[],t=[])=>uh(CS(kS(o),e),t);var hs=IS;var dh=o=>Um(o,(e,t)=>`${t}:${e};`).join("");var ph=(o,e)=>o.appendChild(e),JE=so.ELEMENT_NODE,XE=so.TEXT_NODE,QE=so.CDATA_SECTION_NODE,ZE=so.COMMENT_NODE,eM=so.DOCUMENT_NODE,tM=so.DOCUMENT_TYPE_NODE,rM=so.DOCUMENT_FRAGMENT_NODE;var ao=Symbol;var ya=ao(),ba=ao(),cc=ao(),uc=ao(),dc=ao(),wa=ao(),pc=ao(),_a=ao(),mc=ao(),hh=o=>{var n;o.length===1&&((n=o[0])==null?void 0:n.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let s=o[r];s===void 0?e.push("undefined"):s.constructor===String||s.constructor===Number?e.push(s):s.constructor===Object&&t.push(JSON.stringify(s))}return t};var oM=Pn();var AS={[ya]:jt("font-weight","bold"),[ba]:jt("font-weight","normal"),[cc]:jt("color","blue"),[dc]:jt("color","green"),[uc]:jt("color","grey"),[wa]:jt("color","red"),[pc]:jt("color","purple"),[_a]:jt("color","orange"),[mc]:jt("color","black")},ES=o=>{var a;o.length===1&&((a=o[0])==null?void 0:a.constructor)===Function&&(o=o[0]());let e=[],t=[],r=Pt(),n=[],s=0;for(;s<o.length;s++){let i=o[s],l=AS[i];if(l!==void 0)r.set(l.left,l.right);else{if(i===void 0)break;if(i.constructor===String||i.constructor===Number){let c=dh(r);s>0||c.length>0?(e.push("%c"+i),t.push(c)):e.push(i)}else break}}for(s>0&&(n=t,n.unshift(e.join("")));s<o.length;s++){let i=o[s];i instanceof Symbol||n.push(i)}return n},MS=lh?ES:hh,gh=(...o)=>{console.log(...MS(o)),FS.forEach(e=>e.print(o))};var FS=oo();var xh=o=>({[Symbol.iterator](){return this},next:o}),yh=(o,e)=>xh(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),Mi=(o,e)=>xh(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var Sa=class{constructor(e,t){this.clock=e,this.len=t}},Dn=class{constructor(){this.clients=new Map}},Mh=(o,e,t)=>e.clients.forEach((r,n)=>{let s=o.doc.store.clients.get(n);for(let a=0;a<r.length;a++){let i=r[a];zh(o,s,i.clock,i.len,t)}}),BS=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let n=ir((t+r)/2),s=o[n],a=s.clock;if(a<=e){if(e<a+s.len)return n;t=n+1}else r=n-1}return null},Dc=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&BS(t,e.clock)!==null},Ac=o=>{o.clients.forEach(e=>{e.sort((n,s)=>n.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){let n=e[r-1],s=e[t];n.clock+n.len>=s.clock?n.len=zr(n.len,s.clock+s.len-n.clock):(r<t&&(e[r]=s),r++)}e.length=r})},gc=o=>{let e=new Dn;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,n)=>{if(!e.clients.has(n)){let s=r.slice();for(let a=t+1;a<o.length;a++)Bm(s,o[a].clients.get(n)||[]);e.clients.set(n,s)}});return Ac(e),e},Ni=(o,e,t,r)=>{Nr(o.clients,e,()=>[]).push(new Sa(t,r))},Ec=()=>new Dn,NS=o=>{let e=Ec();return o.clients.forEach((t,r)=>{let n=[];for(let s=0;s<t.length;s++){let a=t[s];if(a.deleted){let i=a.id.clock,l=a.length;if(s+1<t.length)for(let c=t[s+1];s+1<t.length&&c.deleted;c=t[++s+1])l+=c.length;n.push(new Sa(i,l))}}n.length>0&&e.clients.set(r,n)}),e},nn=(o,e)=>{Me(o.restEncoder,e.clients.size),Hr(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),Me(o.restEncoder,t);let n=r.length;Me(o.restEncoder,n);for(let s=0;s<n;s++){let a=r[s];o.writeDsClock(a.clock),o.writeDsLen(a.len)}})},ka=o=>{let e=new Dn,t=De(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let n=De(o.restDecoder),s=De(o.restDecoder);if(s>0){let a=Nr(e.clients,n,()=>[]);for(let i=0;i<s;i++)a.push(new Sa(o.readDsClock(),o.readDsLen()))}}return e},_h=(o,e,t)=>{let r=new Dn,n=De(o.restDecoder);for(let s=0;s<n;s++){o.resetDsCurVal();let a=De(o.restDecoder),i=De(o.restDecoder),l=t.clients.get(a)||[],c=St(t,a);for(let u=0;u<i;u++){let d=o.readDsClock(),m=d+o.readDsLen();if(d<c){c<m&&Ni(r,a,c,m-c);let x=lo(l,d),h=l[x];for(!h.deleted&&h.id.clock<d&&(l.splice(x+1,0,Yi(e,h,d-h.id.clock)),x++);x<l.length&&(h=l[x++],h.id.clock<m);)h.deleted||(m<h.id.clock+h.length&&l.splice(x,0,Yi(e,h,m-h.id.clock)),h.delete(e))}else Ni(r,a,d,m-d)}}if(r.clients.size>0){let s=new Do;return Me(s.restEncoder,0),nn(s,r),s.toUint8Array()}return null};var Fh=pa,gr=class extends ki{constructor({guid:e=Ei(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:s=null,autoLoad:a=!1,shouldLoad:i=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=Fh(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new Wi,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=i,this.autoLoad=a,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Po(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});let l=()=>Po(c=>{let u=d=>{(d===void 0||d===!0)&&(this.off("sync",u),c())};this.on("sync",u)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&nt(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Hr(this.subdocs).map(e=>e.guid))}transact(e,t=null){return nt(this,e,t)}get(e,t=It){let r=Nr(this.share,e,()=>{let s=new t;return s._integrate(this,null),s}),n=r.constructor;if(t!==It&&n!==t)if(n===It){let s=new t;s._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=s}),s._start=r._start;for(let a=s._start;a!==null;a=a.right)a.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,io)}getText(e=""){return this.get(e,ln)}getMap(e=""){return this.get(e,Ao)}getXmlElement(e=""){return this.get(e,fn)}getXmlFragment(e=""){return this.get(e,Eo)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){Hr(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new gr({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,nt(e.parent.doc,r=>{let n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},ys=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return De(this.restDecoder)}readDsLen(){return De(this.restDecoder)}},Hi=class extends ys{readLeftID(){return Ne(De(this.restDecoder),De(this.restDecoder))}readRightID(){return Ne(De(this.restDecoder),De(this.restDecoder))}readClient(){return De(this.restDecoder)}readInfo(){return Cn(this.restDecoder)}readString(){return qr(this.restDecoder)}readParentInfo(){return De(this.restDecoder)===1}readTypeRef(){return De(this.restDecoder)}readLen(){return De(this.restDecoder)}readAny(){return ds(this.restDecoder)}readBuf(){return fh(Ut(this.restDecoder))}readJSON(){return JSON.parse(qr(this.restDecoder))}readKey(){return qr(this.restDecoder)}},xc=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=De(this.restDecoder),this.dsCurrVal}readDsLen(){let e=De(this.restDecoder)+1;return this.dsCurrVal+=e,e}},sn=class extends xc{constructor(e){super(e),this.keys=[],De(e),this.keyClockDecoder=new ps(Ut(e)),this.clientDecoder=new Tn(Ut(e)),this.leftClockDecoder=new ps(Ut(e)),this.rightClockDecoder=new ps(Ut(e)),this.infoDecoder=new da(Ut(e),Cn),this.stringDecoder=new Pi(Ut(e)),this.parentInfoDecoder=new da(Ut(e),Cn),this.typeRefDecoder=new Tn(Ut(e)),this.lenDecoder=new Tn(Ut(e))}readLeftID(){return new on(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new on(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ds(this.restDecoder)}readBuf(){return Ut(this.restDecoder)}readJSON(){return ds(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},bs=class{constructor(){this.restEncoder=In()}toUint8Array(){return hr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Me(this.restEncoder,e)}writeDsLen(e){Me(this.restEncoder,e)}},An=class extends bs{writeLeftID(e){Me(this.restEncoder,e.client),Me(this.restEncoder,e.clock)}writeRightID(e){Me(this.restEncoder,e.client),Me(this.restEncoder,e.clock)}writeClient(e){Me(this.restEncoder,e)}writeInfo(e){Ci(this.restEncoder,e)}writeString(e){To(this.restEncoder,e)}writeParentInfo(e){Me(this.restEncoder,e?1:0)}writeTypeRef(e){Me(this.restEncoder,e)}writeLen(e){Me(this.restEncoder,e)}writeAny(e){fs(this.restEncoder,e)}writeBuf(e){At(this.restEncoder,e)}writeJSON(e){To(this.restEncoder,JSON.stringify(e))}writeKey(e){To(this.restEncoder,e)}},zi=class{constructor(){this.restEncoder=In(),this.dsCurrVal=0}toUint8Array(){return hr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,Me(this.restEncoder,t)}writeDsLen(e){e===0&&Tr(),Me(this.restEncoder,e-1),this.dsCurrVal+=e}},Do=class extends zi{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new cs,this.clientEncoder=new Ln,this.leftClockEncoder=new cs,this.rightClockEncoder=new cs,this.infoEncoder=new ca(Ci),this.stringEncoder=new Ii,this.parentInfoEncoder=new ca(Ci),this.typeRefEncoder=new Ln,this.lenEncoder=new Ln}toUint8Array(){let e=In();return Me(e,0),At(e,this.keyClockEncoder.toUint8Array()),At(e,this.clientEncoder.toUint8Array()),At(e,this.leftClockEncoder.toUint8Array()),At(e,this.rightClockEncoder.toUint8Array()),At(e,hr(this.infoEncoder)),At(e,this.stringEncoder.toUint8Array()),At(e,hr(this.parentInfoEncoder)),At(e,this.typeRefEncoder.toUint8Array()),At(e,this.lenEncoder.toUint8Array()),ua(e,hr(this.restEncoder)),hr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){fs(this.restEncoder,e)}writeBuf(e){At(this.restEncoder,e)}writeJSON(e){fs(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},HS=(o,e,t,r)=>{r=zr(r,e[0].id.clock);let n=lo(e,r);Me(o.restEncoder,e.length-n),o.writeClient(t),Me(o.restEncoder,r);let s=e[n];s.write(o,r-s.id.clock);for(let a=n+1;a<e.length;a++)e[a].write(o,0)},Mc=(o,e,t)=>{let r=new Map;t.forEach((n,s)=>{St(e,s)>n&&r.set(s,n)}),Ji(e).forEach((n,s)=>{t.has(s)||r.set(s,0)}),Me(o.restEncoder,r.size),Hr(r.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{HS(o,e.clients.get(n),n,s)})},zS=(o,e)=>{let t=Pt(),r=De(o.restDecoder);for(let n=0;n<r;n++){let s=De(o.restDecoder),a=new Array(s),i=o.readClient(),l=De(o.restDecoder);t.set(i,{i:0,refs:a});for(let c=0;c<s;c++){let u=o.readInfo();switch(31&u){case 0:{let d=o.readLen();a[c]=new lr(Ne(i,l),d),l+=d;break}case 10:{let d=De(o.restDecoder);a[c]=new fr(Ne(i,l),d),l+=d;break}default:{let d=(u&192)===0,m=new ut(Ne(i,l),null,(u&128)===128?o.readLeftID():null,null,(u&64)===64?o.readRightID():null,d?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,d&&(u&32)===32?o.readString():null,ig(o,u));a[c]=m,l+=m.length}}}}return t},VS=(o,e,t)=>{let r=[],n=Hr(t.keys()).sort((x,h)=>x-h);if(n.length===0)return null;let s=()=>{if(n.length===0)return null;let x=t.get(n[n.length-1]);for(;x.refs.length===x.i;)if(n.pop(),n.length>0)x=t.get(n[n.length-1]);else return null;return x},a=s();if(a===null)return null;let i=new Wi,l=new Map,c=(x,h)=>{let _=l.get(x);(_==null||_>h)&&l.set(x,h)},u=a.refs[a.i++],d=new Map,m=()=>{for(let x of r){let h=x.id.client,_=t.get(h);_?(_.i--,i.clients.set(h,_.refs.slice(_.i)),t.delete(h),_.i=0,_.refs=[]):i.clients.set(h,[x]),n=n.filter(b=>b!==h)}r.length=0};for(;;){if(u.constructor!==fr){let h=Nr(d,u.id.client,()=>St(e,u.id.client))-u.id.clock;if(h<0)r.push(u),c(u.id.client,u.id.clock-1),m();else{let _=u.getMissing(o,e);if(_!==null){r.push(u);let b=t.get(_)||{refs:[],i:0};if(b.refs.length===b.i)c(_,St(e,_)),m();else{u=b.refs[b.i++];continue}}else(h===0||h<u.length)&&(u.integrate(o,h),d.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(a!==null&&a.i<a.refs.length)u=a.refs[a.i++];else{if(a=s(),a===null)break;u=a.refs[a.i++]}}if(i.clients.size>0){let x=new Do;return Mc(x,i,new Map),Me(x.restEncoder,0),{missing:l,update:x.toUint8Array()}}return null},qS=(o,e)=>Mc(o,e.doc.store,e.beforeState),WS=(o,e,t,r=new sn(o))=>nt(e,n=>{n.local=!1;let s=!1,a=n.doc,i=a.store,l=zS(r,a),c=VS(n,i,l),u=i.pendingStructs;if(u){for(let[m,x]of u.missing)if(x<St(i,m)){s=!0;break}if(c){for(let[m,x]of c.missing){let h=u.missing.get(m);(h==null||h>x)&&u.missing.set(m,x)}u.update=Gi([u.update,c.update])}}else i.pendingStructs=c;let d=_h(r,n,i);if(i.pendingDs){let m=new sn(Wr(i.pendingDs));De(m.restDecoder);let x=_h(m,n,i);d&&x?i.pendingDs=Gi([d,x]):i.pendingDs=d||x}else i.pendingDs=d;if(s){let m=i.pendingStructs.update;i.pendingStructs=null,Rh(n.doc,m)}},t,!1);var Rh=(o,e,t,r=sn)=>{let n=Wr(e);WS(n,o,t,new r(n))},Fo=(o,e,t)=>Rh(o,e,t,Hi),GS=(o,e,t=new Map)=>{Mc(o,e.store,t),nn(o,NS(e.store))},KS=(o,e=new Uint8Array([0]),t=new Do)=>{let r=Oh(e);GS(t,o,r);let n=[t.toUint8Array()];if(o.store.pendingDs&&n.push(o.store.pendingDs),o.store.pendingStructs&&n.push(ak(o.store.pendingStructs.update,e)),n.length>1){if(t.constructor===An)return nk(n.map((s,a)=>a===0?s:lk(s)));if(t.constructor===Do)return Gi(n)}return n[0]},Rn=(o,e)=>KS(o,e,new An),jS=o=>{let e=new Map,t=De(o.restDecoder);for(let r=0;r<t;r++){let n=De(o.restDecoder),s=De(o.restDecoder);e.set(n,s)}return e},Oh=o=>jS(new ys(Wr(o))),Uh=(o,e)=>(Me(o.restEncoder,e.size),Hr(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{Me(o.restEncoder,t),Me(o.restEncoder,r)}),o),YS=(o,e)=>Uh(o,Ji(e.store)),JS=(o,e=new zi)=>(o instanceof Map?Uh(e,o):YS(e,o),e.toUint8Array()),$h=o=>JS(o,new bs),yc=class{constructor(){this.l=[]}},vh=()=>new yc,Sh=(o,e)=>o.l.push(e),kh=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(n=>e!==n),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Bh=(o,e,t)=>ha(o.l,[e,t]),on=class{constructor(e,t){this.client=e,this.clock=t}},xs=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,Ne=(o,e)=>new on(o,e);var Nh=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw Tr()};var Vi=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let n=(s,a)=>{let i=s.get("ds"),l=s.get("ids"),c=u=>this.clients.set(u,a);i.observe(u=>{u.changes.added.forEach(d=>{d.content.getContent().forEach(m=>{m instanceof Uint8Array&&this.dss.set(a,gc([this.dss.get(a)||Ec(),ka(new ys(Wr(m)))]))})})}),this.dss.set(a,gc(i.map(u=>ka(new ys(Wr(u)))))),l.observe(u=>u.changes.added.forEach(d=>d.content.getContent().forEach(c))),l.forEach(c)};t.observe(s=>{s.keysChanged.forEach(a=>n(t.get(a),a))}),t.forEach(n)}setUserMapping(e,t,r,{filter:n=()=>!0}={}){let s=this.yusers,a=s.get(r);a||(a=new Ao,a.set("ids",new io),a.set("ds",new io),s.set(r,a)),a.get("ids").push([t]),s.observe(i=>{setTimeout(()=>{let l=s.get(r);if(l!==a){a=l,this.clients.forEach((d,m)=>{r===d&&a.get("ids").push([m])});let c=new bs,u=this.dss.get(r);u&&(nn(c,u),a.get("ds").push([c.toUint8Array()]))}},0)}),e.on("afterTransaction",i=>{setTimeout(()=>{let l=a.get("ds"),c=i.deleteSet;if(i.local&&c.clients.size>0&&n(i,c)){let u=new bs;nn(u,c),l.push([u.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(Dc(r,e))return t;return null}},qi=class{constructor(e,t,r,n=0){this.type=e,this.tname=t,this.item=r,this.assoc=n}};var Fc=o=>new qi(o.type==null?null:Ne(o.type.client,o.type.clock),o.tname||null,o.item==null?null:Ne(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),bc=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},XS=(o,e,t=0)=>new bc(o,e,t),Fi=(o,e,t)=>{let r=null,n=null;return o._item===null?n=Nh(o):r=Ne(o._item.id.client,o._item.id.clock),new qi(r,n,e,t)},Rc=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return Fi(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return Fi(o,Ne(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return Fi(o,r.lastId,t);r=r.right}return Fi(o,null,t)};var Oc=(o,e)=>{let t=e.store,r=o.item,n=o.type,s=o.tname,a=o.assoc,i=null,l=0;if(r!==null){if(St(t,r.client)<=r.clock)return null;let c=Eh(t,r),u=c.item;if(!(u instanceof ut))return null;if(i=u.parent,i._item===null||!i._item.deleted){l=u.deleted||!u.countable?0:c.diff+(a>=0?0:1);let d=u.left;for(;d!==null;)!d.deleted&&d.countable&&(l+=d.length),d=d.left}}else{if(s!==null)i=e.get(s);else if(n!==null){if(St(t,n.client)<=n.clock)return null;let{item:c}=Eh(t,n);if(c instanceof ut&&c.content instanceof Dr)i=c.content.type;else return null}else throw Tr();a>=0?l=i._length:l=0}return XS(i,l,o.assoc)},Uc=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&xs(o.item,e.item)&&xs(o.type,e.type)&&o.assoc===e.assoc,wc=class{constructor(e,t){this.ds=e,this.sv=t}};var QS=(o,e)=>new wc(o,e),pM=QS(Ec(),new Map);var gs=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!Dc(e.ds,o.id),_c=(o,e)=>{let t=Nr(o.meta,_c,oo),r=o.doc.store;t.has(e)||(e.sv.forEach((n,s)=>{n<St(r,s)&&an(o,Ne(s,n))}),Mh(o,e.ds,n=>{}),t.add(e))};var Wi=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},Ji=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let n=t[t.length-1];e.set(r,n.id.clock+n.length)}),e},St=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},Hh=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Tr()}t.push(e)},lo=(o,e)=>{let t=0,r=o.length-1,n=o[r],s=n.id.clock;if(s===e)return r;let a=ir(e/(s+n.length-1)*r);for(;t<=r;){if(n=o[a],s=n.id.clock,s<=e){if(e<s+n.length)return a;t=a+1}else r=a-1;a=ir((t+r)/2)}throw Tr()},ZS=(o,e)=>{let t=o.clients.get(e.client);return t[lo(t,e.clock)]},Ui=ZS,vc=(o,e,t)=>{let r=lo(e,t),n=e[r];return n.id.clock<t&&n instanceof ut?(e.splice(r+1,0,Yi(o,n,t-n.id.clock)),r+1):r},an=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[vc(o,t,e.clock)]},Lh=(o,e,t)=>{let r=e.clients.get(t.client),n=lo(r,t.clock),s=r[n];return t.clock!==s.id.clock+s.length-1&&s.constructor!==lr&&r.splice(n+1,0,Yi(o,s,t.clock-s.id.clock+1)),s},ek=(o,e,t)=>{let r=o.clients.get(e.id.client);r[lo(r,e.id.clock)]=t},zh=(o,e,t,r,n)=>{if(r===0)return;let s=t+r,a=vc(o,e,t),i;do i=e[a++],s<i.id.clock+i.length&&vc(o,e,s),n(i);while(a<e.length&&e[a].id.clock<s)},Sc=class{constructor(e,t,r){this.doc=e,this.deleteSet=new Dn,this.beforeState=Ji(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},Ih=(o,e)=>e.deleteSet.clients.size===0&&!$m(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Ac(e.deleteSet),qS(o,e),nn(o,e.deleteSet),!0),Ch=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&Nr(o.changed,e,oo).add(t)},$i=(o,e)=>{let t=o[e],r=o[e-1],n=e;for(;n>0;t=r,r=o[--n-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof ut&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let s=e-n;return s&&o.splice(e+1-s,s),s},tk=(o,e,t)=>{for(let[r,n]of o.clients.entries()){let s=e.clients.get(r);for(let a=n.length-1;a>=0;a--){let i=n[a],l=i.clock+i.len;for(let c=lo(s,i.clock),u=s[c];c<s.length&&u.id.clock<l;u=s[++c]){let d=s[c];if(i.clock+i.len<=d.id.clock)break;d instanceof ut&&d.deleted&&!d.keep&&t(d)&&d.gc(e,!1)}}}},rk=(o,e)=>{o.clients.forEach((t,r)=>{let n=e.clients.get(r);for(let s=t.length-1;s>=0;s--){let a=t[s],i=ns(n.length-1,1+lo(n,a.clock+a.len-1));for(let l=i,c=n[l];l>0&&c.id.clock>=a.clock;c=n[l])l-=1+$i(n,l)}})};var Vh=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,n=r.store,s=t.deleteSet,a=t._mergeStructs;try{Ac(s),t.afterState=Ji(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let i=[];t.changed.forEach((l,c)=>i.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),i.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=c,u._path=null}),l.sort((u,d)=>u.path.length-d.path.length),Bh(c._dEH,l,t))})}),i.push(()=>r.emit("afterTransaction",[t,r])),ha(i,[]),t._needFormattingCleanup&&bk(t)}finally{r.gc&&tk(s,n,r.gcFilter),rk(s,n),t.afterState.forEach((u,d)=>{let m=t.beforeState.get(d)||0;if(m!==u){let x=n.clients.get(d),h=zr(lo(x,m),1);for(let _=x.length-1;_>=h;)_-=1+$i(x,_)}});for(let u=a.length-1;u>=0;u--){let{client:d,clock:m}=a[u].id,x=n.clients.get(d),h=lo(x,m);h+1<x.length&&$i(x,h+1)>1||h>0&&$i(x,h)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(gh(_a,ya,"[yjs] ",ba,wa,"Changed the client-id because another client seems to be using it."),r.clientID=Fh()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let u=new An;Ih(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let u=new Do;Ih(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}let{subdocsAdded:i,subdocsLoaded:l,subdocsRemoved:c}=t;(i.size>0||c.size>0||l.size>0)&&(i.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),c.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:i,removed:c},r,t]),c.forEach(u=>u.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):Vh(o,e+1)}}},nt=(o,e,t=null,r=!0)=>{let n=o._transactionCleanups,s=!1,a=null;o._transaction===null&&(s=!0,o._transaction=new Sc(o,t,r),n.push(o._transaction),n.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{a=e(o._transaction)}finally{if(s){let i=o._transaction===n[0];o._transaction=null,i&&Vh(n,0)}}return a};function*ok(o){let e=De(o.restDecoder);for(let t=0;t<e;t++){let r=De(o.restDecoder),n=o.readClient(),s=De(o.restDecoder);for(let a=0;a<r;a++){let i=o.readInfo();if(i===10){let l=De(o.restDecoder);yield new fr(Ne(n,s),l),s+=l}else if(31&i){let l=(i&192)===0,c=new ut(Ne(n,s),null,(i&128)===128?o.readLeftID():null,null,(i&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(i&32)===32?o.readString():null,ig(o,i));yield c,s+=c.length}else{let l=o.readLen();yield new lr(Ne(n,s),l),s+=l}}}}var La=class{constructor(e,t){this.gen=ok(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===fr);return this.curr}};var Ia=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},nk=o=>Gi(o,Hi,An);var sk=(o,e)=>{if(o.constructor===lr){let{client:t,clock:r}=o.id;return new lr(Ne(t,r+e),o.length-e)}else if(o.constructor===fr){let{client:t,clock:r}=o.id;return new fr(Ne(t,r+e),o.length-e)}else{let t=o,{client:r,clock:n}=t.id;return new ut(Ne(r,n+e),null,Ne(r,n+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},Gi=(o,e=sn,t=Do)=>{if(o.length===1)return o[0];let r=o.map(u=>new e(Wr(u))),n=r.map(u=>new La(u,!0)),s=null,a=new t,i=new Ia(a);for(;n=n.filter(m=>m.curr!==null),n.sort((m,x)=>{if(m.curr.id.client===x.curr.id.client){let h=m.curr.id.clock-x.curr.id.clock;return h===0?m.curr.constructor===x.curr.constructor?0:m.curr.constructor===fr?1:-1:h}else return x.curr.id.client-m.curr.id.client}),n.length!==0;){let u=n[0],d=u.curr.id.client;if(s!==null){let m=u.curr,x=!1;for(;m!==null&&m.id.clock+m.length<=s.struct.id.clock+s.struct.length&&m.id.client>=s.struct.id.client;)m=u.next(),x=!0;if(m===null||m.id.client!==d||x&&m.id.clock>s.struct.id.clock+s.struct.length)continue;if(d!==s.struct.id.client)tn(i,s.struct,s.offset),s={struct:m,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<m.id.clock)if(s.struct.constructor===fr)s.struct.length=m.id.clock+m.length-s.struct.id.clock;else{tn(i,s.struct,s.offset);let h=m.id.clock-s.struct.id.clock-s.struct.length;s={struct:new fr(Ne(d,s.struct.id.clock+s.struct.length),h),offset:0}}else{let h=s.struct.id.clock+s.struct.length-m.id.clock;h>0&&(s.struct.constructor===fr?s.struct.length-=h:m=sk(m,h)),s.struct.mergeWith(m)||(tn(i,s.struct,s.offset),s={struct:m,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let m=u.curr;m!==null&&m.id.client===d&&m.id.clock===s.struct.id.clock+s.struct.length&&m.constructor!==fr;m=u.next())tn(i,s.struct,s.offset),s={struct:m,offset:0}}s!==null&&(tn(i,s.struct,s.offset),s=null),$c(i);let l=r.map(u=>ka(u)),c=gc(l);return nn(a,c),a.toUint8Array()},ak=(o,e,t=sn,r=Do)=>{let n=Oh(e),s=new r,a=new Ia(s),i=new t(Wr(o)),l=new La(i,!1);for(;l.curr;){let u=l.curr,d=u.id.client,m=n.get(d)||0;if(l.curr.constructor===fr){l.next();continue}if(u.id.clock+u.length>m)for(tn(a,u,zr(m-u.id.clock,0)),l.next();l.curr&&l.curr.id.client===d;)tn(a,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===d&&l.curr.id.clock+l.curr.length<=m;)l.next()}$c(a);let c=ka(i);return nn(s,c),s.toUint8Array()};var qh=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:hr(o.encoder.restEncoder)}),o.encoder.restEncoder=In(),o.written=0)},tn=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&qh(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),Me(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},$c=o=>{qh(o);let e=o.encoder.restEncoder;Me(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];Me(e,r.written),ua(e,r.restEncoder)}},ik=(o,e,t,r)=>{let n=new t(Wr(o)),s=new La(n,!1),a=new r,i=new Ia(a);for(let c=s.curr;c!==null;c=s.next())tn(i,e(c),0);$c(i);let l=ka(n);return nn(a,l),a.toUint8Array()};var lk=o=>ik(o,sh,sn,An),Th="You must not compute changes after the event-handler fired.",ws=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=fk(this.currentTarget,this.target))}deletes(e){return Dc(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Cr(Th);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(n=>{if(n!==null){let s=t._map.get(n),a,i;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))a="delete",i=Si(l.content.getContent());else return;else l!==null&&this.deletes(l)?(a="update",i=Si(l.content.getContent())):(a="add",i=void 0)}else if(this.deletes(s))a="delete",i=Si(s.content.getContent());else return;e.set(n,{action:a,oldValue:i})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Cr(Th);let t=this.target,r=oo(),n=oo(),s=[];if(e={added:r,deleted:n,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let i=null,l=()=>{i&&s.push(i)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((i===null||i.delete===void 0)&&(l(),i={delete:0}),i.delete+=c.length,n.add(c)):this.adds(c)?((i===null||i.insert===void 0)&&(l(),i={insert:[]}),i.insert=i.insert.concat(c.content.getContent()),r.add(c)):((i===null||i.retain===void 0)&&(l(),i={retain:0}),i.retain+=c.length);i!==null&&i.retain===void 0&&l()}this._changes=e}return e}},fk=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,n=e._item.parent._start;for(;n!==e._item&&n!==null;)n.deleted||r++,n=n.right;t.unshift(r)}e=e._item.parent}return t},Wh=80,Bc=0,kc=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Bc++}},ck=o=>{o.timestamp=Bc++},Gh=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=Bc++},uk=(o,e,t)=>{if(o.length>=Wh){let r=o.reduce((n,s)=>n.timestamp<s.timestamp?n:s);return Gh(r,e,t),r}else{let r=new kc(e,t);return o.push(r),r}},Xi=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((s,a)=>os(e-s.index)<os(e-a.index)?s:a),r=o._start,n=0;for(t!==null&&(r=t.p,n=t.index,ck(t));r.right!==null&&n<e;){if(!r.deleted&&r.countable){if(e<n+r.length)break;n+=r.length}r=r.right}for(;r.left!==null&&n>e;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);return t!==null&&os(t.index-n)<r.parent.length/Wh?(Gh(t,r,n),t):uk(o._searchMarker,r,n)},Ca=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let n=o[r];if(t>0){let s=n.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(n.index-=s.length);if(s===null||s.marker===!0){o.splice(r,1);continue}n.p=s,s.marker=!0}(e<n.index||t>0&&e===n.index)&&(n.index=zr(e,n.index+t))}};var Qi=(o,e,t)=>{let r=o,n=e.changedParentTypes;for(;Nr(n,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;Bh(r._eH,t,e)},It=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=vh(),this._dEH=vh(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Vr()}clone(){throw Vr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Sh(this._eH,e)}observeDeep(e){Sh(this._dEH,e)}unobserve(e){kh(this._eH,e)}unobserveDeep(e){kh(this._dEH,e)}toJSON(){}},Kh=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,n=[],s=o._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){let a=s.content.getContent();if(a.length<=e)e-=a.length;else{for(let i=e;i<a.length&&r>0;i++)n.push(a[i]),r--;e=0}}s=s.right}return n},jh=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let n=0;n<r.length;n++)e.push(r[n])}t=t.right}return e};var Ta=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let n=r.content.getContent();for(let s=0;s<n.length;s++)e(n[s],t++,o)}r=r.right}},Yh=(o,e)=>{let t=[];return Ta(o,(r,n)=>{t.push(e(r,n,o))}),t},dk=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let n=t[r++];return t.length<=r&&(t=null),{done:!1,value:n}}}},Jh=(o,e)=>{let t=Xi(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Ki=(o,e,t,r)=>{let n=t,s=o.doc,a=s.clientID,i=s.store,l=t===null?e._start:t.right,c=[],u=()=>{c.length>0&&(n=new ut(Ne(a,St(i,a)),n,n&&n.lastId,l,l&&l.id,e,null,new Gr(c)),n.integrate(o,0),c=[])};r.forEach(d=>{if(d===null)c.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(d);break;default:switch(u(),d.constructor){case Uint8Array:case ArrayBuffer:n=new ut(Ne(a,St(i,a)),n,n&&n.lastId,l,l&&l.id,e,null,new En(new Uint8Array(d))),n.integrate(o,0);break;case gr:n=new ut(Ne(a,St(i,a)),n,n&&n.lastId,l,l&&l.id,e,null,new Fn(d)),n.integrate(o,0);break;default:if(d instanceof It)n=new ut(Ne(a,St(i,a)),n,n&&n.lastId,l,l&&l.id,e,null,new Dr(d)),n.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Xh=()=>Cr("Length exceeded!"),Qh=(o,e,t,r)=>{if(t>e._length)throw Xh();if(t===0)return e._searchMarker&&Ca(e._searchMarker,t,r.length),Ki(o,e,null,r);let n=t,s=Xi(e,t),a=e._start;for(s!==null&&(a=s.p,t-=s.index,t===0&&(a=a.prev,t+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(t<=a.length){t<a.length&&an(o,Ne(a.id.client,a.id.clock+t));break}t-=a.length}return e._searchMarker&&Ca(e._searchMarker,n,r.length),Ki(o,e,a,r)},pk=(o,e,t)=>{let n=(e._searchMarker||[]).reduce((s,a)=>a.index>s.index?a:s,{index:0,p:e._start}).p;if(n)for(;n.right;)n=n.right;return Ki(o,e,n,t)},Zh=(o,e,t,r)=>{if(r===0)return;let n=t,s=r,a=Xi(e,t),i=e._start;for(a!==null&&(i=a.p,t-=a.index);i!==null&&t>0;i=i.right)!i.deleted&&i.countable&&(t<i.length&&an(o,Ne(i.id.client,i.id.clock+t)),t-=i.length);for(;r>0&&i!==null;)i.deleted||(r<i.length&&an(o,Ne(i.id.client,i.id.clock+r)),i.delete(o),r-=i.length),i=i.right;if(r>0)throw Xh();e._searchMarker&&Ca(e._searchMarker,n,-s+r)},ji=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},Nc=(o,e,t,r)=>{let n=e._map.get(t)||null,s=o.doc,a=s.clientID,i;if(r==null)i=new Gr([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:i=new Gr([r]);break;case Uint8Array:i=new En(r);break;case gr:i=new Fn(r);break;default:if(r instanceof It)i=new Dr(r);else throw new Error("Unexpected content type")}new ut(Ne(a,St(s.store,a)),n,n&&n.lastId,null,null,e,t,i).integrate(o,0)},Hc=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},eg=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},tg=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var mk=(o,e)=>{let t={};return o._map.forEach((r,n)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&gs(s,e)&&(t[n]=s.content.getContent()[s.length-1])}),t},Ri=o=>yh(o.entries(),e=>!e[1].deleted),Lc=class extends ws{constructor(e,t){super(e,t),this._transaction=t}},io=class extends It{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new io;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new io}clone(){let e=new io;return e.insert(0,this.toArray().map(t=>t instanceof It?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),Qi(this,e,new Lc(this,e))}insert(e,t){this.doc!==null?nt(this.doc,r=>{Qh(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?nt(this.doc,t=>{pk(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?nt(this.doc,r=>{Zh(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Jh(this,e)}toArray(){return jh(this)}slice(e=0,t=this.length){return Kh(this,e,t)}toJSON(){return this.map(e=>e instanceof It?e.toJSON():e)}map(e){return Yh(this,e)}forEach(e){Ta(this,e)}[Symbol.iterator](){return dk(this)}_write(e){e.writeTypeRef(Rk)}},hk=o=>new io,Ic=class extends ws{constructor(e,t,r){super(e,t),this.keysChanged=r}},Ao=class extends It{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new Ao}clone(){let e=new Ao;return this.forEach((t,r)=>{e.set(r,t instanceof It?t.clone():t)}),e}_callObserver(e,t){Qi(this,e,new Ic(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let n=t.content.getContent()[t.length-1];e[r]=n instanceof It?n.toJSON():n}}),e}get size(){return[...Ri(this._map)].length}keys(){return Mi(Ri(this._map),e=>e[0])}values(){return Mi(Ri(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Mi(Ri(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?nt(this.doc,t=>{ji(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?nt(this.doc,r=>{Nc(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return Hc(this,e)}has(e){return tg(this,e)}clear(){this.doc!==null?nt(this.doc,e=>{this.forEach(function(t,r,n){ji(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Ok)}},gk=o=>new Ao,rn=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&nc(o,e),Pa=class{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){switch(this.right===null&&Tr(),this.right.content.constructor){case wt:this.right.deleted||ks(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},Ph=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case wt:e.right.deleted||ks(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&an(o,Ne(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Oi=(o,e,t,r)=>{let n=new Map,s=r?Xi(e,t):null;if(s){let a=new Pa(s.p.left,s.p,s.index,n);return Ph(o,a,t-s.index)}else{let a=new Pa(null,e._start,0,n);return Ph(o,a,t)}},rg=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===wt&&rn(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let n=o.doc,s=n.clientID;r.forEach((a,i)=>{let l=t.left,c=t.right,u=new ut(Ne(s,St(n.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new wt(i,a));u.integrate(o,0),t.right=u,t.forward()})},ks=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},og=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===wt&&rn((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},ng=(o,e,t,r)=>{var i;let n=o.doc,s=n.clientID,a=new Map;for(let l in r){let c=r[l],u=(i=t.currentAttributes.get(l))!=null?i:null;if(!rn(u,c)){a.set(l,u);let{left:d,right:m}=t;t.right=new ut(Ne(s,St(n.store,s)),d,d&&d.lastId,m,m&&m.id,e,null,new wt(l,c)),t.right.integrate(o,0),t.forward()}}return a},hc=(o,e,t,r,n)=>{t.currentAttributes.forEach((m,x)=>{n[x]===void 0&&(n[x]=null)});let s=o.doc,a=s.clientID;og(t,n);let i=ng(o,e,t,n),l=r.constructor===String?new Pr(r):r instanceof It?new Dr(r):new Mo(r),{left:c,right:u,index:d}=t;e._searchMarker&&Ca(e._searchMarker,t.index,l.getLength()),u=new ut(Ne(a,St(s.store,a)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(o,0),t.right=u,t.index=d,t.forward(),rg(o,e,t,i)},Dh=(o,e,t,r,n)=>{let s=o.doc,a=s.clientID;og(t,n);let i=ng(o,e,t,n);e:for(;t.right!==null&&(r>0||i.size>0&&(t.right.deleted||t.right.content.constructor===wt));){if(!t.right.deleted)switch(t.right.content.constructor){case wt:{let{key:l,value:c}=t.right.content,u=n[l];if(u!==void 0){if(rn(u,c))i.delete(l);else{if(r===0)break e;i.set(l,c)}t.right.delete(o)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&an(o,Ne(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new ut(Ne(a,St(s.store,a)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Pr(l)),t.right.integrate(o,0),t.forward()}rg(o,e,t,i)},sg=(o,e,t,r,n)=>{var c,u;let s=e,a=Pt();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===wt){let d=s.content;a.set(d.key,d)}s=s.right}let i=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){let d=e.content;switch(d.constructor){case wt:{let{key:m,value:x}=d,h=(c=r.get(m))!=null?c:null;(a.get(m)!==d||h===x)&&(e.delete(o),i++,!l&&((u=n.get(m))!=null?u:null)===x&&h!==x&&(h===null?n.delete(m):n.set(m,h))),!l&&!e.deleted&&ks(n,d);break}}}e=e.right}return i},xk=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===wt){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},yk=o=>{let e=0;return nt(o.doc,t=>{let r=o._start,n=o._start,s=Pt(),a=vi(s);for(;n;){if(n.deleted===!1)switch(n.content.constructor){case wt:ks(a,n.content);break;default:e+=sg(t,r,n,s,a),s=vi(a),r=n;break}n=n.right}}),e},bk=o=>{let e=new Set,t=o.doc;for(let[r,n]of o.afterState.entries()){let s=o.beforeState.get(r)||0;n!==s&&zh(o,t.store.clients.get(r),s,n,a=>{!a.deleted&&a.content.constructor===wt&&a.constructor!==lr&&e.add(a.parent)})}nt(t,r=>{Mh(o,o.deleteSet,n=>{if(n instanceof lr||!n.parent._hasFormatting||e.has(n.parent))return;let s=n.parent;n.content.constructor===wt?e.add(s):xk(r,n)});for(let n of e)yk(n)})},Ah=(o,e,t)=>{let r=t,n=vi(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Dr:case Mo:case Pr:t<e.right.length&&an(o,Ne(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}s&&sg(o,s,e.right,n,e.currentAttributes);let a=(e.left||e.right).parent;return a._searchMarker&&Ca(a._searchMarker,e.index,-r+t),e},Cc=class extends ws{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];nt(e,r=>{var x,h,_;let n=new Map,s=new Map,a=this.target._start,i=null,l={},c="",u=0,d=0,m=()=>{if(i!==null){let b=null;switch(i){case"delete":d>0&&(b={delete:d}),d=0;break;case"insert":(typeof c=="object"||c.length>0)&&(b={insert:c},n.size>0&&(b.attributes={},n.forEach((v,D)=>{v!==null&&(b.attributes[D]=v)}))),c="";break;case"retain":u>0&&(b={retain:u},oh(l)||(b.attributes=th({},l))),u=0;break}b&&t.push(b),i=null}};for(;a!==null;){switch(a.content.constructor){case Dr:case Mo:this.adds(a)?this.deletes(a)||(m(),i="insert",c=a.content.getContent()[0],m()):this.deletes(a)?(i!=="delete"&&(m(),i="delete"),d+=1):a.deleted||(i!=="retain"&&(m(),i="retain"),u+=1);break;case Pr:this.adds(a)?this.deletes(a)||(i!=="insert"&&(m(),i="insert"),c+=a.content.str):this.deletes(a)?(i!=="delete"&&(m(),i="delete"),d+=a.length):a.deleted||(i!=="retain"&&(m(),i="retain"),u+=a.length);break;case wt:{let{key:b,value:v}=a.content;if(this.adds(a)){if(!this.deletes(a)){let D=(x=n.get(b))!=null?x:null;rn(D,v)?v!==null&&a.delete(r):(i==="retain"&&m(),rn(v,(h=s.get(b))!=null?h:null)?delete l[b]:l[b]=v)}}else if(this.deletes(a)){s.set(b,v);let D=(_=n.get(b))!=null?_:null;rn(D,v)||(i==="retain"&&m(),l[b]=D)}else if(!a.deleted){s.set(b,v);let D=l[b];D!==void 0&&(rn(D,v)?D!==null&&a.delete(r):(i==="retain"&&m(),v===null?delete l[b]:l[b]=v))}a.deleted||(i==="insert"&&m(),ks(n,a.content));break}}a=a.right}for(m();t.length>0;){let b=t[t.length-1];if(b.retain!==void 0&&b.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},ln=class extends It{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new ln}clone(){let e=new ln;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new Cc(this,e,t);Qi(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Pr&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?nt(this.doc,r=>{let n=new Pa(null,this._start,0,new Map);for(let s=0;s<e.length;s++){let a=e[s];if(a.insert!==void 0){let i=!t&&typeof a.insert=="string"&&s===e.length-1&&n.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof i!="string"||i.length>0)&&hc(r,this,n,i,a.attributes||{})}else a.retain!==void 0?Dh(r,this,n,a.retain,a.attributes||{}):a.delete!==void 0&&Ah(r,n,a.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let n=[],s=new Map,a=this.doc,i="",l=this._start;function c(){if(i.length>0){let d={},m=!1;s.forEach((h,_)=>{m=!0,d[_]=h});let x={insert:i};m&&(x.attributes=d),n.push(x),i=""}}let u=()=>{for(;l!==null;){if(gs(l,e)||t!==void 0&&gs(l,t))switch(l.content.constructor){case Pr:{let d=s.get("ychange");e!==void 0&&!gs(l,e)?(d===void 0||d.user!==l.id.client||d.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!gs(l,t)?(d===void 0||d.user!==l.id.client||d.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):d!==void 0&&(c(),s.delete("ychange")),i+=l.content.str;break}case Dr:case Mo:{c();let d={insert:l.content.getContent()[0]};if(s.size>0){let m={};d.attributes=m,s.forEach((x,h)=>{m[h]=x})}n.push(d);break}case wt:gs(l,e)&&(c(),ks(s,l.content));break}l=l.right}c()};return e||t?nt(a,d=>{e&&_c(d,e),t&&_c(d,t),u()},"cleanup"):u(),n}insert(e,t,r){if(t.length<=0)return;let n=this.doc;n!==null?nt(n,s=>{let a=Oi(s,this,e,!r);r||(r={},a.currentAttributes.forEach((i,l)=>{r[l]=i})),hc(s,this,a,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let n=this.doc;n!==null?nt(n,s=>{let a=Oi(s,this,e,!r);hc(s,this,a,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?nt(r,n=>{Ah(n,Oi(n,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let n=this.doc;n!==null?nt(n,s=>{let a=Oi(s,this,e,!1);a.right!==null&&Dh(s,this,a,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?nt(this.doc,t=>{ji(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?nt(this.doc,r=>{Nc(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return Hc(this,e)}getAttributes(){return eg(this)}_write(e){e.writeTypeRef(Uk)}},wk=o=>new ln,va=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===fn||t.constructor===Eo)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},Eo=class extends It{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Eo}clone(){let e=new Eo;return e.insert(0,this.toArray().map(t=>t instanceof It?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new va(this,e)}querySelector(e){e=e.toUpperCase();let r=new va(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Hr(new va(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Qi(this,e,new Tc(this,t,e))}toString(){return Yh(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),Ta(this,s=>{n.insertBefore(s.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?nt(this.doc,r=>{Qh(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)nt(this.doc,r=>{let n=e&&e instanceof It?e._item:e;Ki(r,this,n,t)});else{let r=this._prelimContent,n=e===null?0:r.findIndex(s=>s===e)+1;if(n===0&&e!==null)throw Cr("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){this.doc!==null?nt(this.doc,r=>{Zh(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return jh(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Jh(this,e)}slice(e=0,t=this.length){return Kh(this,e,t)}forEach(e){Ta(this,e)}_write(e){e.writeTypeRef(Bk)}},_k=o=>new Eo,fn=class extends Eo{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new fn(this.nodeName)}clone(){let e=new fn(this.nodeName),t=this.getAttributes();return rh(t,(r,n)=>{typeof r=="string"&&e.setAttribute(n,r)}),e.insert(0,this.toArray().map(r=>r instanceof It?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let i in e)r.push(i);r.sort();let n=r.length;for(let i=0;i<n;i++){let l=r[i];t.push(l+'="'+e[l]+'"')}let s=this.nodeName.toLocaleLowerCase(),a=t.length>0?" "+t.join(" "):"";return`<${s}${a}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?nt(this.doc,t=>{ji(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?nt(this.doc,r=>{Nc(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return Hc(this,e)}hasAttribute(e){return tg(this,e)}getAttributes(e){return e?mk(this,e):eg(this)}toDOM(e=document,t={},r){let n=e.createElement(this.nodeName),s=this.getAttributes();for(let a in s){let i=s[a];typeof i=="string"&&n.setAttribute(a,i)}return Ta(this,a=>{n.appendChild(a.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef($k),e.writeKey(this.nodeName)}},vk=o=>new fn(o.readKey()),Tc=class extends ws{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}},_s=class extends Ao{constructor(e){super(),this.hookName=e}_copy(){return new _s(this.hookName)}clone(){let e=new _s(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let n=t[this.hookName],s;return n!==void 0?s=n.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(Nk),e.writeKey(this.hookName)}},Sk=o=>new _s(o.readKey()),vs=class extends ln{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new vs}clone(){let e=new vs;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{let t=[];for(let n in e.attributes){let s=[];for(let a in e.attributes[n])s.push({key:a,value:e.attributes[n][a]});s.sort((a,i)=>a.key<i.key?-1:1),t.push({nodeName:n,attrs:s})}t.sort((n,s)=>n.nodeName<s.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){let s=t[n];r+=`<${s.nodeName}`;for(let a=0;a<s.attrs.length;a++){let i=s.attrs[a];r+=` ${i.key}="${i.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(Hk)}},kk=o=>new vs,Da=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Vr()}mergeWith(e){return!1}write(e,t,r){throw Vr()}integrate(e,t){throw Vr()}},Lk=0,lr=class extends Da{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),Hh(e.doc.store,this)}write(e,t){e.writeInfo(Lk),e.writeLen(this.length-t)}getMissing(e,t){return null}},En=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new En(this.content)}splice(e){throw Vr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},Ik=o=>new En(o.readBuf()),Mn=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Mn(this.len)}splice(e){let t=new Mn(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){Ni(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},Ck=o=>new Mn(o.readLen()),ag=(o,e)=>new gr({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),Fn=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Fn(ag(this.doc.guid,this.opts))}splice(e){throw Vr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},Tk=o=>new Fn(ag(o.readString(),o.readAny())),Mo=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Mo(this.embed)}splice(e){throw Vr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},Pk=o=>new Mo(o.readJSON()),wt=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new wt(this.key,this.value)}splice(e){throw Vr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},Dk=o=>new wt(o.readKey(),o.readJSON()),Ss=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ss(this.arr)}splice(e){let t=new Ss(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}},Ak=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let n=o.readString();n==="undefined"?t.push(void 0):t.push(JSON.parse(n))}return new Ss(t)},Gr=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Gr(this.arr)}splice(e){let t=new Gr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeAny(s)}}getRef(){return 8}},Ek=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new Gr(t)},Pr=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Pr(this.str)}splice(e){let t=new Pr(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},Mk=o=>new Pr(o.readString()),Fk=[hk,gk,wk,vk,_k,Sk,kk],Rk=0,Ok=1,Uk=2,$k=3,Bk=4,Nk=5,Hk=6,Dr=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Dr(this.type._copy())}splice(e){throw Vr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},zk=o=>new Dr(Fk[o.readTypeRef()](o)),Eh=(o,e)=>{let t=e,r=0,n;do r>0&&(t=Ne(t.client,t.clock+r)),n=Ui(o,t),r=t.clock-n.id.clock,t=n.redone;while(t!==null&&n instanceof ut);return{item:n,diff:r}};var Yi=(o,e,t)=>{let{client:r,clock:n}=e.id,s=new ut(Ne(r,n+t),e,Ne(r,n+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Ne(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),o._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};var ut=class extends Da{constructor(e,t,r,n,s,a,i,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=s,this.parent=a,this.parentSub=i,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=St(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=St(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===on&&this.id.client!==this.parent.client&&this.parent.clock>=St(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Lh(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=an(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===lr||this.right&&this.right.constructor===lr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ut&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ut&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===on){let r=Ui(t,this.parent);r.constructor===lr?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=Lh(e,e.doc.store,Ne(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;let s=new Set,a=new Set;for(;n!==null&&n!==this.right;){if(a.add(n),s.add(n),xs(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,s.clear();else if(xs(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&a.has(Ui(e.doc.store,n.origin)))s.has(Ui(e.doc.store,n.origin))||(r=n,s.clear());else break;n=n.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Hh(e.doc.store,this),this.content.integrate(e,this),Ch(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new lr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ne(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&xs(e.origin,this.lastId)&&this.right===e&&xs(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),Ni(e.deleteSet,this.id.client,this.id.clock,this.length),Ch(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Tr();this.content.gc(e),t?ek(e,this,new lr(this.id,this.length)):this.content=new Mn(this.length)}write(e,t){let r=t>0?Ne(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,s=this.parentSub,a=this.content.getRef()&31|(r===null?0:128)|(n===null?0:64)|(s===null?0:32);if(e.writeInfo(a),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){let i=this.parent;if(i._item!==void 0){let l=i._item;if(l===null){let c=Nh(i);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else i.constructor===String?(e.writeParentInfo(!0),e.writeString(i)):i.constructor===on?(e.writeParentInfo(!1),e.writeLeftID(i)):Tr();s!==null&&e.writeString(s)}this.content.write(e,t)}},ig=(o,e)=>Vk[e&31](o),Vk=[()=>{Tr()},Ck,Ak,Ik,Mk,Pk,Dk,zk,Ek,Tk,()=>{Tr()}],qk=10,fr=class extends Da{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Tr()}write(e,t){e.writeInfo(qk),Me(e.restEncoder,this.length-t)}getMissing(e,t){return null}},lg=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},fg="__ $YJS$ __";lg[fg]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");lg[fg]=!0;var Ct=require("obsidian");var On=o=>Po((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),cg=(o,e)=>Po((t,r)=>{let n=indexedDB.open(o);n.onupgradeneeded=s=>e(s.target.result),n.onerror=s=>r(Cr(s.target.error)),n.onsuccess=s=>{let a=s.target.result;a.onversionchange=()=>{a.close()},t(a)}}),ug=o=>On(indexedDB.deleteDatabase(o)),dg=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),fo=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(n=>jk(r,n))},Un=(o,e)=>On(o.count(e)),pg=(o,e)=>On(o.get(e)),zc=(o,e)=>On(o.delete(e)),mg=(o,e,t)=>On(o.put(e,t));var Zi=(o,e)=>On(o.add(e)),hg=(o,e,t)=>On(o.getAll(e,t));var Wk=(o,e,t)=>{let r=null;return Kk(o,e,n=>(r=n,!1),t).then(()=>r)},gg=(o,e=null)=>Wk(o,e,"prev");var Gk=(o,e)=>Po((t,r)=>{o.onerror=r,o.onsuccess=async n=>{let s=n.target.result;if(s===null||await e(s)===!1)return t();s.continue()}});var Kk=(o,e,t,r="next")=>Gk(o.openKeyCursor(e,r),n=>t(n.key)),jk=(o,e)=>o.objectStore(e);var xg=(o,e)=>IDBKeyRange.upperBound(o,e),yg=(o,e)=>IDBKeyRange.lowerBound(o,e);var qc="custom",bg="updates",wg=500,_g=(o,e=()=>{},t=()=>{})=>{let[r]=fo(o.db,[bg]);return hg(r,yg(o._dbref,!1)).then(n=>{o._destroyed||(e(r),nt(o.doc,()=>{n.forEach(s=>Fo(o.doc,s))},o,!1),t(r))}).then(()=>gg(r).then(n=>{o._dbref=n+1})).then(()=>Un(r).then(n=>{o._dbsize=n})).then(()=>r)},Yk=(o,e=!0)=>_g(o).then(t=>{(e||o._dbsize>=wg)&&Zi(t,Rn(o.doc)).then(()=>zc(t,xg(o._dbref,!0))).then(()=>Un(t).then(r=>{o._dbsize=r}))});var Is=class extends rs{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=cg(e,r=>dg(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Po(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,_g(this,a=>Zi(a,Rn(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,n)=>{if(this.db&&n!==this){let[s]=fo(this.db,[bg]);Zi(s,r),++this._dbsize>=wg&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{Yk(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{ug(this.name)})}get(e){return this._db.then(t=>{let[r]=fo(t,[qc],"readonly");return pg(r,e)})}set(e,t){return this._db.then(r=>{let[n]=fo(r,[qc]);return mg(n,t,e)})}del(e){return this._db.then(t=>{let[r]=fo(t,[qc]);return zc(r,e)})}};var el,Jk=new Uint8Array(16);function Wc(){if(!el&&(el=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!el))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return el(Jk)}var $t=[];for(let o=0;o<256;++o)$t.push((o+256).toString(16).slice(1));function vg(o,e=0){return $t[o[e+0]]+$t[o[e+1]]+$t[o[e+2]]+$t[o[e+3]]+"-"+$t[o[e+4]]+$t[o[e+5]]+"-"+$t[o[e+6]]+$t[o[e+7]]+"-"+$t[o[e+8]]+$t[o[e+9]]+"-"+$t[o[e+10]]+$t[o[e+11]]+$t[o[e+12]]+$t[o[e+13]]+$t[o[e+14]]+$t[o[e+15]]}var Xk=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Gc={randomUUID:Xk};function Qk(o,e,t){if(Gc.randomUUID&&!e&&!o)return Gc.randomUUID();o=o||{};let r=o.random||(o.rng||Wc)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=r[n];return e}return vg(r)}var Aa=Qk;var Rr=es(_i());var Sg=0,tl=1,kg=2,rl=(o,e)=>{Me(o,Sg);let t=$h(e);At(o,t)},Kc=(o,e,t)=>{Me(o,tl),At(o,Rn(e,t))},Zk=(o,e,t)=>Kc(e,t,Ut(o)),Lg=(o,e,t)=>{try{Fo(e,Ut(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Ig=(o,e)=>{Me(o,kg),At(o,e)},eL=Lg,Cg=(o,e,t,r)=>{let n=De(o);switch(n){case Sg:Zk(o,e,t);break;case tl:Lg(o,t,r);break;case kg:eL(o,t,r);break;default:throw new Error("Unknown message type")}return n};var rL=0;var Tg=(o,e,t)=>{switch(De(o)){case rL:t(e,qr(o))}};var jc=3e4,ol=class extends rs{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=Pn();this.getLocalState()!==null&&jc/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((n,s)=>{s!==this.clientID&&jc<=t-n.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&nl(this,r,"timeout")},ir(jc/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),n=r===void 0?0:r.clock+1,s=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:Pn()});let a=[],i=[],l=[],c=[];e===null?c.push(t):s==null?e!=null&&a.push(t):(i.push(t),ms(s,e)||l.push(t)),(a.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:a,updated:l,removed:c},"local"]),this.emit("update",[{added:a,updated:i,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},nl=(o,e,t)=>{let r=[];for(let n=0;n<e.length;n++){let s=e[n];if(o.states.has(s)){if(o.states.delete(s),s===o.clientID){let a=o.meta.get(s);o.meta.set(s,{clock:a.clock+1,lastUpdated:Pn()})}r.push(s)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},Cs=(o,e,t=o.states)=>{let r=e.length,n=In();Me(n,r);for(let s=0;s<r;s++){let a=e[s],i=t.get(a)||null,l=o.meta.get(a).clock;Me(n,a),Me(n,l),To(n,JSON.stringify(i))}return hr(n)};var Pg=(o,e,t)=>{let r=Wr(e),n=Pn(),s=[],a=[],i=[],l=[],c=De(r);for(let u=0;u<c;u++){let d=De(r),m=De(r),x=JSON.parse(qr(r)),h=o.meta.get(d),_=o.states.get(d),b=h===void 0?0:h.clock;(b<m||b===m&&x===null&&o.states.has(d))&&(x===null?d===o.clientID&&o.getLocalState()!=null?m++:o.states.delete(d):o.states.set(d,x),o.meta.set(d,{clock:m,lastUpdated:n}),h===void 0&&x!==null?s.push(d):h!==void 0&&x===null?l.push(d):x!==null&&(ms(x,_)||i.push(d),a.push(d)))}(s.length>0||i.length>0||l.length>0)&&o.emit("change",[{added:s,updated:i,removed:l},t]),(s.length>0||a.length>0||l.length>0)&&o.emit("update",[{added:s,updated:a,removed:l},t])};var Ps=()=>new Map,Fg=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Rg=()=>new Set,sL=Array.from,IM=Array.isArray,Og=String.fromCharCode,CM=String.fromCodePoint,TM=Og(65535),aL=o=>o.toLowerCase(),iL=/^\s*/g,lL=o=>o.replace(iL,""),fL=/([A-Z])/g,Dg=(o,e)=>lL(o.replace(fL,t=>`${e}${aL(t)}`)),cL=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},Ea=typeof TextEncoder!="undefined"?new TextEncoder:null,uL=o=>Ea.encode(o),dL=Ea?uL:cL,Yc=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Yc&&Yc.decode(new Uint8Array).length===1&&(Yc=null);var Ag=o=>o===void 0?null:o,pL=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},Ug=new pL,tu=!0;try{typeof localStorage!="undefined"&&(Ug=localStorage,tu=!1)}catch(o){}var $g=Ug,mL=o=>tu||addEventListener("storage",o),hL=o=>tu||removeEventListener("storage",o),gL=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},xL=(o,e)=>e.includes(o),Es=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),Bg=typeof window!="undefined"&&typeof document!="undefined"&&!Es,PM=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,co,yL=[],bL=()=>{if(co===void 0)if(Es){co=Ps();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&co.set(e,""),e=r):e!==null?(co.set(e,r),e=null):yL.push(r)}e!==null&&co.set(e,"")}else typeof location=="object"?(co=Ps(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");co.set(`--${Dg(e,"-")}`,t),co.set(`-${Dg(e,"-")}`,t)}})):co=Ps();return co},Xc=o=>bL().has(o),Qc=o=>Ag(Es?process.env[o.toUpperCase()]:$g.getItem(o)),wL=o=>Xc("--"+o)||Qc(o)!==null,DM=wL("production"),Eg=Es&&xL(process.env.FORCE_COLOR,["true","1","2"]),AM=!Xc("no-colors")&&(!Es||process.stdout.isTTY||Eg)&&(!Es||Xc("color")||Eg||Qc("COLORTERM")!==null||(Qc("TERM")||"").includes("color")),Ng=Math.floor,Hg=(o,e)=>o<e?o:e,_L=(o,e)=>o>e?o:e,EM=Number.isNaN,vL=Math.pow,zg=128,SL=1<<17,kL=1<<18,LL=1<<19,IL=1<<20,CL=1<<21,TL=1<<22,PL=1<<23,DL=1<<24,AL=1<<25,EL=1<<26,ML=1<<27,FL=1<<28,RL=1<<29,OL=1<<30,MM=1<<31,sl=127,FM=SL-1,RM=kL-1,OM=LL-1,UM=IL-1,$M=CL-1,BM=TL-1,NM=PL-1,HM=DL-1,zM=AL-1,VM=EL-1,qM=ML-1,WM=FL-1,GM=RL-1,KM=OL-1,UL=Number.MAX_SAFE_INTEGER,jM=Number.MIN_SAFE_INTEGER,YM=1<<31,JM=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&Ng(o)===o),XM=Number.isNaN,QM=Number.parseInt,$L=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Kr=()=>new $L,ru=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},Ar=o=>{let e=new Uint8Array(ru(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(Wg(o.cbuf.buffer,0,o.cpos),t),e},al=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},Yt=(o,e)=>{for(;e>sl;)al(o,zg|sl&e),e=Ng(e/128);al(o,sl&e)},Zc=new Uint8Array(3e4),BL=Zc.length/3,NL=(o,e)=>{if(e.length<BL){let t=Ea.encodeInto(e,Zc).written||0;Yt(o,t);for(let r=0;r<t;r++)al(o,Zc[r])}else Ds(o,dL(e))},HL=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Yt(o,r);for(let n=0;n<r;n++)al(o,t.codePointAt(n))},ZM=Ea&&Ea.encodeInto?NL:HL,zL=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=Hg(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(_L(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},Ds=(o,e)=>{Yt(o,e.byteLength),zL(o,e)},eF=new DataView(new ArrayBuffer(4)),Vg=o=>new Error(o),VL=Vg("Unexpected end of array"),qL=Vg("Integer out of Range"),WL=class{constructor(o){this.arr=o,this.pos=0}},GL=o=>new WL(o),KL=(o,e)=>{let t=Wg(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},jL=o=>KL(o,qg(o)),qg=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&sl)*t,t*=128,n<zg)return e;if(e>UL)throw qL}throw VL},YL=o=>new Uint8Array(o),Wg=(o,e,t)=>new Uint8Array(o,e,t),JL=o=>new Uint8Array(o),XL=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=Og(o[t]);return btoa(e)},QL=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),ZL=o=>{let e=atob(o),t=YL(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},eI=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},tI=Bg?XL:QL,rI=Bg?ZL:eI,Gg=new Map,oI=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:rI(e.newValue||"")}),mL(this._onChange)}postMessage(o){$g.setItem(this.room,tI(JL(o)))}close(){hL(this._onChange)}},nI=typeof BroadcastChannel=="undefined"?oI:BroadcastChannel,ou=o=>Fg(Gg,o,()=>{let e=Rg(),t=new nI(o);return t.onmessage=r=>e.forEach(n=>n(r.data,"broadcastchannel")),{bc:t,subs:e}}),sI=(o,e)=>(ou(o).subs.add(e),e),aI=(o,e)=>{let t=ou(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),Gg.delete(o)),r},Ts=(o,e,t=null)=>{let r=ou(o);r.bc.postMessage(e),r.subs.forEach(n=>n(e,t))},eu=Date.now,iI=class{constructor(){this._observers=Ps()}on(o,e){Fg(this._observers,o,Rg).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return sL((this._observers.get(o)||Ps()).values()).forEach(t=>t(...e))}destroy(){this._observers=Ps()}},lI=o=>gL(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),$n=0,Kg=3,As=1,fI=2,Ma=[];Ma[$n]=(o,e,t,r,n)=>{Yt(o,$n);let s=Cg(e,o,t.doc,t);r&&s===tl&&!t.synced&&(t.synced=!0)};Ma[Kg]=(o,e,t,r,n)=>{Yt(o,As),Ds(o,Cs(t.awareness,Array.from(t.awareness.getStates().keys())))};Ma[As]=(o,e,t,r,n)=>{Pg(t.awareness,jL(e),t)};Ma[fI]=(o,e,t,r,n)=>{Tg(e,t.doc,(s,a)=>cI(t,a))};var Mg=3e4,cI=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),jg=(o,e,t)=>{let r=GL(e),n=Kr(),s=qg(r),a=o.messageHandlers[s];return a?a(n,r,o,t,s):console.error("Unable to compute message"),n},Yg=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=eu();let r=jg(o,new Uint8Array(t.data),!0);ru(r)>1&&e.send(Ar(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,nl(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(Yg,Hg(vL(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=eu(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=Kr();if(Yt(t,$n),rl(t,o.doc),e.send(Ar(t)),o.awareness.getLocalState()!==null){let r=Kr();Yt(r,As),Ds(r,Cs(o.awareness,[o.doc.clientID])),e.send(Ar(r))}},o.emit("status",[{status:"connecting"}])}},Jc=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&Ts(o.bcChannel,e,o)},Jg=class extends iI{constructor(o,e,t,{connect:r=!0,awareness:n=new ol(t),params:s={},WebSocketPolyfill:a=WebSocket,resyncInterval:i=-1,maxBackoffTime:l=2500,disableBc:c=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let u=lI(s);this.maxBackoffTime=l,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(u.length===0?"":"?"+u),this.roomname=e,this.doc=t,this._WS=a,this.awareness=n,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=c,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Ma.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,i>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let d=Kr();Yt(d,$n),rl(d,t),this.ws.send(Ar(d))}},i)),this._bcSubscriber=(d,m)=>{if(m!==this){let x=jg(this,new Uint8Array(d),!1);ru(x)>1&&Ts(this.bcChannel,Ar(x),this)}},this._updateHandler=(d,m)=>{if(m!==this){let x=Kr();Yt(x,$n),Ig(x,d),Jc(this,Ar(x))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:d,updated:m,removed:x},h)=>{let _=d.concat(m).concat(x),b=Kr();Yt(b,As),Ds(b,Cs(n,_)),Jc(this,Ar(b))},this._unloadHandler=()=>{nl(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),n.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var d;this.wsconnected&&Mg<eu()-this.wsLastMessageReceived&&((d=this.ws)==null||d.close())},Mg/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(sI(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=Kr();Yt(o,$n),rl(o,this.doc),Ts(this.bcChannel,Ar(o),this);let e=Kr();Yt(e,$n),Kc(e,this.doc),Ts(this.bcChannel,Ar(e),this);let t=Kr();Yt(t,Kg),Ts(this.bcChannel,Ar(t),this);let r=Kr();Yt(r,As),Ds(r,Cs(this.awareness,[this.doc.clientID])),Ts(this.bcChannel,Ar(r),this)}disconnectBc(){let o=Kr();Yt(o,As),Ds(o,Cs(this.awareness,[this.doc.clientID],new Map)),Jc(this,Ar(o)),this.bcconnected&&(aI(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Yg(this),this.connectBc())}};var Wt=new WeakMap,Xg=!1;function ll(o){Xg=o}var jr={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3},Jt,Xt,il=[];function Qg(o,e,t,r){Xt=o,Jt=t,r&&(jr={...jr,...r}),e.setInterval(nu,jr.batchInterval)}async function nu(){if(il.length===0)return;let o=[...il];il.length=0;for(let e=0;e<jr.maxRetries;e++)try{await uI();let t=o.map(Zg).join(`
`)+`
`;await Xt.append(Jt,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===jr.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function uI(){let o=await Xt.stat(Jt);if(o&&o.size>jr.maxFileSize){for(let e=jr.maxBackups;e>0;e--){let t=`${Jt}.${e}`,r=`${Jt}.${e+1}`;await Xt.exists(t)&&(e===jr.maxBackups?await Xt.remove(t):await Xt.rename(t,r))}await Xt.exists(Jt)&&await Xt.rename(Jt,`${Jt}.1`),await Xt.write(Jt,"")}}function Zg(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}function dI(o,e){return e?t=>(o.notify(t.name+`
`+t.message),t):t=>(o.notify(t.name+`:
An error has occurred, please reload Obsidian.`),t)}var pI=["token","authorization","email"];function mI(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var n;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&pI.some(s=>t.toLowerCase().includes(s.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(n=r.stack)==null?void 0:n.split(`
`).map(s=>s.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function Se(o,e="log"){return(...t)=>{if(Xg){let r=new Date().toISOString(),n=new Error().stack,s=n?n.split(`
`)[2].trim():"",a=t.map(mI).join(" "),i={timestamp:r,level:e,message:`${o}: ${a}`,callerInfo:s};jr.disableConsole||console[e](Zg(i)),il.push(i)}}}async function fl(){let o=[];await Xt.exists(Jt)&&o.push(Jt);for(let e=1;e<=jr.maxBackups;e++){let t=`${Jt}.${e}`;await Xt.exists(t)&&o.push(t)}return o}async function ex(){let o=[];if(await Xt.exists(Jt)){let e=await Xt.read(Jt);o.push(e)}for(let e=1;e<=jr.maxBackups;e++){let t=`${Jt}.${e}`;if(await Xt.exists(t)){let r=await Xt.read(t);o.push(r)}}return o.reverse().join(`
`)}var Ro=class{constructor(e){let t=e||this.constructor.name;this.debug=Se(`[${t}]`,"debug"),this.log=Se(`[${t}]`,"log"),this.warn=Se(`[${t}]`,"warn"),this.error=Se(`[${t}]`,"error")}setLoggers(e){this.debug=Se(`[${e}]`,"debug"),this.log=Se(`[${e}]`,"log"),this.warn=Se(`[${e}]`,"warn"),this.error=Se(`[${e}]`,"error")}},hI=!1;function tx(o){return dI(o,hI)}var su=class{constructor(){this.platform="s3rn";this.product="relay"}},au=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},Oo=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},Yr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},cn=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},Bn=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},Qt=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,n,s,a,i,l,c]=t;if(!this.validateUUID(s))throw new Error("Invalid UUID");if(i&&!this.validateUUID(i))throw new Error("Invalid UUID");if(c&&!this.validateUUID(c))throw new Error("Invalid UUID");if(r==="relay"&&n==="relay"&&a==="folder"&&l==="doc")return new Yr(s,i,c);if(r==="relay"&&n==="relay"&&a=="folder")return new Oo(s,i);if(r==="relay"&&n==="folder"&&a==="document")return new Bn(s,i);if(r==="relay"&&n==="folder")return new cn(s);if(r==="relay"&&n==="relay")return new au(s);if(n===void 0)return new su;throw new Error("Invalid s3rn format for the given product type")}};function gI(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function rx(o){let e=JSON.stringify(o),t=gI(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var cl={enableUpdateYDocFromDiskBuffer:!1,enableDocumentStatus:!1,enableDebugFileTag:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableHTTPSync:!1,enableSyncMenu:!0,enableDocumentServer:!1,enableDocumentHistory:!1,enableEditorTweens:!1,enableSyncModal:!1,enableDesyncPill:!1};function xI(){return new Proxy({},{get:(o,e)=>e})}var Er=xI();var Ms=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...n)},t)}}};var Bt=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return Bt.instance||(Bt.instance=new Bt(new Ms),Wt.set(this.instance,"postie")),Bt.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let n={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(n),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Se("[postie]","debug");for(let[t,r]of this.mailboxes){for(let n of r)t(n),e("send",n.constructor.name,t),this.deliveredMailLog.push({sender:n,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Se("[postie]","warn")("All Mail Log:"),this.prettyPrintMailLog(this.allMailLog)}prettyPrintDeliveredMailLog(){Se("[postie]","warn")("Delivered Mail Log:"),this.prettyPrintMailLog(this.deliveredMailLog)}prettyPrintMailLog(e){let t=Se("[postie]","warn");e.forEach((r,n)=>{t(`Mail #${n+1}:`),t(`  Timestamp: ${new Date(r.timestamp).toISOString()}`),t(`  Transaction ID: ${r.transactionId}`),t(`  Sender: ${r.sender.observableName||r.sender.constructor.name}`),t(`  Recipient: ${r.recipient.name||"Anonymous function"}`),t(`  Recipient Origin: ${r.recipientOrigin||"Unknown"}`),t("---")})}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let n=200,s=t.replace(/\s+/g," ").slice(0,n);return s.length===n&&(s+="..."),`AnonymousFunction(${s})`}static destroy(){Bt.instance&&(Bt.instance.mailboxes=null,Bt.instance.allMailLog=[],Bt.instance.deliveredMailLog=[],Bt.instance.timeProvider.destroy(),Bt.instance.timeProvider=null,Bt.instance.isDelivering=!1,Bt.instance.isInTransaction=!1,Bt.instance.currentTransactionId=0,Bt._destroyed=!0,Bt.instance=void 0)}},Mr=Bt;Mr._destroyed=!1;var iu=new Map;function ox(){for(let[,o]of iu)o();iu.clear()}var Et=class extends Ro{constructor(t){super();this.observableName=t;iu.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners`,this,this._listeners)}),this._listeners=new Set}notifyListeners(){for(let t of this._listeners)Mr.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),Mr.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners.delete(t)}destroy(){this._listeners.clear(),this._listeners=null}};function Fr(){return{...Gt.getInstance().flags}}function uo(o,e,t=()=>{}){Gt.getInstance().flags[o]?e():t()}function nx(o,e,t=()=>{}){o.forEach(r=>{if(Gt.getInstance().flags[r]){e();return}}),t()}var Gt=class extends Et{constructor(){super();this.flags=cl}static getInstance(){return Gt.instance||(Gt.instance=new Gt),Gt.instance}setSettings(t){this.settings=t,this.settings.subscribe(r=>{this.flags={...this.flags,...r},this.notifyListeners()})}getFlag(t){return this.flags[t]}setFlag(t,r){this.settings&&this.settings.update(n=>({...n,[t]:r}))}static destroy(){Gt.instance=null}};var yI={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function sx(o,e,t){let r={token:o.token},n=new Jg(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&n.awareness.setLocalStateField("user",{name:t.name,color:t.color.color,colorLight:t.color.light}),n}var Fs=class extends Ro{constructor(t,r,n,s){var c;super();this.guid=t;this._s3rn=r;this.tokenStore=n;this.loginManager=s;this._providerSynced=!1;this.PROVIDER_MAX_ERRORS=3;this.listeners=new Map,this.loginManager=s;let a=(c=this.loginManager)==null?void 0:c.user;this.ydoc=new gr,Fr().enableDocumentHistory&&(this.ydoc.gc=!1),a&&new Vi(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,a.id),this.tokenStore=n,this.clientToken=this.tokenStore.getTokenSync(Qt.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=sx(this.clientToken,this.ydoc,a);let i=this.providerConnectionErrorSubscription(u=>{this.log(`[${this.path}] disconnection event`,u);let d=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),d&&this.connect()});i.on(),this._offConnectionError=i.off;let l=this.providerStateSubscription(u=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${rx(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(Qt.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,n=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!n}return!1}refreshProvider(t){var a;this.clientToken=t;let r=new gr,n=sx(t,r),s=n.url;if(this._provider){if(this._provider.url!==s){this._provider.url=s,this._provider.wsUnsuccessfulReconnects=0;let i=this._provider.url.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${i}`),(a=this._provider.ws)==null||a.close()}}else throw new Error("missing provider!");n.awareness.destroy(),n.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:yI[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._providerSynced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=n=>{n.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}_injectIntent(t){return n=>{t({status:n.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var un=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},ul=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=n=>{n.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((n,s)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>s(l.error),l.onsuccess=()=>n()}catch(a){s(a)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let i=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);i.onerror=()=>n(i.error),i.onsuccess=()=>r(i.result?i.result.contents:null)}catch(s){n(s)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let i=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);i.onerror=()=>n(i.error),i.onsuccess=()=>r()}catch(s){n(s)}})}};var dn=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=n=>{if(this.currentPromise&&this.resolver){let s=this.resolver;s(n),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let n=r(t);if(n)return n}return this.currentPromise||(this.currentPromise=new Promise((n,s)=>{this.resolver=n,this.timeoutId=window.setTimeout(()=>{Se("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[a,i]=this.checkFunction();a&&r(i)},3e3),this.promiseFunction().then(a=>{this.timeoutId&&clearTimeout(this.timeoutId),n(a)},a=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,s(a)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},dl=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{Se("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function lu(o,...e){return new Promise((t,r)=>{let n=window.setTimeout(()=>{Se("[Promise]","error")("Promise stuck after 3s:",...e)},3e3);o.then(s=>{clearTimeout(n),t(s)},s=>{clearTimeout(n),r(s)})})}var po=class extends Fs{constructor(t,r,n,s){let a=s.relayId?new Yr(s.relayId,s.guid,r):new Bn(s.guid,r);super(r,a,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let i=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new Is(i,this.ydoc)}catch(i){throw this.warn("Unable to open persistence.",this.guid),console.error(i),i}this.whenSynced().then(()=>{let i=l=>{let c=l.transaction.origin;l.changes.keys.size!==0&&c!=this&&this.updateStats()};this.ytext.observe(i),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(i)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",Qt.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),uo(Er.enableDeltaLogging,()=>{let i=l=>{var u,d;let c="";c+=`Transaction origin: ${l.transaction.origin} ${(d=(u=l.transaction.origin)==null?void 0:u.constructor)==null?void 0:d.name}
`;for(let m of l.changes.delta)c+=`insert: ${m.insert}

retain: ${m.retain}

delete: ${m.delete}
`;this.debug(c)};this.ytext.observe(i),this.unsubscribes.push(()=>{this.ytext.unobserve(i)})}),this._tfile=null}setLoggers(t){this.debug=Se(t,"debug"),this.log=Se(t,"log"),this.warn=Se(t,"warn"),this.error=Se(t,"error")}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let n=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(s=>null);return n!==null&&n!==""?r=n:r=await this._parent.read(this),this.setDiskBuffer(r.replace(`\r
`,`
`))}catch(n){throw console.error(n),n}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new un(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,n=this.text!==r;return n||this.clearDiskBuffer(),n}async connect(){return this.sharedFolder.s3rn instanceof cn?!1:(this.s3rn instanceof Bn&&(this.sharedFolder.relayId?this.s3rn=new Yr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Bn(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new dn(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new dn(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=fo(this._persistence.db,["updates"],"readonly"),r=await Un(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}async read(){return this.text}async rename(t){this.move(t)}async delete(){this.destroy()}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var Uo=class extends Et{constructor(){super();this._set=new Set}add(t){return this._set.add(t),this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let n of this._set)t(n)&&r.push(n);return r}};var Rs=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let n=r.split(`${this.namespace}${this.seperator}`)[1],s=this.get(n);e.call(t,s,n,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var fu=class extends Uo{constructor(){super(...arguments);this.notifyListeners=(0,Ct.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){return r=r&&!this._set.has(t),this._set.add(t),r&&this.notifyListeners(),this}},pl=class extends Fs{constructor(t,r,n,s,a,i,l,c,u,d,m,x=!0){var _;let h=m?new Oo(m,r):new cn(r);super(r,h,l,s);this.appId=t;this.backgroundSync=u;this._settings=d;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getFiles(),r=[],n=[];t.forEach(a=>{this.checkPath(a.path)&&(this.ids.has(a.path)||n.push(this.getVirtualPath(a.path)))});let s=this.placeHold(n);t.forEach(a=>{if(!this.checkPath(a.path)||!this.checkExtension(a.path)||a instanceof Ct.TFolder)return;let i=this.getVirtualPath(a.path);if(s.contains(i)){let c=this.uploadDoc(i,!1);r.push(c)}else{let c=this.getDoc(i,!1);r.push(c)}}),r.length>0&&this.docset.update()};this.path=n,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=i,this.vault=a,this.ids=this.ydoc.getMap("docs"),this.docs=new Map,this.docset=new fu,this.pendingUpload=new Rs(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.relayManager=c,this.relayId=m,this.diskBufferStore=new ul,this._shouldConnect=(_=this.settings.connect)!=null?_:!0,this.authoritative=!x,this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(b=>{this.remote=b.find(v=>v.guid==this.guid)}));try{this._persistence=new Is(this.guid,this.ydoc)}catch(b){throw this.warn("Unable to open persistence.",this.guid),console.error(b),b}s.loggedIn&&this.connect(),this.whenReady().then(async()=>{this.destroyed||(this.addLocalDocs(),await this.syncFileTree(this.ydoc))}),uo(Er.enableDeltaLogging,()=>{let b=v=>{var B,A;let D="";D+=`Transaction origin: ${v.transaction.origin}${(A=(B=v.transaction.origin)==null?void 0:B.constructor)==null?void 0:A.name}
`,v.changes.keys.forEach((F,O)=>{F.action==="add"&&(D+=`Added ${O}: ${this.ids.get(O)}
`),F.action==="update"&&(D+=`Updated ${O}: ${this.ids.get(O)}
`),F.action==="delete"&&(D+=`Deleted ${O}
`)}),this.debug(D)};this.ids.observe(b),this.unsubscribes.push(()=>{this.ids.unobserve(b)})}),this.whenSynced().then(async()=>{let b=async v=>{if(v.changes.keys.size===0){this.log("no changes detected");return}v.transaction.origin!=this&&(this.log("file tree",this._debugFileTree()),await this.syncFileTree(this.ydoc))};this.ids.observe(b),this.unsubscribes.push(()=>{this.ids.unobserve(b)});try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",Qt.encode(this.s3rn))}catch(v){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),Wt.set(this,this.path)}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.ydoc),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}getFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof Ct.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return Ct.Vault.recurseChildren(t,n=>{n instanceof Ct.TFile&&r.push(n)}),r}connect(){return this.s3rn instanceof Oo&&(this.connected||this.shouldConnect)?(this.backgroundSync.resume(),super.connect()):Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new Oo(this.relayId,this.guid):new cn(this.guid),this._settings.update(n=>this.relayId?{guid:this.guid,path:this.path,relay:this.relayId}:{guid:this.guid,path:this.path}),this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._serverSynced||this.synced)}async count(){if(this._persistence.db===null)throw new Error("unexpected missing database");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=fo(this._persistence.db,["updates"],"readonly"),r=await Un(t);return this._dbsize=r,this._dbsize}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}hasLocalDB(){return this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new dn(t,()=>[this.ready,this]),this.readyPromise.getPromise()}_debugFileTree(){let t=new Map;return this.ydoc.getMap("docs")._map.forEach((r,n)=>{r.content instanceof Gr?t.set(n,r.content.arr[0]):t.set(n,r.content)}),t}whenSynced(){let t=async()=>{if(this._persistence.synced){await this.count(),this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new dn(t,()=>(this._persistence.synced&&this._dbsize&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,n,s){s==null||s.push(`${n.path} was renamed to ${r}`);let a=(0,Rr.dirname)(r);this.existsSync(a)||(await this.mkdir(a),s==null||s.push(`creating directory ${a}`)),this.fileManager.renameFile(n,(0,Ct.normalizePath)(this.getPath(r))).then(()=>{t.move(r)})}async _handleServerCreate(t,r){let n=(0,Rr.dirname)(t);this.existsSync(n)||(await this.mkdir(n),r==null||r.push(`creating directory ${n}`));let s=await this.downloadDoc(t,!1);return r==null||r.push(`created local file for remotely added doc ${t}`),s}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.ids.delete(t);return}}applyRemoteState(t,r,n,s){let a=this.docs.get(t);if(this.existsSync(r)||!this.checkExtension(r))return{op:"noop",path:r,promise:Promise.resolve()};if(n.has(t)&&a){let l=this.getPath(a.path),c=this.vault.getAbstractFileByPath(l);if(c){let u=this._handleServerRename(a,r,c,s);return{op:"rename",path:r,from:l,to:r,promise:u}}}let i=this._handleServerCreate(r,s);return{op:"create",path:r,promise:i}}cleanupExtraLocalFiles(t,r){let n=this.getFiles(),s=[];return n.forEach(a=>{var m,x;let i=this.checkExtension(a.path),l=this.checkPath(a.path),c=t.contains(a.path.slice(this.path.length)),u=this.pendingUpload.has(this.getVirtualPath(a.path)),d=((m=this._provider)==null?void 0:m.synced)&&((x=this._persistence)==null?void 0:x.synced);if(l&&!c&&!u&&i&&d){r.push(`deleted local file ${a.path} for remotely deleted doc`);let h=this.vault.adapter.trashLocal(a.path);s.push({op:"delete",path:a.path,promise:h})}}),s}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let n=this.syncFileTreePromise.getPromise();return n.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),n}let r=async()=>{try{let n=[],s=t.getMap("docs"),a=[];this.ydoc.transact(()=>{s.forEach((m,x)=>{this._assertNamespacing(x)});let d=new Set(this.ids.values());s.forEach((m,x)=>{this._assertNamespacing(x),n.push(this.applyRemoteState(m,x,d,a))})});let i=n.filter(d=>d.op==="create"),l=n.filter(d=>d.op==="rename"),c=n.map(d=>d.path);await Promise.all([...i,...l].map(d=>lu(d.promise,d)));let u=this.cleanupExtraLocalFiles(c,a);(l.length>0||i.length>0||u.length>0)&&this.docset.update(),this.log(`syncFileTree diff:
`+a.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new dl(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,Rr.join)(this.path,t.path);return this.vault.adapter.read((0,Ct.normalizePath)(r))}existsSync(t){let r=(0,Ct.normalizePath)((0,Rr.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,Rr.join)(this.path,t.path);return this.vault.adapter.exists((0,Ct.normalizePath)(r))}flush(t,r){let n=(0,Rr.join)(this.path,t.path);return this.log("writing to ",(0,Ct.normalizePath)(n)),this.vault.adapter.write((0,Ct.normalizePath)(n),r)}getPath(t){return(0,Rr.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,Rr.join)(this.path,t);return this.vault.adapter.mkdir((0,Ct.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+Rr.sep)}checkExtension(t,r=".md"){return t.endsWith(r)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}async getFile(t){let r=this.getVirtualPath(t);if(!this.checkExtension(t))throw new Error("bad extension!");return this.getDoc(r,!0)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof Ct.TFile?r:null}getDoc(t,r=!0){let n=this.ids.get(t)||this.pendingUpload.get(t);if(n!==void 0){let s=this.docs.get(n);return s!==void 0?(s.move(t),s):(this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r))}else return this.warn("[getDoc]: creating new shared ID for existing file"),this.placeHold([t]).length>0?this.uploadDoc(t):this.createDoc(t,r)}placeHold(t){let r=[];return t.forEach(n=>{if(!this.ids.has(n)&&!this.pendingUpload.has(n)){this.debug("creating entirely new doc for",n);let s=Aa();r.push(n),this.pendingUpload.set(n,s)}}),r}viewFile(t){let r=this.getVirtualPath(t);if(!this.checkExtension(t))throw new Error("bad extension!");return this.viewDoc(r)}viewDoc(t){let r=this.ids.get(t)||this.pendingUpload.get(t);return r?this.docs.get(r):void 0}async downloadDoc(t,r=!0){if(!this.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.ids.has(t))throw new Error(`potential for document split at ${t}`);let n=this.ids.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.docs.get(n)||new po(t,n,this.loginManager,this);return s.markOrigin("remote"),await lu(this.backgroundSync.enqueueDownload(s),s.path),this.docs.set(n,s),this.docset.add(s,r),s}uploadDoc(t,r=!0){if(!this.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.ids.has(t)&&!this.pendingUpload.has(t))throw new Error(`potential for document split at ${t}`);let n=this.ids.get(t)||this.pendingUpload.get(t);if(!n)throw new Error("missing guid");let s=this.docs.get(n)||new po(t,n,this.loginManager,this),a=s.getOrigin(),i=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,u,d]=await Promise.all([this.read(s),a,i]),m=s.ydoc.getText("contents");!d&&u===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{m.insert(0,c)},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.docs.set(n,s),this.docset.add(s,r),s}markUploaded(t){this.ids.has(t.path)||t._serverSynced&&this.ydoc.transact(()=>{this.log(`[${t.path}] File uploaded: adding to set`),this.ids.set(t.path,t.guid),this.pendingUpload.delete(t.path)},this)}createDoc(t,r=!0){if(!this.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.ids.has(t)&&!this.pendingUpload.get(t))throw new Error(`potential for document split at ${t}`);let n=this.ids.get(t)||this.pendingUpload.get(t);if(!n)throw new Error("expected guid");let s=this.docs.get(n)||new po(t,n,this.loginManager,this);return(async()=>this.whenReady().then(async()=>{var i;let a=await s.getServerSynced();((i=s.tfile)==null?void 0:i.stat.size)===0&&!a?this.backgroundSync.enqueueDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.docs.set(n,s),this.docset.add(s,r),s}deleteFile(t){let r=this.getVirtualPath(t);return this.deleteDoc(r)}deleteDoc(t){let r=this.ids.get(t)||this.pendingUpload.get(t);r&&this.ydoc.transact(()=>{var s;this.ids.delete(t),this.pendingUpload.delete(t);let n=this.docs.get(r);n&&((s=n._diskBufferStore)==null||s.removeDiskBuffer(r),n.destroy(),this.docset.delete(n)),this.docs.delete(r)},this)}renameFile(t,r){let n="",s="";try{n=this.getVirtualPath(t)}catch(a){this.log("Moving out of shared folder")}try{s=this.getVirtualPath(r)}catch(a){this.log("Moving in from outside of shared folder")}if(!(!n&&!s))if(s){let a=this.ids.get(s)||this.pendingUpload.get(s);if(!a)return;let i=this.docs.get(a);if(!n)this.ydoc.transact(()=>{this.ids.delete(s)},this),this.pendingUpload.delete(s),i&&(i.destroy(),this.docset.delete(i)),this.docs.delete(a);else{let l=this.ids.get(s)||this.pendingUpload.get(s);if(!l)return;let c=this.pendingUpload.get(s);c?(this.pendingUpload.set(n,c),this.pendingUpload.delete(s)):this.ydoc.transact(()=>{this.ids.has(s)&&(this.ids.set(n,l),this.ids.delete(s))},this),i&&i.move(n)}}else{if(this.assertPath(t),!this.checkExtension(t))return;this.placeHold([n]),this.uploadDoc(n)}}destroy(){var t,r,n;this.destroyed=!0,this.docs.forEach(s=>{s.destroy(),this.docs.delete(s.guid)}),super.destroy(),this.ydoc.destroy(),this.docset.clear(),this.unsubscribes.forEach(s=>{s()}),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.vault=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(n=this.syncFileTreePromise)==null||n.destroy(),this.syncFileTreePromise=null}},ml=class extends Uo{constructor(t,r,n,s){super();this.relayManager=t;this.vault=r;this.settings=s;this.unsubscribes=[];this.update=(0,Ct.debounce)(this.notifyListeners,100);this.folderBuilder=n,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(a=>{let i=!1;this.items().forEach(l=>{let c=a.find(u=>u.guid==l.guid);l.remote!=c&&(i=!0),l.remote=c}),i&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(n=>n.filter(s=>s.guid!==t.guid)),r}lookup(t){let r=this.find(n=>n.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(n=>{if(!this.vault.getFolderByPath(n.path)){this.warn(`Invalid settings, ${n.path} does not exist`);return}this._new(n.path,n.guid,n==null?void 0:n.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,n,s){let a=this.find(u=>u.path==t&&u.guid==r);if(a)return a;let i=this.find(u=>u.guid==r);if(i)throw new Error(`This folder is already mounted at ${i.path}.`);if(this.find(u=>u.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let c=this.folderBuilder(t,r,n,s);return this._set.add(c),c}new(t,r,n,s){let a=this._new(t,r,n,s);return this.notifyListeners(),a}};var Dl=require("@codemirror/state"),Ws=require("obsidian");function Q(){}function ie(o,e){for(let t in e)o[t]=e[t];return o}function ax(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function cu(o){return o()}function gl(){return Object.create(null)}function Le(o){o.forEach(cu)}function dt(o){return typeof o=="function"}function Y(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var hl;function uu(o,e){return o===e?!0:(hl||(hl=document.createElement("a")),hl.href=e,o===hl.href)}function ix(o){return Object.keys(o).length===0}function Zt(o,...e){if(o==null){for(let r of e)r(void 0);return Q}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function ye(o,e,t){o.$$.on_destroy.push(Zt(e,t))}function de(o,e,t,r){if(o){let n=lx(o,e,t,r);return o[0](n)}}function lx(o,e,t,r){return o[1]&&r?ie(t.ctx.slice(),o[1](r(e))):t.ctx}function pe(o,e,t,r){if(o[2]&&r){let n=o[2](r(t));if(e.dirty===void 0)return n;if(typeof n=="object"){let s=[],a=Math.max(e.dirty.length,n.length);for(let i=0;i<a;i+=1)s[i]=e.dirty[i]|n[i];return s}return e.dirty|n}return e.dirty}function me(o,e,t,r,n,s){if(n){let a=lx(e,t,r,s);o.p(a,n)}}function he(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function ve(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function du(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function Os(o){return o==null?"":o}function fx(o,e,t){return o.set(t),e}function cx(o){return o&&dt(o.destroy)?o.destroy:Q}var Nn=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var Us=class{constructor(e){mt(this,"_listeners","WeakMap"in Nn?new WeakMap:void 0);mt(this,"_observer");mt(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let n of t)Us.entries.set(n.target,n),(r=this._listeners.get(n.target))==null||r(n)})}};Us.entries="WeakMap"in Nn?new WeakMap:void 0;var ux=!1;function dx(){ux=!0}function px(){ux=!1}function k(o,e){o.appendChild(e)}function Ae(o,e,t){let r=mx(o);if(!r.getElementById(e)){let n=C("style");n.id=e,n.textContent=t,_I(r,n)}}function mx(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function _I(o,e){return k(o.head||o,e),e.sheet}function T(o,e,t){o.insertBefore(e,t||null)}function I(o){o.parentNode&&o.parentNode.removeChild(o)}function ft(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function C(o){return document.createElement(o)}function Jr(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function W(o){return document.createTextNode(o)}function $(){return W(" ")}function Te(){return W("")}function ee(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function hx(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function w(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function Fa(o,e){for(let t in e)w(o,t,e[t])}function gx(o){return Array.from(o.childNodes)}function oe(o,e){e=""+e,o.data!==e&&(o.data=e)}function er(o,e){o.value=e==null?"":e}function ge(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function Ye(o,e,t){o.classList.toggle(e,!!t)}function yl(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var xl=class{constructor(e=!1){mt(this,"is_svg",!1);mt(this,"e");mt(this,"n");mt(this,"t");mt(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=Jr(t.nodeName):this.e=C(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)T(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(I)}};function xx(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function $s(o,e){return new o(e)}var pn;function xr(o){pn=o}function Ra(){if(!pn)throw new Error("Function called outside component initialization");return pn}function tr(o){Ra().$$.on_mount.push(o)}function pu(o){Ra().$$.on_destroy.push(o)}function Nt(){let o=Ra();return(e,t,{cancelable:r=!1}={})=>{let n=o.$$.callbacks[e];if(n){let s=yl(e,t,{cancelable:r});return n.slice().forEach(a=>{a.call(o,s)}),!s.defaultPrevented}return!0}}function Xr(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var Hn=[];var Or=[],Ns=[],yx=[],CI=Promise.resolve(),hu=!1;function bx(){hu||(hu=!0,CI.then(Ua))}function Oa(o){Ns.push(o)}var mu=new Set,Bs=0;function Ua(){if(Bs!==0)return;let o=pn;do{try{for(;Bs<Hn.length;){let e=Hn[Bs];Bs++,xr(e),TI(e.$$)}}catch(e){throw Hn.length=0,Bs=0,e}for(xr(null),Hn.length=0,Bs=0;Or.length;)Or.pop()();for(let e=0;e<Ns.length;e+=1){let t=Ns[e];mu.has(t)||(mu.add(t),t())}Ns.length=0}while(Hn.length);for(;yx.length;)yx.pop()();hu=!1,mu.clear(),xr(o)}function TI(o){if(o.fragment!==null){o.update(),Le(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(Oa)}}function wx(o){let e=[],t=[];Ns.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),Ns=e}var bl=new Set,zn;function we(){zn={r:0,c:[],p:zn}}function _e(){zn.r||Le(zn.c),zn=zn.p}function L(o,e){o&&o.i&&(bl.delete(o),o.i(e))}function P(o,e,t,r){if(o&&o.o){if(bl.has(o))return;bl.add(o),zn.c.push(()=>{bl.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}function gu(o,e){let t=e.token={};function r(n,s,a,i){if(e.token!==t)return;e.resolved=i;let l=e.ctx;a!==void 0&&(l=l.slice(),l[a]=i);let c=n&&(e.current=n)(l),u=!1;e.block&&(e.blocks?e.blocks.forEach((d,m)=>{m!==s&&d&&(we(),P(d,1,1,()=>{e.blocks[m]===d&&(e.blocks[m]=null)}),_e())}):e.block.d(1),c.c(),L(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&Ua()}if(ax(o)){let n=Ra();if(o.then(s=>{xr(n),r(e.then,1,e.value,s),xr(null)},s=>{if(xr(n),r(e.catch,2,e.error,s),xr(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function _x(o,e,t){let r=e.slice(),{resolved:n}=o;o.current===o.then&&(r[o.value]=n),o.current===o.catch&&(r[o.error]=n),o.block.p(r,t)}function Fe(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function vx(o,e){P(o,1,1,()=>{e.delete(o.key)})}function Sx(o,e,t,r,n,s,a,i,l,c,u,d){let m=o.length,x=s.length,h=m,_={};for(;h--;)_[o[h].key]=h;let b=[],v=new Map,D=new Map,B=[];for(h=x;h--;){let M=d(n,s,h),E=t(M),R=a.get(E);R?r&&B.push(()=>R.p(M,e)):(R=c(E,M),R.c()),v.set(E,b[h]=R),E in _&&D.set(E,Math.abs(h-_[E]))}let A=new Set,F=new Set;function O(M){L(M,1),M.m(i,u),a.set(M.key,M),u=M.first,x--}for(;m&&x;){let M=b[x-1],E=o[m-1],R=M.key,G=E.key;M===E?(u=M.first,m--,x--):v.has(G)?!a.has(R)||A.has(R)?O(M):F.has(G)?m--:D.get(R)>D.get(G)?(F.add(R),O(M)):(A.add(G),m--):(l(E,a),m--)}for(;m--;){let M=o[m];v.has(M.key)||l(M,a)}for(;x;)O(b[x-1]);return Le(B),b}function Ue(o,e){let t={},r={},n={$$scope:1},s=o.length;for(;s--;){let a=o[s],i=e[s];if(i){for(let l in a)l in i||(r[l]=1);for(let l in i)n[l]||(t[l]=i[l],n[l]=1);o[s]=i}else for(let l in a)n[l]=1}for(let a in r)a in t||(t[a]=void 0);return t}function We(o){return typeof o=="object"&&o!==null?o:{}}var PI=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],DI=new Set([...PI]);function z(o){o&&o.c()}function N(o,e,t){let{fragment:r,after_update:n}=o.$$;r&&r.m(e,t),Oa(()=>{let s=o.$$.on_mount.map(cu).filter(dt);o.$$.on_destroy?o.$$.on_destroy.push(...s):Le(s),o.$$.on_mount=[]}),n.forEach(Oa)}function H(o,e){let t=o.$$;t.fragment!==null&&(wx(t.after_update),Le(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function EI(o,e){o.$$.dirty[0]===-1&&(Hn.push(o),bx(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function X(o,e,t,r,n,s,a=null,i=[-1]){let l=pn;xr(o);let c=o.$$={fragment:null,ctx:[],props:s,update:Q,not_equal:n,bound:gl(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:gl(),dirty:i,skip_bound:!1,root:e.target||l.$$.root};a&&a(c.root);let u=!1;if(c.ctx=t?t(o,e.props||{},(d,m,...x)=>{let h=x.length?x[0]:m;return c.ctx&&n(c.ctx[d],c.ctx[d]=h)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](h),u&&EI(o,d)),m}):[],c.update(),u=!0,Le(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){dx();let d=gx(e.target);c.fragment&&c.fragment.l(d),d.forEach(I)}else c.fragment&&c.fragment.c();e.intro&&L(o.$$.fragment),N(o,e.target,e.anchor),px(),Ua()}xr(l)}var MI;typeof HTMLElement=="function"&&(MI=class extends HTMLElement{constructor(e,t,r){super();mt(this,"$$ctor");mt(this,"$$s");mt(this,"$$c");mt(this,"$$cn",!1);mt(this,"$$d",{});mt(this,"$$r",!1);mt(this,"$$p_d",{});mt(this,"$$l",{});mt(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let n=this.$$l_u.get(t);n&&(n(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(s){return()=>{let a;return{c:function(){a=C("slot"),s!=="default"&&w(a,"name",s)},m:function(c,u){T(c,a,u)},d:function(c){c&&I(a)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=xx(this);for(let s of this.$$s)s in r&&(t[s]=[e(s)]);for(let s of this.attributes){let a=this.$$g_p(s.name);a in this.$$d||(this.$$d[a]=xu(a,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let n=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let a=xu(s,this.$$d[s],this.$$p_d,"toAttribute");a==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,a)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(let s in this.$$l)for(let a of this.$$l[s]){let i=this.$$c.$on(s,a);this.$$l_u.set(a,i)}this.$$l={}}}attributeChangedCallback(e,t,r){var n;this.$$r||(e=this.$$g_p(e),this.$$d[e]=xu(e,r,this.$$p_d,"toProp"),(n=this.$$c)==null||n.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function xu(o,e,t,r){var s;let n=(s=t[o])==null?void 0:s.type;if(e=n==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(n){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(n){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var J=class{constructor(){mt(this,"$$");mt(this,"$$set")}$destroy(){H(this,1),this.$destroy=Q}$on(e,t){if(!dt(t))return Q;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let n=r.indexOf(t);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!ix(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var kx="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(kx);var FI={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},yu=FI;function Lx(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function bu(o){let e,t=[o[12]],r={};for(let n=0;n<t.length;n+=1)r=ie(r,t[n]);return{c(){e=Jr(o[11]),Fa(e,r)},m(n,s){T(n,e,s)},p(n,s){Fa(e,r=Ue(t,[s&32&&n[12]]))},d(n){n&&I(e)}}}function Ix(o){let e=o[11],t,r=o[11]&&bu(o);return{c(){r&&r.c(),t=Te()},m(n,s){r&&r.m(n,s),T(n,t,s)},p(n,s){n[11]?e?Y(e,n[11])?(r.d(1),r=bu(n),e=n[11],r.c(),r.m(t.parentNode,t)):r.p(n,s):(r=bu(n),e=n[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=n[11])},d(n){n&&I(t),r&&r.d(n)}}}function RI(o){let e,t,r,n,s,a=Fe(o[5]),i=[];for(let m=0;m<a.length;m+=1)i[m]=Ix(Lx(o,a,m));let l=o[10].default,c=de(l,o,o[9],null),u=[yu,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:n=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],d={};for(let m=0;m<u.length;m+=1)d=ie(d,u[m]);return{c(){e=Jr("svg");for(let m=0;m<i.length;m+=1)i[m].c();t=Te(),c&&c.c(),Fa(e,d)},m(m,x){T(m,e,x);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(e,null);k(e,t),c&&c.m(e,null),s=!0},p(m,[x]){if(x&32){a=Fe(m[5]);let h;for(h=0;h<a.length;h+=1){let _=Lx(m,a,h);i[h]?i[h].p(_,x):(i[h]=Ix(_),i[h].c(),i[h].m(e,t))}for(;h<i.length;h+=1)i[h].d(1);i.length=a.length}c&&c.p&&(!s||x&512)&&me(c,l,m,m[9],s?pe(l,m[9],x,null):he(m[9]),null),Fa(e,d=Ue(u,[yu,x&128&&m[7],(!s||x&4)&&{width:m[2]},(!s||x&4)&&{height:m[2]},(!s||x&2)&&{stroke:m[1]},(!s||x&28&&r!==(r=m[4]?Number(m[3])*24/Number(m[2]):m[3]))&&{"stroke-width":r},(!s||x&257&&n!==(n=m[6]("lucide-icon","lucide",m[0]?`lucide-${m[0]}`:"",m[8].class)))&&{class:n}]))},i(m){s||(L(c,m),s=!0)},o(m){P(c,m),s=!1},d(m){m&&I(e),ft(i,m),c&&c.d(m)}}}function OI(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],n=du(e,r),{$$slots:s={},$$scope:a}=e,{name:i=void 0}=e,{color:l="currentColor"}=e,{size:c=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:d=!1}=e,{iconNode:m}=e,x=(...h)=>h.filter((_,b,v)=>Boolean(_)&&v.indexOf(_)===b).join(" ");return o.$$set=h=>{t(8,e=ie(ie({},e),ve(h))),t(7,n=du(e,r)),"name"in h&&t(0,i=h.name),"color"in h&&t(1,l=h.color),"size"in h&&t(2,c=h.size),"strokeWidth"in h&&t(3,u=h.strokeWidth),"absoluteStrokeWidth"in h&&t(4,d=h.absoluteStrokeWidth),"iconNode"in h&&t(5,m=h.iconNode),"$$scope"in h&&t(9,a=h.$$scope)},e=ve(e),[i,l,c,u,d,m,x,n,e,a,s]}var wu=class extends J{constructor(e){super(),X(this,e,OI,RI,Y,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},Ge=wu;function UI(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function $I(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[UI]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function BI(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var _u=class extends J{constructor(e){super(),X(this,e,BI,$I,Y,{})}},vu=_u;function NI(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function HI(o){let e,t,r=[{name:"arrow-up-down"},o[1],{iconNode:o[0]}],n={$$slots:{default:[NI]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function zI(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Su=class extends J{constructor(e){super(),X(this,e,zI,HI,Y,{})}},ku=Su;function VI(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function qI(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[VI]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function WI(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Lu=class extends J{constructor(e){super(),X(this,e,WI,qI,Y,{})}},Iu=Lu;function GI(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function KI(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[GI]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function jI(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Cu=class extends J{constructor(e){super(),X(this,e,jI,KI,Y,{})}},Tu=Cu;function YI(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function JI(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],n={$$slots:{default:[YI]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function XI(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Pu=class extends J{constructor(e){super(),X(this,e,XI,JI,Y,{})}},Du=Pu;function QI(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function ZI(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],n={$$slots:{default:[QI]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function eC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Au=class extends J{constructor(e){super(),X(this,e,eC,ZI,Y,{})}},$a=Au;function tC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function rC(o){let e,t,r=[{name:"clock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[tC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function oC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Eu=class extends J{constructor(e){super(),X(this,e,oC,rC,Y,{})}},Ba=Eu;function nC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function sC(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],n={$$slots:{default:[nC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function aC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Mu=class extends J{constructor(e){super(),X(this,e,aC,sC,Y,{})}},Fu=Mu;function iC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function lC(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],n={$$slots:{default:[iC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function fC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Ru=class extends J{constructor(e){super(),X(this,e,fC,lC,Y,{})}},Ou=Ru;function cC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function uC(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],n={$$slots:{default:[cC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function dC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Uu=class extends J{constructor(e){super(),X(this,e,dC,uC,Y,{})}},$u=Uu;function pC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function mC(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],n={$$slots:{default:[pC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function hC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Bu=class extends J{constructor(e){super(),X(this,e,hC,mC,Y,{})}},$o=Bu;function gC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function xC(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],n={$$slots:{default:[gC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function yC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Nu=class extends J{constructor(e){super(),X(this,e,yC,xC,Y,{})}},Hu=Nu;function bC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function wC(o){let e,t,r=[{name:"pause"},o[1],{iconNode:o[0]}],n={$$slots:{default:[bC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function _C(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var zu=class extends J{constructor(e){super(),X(this,e,_C,wC,Y,{})}},Vu=zu;function vC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function SC(o){let e,t,r=[{name:"play"},o[1],{iconNode:o[0]}],n={$$slots:{default:[vC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function kC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var qu=class extends J{constructor(e){super(),X(this,e,kC,SC,Y,{})}},Wu=qu;function LC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function IC(o){let e,t,r=[{name:"refresh-cw"},o[1],{iconNode:o[0]}],n={$$slots:{default:[LC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function CC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Gu=class extends J{constructor(e){super(),X(this,e,CC,IC,Y,{})}},Ku=Gu;function TC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function PC(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],n={$$slots:{default:[TC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function DC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var ju=class extends J{constructor(e){super(),X(this,e,DC,PC,Y,{})}},Vn=ju;function AC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function EC(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],n={$$slots:{default:[AC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function MC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Yu=class extends J{constructor(e){super(),X(this,e,MC,EC,Y,{})}},Ju=Yu;function FC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function RC(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[FC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function OC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Xu=class extends J{constructor(e){super(),X(this,e,OC,RC,Y,{})}},Na=Xu;function UC(o){let e,t=o[2].default,r=de(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&me(r,t,n,n[3],e?pe(t,n[3],s,null):he(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){P(r,n),e=!1},d(n){r&&r.d(n)}}}function $C(o){let e,t,r=[{name:"upload"},o[1],{iconNode:o[0]}],n={$$slots:{default:[UC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Ge({props:n}),{c(){z(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function BC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"17 8 12 3 7 8"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15"}]];return o.$$set=a=>{t(1,e=ie(ie({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Qu=class extends J{constructor(e){super(),X(this,e,BC,$C,Y,{})}},Zu=Qu;function NC(o){Ae(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function HC(o){let e,t,r,n,s,a;return t=new $o({props:{class:"svg-icon inline-icon"}}),{c(){var i;e=C("button"),z(t.$$.fragment),w(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),w(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),w(e,"tabindex","0"),w(e,"data-filename",s=(i=o[0].view.file)==null?void 0:i.name)},m(i,l){T(i,e,l),N(t,e,null),a=!0},p(i,l){var c;(!a||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(i[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&w(e,"class",r),(!a||l&1&&n!==(n=i[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&w(e,"aria-label",n),(!a||l&1&&s!==(s=(c=i[0].view.file)==null?void 0:c.name))&&w(e,"data-filename",s)},i(i){a||(L(t.$$.fragment,i),a=!0)},o(i){P(t.$$.fragment,i),a=!1},d(i){i&&I(e),H(t)}}}function zC(o){let e,t,r,n,s,a,i,l,c,u,d,m,x;return t=new $o({props:{class:"svg-icon inline-icon"}}),l=new Vn({props:{class:"svg-icon inline-icon"}}),{c(){var h;e=C("button"),z(t.$$.fragment),a=$(),i=C("button"),z(l.$$.fragment),w(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),w(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),w(e,"tabindex","0"),w(e,"data-filename",s=(h=o[0].view.file)==null?void 0:h.name),w(i,"class",c="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),w(i,"aria-label",u=`${o[2].relay.name} (${o[1].status})`),w(i,"tabindex","0")},m(h,_){T(h,e,_),N(t,e,null),T(h,a,_),T(h,i,_),N(l,i,null),d=!0,m||(x=[ee(i,"click",o[3]),ee(i,"keypress",o[4])],m=!0)},p(h,_){var b;(!d||_&1&&r!==(r="clickable-icon view-action system3-view-action "+(h[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&w(e,"class",r),(!d||_&1&&n!==(n=h[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&w(e,"aria-label",n),(!d||_&1&&s!==(s=(b=h[0].view.file)==null?void 0:b.name))&&w(e,"data-filename",s),(!d||_&2&&c!==(c="system3-"+h[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&w(i,"class",c),(!d||_&6&&u!==(u=`${h[2].relay.name} (${h[1].status})`))&&w(i,"aria-label",u)},i(h){d||(L(t.$$.fragment,h),L(l.$$.fragment,h),d=!0)},o(h){P(t.$$.fragment,h),P(l.$$.fragment,h),d=!1},d(h){h&&(I(e),I(a),I(i)),H(t),H(l),m=!1,Le(x)}}}function VC(o){let e,t,r,n,s=[zC,HC],a=[];function i(l,c){return l[2]?0:1}return e=i(o,-1),t=a[e]=s[e](o),{c(){t.c(),r=Te()},m(l,c){a[e].m(l,c),T(l,r,c),n=!0},p(l,[c]){let u=e;e=i(l,c),e===u?a[e].p(l,c):(we(),P(a[u],1,1,()=>{a[u]=null}),_e(),t=a[e],t?t.p(l,c):(t=a[e]=s[e](l),t.c()),L(t,1),t.m(r.parentNode,r))},i(l){n||(L(t),n=!0)},o(l){P(t),n=!1},d(l){l&&I(r),a[e].d(l)}}}function qC(o,e,t){let{view:r}=e,{state:n}=e,{remote:s}=e,a={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},i=()=>{r.toggleConnection()},l=c=>{c.key==="Enter"&&i()};return o.$$set=c=>{"view"in c&&t(0,r=c.view),"state"in c&&t(1,n=c.state),"remote"in c&&t(2,s=c.remote)},[r,n,s,i,l]}var ed=class extends J{constructor(e){super(),X(this,e,qC,VC,Y,{view:0,state:1,remote:2},NC)}},Cx=ed;var Hs=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let n=e.querySelector(".system3-banner");if(!n){n=document.createElement("div"),n.classList.add("system3-banner");let s=n.createSpan();s.setText(this.text),n.appendChild(s),r.appendChild(n);let a=async()=>{await this.onClick()&&this.destroy()};n.addEventListener("click",a)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),!0}};var wl=require("@codemirror/state"),Tx=require("@codemirror/view");function Ha(o,e){let t=Object.keys(e).map(r=>WC(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function WC(o,e,t){let r=o[e],n=o.hasOwnProperty(e),s=n?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},a=t(s);return r&&Object.setPrototypeOf(a,r),Object.setPrototypeOf(i,a),o[e]=i,l;function i(...c){return a===s&&o[e]===i&&l(),a.apply(this,c)}function l(){o[e]===i&&(n?o[e]=s:delete o[e]),a!==s&&(a=s,Object.setPrototypeOf(i,r||Function))}}var Px=es(td());var GC=25,e4=wl.Facet.define({combine(o){return o[o.length-1]}}),rd=wl.Annotation.define(),od=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};var r,n,s,a;if(this.editor=e,this.connectionManager=this.editor.state.field(mn),this.view=(r=this.connectionManager)==null?void 0:r.findView(e),!this.view||(this.log=Se(`[LiveCMPluginValue][${(n=this.view.view.file)==null?void 0:n.path}]`,"log"),this.warn=Se(`[LiveCMPluginValue][${(s=this.view.view.file)==null?void 0:s.path}]`,"warn"),this.debug=Se(`[LiveCMPluginValue][${(a=this.view.view.file)==null?void 0:a.path}]`,"debug"),this.debug("created"),!this.view.document))return;let t=this;this.uninstallMonkeyPatch=Ha(this.view.view,{setViewData(i){return function(l,c){return c&&(Bo(t.view)&&t.view.document.text===l&&(t.view.tracking=!0),t.resync()),i.call(this,l,c)}}}),this.view.document.connected?this.resync():this.view.document.onceConnected().then(()=>{this.resync()}),this._observer=async(i,l)=>{if(!Bo(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(l.origin!==this){let c=i.delta,u=[],d=0;for(let m=0;m<c.length;m++){let x=c[m];x.insert!=null?u.push({from:d,to:d,insert:x.insert}):x.delete!=null?(u.push({from:d,to:d+x.delete,insert:""}),d+=x.delete):x.retain!=null&&(d+=x.retain)}!this.view.tracking||Fr().enableEditorTweens&&this.keyFrameCounter>GC?(this.keyFrameCounter=0,u=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),Bo(this.view)&&(e.dispatch({changes:u,annotations:[rd.of(this.editor)]}),this.view.tracking=!0)}},this.observer=(i,l)=>{var c;try{(c=this._observer)==null||c.call(this,i,l)}catch(u){u instanceof RangeError&&Bo(this.view)&&(this.view.tracking=!1)}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new Px.default,n=r.diff_main(t,e);r.diff_cleanupSemantic(n);let s=[],a=0;for(let[i,l]of n)switch(i){case 0:a+=l.length;break;case 1:s.push({from:a,to:a,insert:l}),a+=l.length;break;case-1:s.push({from:a,to:a+l.length,insert:""});break}return s}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if(Bo(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();Bo(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[rd.of(this.editor)]})}}async getKeyFrame(e=!1){return!Bo(this.view)||this.destroyed?[]:this.view.document.text===this.view.view.getViewData()?(this.view.tracking=!0,[]):(this.warn(`|${this.view.document.text}|
|${this.view.view.getViewData()}|`),this.warn("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(this.view.tracking||this.view.checkStale(),Bo(this.view)&&!this.destroyed?[this.getBufferChange(this.view.document.text,e)]:[]))}update(e){var n,s,a,i;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(rd)===this.editor)return;let t=e.view;this.view=(n=this.connectionManager)==null?void 0:n.findView(t);let r=(a=(s=this.view)==null?void 0:s.document)==null?void 0:a.ytext;r&&((i=r.doc)==null||i.transact(()=>{let l=0;e.changes.iterChanges((c,u,d,m,x)=>{let h=x.sliceString(0,x.length,`
`);c!==u&&r.delete(c+l,u-c),h.length>0&&r.insert(c+l,h),l+=h.length-(u-c)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.uninstallMonkeyPatch&&(this.uninstallMonkeyPatch(),this.uninstallMonkeyPatch=void 0),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Dx=Tx.ViewPlugin.fromClass(od);var _l=require("@codemirror/state"),cr=require("@codemirror/view");var Ax=cr.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),KC=_l.Annotation.define(),nd=class extends cr.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return xa("span",[jt("class","cm-ySelectionCaret"),jt("style",`background-color: ${this.color}; border-color: ${this.color}`)],[hs("\u2060"),xa("div",[jt("class","cm-ySelectionCaretDot")]),hs("\u2060"),xa("div",[jt("class","cm-ySelectionInfo")],[hs(this.name)]),hs("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},sd=class{constructor(e){var r,n;this.editor=e,this.decorations=_l.RangeSet.of([]),this.connectionManager=this.editor.state.field(mn);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof hn){this.view=t;let s=(n=this.view.document)==null?void 0:n._provider;this._listener=({added:a,updated:i,removed:l},c,u)=>{a.concat(i).concat(l).findIndex(m=>{var x;return m!==((x=this._awareness)==null?void 0:x.doc.clientID)})>=0&&e.dispatch({annotations:[KC.of([])]})},s&&(this._awareness=s.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var c,u,d,m;let t=e.view;this.view=(c=this.connectionManager)==null?void 0:c.findView(t);let r=(d=(u=this.view)==null?void 0:u.document)==null?void 0:d.ytext;if(!(this.view&&r&&r.doc))return;let n=(m=this.view.document)==null?void 0:m._provider;if(!n)return;this._awareness=n.awareness;let s=this._awareness,a=r.doc,i=[],l=this._awareness.getLocalState();if(l!=null){let x=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),h=x?e.state.selection.main:null,_=l.cursor==null?null:Fc(l.cursor.anchor),b=l.cursor==null?null:Fc(l.cursor.head);if(h!=null){let v=Rc(r,h.anchor),D=Rc(r,h.head);(l.cursor==null||!Uc(_,v)||!Uc(b,D))&&s.setLocalStateField("cursor",{anchor:v,head:D})}else l.cursor!=null&&x&&s.setLocalStateField("cursor",null)}s.getStates().forEach((x,h)=>{if(h===s.doc.clientID)return;let _=x.cursor;if(_==null||_.anchor==null||_.head==null)return;let b=Oc(_.anchor,a),v=Oc(_.head,a);if(b==null||v==null||b.type!==r||v.type!==r)return;if(b.index>e.state.doc.length||v.index>e.state.doc.length){Se("[RemoteSelections]","warn")(`cursor positions (${b.index}, ${v.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=cr.Decoration.none;return}let{color:D="#30bced",name:B="Anonymous"}=x.user||{},A=x.user&&x.user.colorLight||D+"33",F=ns(b.index,v.index),O=zr(b.index,v.index),M=e.view.state.doc.lineAt(F),E=e.view.state.doc.lineAt(O);if(M.number===E.number)i.push({from:F,to:O,value:cr.Decoration.mark({attributes:{style:`background-color: ${A}`},class:"cm-ySelection"})});else{i.push({from:F,to:M.from+M.length,value:cr.Decoration.mark({attributes:{style:`background-color: ${A}`},class:"cm-ySelection"})}),i.push({from:E.from,to:O,value:cr.Decoration.mark({attributes:{style:`background-color: ${A}`},class:"cm-ySelection"})});for(let R=M.number+1;R<E.number;R++){let G=e.view.state.doc.line(R).from;i.push({from:G,to:G,value:cr.Decoration.line({attributes:{style:`background-color: ${A}`,class:"cm-yLineSelection"}})})}}i.push({from:v.index,to:v.index,value:cr.Decoration.widget({side:v.index-b.index>0?-1:1,block:!1,widget:new nd(D,B)})})}),this.decorations=cr.Decoration.set(i,!0)}},Ex=cr.ViewPlugin.fromClass(sd,{decorations:o=>o.decorations});var vl=require("@codemirror/state"),No=require("@codemirror/view"),Mx=require("@codemirror/view");var p4=vl.Annotation.define(),id=class extends Mx.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},ad=vl.StateEffect.define(),ld=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(mn),this.decorations=No.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,n)=>{this.updateFromMetadata(n),this.editor.dispatch({effects:ad.of(null)})},!this.connectionManager){Se("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=Se(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var r,n;if(this.connectionManager&&this.app&&((n=(r=this.view)==null?void 0:r.document)!=null&&n.tfile)){this.connectionManager.onMeta(this.view.document.tfile,this.cb);let s=this.app.metadataCache.getFileCache(this.view.document.tfile);s&&(this.updateFromMetadata(s),this.editor.dispatch({effects:ad.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(No.EditorView.decorations).forEach(n=>{(typeof n=="function"?n(e):n).between(0,e.state.doc.length,(a,i,l)=>{var d;(((d=l.spec)==null?void 0:d.class)||"").contains("cm-formatting-link-end")&&t.push({from:a,to:i})})}),t}updateFromMetadata(e){var r,n,s,a;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((n=(r=this.view)==null?void 0:r.document)!=null&&n.sharedFolder)||!((a=(s=this.view)==null?void 0:s.document)!=null&&a.tfile))return;let t=new Map;for(let i of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}for(let i of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(n){this.metadata.delete(t)}}updateFromEditor(e){var s,a,i,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((a=(s=this.view)==null?void 0:s.document)!=null&&a.sharedFolder)||!((l=(i=this.view)==null?void 0:i.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),n=this.findInternalLinks(this.editor);for(let c of n){let u=null;for(let[x,h]of r)if(c.from<=h.to&&c.to>=h.from){u=h,r.delete(x);break}if(!u)continue;let d=this.app.metadataCache.getFirstLinkpathDest(u.link,this.view.document.path);d&&!this.view.document.sharedFolder.checkPath(d.path)&&t.push(c.from)}t.filter(c=>c<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>No.Decoration.widget({widget:new id,side:1}).range(t));e.length>0?this.decorations=No.Decoration.set(e,!0):this.decorations=No.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(n=>n.is(ad))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},Fx=No.ViewPlugin.fromClass(ld,{decorations:o=>o.decorations});function Ho(){}Ho.prototype={diff:function(e,t){var r,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=n.callback;typeof n=="function"&&(s=n,n={}),this.options=n;var a=this;function i(A){return s?(setTimeout(function(){s(void 0,A)},0),!0):A}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,c=e.length,u=1,d=l+c;n.maxEditLength&&(d=Math.min(d,n.maxEditLength));var m=(r=n.timeout)!==null&&r!==void 0?r:1/0,x=Date.now()+m,h=[{oldPos:-1,lastComponent:void 0}],_=this.extractCommon(h[0],t,e,0);if(h[0].oldPos+1>=c&&_+1>=l)return i([{value:this.join(t),count:t.length}]);var b=-1/0,v=1/0;function D(){for(var A=Math.max(b,-u);A<=Math.min(v,u);A+=2){var F=void 0,O=h[A-1],M=h[A+1];O&&(h[A-1]=void 0);var E=!1;if(M){var R=M.oldPos-A;E=M&&0<=R&&R<l}var G=O&&O.oldPos+1<c;if(!E&&!G){h[A]=void 0;continue}if(!G||E&&O.oldPos+1<M.oldPos?F=a.addToPath(M,!0,void 0,0):F=a.addToPath(O,void 0,!0,1),_=a.extractCommon(F,t,e,A),F.oldPos+1>=c&&_+1>=l)return i(jC(a,F.lastComponent,t,e,a.useLongestToken));h[A]=F,F.oldPos+1>=c&&(v=Math.min(v,A-1)),_+1>=l&&(b=Math.max(b,A+1))}u++}if(s)(function A(){setTimeout(function(){if(u>d||Date.now()>x)return s();D()||A()},0)})();else for(;u<=d&&Date.now()<=x;){var B=D();if(B)return B}},addToPath:function(e,t,r,n){var s=e.lastComponent;return s&&s.added===t&&s.removed===r?{oldPos:e.oldPos+n,lastComponent:{count:s.count+1,added:t,removed:r,previousComponent:s.previousComponent}}:{oldPos:e.oldPos+n,lastComponent:{count:1,added:t,removed:r,previousComponent:s}}},extractCommon:function(e,t,r,n){for(var s=t.length,a=r.length,i=e.oldPos,l=i-n,c=0;l+1<s&&i+1<a&&this.equals(t[l+1],r[i+1]);)l++,i++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=i,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function jC(o,e,t,r,n){for(var s=[],a;e;)s.push(e),a=e.previousComponent,delete e.previousComponent,e=a;s.reverse();for(var i=0,l=s.length,c=0,u=0;i<l;i++){var d=s[i];if(d.removed){if(d.value=o.join(r.slice(u,u+d.count)),u+=d.count,i&&s[i-1].added){var x=s[i-1];s[i-1]=s[i],s[i]=x}}else{if(!d.added&&n){var m=t.slice(c,c+d.count);m=m.map(function(_,b){var v=r[u+b];return v.length>_.length?v:_}),d.value=o.join(m)}else d.value=o.join(t.slice(c,c+d.count));c+=d.count,d.added||(u+=d.count)}}var h=s[l-1];return l>1&&typeof h.value=="string"&&(h.added||h.removed)&&o.equals("",h.value)&&(s[l-2].value+=h.value,s.pop()),s}var h4=new Ho;function YC(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var Rx=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Ox=/\S/,pd=new Ho;pd.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!Ox.test(o)&&!Ox.test(e)};pd.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Rx.test(e[t])&&Rx.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Ux(o,e,t){return t=YC(t,{ignoreWhitespace:!0}),pd.diff(o,e,t)}var md=new Ho;md.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var n=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=n:(this.options.ignoreWhitespace&&(n=n.trim()),e.push(n))}return e};function JC(o,e,t){return md.diff(o,e,t)}var XC=new Ho;XC.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var QC=new Ho;QC.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function Sl(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Sl=function(e){return typeof e}:Sl=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sl(o)}function fd(o){return ZC(o)||e2(o)||t2(o)||r2()}function ZC(o){if(Array.isArray(o))return cd(o)}function e2(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function t2(o,e){if(o){if(typeof o=="string")return cd(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return cd(o,e)}}function cd(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function r2(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o2=Object.prototype.toString,za=new Ho;za.useLongestToken=!0;za.tokenize=md.tokenize;za.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,n=r===void 0?function(s,a){return typeof a=="undefined"?t:a}:r;return typeof o=="string"?o:JSON.stringify(ud(o,null,null,n),n,"  ")};za.equals=function(o,e){return Ho.prototype.equals.call(za,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function ud(o,e,t,r,n){e=e||[],t=t||[],r&&(o=r(n,o));var s;for(s=0;s<e.length;s+=1)if(e[s]===o)return t[s];var a;if(o2.call(o)==="[object Array]"){for(e.push(o),a=new Array(o.length),t.push(a),s=0;s<o.length;s+=1)a[s]=ud(o[s],e,t,r,n);return e.pop(),t.pop(),a}if(o&&o.toJSON&&(o=o.toJSON()),Sl(o)==="object"&&o!==null){e.push(o),a={},t.push(a);var i=[],l;for(l in o)o.hasOwnProperty(l)&&i.push(l);for(i.sort(),s=0;s<i.length;s+=1)l=i[s],a[l]=ud(o[l],e,t,r,l);e.pop(),t.pop()}else a=o;return a}var dd=new Ho;dd.tokenize=function(o){return o.slice()};dd.join=dd.removeEmpty=function(o){return o};function $x(o,e,t,r,n,s,a){a||(a={}),typeof a.context=="undefined"&&(a.context=4);var i=JC(t,r,a);if(!i)return;i.push({value:"",lines:[]});function l(v){return v.map(function(D){return" "+D})}for(var c=[],u=0,d=0,m=[],x=1,h=1,_=function(D){var B=i[D],A=B.lines||B.value.replace(/\n$/,"").split(`
`);if(B.lines=A,B.added||B.removed){var F;if(!u){var O=i[D-1];u=x,d=h,O&&(m=a.context>0?l(O.lines.slice(-a.context)):[],u-=m.length,d-=m.length)}(F=m).push.apply(F,fd(A.map(function(V){return(B.added?"+":"-")+V}))),B.added?h+=A.length:x+=A.length}else{if(u)if(A.length<=a.context*2&&D<i.length-2){var M;(M=m).push.apply(M,fd(l(A)))}else{var E,R=Math.min(A.length,a.context);(E=m).push.apply(E,fd(l(A.slice(0,R))));var G={oldStart:u,oldLines:x-u+R,newStart:d,newLines:h-d+R,lines:m};if(D>=i.length-2&&A.length<=a.context){var le=/\n$/.test(t),j=/\n$/.test(r),ae=A.length==0&&m.length>G.oldLines;!le&&ae&&t.length>0&&m.splice(G.oldLines,0,"\\ No newline at end of file"),(!le&&!ae||!j)&&m.push("\\ No newline at end of file")}c.push(G),u=0,d=0,m=[]}x+=A.length,h+=A.length}},b=0;b<i.length;b++)_(b);return{oldFileName:o,newFileName:e,oldHeader:n,newHeader:s,hunks:c}}var Hx=require("obsidian");var kl=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var Ll=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let n=0,s=0;for(let a=0;a<r.lines.length;a+=1){let i=r.lines[a];if(i.startsWith("+")||i.startsWith("-")){let l=a,c=l;for(;c<r.lines.length-1&&(r.lines[c+1].startsWith("+")||r.lines[c+1].startsWith("-"));)c+=1;let u=r.lines.slice(l,c+1).filter(m=>m.startsWith("-")).map(m=>m.slice(1)),d=r.lines.slice(l,c+1).filter(m=>m.startsWith("+")).map(m=>m.slice(1));t.push(new kl({file1Start:r.oldStart+l-s-1,file2Start:r.newStart+l-n-1,file1Lines:u,file2Lines:d})),n+=u.length,s+=d.length,a+=c-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function hd(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function Va(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function qa(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function Vs(o){return o!==""?o:"\u200E"}var ur=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var mo=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var xd=require("obsidian");var Bx=es(td());var yr=class extends Et{constructor(t){super();this.observableName=t;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,n]of this._map)if(t(n,r))return n}some(t){for(let[r,n]of this._map)if(t(n,r))return!0;return!1}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let n=new gd(this,t);return this._derivedMaps.set(t,n),n}},gd=class extends yr{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.sub(),this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(()=>{let t=new Map;this.parentMap.forEach((r,n)=>{this.predicate(r,n)&&t.set(n,r)}),this._map=t,this.notifyListeners()}))}subscribe(t){return this.sub(),super.subscribe(t),()=>{this.unsubscribe(t)}}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){this.unsub&&this.unsub()}};function Wa(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let n=Math.min(t.length,r.length);for(let s=0;s<n;s++)if(t[s]!==r[s]){if(s===t.length-1){let a=t[s].match(/\d+/g),i=r[s].match(/\d+/g);if(a&&i){let l=parseInt(a[0]),c=parseInt(i[0]);if(l!==c)return l-c}}return t[s].localeCompare(r[s])}return t.length-r.length}function Nx(o,e){let t=o.getText("contents"),r=t.toString(),n=new Bx.diff_match_patch,s=n.diff_main(r,e);n.diff_cleanupSemantic(s);let a=0,i=Se("[updateYDocFromDiskBuffer]","debug");i("Updating YDoc:"),i("Current content length:",r.length),i("Disk buffer length:",e.length),s.length!=0&&(o.transact(()=>{for(let[l,c]of s)switch(l){case 1:i(`Inserting "${c}" at position ${a}`),t.insert(a,c),a+=c.length;break;case 0:i(`Keeping "${c}" (length: ${c.length})`),a+=c.length;break;case-1:i(`Deleting "${c}" at position ${a}`),t.delete(a,c.length);break}}),i("Update complete. New content length:",t.toString().length))}var Il=class{constructor(e,t,r,n=3){this.loginManager=e;this.timeProvider=t;this.sharedFolders=r;this.concurrency=n;this.activeSync=new Uo;this.activeDownloads=new Uo;this.syncGroups=new yr;this.syncLog=new Uo;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.maxLogEntries=100;this.subscriptions=[];this.log=Se("[BackgroundSync]","log");this.debug=Se("[BackgroundSync]","debug");this.error=Se("[BackgroundSync]","error");this.start=this.resume;Wt.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let e=0,t=0,r=0,n=0,s=0,a=0;this.syncGroups.forEach(u=>{e+=u.total,t+=u.completed,r+=u.syncs,n+=u.completedSyncs,s+=u.downloads,a+=u.completedDownloads});let i=e>0?t/e*100:0,l=r>0?n/r*100:0,c=s>0?a/s*100:0;return{totalPercent:Math.round(i),syncPercent:Math.round(l),downloadPercent:Math.round(c),totalItems:e,completedItems:t,syncItems:r,completedSyncs:n,downloadItems:s,completedDownloads:a}}getGroupProgress(e){let t=this.syncGroups.get(e);if(!t)return null;let r=t.total>0?t.completed/t.total*100:0,n=t.syncs>0?t.completedSyncs/t.syncs*100:0,s=t.downloads>0?t.completedDownloads/t.downloads*100:0;return{percent:Math.round(r),syncPercent:Math.round(n),downloadPercent:Math.round(s),sharedFolder:e,status:t.status}}getAllGroupsProgress(){let e=[];return this.syncGroups.forEach((t,r)=>{let n=this.getGroupProgress(r);n&&e.push(n)}),e}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let e=this.syncQueue.filter(t=>t.sharedFolder.connected);for(;e.length>0&&this.activeSync.size<this.concurrency;){let t=e.shift();if(!t)break;this.syncQueue=this.syncQueue.filter(r=>r.guid!==t.guid),t.status="running",this.activeSync.add(t),this.addToLog({guid:t.guid,path:t.path,type:"sync",status:"running",sharedFolderGuid:t.sharedFolder.guid});try{let r=t.doc;await this.syncDocument(r),t.status="completed",this.addToLog({guid:t.guid,path:t.path,type:"sync",status:"completed",sharedFolderGuid:t.sharedFolder.guid});let n=this.syncCompletionCallbacks.get(t.guid);n&&(n.resolve(),this.syncCompletionCallbacks.delete(t.guid));let s=this.syncGroups.get(t.sharedFolder);s&&(this.debug(`[Sync Progress] Before: completed=${s.completed}, total=${s.total}, syncs=${s.syncs}, completedSyncs=${s.completedSyncs}`),s.completedSyncs++,s.completed++,this.debug(`[Sync Progress] After: completed=${s.completed}, total=${s.total}, syncs=${s.syncs}, completedSyncs=${s.completedSyncs}`),s.completed===s.total&&(s.status="completed",this.debug("[Sync Progress] Group completed!"),this.addToLog({guid:s.sharedFolder.guid,path:`${s.sharedFolder.path} (group)`,type:"sync",status:"completed",sharedFolderGuid:s.sharedFolder.guid})),this.syncGroups.set(t.sharedFolder,s))}catch(r){t.status="failed",this.addToLog({guid:t.guid,path:t.path,type:"sync",status:"failed",sharedFolderGuid:t.sharedFolder.guid,error:r instanceof Error?r.message:String(r)});let n=this.syncCompletionCallbacks.get(t.guid);n&&(n.reject(r instanceof Error?r:new Error(String(r))),this.syncCompletionCallbacks.delete(t.guid));let s=this.syncGroups.get(t.sharedFolder);s&&(this.error("[Sync Failed]",r),s.status="failed",this.syncGroups.set(t.sharedFolder,s),this.addToLog({guid:s.sharedFolder.guid,path:`${s.sharedFolder.path} (group)`,type:"sync",status:"failed",sharedFolderGuid:s.sharedFolder.guid,error:r instanceof Error?r.message:String(r)}))}finally{this.activeSync.delete(t),this.inProgressSyncs.delete(t.guid)}}this.isProcessingSync=!1,this.syncQueue.length>0&&!this.isPaused&&this.syncQueue.some(r=>r.sharedFolder.connected)&&this.processSyncQueue()}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let e=this.downloadQueue.filter(t=>t.sharedFolder.connected);for(;e.length>0&&this.activeDownloads.size<this.concurrency;){let t=e.shift();if(!t)break;this.downloadQueue=this.downloadQueue.filter(r=>r.guid!==t.guid),t.status="running",this.activeDownloads.add(t),this.addToLog({guid:t.guid,path:t.path,type:"download",status:"running",sharedFolderGuid:t.sharedFolder.guid});try{await this.getDocument(t.doc),t.status="completed",this.addToLog({guid:t.guid,path:t.path,type:"download",status:"completed",sharedFolderGuid:t.sharedFolder.guid});let r=this.downloadCompletionCallbacks.get(t.guid);r&&(r.resolve(),this.downloadCompletionCallbacks.delete(t.guid));let n=this.syncGroups.get(t.sharedFolder);n&&(n.completedDownloads++,n.completed++,n.completed===n.total&&(n.status="completed",this.addToLog({guid:n.sharedFolder.guid,path:`${n.sharedFolder.path} (group)`,type:"download",status:"completed",sharedFolderGuid:n.sharedFolder.guid})),this.syncGroups.set(t.sharedFolder,n))}catch(r){t.status="failed",this.addToLog({guid:t.guid,path:t.path,type:"download",status:"failed",sharedFolderGuid:t.sharedFolder.guid,error:r instanceof Error?r.message:String(r)});let n=this.downloadCompletionCallbacks.get(t.guid);n&&(n.reject(r instanceof Error?r:new Error(String(r))),this.downloadCompletionCallbacks.delete(t.guid));let s=this.syncGroups.get(t.sharedFolder);s&&(s.status="failed",this.syncGroups.set(t.sharedFolder,s),this.addToLog({guid:s.sharedFolder.guid,path:`${s.sharedFolder.path} (group)`,type:"download",status:"failed",sharedFolderGuid:s.sharedFolder.guid,error:r instanceof Error?r.message:String(r)})),this.error("[processDownloadQueue]",r)}finally{this.activeDownloads.delete(t),this.inProgressDownloads.delete(t.guid)}}this.isProcessingDownloads=!1,this.downloadQueue.length>0&&!this.isPaused&&this.downloadQueue.some(r=>r.sharedFolder.connected)&&this.processDownloadQueue()}async enqueueSync(e){if(this.inProgressSyncs.has(e.guid)){this.debug(`[enqueueSync] Item ${e.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(e.guid);return a?new Promise((i,l)=>{a.resolve=i,a.reject=l}):(this.processSyncQueue(),Promise.resolve())}let t=e.sharedFolder,r={guid:e.guid,path:t.getPath(e.path),doc:e,status:"pending",sharedFolder:t},n=this.syncGroups.get(t);n?(n.total++,n.syncs++):n={sharedFolder:t,total:1,completed:0,status:"pending",downloads:0,syncs:1,completedDownloads:0,completedSyncs:0},this.syncGroups.set(t,n),this.addToLog({guid:e.guid,path:r.path,type:"sync",status:"pending",sharedFolderGuid:t.guid}),this.inProgressSyncs.add(e.guid);let s=new Promise((a,i)=>{this.syncCompletionCallbacks.set(e.guid,{resolve:a,reject:i})});return this.syncQueue.push(r),this.syncQueue.sort(Wa),this.processSyncQueue(),s}enqueueDownload(e){if(this.inProgressDownloads.has(e.guid)){this.debug(`[enqueueDownload] Item ${e.guid} already in progress, skipping`);let a=this.downloadCompletionCallbacks.get(e.guid);return a?(this.processDownloadQueue(),new Promise((i,l)=>{a.resolve=i,a.reject=l})):(this.processDownloadQueue(),Promise.resolve())}let t=e.sharedFolder,r=this.syncGroups.get(t);r||(r={sharedFolder:t,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),r.downloads++,r.total++,this.syncGroups.set(t,r);let n={guid:e.guid,path:t.getPath(e.path),doc:e,status:"pending",sharedFolder:t};this.addToLog({guid:e.guid,path:n.path,type:"download",status:"pending",sharedFolderGuid:t.guid}),this.inProgressDownloads.add(e.guid);let s=new Promise((a,i)=>{this.downloadCompletionCallbacks.set(e.guid,{resolve:a,reject:i})});return this.downloadQueue.push(n),this.downloadQueue.sort(Wa),this.processDownloadQueue(),s}enqueueSharedFolderSync(e){let t=[...e.docs.values()],r={sharedFolder:e,total:t.length,completed:0,status:"pending",downloads:0,syncs:t.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(e,r),this.addToLog({guid:e.guid,path:`${e.path} (group sync started)`,type:"sync",status:"pending",sharedFolderGuid:e.guid});let n=[...t].sort(Wa);for(let s of n)this.enqueueDocumentForGroupSync(s);r.status="running",this.syncGroups.set(e,r),this.addToLog({guid:e.guid,path:`${e.path} (group sync running)`,type:"sync",status:"running",sharedFolderGuid:e.guid})}async enqueueDocumentForGroupSync(e){if(this.inProgressSyncs.has(e.guid)){this.debug(`[enqueueDocumentForGroupSync] Item ${e.guid} already in progress, skipping`);let s=this.syncCompletionCallbacks.get(e.guid);return s?(this.processSyncQueue(),new Promise((a,i)=>{s.resolve=a,s.reject=i})):Promise.resolve()}let t=e.sharedFolder,r={guid:e.guid,path:t.getPath(e.path),doc:e,status:"pending",sharedFolder:t};this.addToLog({guid:e.guid,path:r.path,type:"sync",status:"pending",sharedFolderGuid:t.guid}),this.inProgressSyncs.add(e.guid);let n=new Promise((s,a)=>{this.syncCompletionCallbacks.set(e.guid,{resolve:s,reject:a})});return this.syncQueue.push(r),this.syncQueue.sort(Wa),this.processSyncQueue(),n}getAuthHeader(e){var t;return{Authorization:Fr().enableDocumentServer?`Bearer ${e.token}`:`Bearer ${(t=this.loginManager.user)==null?void 0:t.token}`}}getBaseUrl(e,t){var a;let r=new URL(e.url);r.protocol="https:";let n=r.pathname.split("/");n.pop(),n.push(e.docId),r.pathname=n.join("/");let s=((a=e.baseUrl)==null?void 0:a.replace(/\/$/,""))||r.toString();return Fr().enableDocumentServer?s:`https://api.system3.md/relay/${t.relayId}/doc/${t.documentId}`}async downloadItem(e){let t=e.s3rn;if(this.log("[downloadItem]",e.path,`${Qt.encode(t)}`),!(t instanceof Yr))throw new Error("Unable to decode S3RN");let r=await e.getProviderToken(),n=this.getAuthHeader(r),s=this.getBaseUrl(r,t),a=`${s}/as-update`,i=await(0,xd.requestUrl)({url:a,method:"GET",headers:n});return i.status===200?this.debug("[downloadItem]",t.documentId,i.status):this.error("[downloadItem]",t.documentId,s,i.status,i.text),i}async syncDocumentWebsocket(e){let t=e.text,r="";try{r=await e.sharedFolder.read(e)}catch(i){}if(!(t===r)&&r)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let s=e.onceProviderSynced(),a=e.intent;return e.connect(),a==="disconnected"&&!e.userLock&&await s,a==="disconnected"&&!e.userLock&&(e.disconnect(),e.sharedFolder.tokenStore.removeFromRefreshQueue(Qt.encode(e.s3rn))),!0}async uploadItem(e){let t=e.s3rn;if(this.log("[uploadItem]",`${Qt.encode(t)}`),!(t instanceof Yr))throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let r=await e.getProviderToken(),n={"Content-Type":"application/octet-stream",...this.getAuthHeader(r)},s=Rn(e.ydoc),i=`${this.getBaseUrl(r,t)}/update`,l=await(0,xd.requestUrl)({url:i,method:"POST",headers:n,body:s.buffer,throw:!1});return l.status===200?this.debug("[uploadItem]",t.documentId,l.status,l.text):this.error("[uploadItem]",t.documentId,i,l.status,l.text),l}async getDocument(e,t=3,r=3e3){try{let n=e.text,s="";try{s=await e.sharedFolder.read(e)}catch(h){}let a=n===s,i=s!=="",c=(await this.downloadItem(e)).arrayBuffer,u=new Uint8Array(c),d=new gr;Fo(d,u);let m=d.getMap("users");if(d.getText("contents").toString()===""){if(m.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",m.size,t,r),t>0&&this.timeProvider.setTimeout(()=>{this.getDocument(e,t-1,r*2)},r);return}if(e.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(e);return}}if(this.log("[getDocument] applying content from server"),Fo(e.ydoc,u),i&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}e.sharedFolder.ids.has(e.path)&&(e.sharedFolder.flush(e,e.text),this.log("[getDocument] flushed"))}catch(n){throw this.error(n),n}}async syncItem(e){let t=e.text,r="";try{r=await e.sharedFolder.read(e)}catch(d){}if(!(t===r))return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let s=await this.downloadItem(e);if(s.status!==200)return this.log("server returned an error."),!1;let a=s.arrayBuffer,i=new Uint8Array(a),l=new gr;Fo(l,i);let c=l.getText("contents").toString();return l.getMap("users").size>0&&c===t||(Fo(e.ydoc,i),e.sharedFolder.flush(e,e.text),this.uploadItem(e)),!0}async syncDocument(e){var t;try{Fr().enableHTTPSync&&((t=e.sharedFolder.remote)!=null&&t.relay.provider)?await this.syncItem(e):(this.debug("fallback to websocket sync"),await this.syncDocumentWebsocket(e))}catch(r){console.error(r);return}}subscribeToSync(e){return this.activeSync.subscribe(e)}subscribeToDownloads(e){return this.activeDownloads.subscribe(e)}subscribeToSyncGroups(e){return this.syncGroups.subscribe(e)}subscribeToProgress(e){let t=()=>{e(this.getOverallProgress())},r=this.activeSync.subscribe(()=>t()),n=this.activeDownloads.subscribe(()=>t()),s=this.syncGroups.subscribe(()=>t());return()=>{r(),n(),s()}}addToLog(e){let t=Date.now(),r=e.id||`log-${e.type}-${e.guid}-${e.status}-${t}`,n=`${e.type}-${e.guid}-${e.status}`;if(!this.loggedItems.has(n)){this.loggedItems.set(n,!0);let s={id:r,timestamp:t,path:e.path||"",type:e.type||"sync",status:e.status||"pending",guid:e.guid||r,sharedFolderGuid:e.sharedFolderGuid||"",error:e.error};this.syncLog.add(s),this.trimLog()}}getSyncLog(){let e=[];return this.syncLog.forEach(t=>e.push(t)),e.sort((t,r)=>r.timestamp-t.timestamp)}clearSyncLog(){this.syncLog.clear(),this.loggedItems.clear()}trimLog(){let e=this.getSyncLog();if(e.length>this.maxLogEntries){let t=e.slice(0,this.maxLogEntries);this.syncLog.clear(),t.forEach(r=>{this.syncLog.add(r)})}}async retryLogItem(e){try{let t=[];this.sharedFolders.forEach(s=>t.push(s));let r=t.find(s=>s.guid===e.sharedFolderGuid);if(!r)return this.log("Retry failed: Shared folder not found"),!1;let n=r.docs.get(e.guid);return n?(this.addToLog({guid:e.guid,path:e.path,type:e.type,status:"pending",sharedFolderGuid:e.sharedFolderGuid}),e.type==="sync"?(await this.enqueueSync(n),this.log(`Retrying sync for ${e.path}`)):(await this.enqueueDownload(n),this.log(`Retrying download for ${e.path}`)),!0):(this.log("Retry failed: Document not found"),!1)}catch(t){return this.error("Error retrying item:",t),this.addToLog({guid:e.guid,path:e.path,type:e.type,status:"failed",sharedFolderGuid:e.sharedFolderGuid,error:t instanceof Error?t.message:String(t)}),!1}}subscribeToSyncLog(e){return this.syncLog.subscribe(e)}subscribeToGroupProgress(e,t){return this.syncGroups.subscribe(()=>{t(this.getGroupProgress(e))})}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[e,t]of this.syncCompletionCallbacks)t.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(e);for(let[e,t]of this.downloadCompletionCallbacks)t.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(e);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncLog.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.sharedFolders=null,this.timeProvider=null,this.subscriptions.forEach(e=>e())}};var Cl=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof po){Nx(e.ydoc,t);return}else if(e instanceof un){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,n=this.difference.file2Lines.length>0;n&&r?(new ur({text:"Accept Top (Editor)",onClick:s=>this.acceptTopClick(s,this.difference)}).build(t),mo.build(t),new ur({text:"Accept Bottom (Local Disk)",onClick:s=>this.acceptBottomClick(s,this.difference)}).build(t),mo.build(t),new ur({text:"Accept All",onClick:s=>this.acceptAllClick(s,this.difference)}).build(t),mo.build(t),new ur({text:"Accept None",onClick:s=>this.acceptNoneClick(s,this.difference)}).build(t)):r?(new ur({text:"Keep in Editor",onClick:s=>this.insertFile1Difference(s,this.difference)}).build(t),mo.build(t),new ur({text:"Discard in Editor",onClick:s=>this.discardFile1Difference(s,this.difference)}).build(t)):n&&(new ur({text:"Accept from Local Disk",onClick:s=>this.insertFile2Difference(s,this.difference)}).build(t),mo.build(t),new ur({text:"Discard on Disk",onClick:s=>this.discardFile2Difference(s,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=Va({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=Va({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),n=Va({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n);let s=Va({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=qa({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let n=qa({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=hd({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=hd({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,n),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=qa({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=qa({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var qs="system3-differences-view";async function zx(o,e){o.detachLeavesOfType(qs);let t=o.getLeaf(!0);t.setViewState({type:qs,active:!0,state:e}),o.revealLeaf(t)}var Tl=class extends Hx.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[]}async getContent(t){return t instanceof po?t.text:t instanceof un?t.contents:await this.app.vault.cachedRead(t)}getViewType(){return qs}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,n;if(((r=this.state)==null?void 0:r.file1)==null||((n=this.state)==null?void 0:n.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(s=>s.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(s=>s.trimEnd());let t=$x(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));this.fileDifferences=Ll.fromParsedDiff(t),this.fileDifferences.differences.length===0&&this.leaf.detach()}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new ur({text:"Keep Editor Contents",onClick:async n=>{n.preventDefault(),await this.acceptAllFromLeft()}}).build(r),mo.build(r),new ur({text:"Accept All from Local Disk",onClick:async n=>{n.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async acceptAllFromLeft(){!this.state||!this.fileDifferences||(await this.app.vault.modify(this.state.file2,this.file1Content||""),this.leaf.detach())}async acceptAllFromRight(){!this.state||!this.fileDifferences||(await this.app.vault.modify(this.state.file1,this.file2Content||""),this.leaf.detach())}buildLines(t){var a,i,l;let r=0,n=0,s=Math.max(((a=this.file1Lines)==null?void 0:a.length)||0,((i=this.file2Lines)==null?void 0:i.length)||0);for(;r<=s||n<=s;){let c=(l=this.fileDifferences)==null?void 0:l.differences.find(u=>u.file1Start===r&&u.file2Start===n);if(c!=null){let u=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(u,c),r+=c.file1Lines.length,n+=c.file2Lines.length}else{let u=r<=n?this.file1Lines[r]:this.file2Lines[n];t.createDiv({text:Vs(u),cls:"file-diff__line"}),r+=1,n+=1}}}buildDifferenceVisualizer(t,r){var n;(n=this.state)!=null&&n.showMergeOption&&new Cl(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let s=0;s<r.file1Lines.length;s+=1){let a=r.file1Lines[s],i=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),c=this.buildDiffLine(a,i,"file-diff_top-line__character");(s<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),s!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(c)}for(let s=0;s<r.file2Lines.length;s+=1){let a=r.file1Lines[s],i=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),c=this.buildDiffLine(i,a,"file-diff_bottom-line__character");(s==0&&r.file1Lines.length>0||s>0)&&l.classList.add("file-diff__no-top-border"),s<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(c)}}buildDiffLine(t,r,n){let s=document.createElement("div");if(t!=null&&t.length===0)s.textContent=Vs(t);else if(t!=null&&r!=null){let a=Ux(r,t);for(let i of a){if(i.removed)continue;let l=document.createElement("span");l.textContent=Vs(i.value),i.added&&l.classList.add(n),s.appendChild(l)}}else if(t!=null&&r==null){let a=document.createElement("span");a.textContent=Vs(t),a.classList.add(n),s.appendChild(a)}else s.textContent=Vs(t);return s}scrollToFirstDifference(){var n;if(((n=this.fileDifferences)==null?void 0:n.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var a2=3;function yd(o,e){o.iterateAllLeaves(t=>{t.view instanceof Ws.MarkdownView&&e(t.view)})}function i2(o,e){var t,r,n,s;if(o.length!==e.length)return!1;for(let a=0;a<o.length;a++)if(((t=o[a].view.file)==null?void 0:t.path)!==((r=e[a].view.file)==null?void 0:r.path)||((n=o[a].document)==null?void 0:n.path)!==((s=e[a].document)==null?void 0:s.path))return!1;return!0}var bd=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new Hs(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){this.release(),this.banner=void 0,this.view=null}};function Bo(o){return o instanceof hn&&o.document!==void 0&&o.document.text!==void 0}var hn=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new Hs(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new Hs(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Cx({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.document.userLock=!0,this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect(),this.document.userLock=!1}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},Pl=class{constructor(e,t,r,n){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=n,this.refreshQueue=[],this._compartment=new Dl.Compartment,this.log=Se("[LiveViews]","log"),this.warn=Se("[LiveViews]","warn"),this.metadataListeners=new Map;let s=(l,c,u)=>{let d=this.metadataListeners.get(l);d==null||d(c,u)},a=this.app.metadataCache.on("changed",s);this.offListeners.push(()=>{this.app.metadataCache.offref(a)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let i=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(c=>{this.views.forEach(u=>{var d;((d=u.document)==null?void 0:d.sharedFolder)===l&&u.offlineBanner()})}))(),l.docset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,c)=>{this.sharedFolders.has(c)||(l(),this.folderListeners.delete(c))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,i(l))})})),Wt.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([mn.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){zx(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return yd(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(yd(this.workspace,r=>{var a;let n=(a=r.file)==null?void 0:a.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return yd(this.workspace,async t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let a=await n.getFile(r),i=new hn(this,t,a);e.push(i)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let a=new bd(this,t,()=>this.loginManager.openLoginPage());e.push(a)}}),e}findView(e){return this.views.find(t=>t.view.editor.cm===e)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof hn).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=a2){let r=this.workspace.getActiveViewOfType(Ws.MarkdownView),n=0,s=e.sort((i,l)=>l.view.leaf.activeTime-i.view.leaf.activeTime),a=new Set;for(let i of s)i instanceof hn&&(i.view===r||a.has(i.document)?(i.canConnect=!0,a.add(i.document)):n<t?(i.canConnect=!0,a.add(i.document),n++):i.canConnect=!1);return n>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${n-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(n=>{let s=e.find(a=>{if(n.document==a.document&&n.view==a.view)return!0});s?(r.push(n),e.remove(s)):t.push(n)}),e.forEach(n=>{r.push(n)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,n=Se(r,"debug"),s=(d,m)=>{n(d,m.map(x=>{var h;return{type:x.constructor.name,file:(h=x.document)==null?void 0:h.path,canConnect:x.canConnect}}))};if(n("Refresh"),this.destroyed)return!1;await this.foldersReady();let a=[];try{a=await this.getViews()}catch(d){return this.warn("[System 3][Relay][Live Views] error getting views",d),!1}let i=this.findFolders();if(i.length===0&&a.length===0)return this.extensions.length!==0&&(n("Unexpected plugins loaded."),this.wipe()),s("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?i.forEach(d=>{d.connect()}):this.sharedFolders.forEach(d=>{d.disconnect()});let[l,c]=this.deduplicate(a);if(s("Releasing Views",c),this.releaseViews(c),c.length===0&&i2(l,this.views)){let d=await this.viewsAttachedWithConnectionPool(this.views);s("Attached Views",d)}else{let d=await this.viewsReady(l);s("Ready Views",d);let m=await this.viewsAttachedWithConnectionPool(d);s("Attached Views",m),this.views=l}n("loading plugins"),this.load();let u=Ws.moment.utc();return n(`refresh completed in ${u.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=Se(e,"warn"),r=Ws.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let n=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=n().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(mn.init(()=>this)),Dx,Ax,Ex,Fx]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},mn=Dl.StateField.define({create(o){},update(o,e){return o}});var Gs=require("obsidian");function l2(o){Ae(o,"svelte-1vj9882",".folder-icons.svelte-1vj9882{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.icon.svelte-1vj9882{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1vj9882{color:var(--color-accent)}span.system3-disconnected.svelte-1vj9882{color:var(--color-base-40)}span.notebook.svelte-1vj9882{color:var(--color-accent)}span.hidden.svelte-1vj9882{display:none}.system3-progress-text.svelte-1vj9882{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1vj9882{animation:svelte-1vj9882-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1vj9882{color:var(--color-red)}@keyframes svelte-1vj9882-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function Vx(o){let e,t,r,n;return{c(){e=C("span"),t=W(o[3]),r=W("%"),w(e,"class",n="system3-progress-text system3-"+o[4]+" svelte-1vj9882"),ge(e,"opacity","1")},m(s,a){T(s,e,a),k(e,t),k(e,r)},p(s,a){a&8&&oe(t,s[3]),a&16&&n!==(n="system3-progress-text system3-"+s[4]+" svelte-1vj9882")&&w(e,"class",n)},d(s){s&&I(e)}}}function f2(o){let e,t,r;return t=new $o({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=C("span"),z(t.$$.fragment),w(e,"class","notebook icon svelte-1vj9882"),w(e,"aria-label","Tracking Changes")},m(n,s){T(n,e,s),N(t,e,null),r=!0},p:Q,i(n){r||(L(t.$$.fragment,n),r=!0)},o(n){P(t.$$.fragment,n),r=!1},d(n){n&&I(e),H(t)}}}function c2(o){let e,t,r,n,s,a,i,l;return t=new $o({props:{class:"inline-icon",style:"width: 0.8em"}}),s=new Vn({props:{class:"inline-icon"}}),{c(){var c;e=C("span"),z(t.$$.fragment),r=$(),n=C("span"),z(s.$$.fragment),w(e,"class","notebook icon hidden svelte-1vj9882"),w(e,"aria-label","Tracking Changes"),w(n,"class",a="satellite icon system3-"+o[0]+" svelte-1vj9882"),w(n,"aria-label",i=`${((c=o[2])==null?void 0:c.relay.name)||"Relay Server"} (${o[0]})`)},m(c,u){T(c,e,u),N(t,e,null),T(c,r,u),T(c,n,u),N(s,n,null),l=!0},p(c,u){var d;(!l||u&1&&a!==(a="satellite icon system3-"+c[0]+" svelte-1vj9882"))&&w(n,"class",a),(!l||u&5&&i!==(i=`${((d=c[2])==null?void 0:d.relay.name)||"Relay Server"} (${c[0]})`))&&w(n,"aria-label",i)},i(c){l||(L(t.$$.fragment,c),L(s.$$.fragment,c),l=!0)},o(c){P(t.$$.fragment,c),P(s.$$.fragment,c),l=!1},d(c){c&&(I(e),I(r),I(n)),H(t),H(s)}}}function u2(o){let e,t,r,n,s,a=o[5]&&Vx(o),i=[c2,f2],l=[];function c(u,d){return u[1]?0:1}return r=c(o,-1),n=l[r]=i[r](o),{c(){e=C("div"),a&&a.c(),t=$(),n.c(),w(e,"class","folder-icons svelte-1vj9882")},m(u,d){T(u,e,d),a&&a.m(e,null),k(e,t),l[r].m(e,null),s=!0},p(u,[d]){u[5]?a?a.p(u,d):(a=Vx(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null);let m=r;r=c(u,d),r===m?l[r].p(u,d):(we(),P(l[m],1,1,()=>{l[m]=null}),_e(),n=l[r],n?n.p(u,d):(n=l[r]=i[r](u),n.c()),L(n,1),n.m(e,null))},i(u){s||(L(n),s=!0)},o(u){P(n),s=!1},d(u){u&&I(e),a&&a.d(),l[r].d()}}}function d2(o,e,t){let r,{status:n="disconnected"}=e,{relayId:s}=e,{remote:a}=e,{progress:i=0}=e,{syncStatus:l="pending"}=e;return o.$$set=c=>{"status"in c&&t(0,n=c.status),"relayId"in c&&t(1,s=c.relayId),"remote"in c&&t(2,a=c.remote),"progress"in c&&t(3,i=c.progress),"syncStatus"in c&&t(4,l=c.syncStatus)},o.$$.update=()=>{if(o.$$.dirty&24){e:t(5,r=(l!=="completed"||i<100)&&i>0)}},[n,s,a,i,l,r]}var wd=class extends J{constructor(e){super(),X(this,e,d2,u2,Y,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},l2)}},qx=wd;function p2(o){Ae(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function m2(o){let e,t,r;return{c(){e=C("div"),t=C("span"),r=W(o[0]),w(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),w(e,"aria-label",o[1])},m(n,s){T(n,e,s),k(e,t),k(t,r)},p(n,[s]){s&1&&oe(r,n[0]),s&2&&w(e,"aria-label",n[1])},i:Q,o:Q,d(n){n&&I(e)}}}function h2(o,e,t){let{text:r}=e,{label:n}=e;return o.$$set=s=>{"text"in s&&t(0,r=s.text),"label"in s&&t(1,n=s.label)},[r,n]}var _d=class extends J{constructor(e){super(),X(this,e,h2,m2,Y,{text:0,label:1},p2)}},Al=_d;var vd=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,n)=>{for(let s of r)s.type==="childList"&&e.nextSibling&&(t(e),n.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},zo=class{visitFolder(e,t,r,n){return null}visitFile(e,t,r,n){return null}},Sd=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new vd(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},kd=class extends zo{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new Sd(t.selfEl,n):(r&&r.destroy(),null)}},Ld=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.el.addClass("system3-pill"),this.pill=new qx({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let r=[];r.push(this.sharedFolder.subscribe(this.el,n=>{this.pill.$set({status:n.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),r.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,n=>{n&&this.pill.$set({progress:n.percent,syncStatus:n.status})})),this.unsubscribe=()=>r.forEach(n=>n())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},Id=class extends zo{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new Ld(t.selfEl,n):(r&&r.destroy(),null)}},Cd=class{constructor(e,t,r,n){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=n;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},Td=class extends zo{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,n,s){return s&&s.ready&&s.checkExtension(t.path)&&s.checkPath(t.path)?n||new Cd(r.el,t.path,this.activeSync,this.activeDownloads):(n&&n.destroy(),null)}},Pd=class{constructor(e,t){this.el=e;this.doc=t;this.el.querySelectorAll(".system3-filepill").forEach(n=>{n.remove()}),this.pill=new Al({target:this.el,props:{text:`${t.guid.slice(0,3)}`}});let r=async()=>{await t.whenSynced(),await t.count(),this.pill.$set({text:`${t.guid.slice(0,3)} ${t.dbsize}`})};t.whenReady().then(()=>{t.ydoc.on("update",r),r()}),this.unsubscribe=()=>{t.ydoc.off("update",r)}}destroy(){var e;this.pill.$destroy(),(e=this.unsubscribe)==null||e.call(this),this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()})}},Dd=class extends zo{visitFile(e,t,r,n){if(n&&n.ready&&n.checkExtension(e.path)){let s=n.viewFile(e.path);return!s||!s.ready?null:r||new Pd(t.selfEl,s)}return r&&r.destroy(),null}},Ad=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new Al({target:this.el,props:{text:"NOT SYNCED",label:"Relay does not support this file type."}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},Ed=class extends zo{visitFile(e,t,r,n){return n&&!n.checkExtension(e.path)?r||new Ad(t.selfEl):(r&&r.destroy(),null)}},Md=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,n=>{this.docStatus(n)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},Fd=class extends zo{visitFile(e,t,r,n){if(n)try{let s=n.ids.get(n.getVirtualPath(e.path));if(!s)return null;let a=n.docs.get(s);return a?r||new Md(t.el,a,e):null}catch(s){return null}return r&&r.destroy(),null}},Rd=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new Al({target:this.el,props:{text:"DESYNC",label:"File content does not match document content"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},Od=class extends zo{visitFile(e,t,r,n){if(n&&n.checkExtension(e.path)){let s=n.viewFile(e.path);if(!s||!s.ready)return null;if(e.stat.size!==s.stat.size)return r||new Rd(t.selfEl)}return r&&r.destroy(),null}},El=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let n of this.visitors)this.storage.set(n,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(s=>s.path===e.path)||t,n=this.getFileExplorerItem(this.fileExplorer,e);n&&this.storage.forEach((s,a)=>{let i=s.get(n),l=a.visitFolder(e,n,i,r);i&&!l?s.delete(n):l&&s.set(n,l)}),e.children.forEach(s=>{if(s instanceof Gs.TFolder)this.walk(s,r);else if(s instanceof Gs.TFile){let a=this.getFileExplorerItem(this.fileExplorer,s);if(!a)return;this.storage.forEach((i,l)=>{let c=i.get(a),u=l.visitFile(s,a,c,r);c&&!u?i.delete(a):u&&i.set(a,u)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},Ml=class{constructor(e,t,r,n){this.layoutReady=!1;this.queueSubscriptions=[];this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=n,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.queueSubscriptions.push(n.activeSync.subscribe(()=>this.quickRefresh()),n.activeDownloads.subscribe(()=>this.quickRefresh()),n.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(s=>{nx([Er.enableDocumentStatus,Er.enableDebugFileTag],()=>{this.offDocumentListeners.get(s)||this.offDocumentListeners.set(s,s.docset.on(()=>{this.refresh()}))}),s.whenReady().then(()=>{this.refresh()})}),this.refresh()}),this.offLayoutChange=(()=>{let s=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(s)}})()}makeVisitors(){let e=[];return e.push(new kd),e.push(new Id),uo(Er.enableDocumentStatus,()=>{e.push(new Fd),e.push(new Td(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),uo(Er.enableDebugFileTag,()=>{e.push(new Dd)}),uo(Er.enableDesyncPill,()=>{e.push(new Od)}),e.push(new Ed),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let n=this.treeState.get(r)||new El(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,n);for(let s of t){let a=this.vault.getAbstractFileByPath(s);a instanceof Gs.TFolder&&n.walk(a)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new El(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let n=this.vault.getAbstractFileByPath("/");n instanceof Gs.TFolder&&r.walk(n)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.queueSubscriptions.forEach(t=>t()),this.queueSubscriptions=[],this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var ob=require("obsidian");function Ze(o,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function i(u){try{c(r.next(u))}catch(d){a(d)}}function l(u){try{c(r.throw(u))}catch(d){a(d)}}function c(u){u.done?s(u.value):n(u.value).then(i,l)}c((r=r.apply(o,e||[])).next())})}var gn=require("obsidian");function g2(o){let e,t,r;return{c(){e=Jr("svg"),t=Jr("g"),r=Jr("path"),w(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),w(r,"fill","#5865F2"),w(r,"fill-rule","nonzero"),w(e,"width",o[0]),w(e,"height",o[0]),w(e,"viewBox","0 -28.5 256 256"),w(e,"version","1.1"),w(e,"xmlns","http://www.w3.org/2000/svg"),w(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),w(e,"preserveAspectRatio","xMidYMid")},m(n,s){T(n,e,s),k(e,t),k(t,r)},p(n,[s]){s&1&&w(e,"width",n[0]),s&1&&w(e,"height",n[0])},i:Q,o:Q,d(n){n&&I(e)}}}function x2(o,e,t){let{size:r="1em"}=e;return o.$$set=n=>{"size"in n&&t(0,r=n.size)},[r]}var Ud=class extends J{constructor(e){super(),X(this,e,x2,g2,Y,{size:0})}},Fl=Ud;function y2(o){Ae(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function Wx(o){let e,t,r,n,s,a,i,l,c,u,d,m,x;return i=new Fl({props:{size:20}}),{c(){e=C("div"),t=C("div"),r=$(),n=C("div"),s=C("span"),a=C("a"),z(i.$$.fragment),l=$(),c=C("span"),c.textContent="Join the community",w(t,"class","arrow svelte-4t8k3t"),w(a,"href","https://discord.system3.md"),w(a,"target","_blank"),w(a,"rel","noopener noreferrer"),w(a,"class","menu-item svelte-4t8k3t"),ge(s,"text-align","center"),ge(s,"display","flex"),w(n,"class","menu-content svelte-4t8k3t"),w(e,"class","menu-dropdown svelte-4t8k3t")},m(h,_){T(h,e,_),k(e,t),k(e,r),k(e,n),k(n,s),k(s,a),N(i,a,null),k(a,l),k(a,c),d=!0,m||(x=cx(u=o[1].call(null,e)),m=!0)},i(h){d||(L(i.$$.fragment,h),d=!0)},o(h){P(i.$$.fragment,h),d=!1},d(h){h&&I(e),H(i),m=!1,x()}}}function b2(o){let e,t,r,n,s,a,i;r=new Hu({props:{size:"20px"}});let l=o[0]&&Wx(o);return{c(){e=C("div"),t=C("button"),z(r.$$.fragment),n=$(),l&&l.c(),w(t,"class","menu-button svelte-4t8k3t"),w(e,"class","menu-container svelte-4t8k3t")},m(c,u){T(c,e,u),k(e,t),N(r,t,null),k(e,n),l&&l.m(e,null),s=!0,a||(i=ee(t,"click",hx(o[2])),a=!0)},p(c,[u]){c[0]?l?u&1&&L(l,1):(l=Wx(c),l.c(),L(l,1),l.m(e,null)):l&&(we(),P(l,1,1,()=>{l=null}),_e())},i(c){s||(L(r.$$.fragment,c),L(l),s=!0)},o(c){P(r.$$.fragment,c),P(l),s=!1},d(c){c&&I(e),H(r),l&&l.d(),a=!1,i()}}}function w2(o,e,t){let r=!1;function n(a){let i=l=>{let c=document.querySelector(".menu-button");!a.contains(l.target)&&l.target!==c&&!(c!=null&&c.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",i)},0),{destroy(){document.removeEventListener("click",i)}}}function s(a){a.stopPropagation(),t(0,r=!r)}return[r,n,s]}var $d=class extends J{constructor(e){super(),X(this,e,w2,b2,Y,{},y2)}},Gx=$d;function _2(o){Ae(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function v2(o){let e,t;return{c(){e=Jr("svg"),t=Jr("path"),w(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),w(e,"class","relay-text svelte-ycfe1d"),w(e,"width",o[0]),w(e,"height",o[1]),w(e,"viewBox","0 0 154.24573 66.293579"),w(e,"xmlns","http://www.w3.org/2000/svg")},m(r,n){T(r,e,n),k(e,t)},p:Q,i:Q,o:Q,d(r){r&&I(e)}}}function S2(o,e,t){let{size:r=64}=e,n=r,s=r/2;return o.$$set=a=>{"size"in a&&t(2,r=a.size)},[n,s,r]}var Bd=class extends J{constructor(e){super(),X(this,e,S2,v2,Y,{size:2},_2)}},Rl=Bd;function k2(o){Ae(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function L2(o){let e,t,r,n,s,a;return e=new Rl({props:{size:140}}),{c(){z(e.$$.fragment),t=$(),r=C("p"),r.textContent="Real-time collaboration in Obsidian",n=$(),s=C("p"),s.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,w(r,"class","subtitle svelte-120r7kg"),w(s,"class","description svelte-120r7kg")},m(i,l){N(e,i,l),T(i,t,l),T(i,r,l),T(i,n,l),T(i,s,l),a=!0},p:Q,i(i){a||(L(e.$$.fragment,i),a=!0)},o(i){P(e.$$.fragment,i),a=!1},d(i){i&&(I(t),I(r),I(n),I(s)),H(e,i)}}}var Nd=class extends J{constructor(e){super(),X(this,e,null,L2,Y,{},k2)}},Kx=Nd;var Ol=require("obsidian");function I2(o){Ae(o,"svelte-1kvxms3",`.help-section.svelte-1kvxms3{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1kvxms3{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1kvxms3{position:relative;max-width:640px;margin:0 auto}.why-google.svelte-1kvxms3:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-google.svelte-1kvxms3{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-google.svelte-1kvxms3:hover{color:var(--text-normal)}.help-content.svelte-1kvxms3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1kvxms3{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1kvxms3{opacity:1;visibility:visible}.popover.svelte-1kvxms3:not(.visible){transition-delay:0s}.arrow.svelte-1kvxms3{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1kvxms3{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function C2(o){let e,t,r,n;return{c(){e=C("div"),t=C("div"),r=$(),n=C("p"),n.textContent=`${Yx}`,w(t,"class","arrow svelte-1kvxms3"),w(e,"class","popover svelte-1kvxms3"),Ye(e,"visible",o[0])},m(s,a){T(s,e,a),k(e,t),k(e,r),k(e,n),o[9](e)},p(s,a){a&1&&Ye(e,"visible",s[0])},d(s){s&&I(e),o[9](null)}}}function T2(o){let e,t=o[0]&&jx(o);return{c(){t&&t.c(),e=Te()},m(r,n){t&&t.m(r,n),T(r,e,n)},p(r,n){r[0]?t?t.p(r,n):(t=jx(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&I(e),t&&t.d(r)}}}function jx(o){let e,t;return{c(){e=C("div"),t=C("p"),t.textContent=`${Yx}`,w(e,"class","help-content svelte-1kvxms3")},m(r,n){T(r,e,n),k(e,t)},p:Q,d(r){r&&I(e)}}}function P2(o){let e,t,r,n,s,a,i,l,c,u,d,m;function x(b,v){return b[1]?T2:C2}let h=x(o,-1),_=h(o);return l=new Fl({}),{c(){e=C("div"),t=C("div"),r=C("button"),r.textContent="Why sign in with Google?",n=$(),_.c(),s=$(),a=C("div"),i=C("a"),z(l.$$.fragment),c=W(`
		Join the project on Discord`),w(r,"class","why-google svelte-1kvxms3"),Ye(r,"mobile",o[1]),w(t,"class","help-container svelte-1kvxms3"),w(e,"class","help-section svelte-1kvxms3"),w(i,"href","https://discord.system3.md"),w(i,"class","discord-link svelte-1kvxms3"),w(a,"class","footer svelte-1kvxms3")},m(b,v){T(b,e,v),k(e,t),k(t,r),o[8](r),k(t,n),_.m(t,null),T(b,s,v),T(b,a,v),k(a,i),N(l,i,null),k(i,c),u=!0,d||(m=[ee(r,"mouseenter",o[4]),ee(r,"mouseleave",o[5]),ee(r,"click",o[6])],d=!0)},p(b,[v]){(!u||v&2)&&Ye(r,"mobile",b[1]),h===(h=x(b,v))&&_?_.p(b,v):(_.d(1),_=h(b),_&&(_.c(),_.m(t,null)))},i(b){u||(L(l.$$.fragment,b),u=!0)},o(b){P(l.$$.fragment,b),u=!1},d(b){b&&(I(e),I(s),I(a)),o[8](null),_.d(),H(l),d=!1,Le(m)}}}var Yx="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. An identity provider like Google helps to prevent spam accounts. We may add more sign-in options based on user feedback \u2014 let us know in Discord.";function D2(o,e,t){var r;let n=!1,s=!1,a,i;function l(){s||t(0,n=!0)}function c(){s||t(0,n=!1)}function u(){s&&t(0,n=!n)}function d(x){Or[x?"unshift":"push"](()=>{a=x,t(2,a)})}function m(x){Or[x?"unshift":"push"](()=>{i=x,t(3,i)})}return o.$$.update=()=>{if(o.$$.dirty&128){e:t(1,s=t(7,r=Ol.Platform===null||Ol.Platform===void 0?void 0:Ol.Platform.isMobile)!==null&&r!==void 0?r:!1)}},[n,s,a,i,l,c,u,r,d,m]}var Hd=class extends J{constructor(e){super(),X(this,e,D2,P2,Y,{},I2)}},Jx=Hd;var Xx=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],Ul=class{constructor(e,t,r,n,s){this.id=e;this.name=t;this.email=r;this.picture=n;this.token=s;this.color=Xx[pa()%Xx.length]}};function A2(o){Ae(o,"svelte-1ym1y1w",".avatar.svelte-1ym1y1w{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.initial.svelte-1ym1y1w{color:var(--text-on-accent)}img.svelte-1ym1y1w{width:100%;height:100%;object-fit:cover}")}function E2(o){let e,t;return{c(){e=C("span"),t=W(o[5]),w(e,"class","initial svelte-1ym1y1w"),ge(e,"font-size",o[4])},m(r,n){T(r,e,n),k(e,t)},p(r,n){n&32&&oe(t,r[5]),n&16&&ge(e,"font-size",r[4])},d(r){r&&I(e)}}}function M2(o){let e,t,r,n;return{c(){e=C("img"),uu(e.src,t=o[0].picture)||w(e,"src",t),w(e,"alt",o[1]),w(e,"class","svelte-1ym1y1w")},m(s,a){T(s,e,a),r||(n=ee(e,"error",o[6]),r=!0)},p(s,a){a&1&&!uu(e.src,t=s[0].picture)&&w(e,"src",t),a&2&&w(e,"alt",s[1])},d(s){s&&I(e),r=!1,n()}}}function F2(o){let e;function t(s,a){return!s[3]&&s[0].picture?M2:E2}let r=t(o,-1),n=r(o);return{c(){e=C("div"),n.c(),w(e,"class","avatar svelte-1ym1y1w"),ge(e,"width",o[2]),ge(e,"height",o[2])},m(s,a){T(s,e,a),n.m(e,null)},p(s,[a]){r===(r=t(s,a))&&n?n.p(s,a):(n.d(1),n=r(s),n&&(n.c(),n.m(e,null))),a&4&&ge(e,"width",s[2]),a&4&&ge(e,"height",s[2])},i:Q,o:Q,d(s){s&&I(e),n.d()}}}function R2(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function O2(o,e,t){let r,n,s,{user:a}=e,{alt:i="Profile picture"}=e,{size:l="40px"}=e,c=!1;function u(){t(3,c=!0)}return o.$$set=d=>{"user"in d&&t(0,a=d.user),"alt"in d&&t(1,i=d.alt),"size"in d&&t(2,l=d.size)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(5,r=a.name?a.name.charAt(0).toUpperCase():"?")}if(o.$$.dirty&4){e:t(7,n=R2(l))}if(o.$$.dirty&132){e:t(4,s=`${parseFloat(l)/2}${n}`)}},[a,i,l,c,s,r,u,n]}var zd=class extends J{constructor(e){super(),X(this,e,O2,F2,Y,{user:0,alt:1,size:2},A2)}},Qx=zd;function U2(o){let e,t,r,n,s,a=(o[0].name||"")+"",i,l,c,u,d=(o[0].email||"")+"",m,x,h,_;t=new Qx({props:{size:"2.5em",user:o[0]}});let b=o[2].default,v=de(b,o,o[1],null);return{c(){e=C("div"),z(t.$$.fragment),r=$(),n=C("div"),s=C("div"),i=W(a),l=$(),c=C("br"),u=$(),m=W(d),x=$(),h=C("div"),v&&v.c(),w(s,"class","setting-item-description"),w(n,"class","setting-item-info"),ge(n,"display","grid"),w(h,"class","setting-item-control"),w(e,"class","setting-item")},m(D,B){T(D,e,B),N(t,e,null),k(e,r),k(e,n),k(n,s),k(s,i),k(s,l),k(s,c),k(s,u),k(s,m),k(e,x),k(e,h),v&&v.m(h,null),_=!0},p(D,[B]){let A={};B&1&&(A.user=D[0]),t.$set(A),(!_||B&1)&&a!==(a=(D[0].name||"")+"")&&oe(i,a),(!_||B&1)&&d!==(d=(D[0].email||"")+"")&&oe(m,d),v&&v.p&&(!_||B&2)&&me(v,b,D,D[1],_?pe(b,D[1],B,null):he(D[1]),null)},i(D){_||(L(t.$$.fragment,D),L(v,D),_=!0)},o(D){P(t.$$.fragment,D),P(v,D),_=!1},d(D){D&&I(e),H(t),v&&v.d(D)}}}function $2(o,e,t){let{$$slots:r={},$$scope:n}=e,{user:s}=e;return o.$$set=a=>{"user"in a&&t(0,s=a.user),"$$scope"in a&&t(1,n=a.$$scope)},[s,n,r]}var Vd=class extends J{constructor(e){super(),X(this,e,$2,U2,Y,{user:0})}},Zx=Vd;var $l=require("obsidian");function B2(o){Ae(o,"svelte-5zjjwa",".help-container.svelte-5zjjwa{position:relative;display:inline-block}button.svelte-5zjjwa{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-5zjjwa:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-5zjjwa:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.popover.svelte-5zjjwa{position:absolute;z-index:50;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.popover.left.svelte-5zjjwa{right:100%;margin-right:8px}.popover.right.svelte-5zjjwa{left:0}.arrow.svelte-5zjjwa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-5zjjwa{right:8px}.arrow.right.svelte-5zjjwa{left:8px}p.svelte-5zjjwa{margin:0;color:var(--text-normal)}")}function ey(o){let e,t,r,n,s;return{c(){e=C("div"),t=C("div"),r=$(),n=C("p"),s=W(o[0]),w(t,"class","arrow svelte-5zjjwa"),Ye(t,"left",o[4]==="left"),Ye(t,"right",o[4]==="right"),w(n,"class","svelte-5zjjwa"),w(e,"class","popover svelte-5zjjwa"),Ye(e,"left",o[4]==="left"),Ye(e,"right",o[4]==="right")},m(a,i){T(a,e,i),k(e,t),k(e,r),k(e,n),k(n,s),o[9](e)},p(a,i){i&16&&Ye(t,"left",a[4]==="left"),i&16&&Ye(t,"right",a[4]==="right"),i&1&&oe(s,a[0]),i&16&&Ye(e,"left",a[4]==="left"),i&16&&Ye(e,"right",a[4]==="right")},d(a){a&&I(e),o[9](null)}}}function N2(o){let e,t,r,n,s,a,i;r=new $a({props:{size:16}});let l=o[1]&&ey(o);return{c(){e=C("div"),t=C("button"),z(r.$$.fragment),n=$(),l&&l.c(),w(t,"type","button"),w(t,"class","svelte-5zjjwa"),w(e,"class","help-container svelte-5zjjwa")},m(c,u){T(c,e,u),k(e,t),N(r,t,null),o[8](t),k(e,n),l&&l.m(e,null),s=!0,a||(i=[ee(t,"mouseenter",o[5]),ee(t,"mouseleave",o[6]),ee(t,"click",o[7])],a=!0)},p(c,[u]){c[1]?l?l.p(c,u):(l=ey(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(c){s||(L(r.$$.fragment,c),s=!0)},o(c){P(r.$$.fragment,c),s=!1},d(c){c&&I(e),H(r),o[8](null),l&&l.d(),a=!1,Le(i)}}}function H2(o,e,t){let{helpText:r}=e,n=!1,s="right",a,i;function l(){t(1,n=!0)}function c(){t(1,n=!1)}function u(){t(1,n=!n)}function d(x){Or[x?"unshift":"push"](()=>{a=x,t(2,a)})}function m(x){Or[x?"unshift":"push"](()=>{i=x,t(3,i)})}return o.$$set=x=>{"helpText"in x&&t(0,r=x.helpText)},o.$$.update=()=>{if(o.$$.dirty&14){e:if(n&&a&&i){let x=a.getBoundingClientRect(),h=i.getBoundingClientRect(),_=window.innerWidth;t(4,s=x.right+h.width>_-20?"left":"right")}}},[r,n,a,i,s,l,c,u,d,m]}var qd=class extends J{constructor(e){super(),X(this,e,H2,N2,Y,{helpText:0},B2)}},ty=qd;function z2(o){Ae(o,"svelte-1v3t6m3",".setting-item-name.svelte-1v3t6m3{display:flex;align-items:center;gap:8px}.help-button.svelte-1v3t6m3{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-1v3t6m3:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-1v3t6m3:active{color:var(--text-normal)}.help-content.svelte-1v3t6m3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-1v3t6m3{margin:0}")}var V2=o=>({}),ry=o=>({}),q2=o=>({}),oy=o=>({}),W2=o=>({}),ny=o=>({});function G2(o){let e;return{c(){e=W(o[0])},m(t,r){T(t,e,r)},p(t,r){r&1&&oe(e,t[0])},d(t){t&&I(e)}}}function sy(o){let e,t,r,n,s=[j2,K2],a=[];function i(l,c){return l[3]?0:1}return e=i(o,-1),t=a[e]=s[e](o),{c(){t.c(),r=Te()},m(l,c){a[e].m(l,c),T(l,r,c),n=!0},p(l,c){let u=e;e=i(l,c),e===u?a[e].p(l,c):(we(),P(a[u],1,1,()=>{a[u]=null}),_e(),t=a[e],t?t.p(l,c):(t=a[e]=s[e](l),t.c()),L(t,1),t.m(r.parentNode,r))},i(l){n||(L(t),n=!0)},o(l){P(t),n=!1},d(l){l&&I(r),a[e].d(l)}}}function K2(o){let e,t;return e=new ty({props:{helpText:o[1]}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&2&&(s.helpText=r[1]),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function j2(o){let e,t,r,n,s;return t=new $a({props:{size:16}}),{c(){e=C("button"),z(t.$$.fragment),w(e,"class","help-button svelte-1v3t6m3"),w(e,"aria-expanded",o[2])},m(a,i){T(a,e,i),N(t,e,null),r=!0,n||(s=ee(e,"click",o[4]),n=!0)},p(a,i){(!r||i&4)&&w(e,"aria-expanded",a[2])},i(a){r||(L(t.$$.fragment,a),r=!0)},o(a){P(t.$$.fragment,a),r=!1},d(a){a&&I(e),H(t),n=!1,s()}}}function Y2(o){let e,t,r=o[7].description,n=de(r,o,o[6],ry);return{c(){e=C("div"),n&&n.c(),w(e,"class","setting-item-description")},m(s,a){T(s,e,a),n&&n.m(e,null),t=!0},p(s,a){n&&n.p&&(!t||a&64)&&me(n,r,s,s[6],t?pe(r,s[6],a,V2):he(s[6]),ry)},i(s){t||(L(n,s),t=!0)},o(s){P(n,s),t=!1},d(s){s&&I(e),n&&n.d(s)}}}function ay(o){let e,t,r;return{c(){e=C("div"),t=C("p"),r=W(o[1]),w(t,"class","svelte-1v3t6m3"),w(e,"class","help-content svelte-1v3t6m3"),Ye(e,"expanded",o[2])},m(n,s){T(n,e,s),k(e,t),k(t,r)},p(n,s){s&2&&oe(r,n[1]),s&4&&Ye(e,"expanded",n[2])},d(n){n&&I(e)}}}function J2(o){let e,t,r,n,s,a,i,l,c,u=o[7].name,d=de(u,o,o[6],ny),m=d||G2(o),x=o[1]&&sy(o),h=o[7].description,_=de(h,o,o[6],oy),b=_||Y2(o),v=o[1]&&o[2]&&o[3]&&ay(o),D=o[7].default,B=de(D,o,o[6],null);return{c(){e=C("div"),t=C("div"),r=C("div"),m&&m.c(),n=$(),x&&x.c(),s=$(),b&&b.c(),a=$(),v&&v.c(),i=$(),l=C("div"),B&&B.c(),w(r,"class","setting-item-name svelte-1v3t6m3"),w(t,"class","setting-item-info"),w(l,"class","setting-item-control"),w(e,"class","setting-item setting-item-heading")},m(A,F){T(A,e,F),k(e,t),k(t,r),m&&m.m(r,null),k(r,n),x&&x.m(r,null),k(t,s),b&&b.m(t,null),k(t,a),v&&v.m(t,null),k(e,i),k(e,l),B&&B.m(l,null),c=!0},p(A,[F]){d?d.p&&(!c||F&64)&&me(d,u,A,A[6],c?pe(u,A[6],F,W2):he(A[6]),ny):m&&m.p&&(!c||F&1)&&m.p(A,c?F:-1),A[1]?x?(x.p(A,F),F&2&&L(x,1)):(x=sy(A),x.c(),L(x,1),x.m(r,null)):x&&(we(),P(x,1,1,()=>{x=null}),_e()),_?_.p&&(!c||F&64)&&me(_,h,A,A[6],c?pe(h,A[6],F,q2):he(A[6]),oy):b&&b.p&&(!c||F&64)&&b.p(A,c?F:-1),A[1]&&A[2]&&A[3]?v?v.p(A,F):(v=ay(A),v.c(),v.m(t,null)):v&&(v.d(1),v=null),B&&B.p&&(!c||F&64)&&me(B,D,A,A[6],c?pe(D,A[6],F,null):he(A[6]),null)},i(A){c||(L(m,A),L(x),L(b,A),L(B,A),c=!0)},o(A){P(m,A),P(x),P(b,A),P(B,A),c=!1},d(A){A&&I(e),m&&m.d(A),x&&x.d(),b&&b.d(A),v&&v.d(),B&&B.d(A)}}}function X2(o,e,t){let{$$slots:r={},$$scope:n}=e;var s;let{name:a=""}=e,{helpText:i=void 0}=e,l=!1,c=!1;function u(){c&&t(2,l=!l)}return o.$$set=d=>{"name"in d&&t(0,a=d.name),"helpText"in d&&t(1,i=d.helpText),"$$scope"in d&&t(6,n=d.$$scope)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,c=t(5,s=$l.Platform===null||$l.Platform===void 0?void 0:$l.Platform.isMobile)!==null&&s!==void 0?s:!1)}},[a,i,l,c,u,s,n,r]}var Wd=class extends J{constructor(e){super(),X(this,e,X2,J2,Y,{name:0,helpText:1},z2)}},et=Wd;var Ks=[];function Q2(o,e){return{subscribe:xe(o,e).subscribe}}function xe(o,e=Q){let t,r=new Set;function n(i){if(Y(o,i)&&(o=i,t)){let l=!Ks.length;for(let c of r)c[1](),Ks.push(c,o);if(l){for(let c=0;c<Ks.length;c+=2)Ks[c][0](Ks[c+1]);Ks.length=0}}}function s(i){n(i(o))}function a(i,l=Q){let c=[i,l];return r.add(c),r.size===1&&(t=e(n,s)||Q),i(o),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:n,update:s,subscribe:a}}function qn(o,e,t){let r=!Array.isArray(o),n=r?[o]:o;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let s=e.length<2;return Q2(t,(a,i)=>{let l=!1,c=[],u=0,d=Q,m=()=>{if(u)return;d();let h=e(r?c[0]:c,a,i);s?a(h):d=dt(h)?h:Q},x=n.map((h,_)=>Zt(h,b=>{c[_]=b,u&=~(1<<_),l&&m()},()=>{u|=1<<_}));return l=!0,m(),function(){Le(x),d(),l=!1}})}var py=require("obsidian"),my=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkFetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(my.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=dy()));var br=async(o,e)=>{let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",n=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.4.6"}),s={url:t,method:r,body:e==null?void 0:e.body,headers:n,throw:!1},a;if(a=await(0,py.requestUrl)(s),!a.arrayBuffer.byteLength)return new Response(null,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});let i=new Response(a.arrayBuffer,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});Object.defineProperty(i,"json",{value:async()=>JSON.parse(a.text)});let c=a.status>=500?"error":a.status>=400?"warn":"debug",u=a.text,d;try{d=JSON.parse(u)}catch(m){}if(Se("[CustomFetch]",c)(a.status.toString(),r,t,d||u),a.status>=500)throw new Error(u);return i};function uT(o){Ae(o,"svelte-16zgfvu",`.continue.svelte-16zgfvu{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-16zgfvu{color:var(--text-muted)}.link.svelte-16zgfvu:hover{color:var(--text-normal)}.not-working.svelte-16zgfvu{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-16zgfvu{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-16zgfvu:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-16zgfvu{height:auto;padding:0;color:var(--text-faint)}.welcome.svelte-16zgfvu{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-16zgfvu{height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
			Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-16zgfvu:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-16zgfvu:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}`)}function dT(o){let e,t,r,n,s,a,i;t=new Kx({});function l(h,_){return h[3]?hT:mT}let c=l(o,[-1,-1]),u=c(o);function d(h,_){if(h[5])return xT;if(h[4])return gT}let m=d(o,[-1,-1]),x=m&&m(o);return a=new Jx({}),{c(){e=C("div"),z(t.$$.fragment),r=$(),u.c(),n=$(),x&&x.c(),s=$(),z(a.$$.fragment),w(e,"class","welcome svelte-16zgfvu")},m(h,_){T(h,e,_),N(t,e,null),k(e,r),u.m(e,null),k(e,n),x&&x.m(e,null),T(h,s,_),N(a,h,_),i=!0},p(h,_){c===(c=l(h,_))&&u?u.p(h,_):(u.d(1),u=c(h),u&&(u.c(),u.m(e,n))),m===(m=d(h,_))&&x?x.p(h,_):(x&&x.d(1),x=m&&m(h),x&&(x.c(),x.m(e,null)))},i(h){i||(L(t.$$.fragment,h),L(a.$$.fragment,h),i=!0)},o(h){P(t.$$.fragment,h),P(a.$$.fragment,h),i=!1},d(h){h&&(I(e),I(s)),H(t),u.d(),x&&x.d(),H(a,h)}}}function pT(o){let e,t,r,n,s,a,i;e=new et({props:{$$slots:{name:[bT],default:[yT]},$$scope:{ctx:o}}}),r=new et({props:{name:"Account"}}),s=new Zx({props:{user:o[2].user,$$slots:{default:[wT]},$$scope:{ctx:o}}});let l=o[17].default,c=de(l,o,o[23],null);return{c(){z(e.$$.fragment),t=$(),z(r.$$.fragment),n=$(),z(s.$$.fragment),a=$(),c&&c.c()},m(u,d){N(e,u,d),T(u,t,d),N(r,u,d),T(u,n,d),N(s,u,d),T(u,a,d),c&&c.m(u,d),i=!0},p(u,d){let m={};d[0]&8388608&&(m.$$scope={dirty:d,ctx:u}),e.$set(m);let x={};d[0]&4&&(x.user=u[2].user),d[0]&8388608&&(x.$$scope={dirty:d,ctx:u}),s.$set(x),c&&c.p&&(!i||d[0]&8388608)&&me(c,l,u,u[23],i?pe(l,u[23],d,null):he(u[23]),null)},i(u){i||(L(e.$$.fragment,u),L(r.$$.fragment,u),L(s.$$.fragment,u),L(c,u),i=!0)},o(u){P(e.$$.fragment,u),P(r.$$.fragment,u),P(s.$$.fragment,u),P(c,u),i=!1},d(u){u&&(I(t),I(n),I(a)),H(e,u),H(r,u),H(s,u),c&&c.d(u)}}}function mT(o){let e,t,r,n,s;return{c(){e=C("a"),t=C("button"),r=W("Sign in with Google"),w(t,"class","google-sign-in-button svelte-16zgfvu"),t.disabled=o[4],w(e,"href",o[1]),w(e,"target","_blank")},m(a,i){T(a,e,i),k(e,t),k(t,r),n||(s=ee(t,"click",o[20]),n=!0)},p(a,i){i[0]&16&&(t.disabled=a[4]),i[0]&2&&w(e,"href",a[1])},d(a){a&&I(e),n=!1,s()}}}function hT(o){let e,t,r,n;return{c(){e=C("button"),t=W("Sign in with Google"),w(e,"class","google-sign-in-button svelte-16zgfvu"),e.disabled=o[4]},m(s,a){T(s,e,a),k(e,t),r||(n=ee(e,"click",(0,gn.debounce)(o[19])),r=!0)},p(s,a){a[0]&16&&(e.disabled=s[4])},d(s){s&&I(e),r=!1,n()}}}function gT(o){let e,t,r,n,s,a,i,l;return{c(){e=C("div"),t=C("p"),t.textContent="Continue in your browser...",r=$(),n=C("p"),s=W(`Not working?
					`),a=C("button"),a.textContent="(try again)",w(t,"class","continue svelte-16zgfvu"),w(a,"class","link link-button svelte-16zgfvu"),w(n,"class","not-working svelte-16zgfvu")},m(c,u){T(c,e,u),k(e,t),k(e,r),k(e,n),k(n,s),k(n,a),i||(l=ee(a,"click",o[22]),i=!0)},p:Q,d(c){c&&I(e),i=!1,l()}}}function xT(o){let e,t,r,n,s,a=o[6]&&hy(o);return{c(){e=C("p"),t=W(o[5]),r=W("."),n=C("br"),s=$(),a&&a.c()},m(i,l){T(i,e,l),k(e,t),k(e,r),k(e,n),k(e,s),a&&a.m(e,null)},p(i,l){l[0]&32&&oe(t,i[5]),i[6]?a?a.p(i,l):(a=hy(i),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(i){i&&I(e),a&&a.d()}}}function hy(o){let e,t,r,n;return{c(){e=W("Already logged in? "),t=C("button"),t.textContent="(click here)",w(t,"class","link link-button svelte-16zgfvu")},m(s,a){T(s,e,a),T(s,t,a),r||(n=ee(t,"click",(0,gn.debounce)(o[21])),r=!0)},p:Q,d(s){s&&(I(e),I(t)),r=!1,n()}}}function yT(o){let e,t;return e=new Gx({}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function bT(o){let e,t;return e=new Rl({props:{slot:"name"}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p:Q,i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function wT(o){let e,t,r;return{c(){e=C("button"),e.textContent="Logout"},m(n,s){T(n,e,s),t||(r=ee(e,"click",(0,gn.debounce)(o[18])),t=!0)},p:Q,d(n){n&&I(e),t=!1,r()}}}function _T(o){let e,t,r,n,s=[pT,dT],a=[];function i(l,c){return l[2].hasUser&&l[2].user?0:1}return e=i(o,[-1,-1]),t=a[e]=s[e](o),{c(){t.c(),r=Te()},m(l,c){a[e].m(l,c),T(l,r,c),n=!0},p(l,c){let u=e;e=i(l,c),e===u?a[e].p(l,c):(we(),P(a[u],1,1,()=>{a[u]=null}),_e(),t=a[e],t?t.p(l,c):(t=a[e]=s[e](l),t.c()),L(t,1),t.m(r.parentNode,r))},i(l){n||(L(t),n=!0)},o(l){P(t),n=!1},d(l){l&&I(r),a[e].d(l)}}}function Gd(){try{return Response.toString()}catch(o){return"undefined"}}function gy(){try{return fetch.toString()}catch(o){return"undefined"}}function xy(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function vT(o,e,t){let r,n,s,a=Q,i=()=>(a(),a=Zt(_,Oe=>t(2,s=Oe)),_),l,c,u,d;o.$$.on_destroy.push(()=>a());let{$$slots:m={},$$scope:x}=e,{plugin:h}=e,_,b=xe(!gn.Platform.isIosApp);ye(o,b,Oe=>t(3,l=Oe));let v=xe(!1);ye(o,v,Oe=>t(4,c=Oe)),i(_=h.loginManager);let D=xe(!1);ye(o,D,Oe=>t(6,d=Oe));let B=xe(!1),A=xe(!0);ye(o,A,Oe=>t(26,r=Oe));let F=xe("please wait...");ye(o,F,Oe=>t(1,n=Oe));let O,M,E=xe("");ye(o,E,Oe=>t(5,u=Oe));let R=xe(h.settings.debugging);function G(){R.set(h.toggleDebugging(!0))}function le(){return Ze(this,void 0,void 0,function*(){h.loginManager.logout(),B.set(!1),D.set(!1)})}function j(){return Ze(this,void 0,void 0,function*(){try{yield h.loginManager.login()}catch(Oe){b.set(!1),B.set(!1),n&&n!=="please wait..."&&(window.open(n,"_blank"),Ke())}})}let ae=xe(Gd()),V=xe(gy()),Z=xe(xy()),Ee=xe(h.loginManager.pb);function Re(){ae.set(Gd()),V.set(gy()),Z.set(xy()),Ee.set(h.loginManager.pb)}function Pe(){try{let Oe=r?br:fetch;O=void 0,F.set("please wait..."),_.initiateManualOAuth2CodeFlow(Oe).then(([pt,gt,Rt])=>{O=gt,M=Rt,F.set(pt)}).catch(pt=>{let gt=pt.message;throw gt=gt+`
`+Gd(),E.set(gt),pt})}catch(Oe){E.set(Oe.message)}}tr(()=>{B.set(!1),Pe()});function Ke(){return Ze(this,void 0,void 0,function*(){if(!(!O||!M))return yield h.loginManager.poll(O,M).then(Oe=>{B.set(!0),v.set(!1),E.set("")}).catch(Oe=>{D.set(!0),v.set(!1),B.set(!1),E.set(Oe.message)})})}function qe(Oe){let pt=Oe.target;pt.focus(),pt.select(),navigator.clipboard.writeText(pt.value).then(()=>new gn.Notice("Invite link copied")).catch(gt=>{}),Ke()}let fe=()=>{le()},Ce=async()=>{v.set(!0),await j()},te=()=>{v.set(!0),Ke()},ze=()=>{Ke()},kt=()=>{v.set(!1),b.set(!1)};return o.$$set=Oe=>{"plugin"in Oe&&t(16,h=Oe.plugin),"$$scope"in Oe&&t(23,x=Oe.$$scope)},[_,n,s,l,c,u,d,b,v,D,A,F,E,le,j,Ke,h,m,fe,Ce,te,ze,kt,x]}var Kd=class extends J{constructor(e){super(),X(this,e,vT,_T,Y,{plugin:16},uT,[-1,-1])}},yy=Kd;function by(o,e,t){let r=o.slice();return r[5]=e[t],r}var ST=o=>({}),wy=o=>({}),kT=o=>({}),_y=o=>({});function LT(o){let e;return{c(){e=W(o[0])},m(t,r){T(t,e,r)},p(t,r){r&1&&oe(e,t[0])},d(t){t&&I(e)}}}function IT(o){let e,t=Fe(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=vy(by(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=Te()},m(n,s){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(n,s);T(n,e,s)},p(n,s){if(s&2){t=Fe(n[1]);let a;for(a=0;a<t.length;a+=1){let i=by(n,t,a);r[a]?r[a].p(i,s):(r[a]=vy(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&I(e),ft(r,n)}}}function vy(o){let e;return{c(){e=C("div"),e.textContent=`${o[5]} `},m(t,r){T(t,e,r)},p:Q,d(t){t&&I(e)}}}function CT(o){let e,t=o[1].length>0&&IT(o);return{c(){t&&t.c(),e=Te()},m(r,n){t&&t.m(r,n),T(r,e,n)},p(r,n){r[1].length>0&&t.p(r,n)},d(r){r&&I(e),t&&t.d(r)}}}function TT(o){let e,t,r,n,s,a,i,l,c=o[4].name,u=de(c,o,o[3],_y),d=u||LT(o),m=o[4].description,x=de(m,o,o[3],wy),h=x||CT(o),_=o[4].default,b=de(_,o,o[3],null);return{c(){e=C("div"),t=C("div"),r=C("div"),d&&d.c(),n=$(),s=C("div"),h&&h.c(),a=$(),i=C("div"),b&&b.c(),w(r,"class","setting-item-name"),ge(r,"display","grid"),ge(r,"align-items","center"),w(s,"class","setting-item-description"),w(t,"class","setting-item-info"),ge(t,"display","grid"),w(i,"class","setting-item-control"),w(e,"class","setting-item")},m(v,D){T(v,e,D),k(e,t),k(t,r),d&&d.m(r,null),k(t,n),k(t,s),h&&h.m(s,null),k(e,a),k(e,i),b&&b.m(i,null),l=!0},p(v,[D]){u?u.p&&(!l||D&8)&&me(u,c,v,v[3],l?pe(c,v[3],D,kT):he(v[3]),_y):d&&d.p&&(!l||D&1)&&d.p(v,l?D:-1),x&&x.p&&(!l||D&8)&&me(x,m,v,v[3],l?pe(m,v[3],D,ST):he(v[3]),wy),b&&b.p&&(!l||D&8)&&me(b,_,v,v[3],l?pe(_,v[3],D,null):he(v[3]),null)},i(v){l||(L(d,v),L(h,v),L(b,v),l=!0)},o(v){P(d,v),P(h,v),P(b,v),l=!1},d(v){v&&I(e),d&&d.d(v),h&&h.d(v),b&&b.d(v)}}}function PT(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:a}=e,i=a!==void 0?a.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,s=l.name),"description"in l&&t(2,a=l.description),"$$scope"in l&&t(3,n=l.$$scope)},[s,i,a,n,r]}var jd=class extends J{constructor(e){super(),X(this,e,PT,TT,Y,{name:0,description:2})}},He=jd;function DT(o){Ae(o,"svelte-tyruzk",".setting-item-control.svelte-tyruzk{width:unset !important;margin-top:unset !important}.setting-item.svelte-tyruzk{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-tyruzk{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-tyruzk{min-width:0}.truncate.svelte-tyruzk *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var AT=o=>({}),Sy=o=>({}),ET=o=>({}),ky=o=>({});function MT(o){let e;return{c(){e=W(o[0])},m(t,r){T(t,e,r)},p(t,r){r&1&&oe(e,t[0])},d(t){t&&I(e)}}}function FT(o){let e,t,r,n,s,a,i,l=o[2].name,c=de(l,o,o[1],ky),u=c||MT(o),d=o[2].description,m=de(d,o,o[1],Sy),x=o[2].default,h=de(x,o,o[1],null);return{c(){e=C("div"),t=C("div"),r=C("div"),u&&u.c(),n=$(),m&&m.c(),s=$(),a=C("div"),h&&h.c(),w(r,"class","setting-item-name truncate svelte-tyruzk"),w(t,"class","setting-item-info svelte-tyruzk"),w(a,"class","setting-item-control svelte-tyruzk"),w(e,"class","setting-item svelte-tyruzk")},m(_,b){T(_,e,b),k(e,t),k(t,r),u&&u.m(r,null),k(e,n),m&&m.m(e,null),k(e,s),k(e,a),h&&h.m(a,null),i=!0},p(_,[b]){c?c.p&&(!i||b&2)&&me(c,l,_,_[1],i?pe(l,_[1],b,ET):he(_[1]),ky):u&&u.p&&(!i||b&1)&&u.p(_,i?b:-1),m&&m.p&&(!i||b&2)&&me(m,d,_,_[1],i?pe(d,_[1],b,AT):he(_[1]),Sy),h&&h.p&&(!i||b&2)&&me(h,x,_,_[1],i?pe(x,_[1],b,null):he(_[1]),null)},i(_){i||(L(u,_),L(m,_),L(h,_),i=!0)},o(_){P(u,_),P(m,_),P(h,_),i=!1},d(_){_&&I(e),u&&u.d(_),m&&m.d(_),h&&h.d(_)}}}function RT(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e;return o.$$set=a=>{"name"in a&&t(0,s=a.name),"$$scope"in a&&t(1,n=a.$$scope)},[s,n,r]}var Yd=class extends J{constructor(e){super(),X(this,e,RT,FT,Y,{name:0},DT)}},wr=Yd;function OT(o){Ae(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function UT(o){let e,t,r,n,s;return t=new Ju({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){e=C("div"),z(t.$$.fragment),w(e,"class","clickable-icon extra-setting-button svelte-y529x8"),w(e,"aria-label","Options"),w(e,"role","button"),w(e,"tabindex","0")},m(a,i){T(a,e,i),N(t,e,null),r=!0,n||(s=[ee(e,"click",o[0]),ee(e,"keydown",o[0])],n=!0)},p:Q,i(a){r||(L(t.$$.fragment,a),r=!0)},o(a){P(t.$$.fragment,a),r=!1},d(a){a&&I(e),H(t),n=!1,Le(s)}}}function $T(o){let e=Nt();function t(r){(r instanceof MouseEvent||r instanceof KeyboardEvent&&(r.key==="Enter"||r.key===" "))&&e("settings")}return[t]}var Jd=class extends J{constructor(e){super(),X(this,e,$T,UT,Y,{},OT)}},Wn=Jd;function BT(o){let e,t,r,n,s,a;t=new Vn({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let i=o[3].default,l=de(i,o,o[2],null);return{c(){e=C("span"),z(t.$$.fragment),r=$(),l&&l.c(),w(e,"role","button"),w(e,"tabindex","0"),ge(e,"display","flex"),ge(e,"align-items","center"),ge(e,"width","100%")},m(c,u){T(c,e,u),N(t,e,null),k(e,r),l&&l.m(e,null),n=!0,s||(a=[ee(e,"keypress",o[0]),ee(e,"click",o[0])],s=!0)},p(c,[u]){l&&l.p&&(!n||u&4)&&me(l,i,c,c[2],n?pe(i,c[2],u,null):he(c[2]),null)},i(c){n||(L(t.$$.fragment,c),L(l,c),n=!0)},o(c){P(t.$$.fragment,c),P(l,c),n=!1},d(c){c&&I(e),H(t),l&&l.d(c),s=!1,Le(a)}}}function NT(o,e,t){let{$$slots:r={},$$scope:n}=e,{relay:s=void 0}=e,a=Nt();function i(){s&&a("manageRelay",{relay:s})}return o.$$set=l=>{"relay"in l&&t(1,s=l.relay),"$$scope"in l&&t(2,n=l.$$scope)},[i,s,n,r]}var Xd=class extends J{constructor(e){super(),X(this,e,NT,BT,Y,{relay:1})}},xn=Xd;function HT(o){let e,t,r,n,s,a;t=new Ou({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let i=o[3].default,l=de(i,o,o[2],null);return{c(){e=C("span"),z(t.$$.fragment),r=$(),l&&l.c(),w(e,"role","button"),w(e,"tabindex","0"),ge(e,"display","inline-flex"),ge(e,"align-items","center"),ge(e,"width","100%")},m(c,u){T(c,e,u),N(t,e,null),k(e,r),l&&l.m(e,null),n=!0,s||(a=[ee(e,"keypress",o[0]),ee(e,"click",o[0])],s=!0)},p(c,[u]){l&&l.p&&(!n||u&4)&&me(l,i,c,c[2],n?pe(i,c[2],u,null):he(c[2]),null)},i(c){n||(L(t.$$.fragment,c),L(l,c),n=!0)},o(c){P(t.$$.fragment,c),P(l,c),n=!1},d(c){c&&I(e),H(t),l&&l.d(c),s=!1,Le(a)}}}function zT(o,e,t){let{$$slots:r={},$$scope:n}=e,{folder:s=void 0}=e,a=Nt();function i(){var l;s&&a("manageSharedFolder",{folder:s,relay:(l=s.remote)===null||l===void 0?void 0:l.relay})}return o.$$set=l=>{"folder"in l&&t(1,s=l.folder),"$$scope"in l&&t(2,n=l.$$scope)},[i,s,n,r]}var Qd=class extends J{constructor(e){super(),X(this,e,zT,HT,Y,{folder:1})}},ho=Qd;function VT(o){let e,t=o[0].name+"",r;return{c(){e=C("span"),r=W(t),ge(e,"overflow","hidden"),ge(e,"text-overflow","ellipsis"),ge(e,"white-space","nowrap")},m(n,s){T(n,e,s),k(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&oe(r,t)},d(n){n&&I(e)}}}function Ly(o){let e,t,r,n,s;return t=new vu({props:{size:16,class:"svg-icon"}}),n=new xn({props:{relay:o[1],$$slots:{default:[qT]},$$scope:{ctx:o}}}),n.$on("manageRelay",o[3]),{c(){e=C("span"),z(t.$$.fragment),r=$(),z(n.$$.fragment),ge(e,"width","16px"),ge(e,"flex-shrink","0"),ge(e,"display","flex"),ge(e,"justify-content","center")},m(a,i){T(a,e,i),N(t,e,null),T(a,r,i),N(n,a,i),s=!0},p(a,i){let l={};i&2&&(l.relay=a[1]),i&17&&(l.$$scope={dirty:i,ctx:a}),n.$set(l)},i(a){s||(L(t.$$.fragment,a),L(n.$$.fragment,a),s=!0)},o(a){P(t.$$.fragment,a),P(n.$$.fragment,a),s=!1},d(a){a&&(I(e),I(r)),H(t),H(n,a)}}}function qT(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=C("span"),r=W(t),ge(e,"flex","1"),ge(e,"min-width","0"),ge(e,"text-overflow","ellipsis"),ge(e,"white-space","nowrap")},m(n,s){T(n,e,s),k(e,r)},p(n,s){s&1&&t!==(t=n[0].remote.relay.name+"")&&oe(r,t)},d(n){n&&I(e)}}}function WT(o){let e,t,r,n,s;r=new ho({props:{folder:o[0],$$slots:{default:[VT]},$$scope:{ctx:o}}}),r.$on("manageSharedFolder",o[2]);let a=o[0].remote&&Ly(o);return{c(){e=C("span"),t=C("span"),z(r.$$.fragment),n=$(),a&&a.c(),ge(t,"display","inline-flex"),ge(t,"align-items","center"),ge(t,"width","200px"),ge(t,"min-width","200px"),ge(t,"flex-shrink","0"),ge(e,"display","inline-flex"),ge(e,"align-items","center"),ge(e,"width","100%"),ge(e,"gap","8px")},m(i,l){T(i,e,l),k(e,t),N(r,t,null),k(e,n),a&&a.m(e,null),s=!0},p(i,[l]){let c={};l&1&&(c.folder=i[0]),l&17&&(c.$$scope={dirty:l,ctx:i}),r.$set(c),i[0].remote?a?(a.p(i,l),l&1&&L(a,1)):(a=Ly(i),a.c(),L(a,1),a.m(e,null)):a&&(we(),P(a,1,1,()=>{a=null}),_e())},i(i){s||(L(r.$$.fragment,i),L(a),s=!0)},o(i){P(r.$$.fragment,i),P(a),s=!1},d(i){i&&I(e),H(r),a&&a.d()}}}function GT(o,e,t){let{folder:r}=e,{relay:n}=e;function s(i){Xr.call(this,o,i)}function a(i){Xr.call(this,o,i)}return o.$$set=i=>{"folder"in i&&t(0,r=i.folder),"relay"in i&&t(1,n=i.relay)},[r,n,s,a]}var Zd=class extends J{constructor(e){super(),X(this,e,GT,WT,Y,{folder:0,relay:1})}},Iy=Zd;var js=require("obsidian");function KT(o){Ae(o,"svelte-yg42fv","input.system3-input-invalid.svelte-yg42fv{border:1px solid var(--color-red) !important}span.faint.svelte-yg42fv{color:var(--text-faint)}")}function Cy(o,e,t){let r=o.slice();return r[21]=e[t],r}function Ty(o,e,t){let r=o.slice();return r[24]=e[t],r}function jT(o){let e,t,r,n,s,a;return{c(){e=C("input"),r=$(),n=C("button"),n.textContent="Join",w(e,"type","text"),w(e,"placeholder","Enter share key"),w(e,"class",t=Os(o[2]?"system3-input-invalid":"")+" svelte-yg42fv"),w(n,"class","mod-cta")},m(i,l){T(i,e,l),er(e,o[1]),T(i,r,l),T(i,n,l),s||(a=[ee(e,"input",o[12]),ee(e,"input",o[8]),ee(n,"click",function(){dt((0,js.debounce)(o[13]))&&(0,js.debounce)(o[13]).apply(this,arguments)})],s=!0)},p(i,l){o=i,l&4&&t!==(t=Os(o[2]?"system3-input-invalid":"")+" svelte-yg42fv")&&w(e,"class",t),l&2&&e.value!==o[1]&&er(e,o[1])},d(i){i&&(I(e),I(r),I(n)),s=!1,Le(a)}}}function YT(o){let e;return{c(){e=C("span"),e.textContent="Relay Servers",w(e,"slot","name"),ge(e,"display","inline-flex"),ge(e,"align-items","center")},m(t,r){T(t,e,r)},p:Q,d(t){t&&I(e)}}}function JT(o){let e,t;function r(){return o[15](o[24])}return e=new Wn({}),e.$on("settings",r),{c(){z(e.$$.fragment)},m(n,s){N(e,n,s),t=!0},p(n,s){o=n},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function XT(o){let e;return{c(){e=C("span"),e.textContent="(Untitled Relay Server)",w(e,"class","faint svelte-yg42fv")},m(t,r){T(t,e,r)},p:Q,d(t){t&&I(e)}}}function QT(o){let e=o[24].name+"",t;return{c(){t=W(e)},m(r,n){T(r,t,n)},p(r,n){n&8&&e!==(e=r[24].name+"")&&oe(t,e)},d(r){r&&I(t)}}}function ZT(o){let e;function t(s,a){return s[24].name?QT:XT}let r=t(o,-1),n=r(o);return{c(){n.c(),e=Te()},m(s,a){n.m(s,a),T(s,e,a)},p(s,a){r===(r=t(s,a))&&n?n.p(s,a):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&I(e),n.d(s)}}}function eP(o){let e,t;return e=new xn({props:{slot:"name",relay:o[24],t:"name",$$slots:{default:[ZT]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[14]),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&8&&(s.relay=r[24]),n&134217736&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Py(o){let e,t;return e=new wr({props:{$$slots:{name:[eP],default:[JT]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&134217736&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function tP(o){let e,t,r;return{c(){e=C("button"),e.textContent="Create",w(e,"class","mod-cta")},m(n,s){T(n,e,s),t||(r=ee(e,"click",(0,js.debounce)(o[16])),t=!0)},p:Q,d(n){n&&I(e),t=!1,r()}}}function Dy(o){let e,t;return e=new He({props:{description:"Go to a Relay Server's settings page above to share existing folders, or add Shared Folders to your vault."}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function rP(o){let e,t,r;function n(){return o[19](o[21])}return e=new Wn({}),e.$on("settings",function(){dt((0,js.debounce)(n))&&(0,js.debounce)(n).apply(this,arguments)}),{c(){z(e.$$.fragment),t=$()},m(s,a){N(e,s,a),T(s,t,a),r=!0},p(s,a){o=s},i(s){r||(L(e.$$.fragment,s),r=!0)},o(s){P(e.$$.fragment,s),r=!1},d(s){s&&I(t),H(e,s)}}}function oP(o){var r;let e,t;return e=new Iy({props:{folder:o[21],relay:(r=o[21].remote)==null?void 0:r.relay,slot:"name"}}),e.$on("manageRelay",o[17]),e.$on("manageSharedFolder",o[18]),{c(){z(e.$$.fragment)},m(n,s){N(e,n,s),t=!0},p(n,s){var i;let a={};s&16&&(a.folder=n[21]),s&16&&(a.relay=(i=n[21].remote)==null?void 0:i.relay),e.$set(a)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Ay(o){let e,t;return e=new wr({props:{$$slots:{name:[oP],default:[rP]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&134217752&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function nP(o){let e,t,r,n,s,a,i,l,c,u,d,m=o[4].items().length===0,x,h,_;e=new et({props:{name:"Join a Relay Server"}}),r=new He({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[jT]},$$scope:{ctx:o}}}),s=new et({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[YT]},$$scope:{ctx:o}}});let b=Fe(o[3].values().sort(Ey)),v=[];for(let M=0;M<b.length;M+=1)v[M]=Py(Ty(o,b,M));let D=M=>P(v[M],1,1,()=>{v[M]=null});l=new He({props:{name:"",description:"",$$slots:{default:[tP]},$$scope:{ctx:o}}}),u=new et({props:{name:"Shared Folders",helpText:"Shared Folders enhance local folders by tracking edits. You can see what Relay Server a Shared Folder is connected to below."}});let B=m&&Dy(o),A=Fe(o[4].items()),F=[];for(let M=0;M<A.length;M+=1)F[M]=Ay(Cy(o,A,M));let O=M=>P(F[M],1,1,()=>{F[M]=null});return{c(){z(e.$$.fragment),t=$(),z(r.$$.fragment),n=$(),z(s.$$.fragment),a=$();for(let M=0;M<v.length;M+=1)v[M].c();i=$(),z(l.$$.fragment),c=$(),z(u.$$.fragment),d=$(),B&&B.c(),x=$();for(let M=0;M<F.length;M+=1)F[M].c();h=Te()},m(M,E){N(e,M,E),T(M,t,E),N(r,M,E),T(M,n,E),N(s,M,E),T(M,a,E);for(let R=0;R<v.length;R+=1)v[R]&&v[R].m(M,E);T(M,i,E),N(l,M,E),T(M,c,E),N(u,M,E),T(M,d,E),B&&B.m(M,E),T(M,x,E);for(let R=0;R<F.length;R+=1)F[R]&&F[R].m(M,E);T(M,h,E),_=!0},p(M,[E]){let R={};E&134217734&&(R.$$scope={dirty:E,ctx:M}),r.$set(R);let G={};if(E&134217728&&(G.$$scope={dirty:E,ctx:M}),s.$set(G),E&72){b=Fe(M[3].values().sort(Ey));let j;for(j=0;j<b.length;j+=1){let ae=Ty(M,b,j);v[j]?(v[j].p(ae,E),L(v[j],1)):(v[j]=Py(ae),v[j].c(),L(v[j],1),v[j].m(i.parentNode,i))}for(we(),j=b.length;j<v.length;j+=1)D(j);_e()}let le={};if(E&134217728&&(le.$$scope={dirty:E,ctx:M}),l.$set(le),E&16&&(m=M[4].items().length===0),m?B?E&16&&L(B,1):(B=Dy(M),B.c(),L(B,1),B.m(x.parentNode,x)):B&&(we(),P(B,1,1,()=>{B=null}),_e()),E&152){A=Fe(M[4].items());let j;for(j=0;j<A.length;j+=1){let ae=Cy(M,A,j);F[j]?(F[j].p(ae,E),L(F[j],1)):(F[j]=Ay(ae),F[j].c(),L(F[j],1),F[j].m(h.parentNode,h))}for(we(),j=A.length;j<F.length;j+=1)O(j);_e()}},i(M){if(!_){L(e.$$.fragment,M),L(r.$$.fragment,M),L(s.$$.fragment,M);for(let E=0;E<b.length;E+=1)L(v[E]);L(l.$$.fragment,M),L(u.$$.fragment,M),L(B);for(let E=0;E<A.length;E+=1)L(F[E]);_=!0}},o(M){P(e.$$.fragment,M),P(r.$$.fragment,M),P(s.$$.fragment,M),v=v.filter(Boolean);for(let E=0;E<v.length;E+=1)P(v[E]);P(l.$$.fragment,M),P(u.$$.fragment,M),P(B),F=F.filter(Boolean);for(let E=0;E<F.length;E+=1)P(F[E]);_=!1},d(M){M&&(I(t),I(n),I(a),I(i),I(c),I(d),I(x),I(h)),H(e,M),H(r,M),H(s,M),ft(v,M),H(l,M),H(u,M),B&&B.d(M),ft(F,M)}}}function Ey(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function sP(o,e,t){let r,n=Q,s=()=>(n(),n=Zt(l,G=>t(3,r=G)),l),a;o.$$.on_destroy.push(()=>n());let{plugin:i}=e,{relays:l}=e;s();let c=i.sharedFolders;ye(o,c,G=>t(4,a=G));let u="",d=!1,m=Nt();function x(G){G&&m("manageRelay",{relay:G})}function h(G,le){G&&m("manageSharedFolder",{folder:G,relay:le})}function _(){t(2,d=!1)}function b(G){return Ze(this,void 0,void 0,function*(){try{let le=yield i.relayManager.acceptInvitation(G);m("joinRelay",{relay:le})}catch(le){t(2,d=!0)}})}function v(){m("createRelay")}function D(){u=this.value,t(1,u)}let B=()=>b(u);function A(G){Xr.call(this,o,G)}let F=G=>{x(G)},O=()=>v();function M(G){Xr.call(this,o,G)}function E(G){Xr.call(this,o,G)}let R=G=>{let le=r.values().find(j=>{var ae;return((ae=G.remote)==null?void 0:ae.relay.guid)===j.guid});h(G,le)};return o.$$set=G=>{"plugin"in G&&t(11,i=G.plugin),"relays"in G&&s(t(0,l=G.relays))},[l,u,d,r,a,c,x,h,_,b,v,i,D,B,A,F,O,M,E,R]}var ep=class extends J{constructor(e){super(),X(this,e,sP,nP,Y,{plugin:11,relays:0},KT)}},go=ep;var ht=require("obsidian");var Xy=es(_i());function aP(o){let e,t,r,n,s,a,i,l,c;n=new Tu({props:{size:16}});let u=o[3].default,d=de(u,o,o[4],null);return{c(){e=C("span"),t=W(o[1]),r=$(),z(n.$$.fragment),s=$(),a=C("span"),d&&d.c(),w(e,"tabindex","0"),w(e,"role","button"),ge(a,"flex","1"),ge(a,"min-width","0"),ge(a,"text-overflow","ellipsis"),ge(a,"white-space","nowrap"),ge(a,"overflow","hidden")},m(m,x){T(m,e,x),k(e,t),T(m,r,x),N(n,m,x),T(m,s,x),T(m,a,x),d&&d.m(a,null),i=!0,l||(c=[ee(e,"click",o[2]),ee(e,"keypress",o[2])],l=!0)},p(m,x){(!i||x&2)&&oe(t,m[1]),d&&d.p&&(!i||x&16)&&me(d,u,m,m[4],i?pe(u,m[4],x,null):he(m[4]),null)},i(m){i||(L(n.$$.fragment,m),L(d,m),i=!0)},o(m){P(n.$$.fragment,m),P(d,m),i=!1},d(m){m&&(I(e),I(r),I(s),I(a)),H(n,m),d&&d.d(m),l=!1,Le(c)}}}function iP(o){let e,t,r;var n=o[0];function s(a,i){return{props:{$$slots:{default:[aP]},$$scope:{ctx:a}}}}return n&&(t=$s(n,s(o))),{c(){e=C("h4"),t&&z(t.$$.fragment)},m(a,i){T(a,e,i),t&&N(t,e,null),r=!0},p(a,[i]){if(i&1&&n!==(n=a[0])){if(t){we();let l=t;P(l.$$.fragment,1,0,()=>{H(l,1)}),_e()}n?(t=$s(n,s(a,i)),z(t.$$.fragment),L(t.$$.fragment,1),N(t,e,null)):t=null}else if(n){let l={};i&18&&(l.$$scope={dirty:i,ctx:a}),t.$set(l)}},i(a){r||(t&&L(t.$$.fragment,a),r=!0)},o(a){t&&P(t.$$.fragment,a),r=!1},d(a){a&&I(e),t&&H(t)}}}function lP(o,e,t){let{$$slots:r={},$$scope:n}=e,{category:s}=e,{categoryText:a}=e,i=Nt();function l(){i("goBack")}return o.$$set=c=>{"category"in c&&t(0,s=c.category),"categoryText"in c&&t(1,a=c.categoryText),"$$scope"in c&&t(4,n=c.$$scope)},[s,a,l,r,n]}var tp=class extends J{constructor(e){super(),X(this,e,lP,iP,Y,{category:0,categoryText:1})}},Bl=tp;var Hl=require("obsidian");function fP(o){let e,t,r=o[0].shared&&My(o);return{c(){e=C("div"),r&&r.c(),w(e,"class","suggestion-icon")},m(n,s){T(n,e,s),r&&r.m(e,null),t=!0},p(n,s){n[0].shared?r?s&1&&L(r,1):(r=My(n),r.c(),L(r,1),r.m(e,null)):r&&(we(),P(r,1,1,()=>{r=null}),_e())},i(n){t||(L(r),t=!0)},o(n){P(r),t=!1},d(n){n&&I(e),r&&r.d()}}}function cP(o){let e;return{c(){e=C("span"),e.textContent="Enter to create",w(e,"class","suggestion-action")},m(t,r){T(t,e,r)},p:Q,i:Q,o:Q,d(t){t&&I(e)}}}function My(o){let e,t;return e=new $o({props:{class:"svg-icon"}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function uP(o){let e,t,r=o[0].folder+"",n,s,a,i,l,c,u=[cP,fP],d=[];function m(x,h){return x[0].exists?1:0}return i=m(o,-1),l=d[i]=u[i](o),{c(){e=C("div"),t=C("div"),n=W(r),s=$(),a=C("div"),l.c(),w(t,"class","suggestion-title"),w(e,"class","suggestion-content"),w(a,"class","suggestion-aux")},m(x,h){T(x,e,h),k(e,t),k(t,n),T(x,s,h),T(x,a,h),d[i].m(a,null),c=!0},p(x,[h]){(!c||h&1)&&r!==(r=x[0].folder+"")&&oe(n,r);let _=i;i=m(x,h),i===_?d[i].p(x,h):(we(),P(d[_],1,1,()=>{d[_]=null}),_e(),l=d[i],l?l.p(x,h):(l=d[i]=u[i](x),l.c()),L(l,1),l.m(a,null))},i(x){c||(L(l),c=!0)},o(x){P(l),c=!1},d(x){x&&(I(e),I(s),I(a)),d[i].d()}}}function dP(o,e,t){let{suggestion:r}=e;return o.$$set=n=>{"suggestion"in n&&t(0,r=n.suggestion)},[r]}var rp=class extends J{constructor(e){super(),X(this,e,dP,uP,Y,{suggestion:0})}},Fy=rp;var Nl=class extends Hl.SuggestModal{constructor(t,r,n){super(t);this.sharedFolders=r;this.onChoose=n;this.components=[];this.sharedPaths=new Set(this.sharedFolders.map(s=>s.path)),this.hasRemotes=new Set(this.sharedFolders.filter(s=>s.remote!==void 0).map(s=>s.path)),this.setInstructions([{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}])}sortFn(t,r){return t.exists&&!r.exists?1:!t.exists&&r.exists||t.shared&&!r.shared?-1:r.shared&&!t.shared?1:t.folder.localeCompare(r.folder)}onClose(){super.onClose(),this.components.forEach(t=>{t.$destroy()})}getSuggestions(t){this.components.forEach(i=>{i.$destroy()});let r=t.toLowerCase(),n=[],s=this.app.vault.getAbstractFileByPath(t)!==null;t.length>0&&!s&&n.push({folder:t,exists:!1,shared:!1});let a=i=>{let l=this.sharedPaths.has(i.path),c=this.hasRemotes.has(i.path);if(i.path.toLowerCase().contains(r)&&i.path.length>1&&!c&&n.push({folder:i.path,exists:!0,shared:l}),!l)for(let u of i.children)u instanceof Hl.TFolder&&a(u)};return a(this.app.vault.getRoot()),n.sort(this.sortFn)}renderSuggestion(t,r){r.addClass("mod-complex");let n=new Fy({target:r,props:{suggestion:t}});this.components.push(n)}onChooseSuggestion(t,r){this.onChoose(t.folder)}};var Ny=require("obsidian");var np=require("obsidian");var Ry=require("obsidian"),Oy=require("obsidian"),zl=class extends Oy.AbstractInputSuggest{constructor(t,r,n){super(t,n);this.app=t;this.sharedFolders=r;this.inputEl=n;this.sharedPaths=new Set(this.sharedFolders.map(s=>s.path))}getSuggestions(t){let r=t.toLowerCase(),n=[],s=a=>{if(!this.sharedPaths.has(a.path)){a.path.toLowerCase().contains(r)&&n.push(a.path);for(let l of a.children)l instanceof Ry.TFolder&&s(l)}};return s(this.app.vault.getRoot()),n}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};function pP(o){let e,t,r,n;return{c(){e=C("div"),t=C("input"),w(t,"type","text"),w(t,"placeholder","/"),w(e,"class","folder-suggest-container")},m(s,a){T(s,e,a),k(e,t),o[5](t),er(t,o[2]),r||(n=[ee(t,"input",mP),ee(t,"input",o[6])],r=!0)},p(s,[a]){a&4&&t.value!==s[2]&&er(t,s[2])},i:Q,o:Q,d(s){s&&I(e),o[5](null),r=!1,Le(n)}}}function mP(){}function hP(o,e,t){let r,n=Q,s=()=>(n(),n=Zt(u,x=>t(2,r=x)),u);o.$$.on_destroy.push(()=>n());let{app:a}=e,i,l,{sharedFolders:c}=e,{selectedFolder:u=xe()}=e;s(),tr(()=>{l=new zl(a,c,i);let x=h=>{s(t(0,u=h.detail.folder.path))};return i.addEventListener("folder-selected",x),()=>{i.removeEventListener("folder-selected",x)}}),pu(()=>{l&&l.close()});function d(x){Or[x?"unshift":"push"](()=>{i=x,t(1,i)})}function m(){r=this.value,u.set(r)}return o.$$set=x=>{"app"in x&&t(3,a=x.app),"sharedFolders"in x&&t(4,c=x.sharedFolders),"selectedFolder"in x&&s(t(0,u=x.selectedFolder))},[u,i,r,a,c,d,m]}var op=class extends J{constructor(e){super(),X(this,e,hP,pP,Y,{app:3,sharedFolders:4,selectedFolder:0})}},Uy=op;function gP(o){Ae(o,"svelte-hgd3zf","span.error.svelte-hgd3zf{flex:auto;align-content:center}")}function xP(o){let e,t,r;return{c(){e=C("input"),w(e,"type","text")},m(n,s){T(n,e,s),er(e,o[4]),t||(r=ee(e,"input",o[8]),t=!0)},p(n,s){s&16&&e.value!==n[4]&&er(e,n[4])},d(n){n&&I(e),t=!1,r()}}}function yP(o){let e,t;return e=new Uy({props:{app:o[0],sharedFolders:o[2],selectedFolder:o[7]}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.app=r[0]),n&4&&(s.sharedFolders=r[2]),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function $y(o){let e,t;return{c(){e=C("span"),t=W(o[5]),w(e,"class","mod-warning error svelte-hgd3zf")},m(r,n){T(r,e,n),k(e,t)},p(r,n){n&32&&oe(t,r[5])},d(r){r&&I(e)}}}function bP(o){let e,t,r,n,s,a,i,l,c,u,d,m,x;n=new He({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[xP]},$$scope:{ctx:o}}}),a=new He({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[yP]},$$scope:{ctx:o}}});let h=o[5]&&$y(o);return{c(){e=C("div"),e.textContent="Add to vault",t=$(),r=C("div"),z(n.$$.fragment),s=$(),z(a.$$.fragment),i=$(),l=C("div"),h&&h.c(),c=$(),u=C("button"),u.textContent="Confirm",w(e,"class","modal-title"),w(u,"class","mod-cta"),w(l,"class","modal-button-container"),w(r,"class","modal-content")},m(_,b){T(_,e,b),T(_,t,b),T(_,r,b),N(n,r,null),k(r,s),N(a,r,null),k(r,i),k(r,l),h&&h.m(l,null),k(l,c),k(l,u),d=!0,m||(x=ee(u,"click",function(){dt((0,np.debounce)(o[9]))&&(0,np.debounce)(o[9]).apply(this,arguments)}),m=!0)},p(_,[b]){o=_;let v={};b&1040&&(v.$$scope={dirty:b,ctx:o}),n.$set(v);let D={};b&1029&&(D.$$scope={dirty:b,ctx:o}),a.$set(D),o[5]?h?h.p(o,b):(h=$y(o),h.c(),h.m(l,c)):h&&(h.d(1),h=null)},i(_){d||(L(n.$$.fragment,_),L(a.$$.fragment,_),d=!0)},o(_){P(n.$$.fragment,_),P(a.$$.fragment,_),d=!1},d(_){_&&(I(e),I(t),I(r)),H(n),H(a),h&&h.d(),m=!1,x()}}}function wP(o,e,t){let r,{app:n}=e,{remoteFolder:s}=e,{sharedFolders:a}=e,{onConfirm:i}=e,l=s.name,c=xe();ye(o,c,x=>t(6,r=x));let u="";function d(){l=this.value,t(4,l)}let m=async()=>{i(s,l,r||"").catch(x=>{t(5,u=x.message)})};return o.$$set=x=>{"app"in x&&t(0,n=x.app),"remoteFolder"in x&&t(1,s=x.remoteFolder),"sharedFolders"in x&&t(2,a=x.sharedFolders),"onConfirm"in x&&t(3,i=x.onConfirm)},[n,s,a,i,l,u,r,c,d,m]}var sp=class extends J{constructor(e){super(),X(this,e,wP,bP,Y,{app:0,remoteFolder:1,sharedFolders:2,onConfirm:3},gP)}},By=sp;var Vl=class extends Ny.Modal{constructor(t,r,n,s){super(t);this.sharedFolders=r;this.remoteFolder=n;this.onConfirm=s;this.onConfirm=s}onOpen(){let{contentEl:t}=this;this.component=new By({target:t,props:{remoteFolder:this.remoteFolder,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s)=>{await this.onConfirm(r,n,s),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var ip=es(Hy());function _P(o){Ae(o,"svelte-xzg7gq",".system3-settings-danger-zone.svelte-xzg7gq{margin-top:6em}input.system3-updating.svelte-xzg7gq{border:1px solid var(--color-accent) !important}input.system3-input-invalid.svelte-xzg7gq{border:1px solid var(--color-red) !important}.faint.svelte-xzg7gq{color:var(--text-faint)}")}function zy(o,e,t){let r=o.slice();return r[50]=e[t],r}function Vy(o,e,t){let r=o.slice();return r[53]=e[t],r}function vP(o){let e;return{c(){e=C("span"),e.textContent="(Untitled Relay Server)",w(e,"class","faint svelte-xzg7gq")},m(t,r){T(t,e,r)},p:Q,d(t){t&&I(e)}}}function SP(o){let e=o[0].name+"",t;return{c(){t=W(e)},m(r,n){T(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].name+"")&&oe(t,e)},d(r){r&&I(t)}}}function kP(o){let e;function t(s,a){return s[0].name?SP:vP}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=Te()},m(s,a){n.m(s,a),T(s,e,a)},p(s,a){r===(r=t(s,a))&&n?n.p(s,a):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&I(e),n.d(s)}}}function qy(o){let e,t;return e=new He({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[LP]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&297|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function LP(o){let e,t,r,n;return{c(){e=C("input"),w(e,"type","text"),w(e,"spellcheck","false"),w(e,"placeholder","Example: Shared Notes"),w(e,"class",t=Os((o[8]?"system3-updating":"")+(o[5]?"":" system3-input-invalid"))+" svelte-xzg7gq")},m(s,a){T(s,e,a),er(e,o[0].name),o[35](e),r||(n=[ee(e,"input",o[34]),ee(e,"input",o[26])],r=!0)},p(s,a){a[0]&288&&t!==(t=Os((s[8]?"system3-updating":"")+(s[5]?"":" system3-input-invalid"))+" svelte-xzg7gq")&&w(e,"class",t),a[0]&1&&e.value!==s[0].name&&er(e,s[0].name)},d(s){s&&I(e),o[35](null),r=!1,Le(n)}}}function IP(o){let e,t;return e=new wr({props:{$$slots:{name:[DP],default:[TP]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&512|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function CP(o){let e,t;return e=new wr({props:{$$slots:{name:[MP],default:[AP]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&1536|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function TP(o){let e,t,r;function n(){return o[39](o[53])}return{c(){e=C("button"),e.textContent="Add to Vault",w(e,"class","mod-cta"),w(e,"aria-label","Add shared folder to vault")},m(s,a){T(s,e,a),t||(r=ee(e,"click",function(){dt((0,ht.debounce)(n))&&(0,ht.debounce)(n).apply(this,arguments)}),t=!0)},p(s,a){o=s},d(s){s&&I(e),t=!1,r()}}}function PP(o){let e=o[53].name+"",t;return{c(){t=W(e)},m(r,n){T(r,t,n)},p(r,n){n[0]&512&&e!==(e=r[53].name+"")&&oe(t,e)},d(r){r&&I(t)}}}function DP(o){let e,t;return e=new ho({props:{slot:"name",$$slots:{default:[PP]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&512|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function AP(o){let e,t;function r(){return o[38](o[53])}return e=new Wn({}),e.$on("settings",function(){dt((0,ht.debounce)(r))&&(0,ht.debounce)(r).apply(this,arguments)}),{c(){z(e.$$.fragment)},m(n,s){N(e,n,s),t=!0},p(n,s){o=n},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function EP(o){let e=o[53].name+"",t;return{c(){t=W(e)},m(r,n){T(r,t,n)},p(r,n){n[0]&512&&e!==(e=r[53].name+"")&&oe(t,e)},d(r){r&&I(t)}}}function MP(o){let e,t;function r(...n){return o[36](o[53],...n)}return e=new ho({props:{folder:o[10].find(r),slot:"name",$$slots:{default:[EP]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[37]),{c(){z(e.$$.fragment)},m(n,s){N(e,n,s),t=!0},p(n,s){o=n;let a={};s[0]&1536&&(a.folder=o[10].find(r)),s[0]&512|s[1]&33554432&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Wy(o){let e,t,r,n,s;function a(...u){return o[33](o[53],...u)}let i=[CP,IP],l=[];function c(u,d){return d[0]&1536&&(e=null),e==null&&(e=!!u[10].find(a)),e?0:1}return t=c(o,[-1,-1]),r=l[t]=i[t](o),{c(){r.c(),n=Te()},m(u,d){l[t].m(u,d),T(u,n,d),s=!0},p(u,d){o=u;let m=t;t=c(o,d),t===m?l[t].p(o,d):(we(),P(l[m],1,1,()=>{l[m]=null}),_e(),r=l[t],r?r.p(o,d):(r=l[t]=i[t](o),r.c()),L(r,1),r.m(n.parentNode,n))},i(u){s||(L(r),s=!0)},o(u){P(r),s=!1},d(u){u&&I(n),l[t].d(u)}}}function FP(o){let e,t,r;return{c(){e=C("button"),e.textContent="Share a folder",w(e,"class","mod-cta"),w(e,"aria-label","Select a folder to share it with this Relay Server")},m(n,s){T(n,e,s),t||(r=ee(e,"click",(0,ht.debounce)(o[40])),t=!0)},p:Q,d(n){n&&I(e),t=!1,r()}}}function RP(o){let e=o[11].values().length+"",t,r,n=o[7].userLimit+"",s;return{c(){t=W(e),r=W(" / "),s=W(n)},m(a,i){T(a,t,i),T(a,r,i),T(a,s,i)},p(a,i){i[0]&2048&&e!==(e=a[11].values().length+"")&&oe(t,e),i[0]&128&&n!==(n=a[7].userLimit+"")&&oe(s,n)},d(a){a&&(I(t),I(r),I(s))}}}function Gy(o){let e,t,r;function n(){return o[41](o[50])}return{c(){e=C("button"),e.textContent="Kick",w(e,"class","mod-destructive")},m(s,a){T(s,e,a),t||(r=ee(e,"click",function(){dt((0,ht.debounce)(n))&&(0,ht.debounce)(n).apply(this,arguments)}),t=!0)},p(s,a){o=s},d(s){s&&I(e),t=!1,r()}}}function OP(o){let e,t=o[50].role==="Member"&&o[7].owner&&Gy(o);return{c(){t&&t.c(),e=$()},m(r,n){t&&t.m(r,n),T(r,e,n)},p(r,n){r[50].role==="Member"&&r[7].owner?t?t.p(r,n):(t=Gy(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&I(e),t&&t.d(r)}}}function Ky(o){let e,t;return e=new He({props:{name:o[50].user.name,description:o[50].role,$$slots:{default:[OP]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&2048&&(s.name=r[50].user.name),n[0]&2048&&(s.description=r[50].role),n[0]&2176|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function UP(o){let e,t,r;return{c(){e=C("input"),e.value=o[4],w(e,"type","text"),e.readOnly=!0,w(e,"id","system3InviteLink")},m(n,s){T(n,e,s),t||(r=ee(e,"click",(0,ht.debounce)(o[30])),t=!0)},p(n,s){s[0]&16&&e.value!==n[4]&&(e.value=n[4])},d(n){n&&I(e),t=!1,r()}}}function $P(o){let e,t,r,n;return e=new et({props:{name:"Membership"}}),r=new He({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[NP]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment),t=$(),z(r.$$.fragment)},m(s,a){N(e,s,a),T(s,t,a),N(r,s,a),n=!0},p(s,a){let i={};a[1]&33554432&&(i.$$scope={dirty:a,ctx:s}),r.$set(i)},i(s){n||(L(e.$$.fragment,s),L(r.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),P(r.$$.fragment,s),n=!1},d(s){s&&I(t),H(e,s),H(r,s)}}}function BP(o){let e,t,r,n,s,a,i,l=[zP,HP],c=[];function u(d,m){return d[12]?0:1}return e=u(o,[-1,-1]),t=c[e]=l[e](o),n=new et({props:{name:"Storage"}}),a=new He({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[XP]},$$scope:{ctx:o}}}),{c(){t.c(),r=$(),z(n.$$.fragment),s=$(),z(a.$$.fragment)},m(d,m){c[e].m(d,m),T(d,r,m),N(n,d,m),T(d,s,m),N(a,d,m),i=!0},p(d,m){let x=e;e=u(d,m),e===x?c[e].p(d,m):(we(),P(c[x],1,1,()=>{c[x]=null}),_e(),t=c[e],t?t.p(d,m):(t=c[e]=l[e](d),t.c()),L(t,1),t.m(r.parentNode,r));let h={};m[0]&64|m[1]&33554432&&(h.$$scope={dirty:m,ctx:d}),a.$set(h)},i(d){i||(L(t),L(n.$$.fragment,d),L(a.$$.fragment,d),i=!0)},o(d){P(t),P(n.$$.fragment,d),P(a.$$.fragment,d),i=!1},d(d){d&&(I(r),I(s)),c[e].d(d),H(n,d),H(a,d)}}}function NP(o){let e,t,r;return{c(){e=C("button"),e.textContent="Leave",w(e,"class","mod-warning")},m(n,s){T(n,e,s),t||(r=ee(e,"click",(0,ht.debounce)(o[45])),t=!0)},p:Q,d(n){n&&I(e),t=!1,r()}}}function HP(o){let e,t;return e=new He({props:{name:`Plan: ${o[7].plan}`,description:"",$$slots:{description:[qP],default:[VP]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.name=`Plan: ${r[7].plan}`),n[0]&128|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function zP(o){let e,t,r=!o[6].values()[0].active||o[6].values()[0].cancelAt,n,s;e=new He({props:{name:`Plan: ${o[7].plan}`,description:"",$$slots:{description:[GP],default:[WP]},$$scope:{ctx:o}}});let a=r&&Yy(o);return{c(){z(e.$$.fragment),t=$(),a&&a.c(),n=Te()},m(i,l){N(e,i,l),T(i,t,l),a&&a.m(i,l),T(i,n,l),s=!0},p(i,l){let c={};l[0]&128&&(c.name=`Plan: ${i[7].plan}`),l[0]&4288|l[1]&33554432&&(c.$$scope={dirty:l,ctx:i}),e.$set(c),l[0]&64&&(r=!i[6].values()[0].active||i[6].values()[0].cancelAt),r?a?(a.p(i,l),l[0]&64&&L(a,1)):(a=Yy(i),a.c(),L(a,1),a.m(n.parentNode,n)):a&&(we(),P(a,1,1,()=>{a=null}),_e())},i(i){s||(L(e.$$.fragment,i),L(a),s=!0)},o(i){P(e.$$.fragment,i),P(a),s=!1},d(i){i&&(I(t),I(n)),H(e,i),a&&a.d(i)}}}function VP(o){let e,t,r;return{c(){e=C("button"),e.textContent="Upgrade",w(e,"class","mod-cta")},m(n,s){T(n,e,s),t||(r=ee(e,"click",function(){dt((0,ht.debounce)(o[44]))&&(0,ht.debounce)(o[44]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&I(e),t=!1,r()}}}function qP(o){let e,t=(o[7].cta||"Thanks for supporting Relay development <3")+"",r;return{c(){e=C("fragment"),r=W(t),w(e,"slot","description")},m(n,s){T(n,e,s),k(e,r)},p(n,s){s[0]&128&&t!==(t=(n[7].cta||"Thanks for supporting Relay development <3")+"")&&oe(r,t)},d(n){n&&I(e)}}}function jy(o){let e,t,r;return{c(){e=C("button"),e.textContent="Cancel",w(e,"class","mod-destructive")},m(n,s){T(n,e,s),t||(r=ee(e,"click",function(){dt((0,ht.debounce)(o[43]))&&(0,ht.debounce)(o[43]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&I(e),t=!1,r()}}}function WP(o){let e,t,r=o[6].values()[0].active&&!o[6].values()[0].cancelAt,n,s,a,i=r&&jy(o);return{c(){e=C("button"),e.textContent="Manage",t=$(),i&&i.c(),n=Te()},m(l,c){T(l,e,c),T(l,t,c),i&&i.m(l,c),T(l,n,c),s||(a=ee(e,"click",function(){dt((0,ht.debounce)(o[42]))&&(0,ht.debounce)(o[42]).apply(this,arguments)}),s=!0)},p(l,c){o=l,c[0]&64&&(r=o[6].values()[0].active&&!o[6].values()[0].cancelAt),r?i?i.p(o,c):(i=jy(o),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(l){l&&(I(e),I(t),I(n)),i&&i.d(l),s=!1,a()}}}function GP(o){let e,t=o[7].cta+"",r;return{c(){e=C("fragment"),r=W(t),w(e,"slot","description")},m(n,s){T(n,e,s),k(e,r)},p(n,s){s[0]&128&&t!==(t=n[7].cta+"")&&oe(r,t)},d(n){n&&I(e)}}}function Yy(o){let e,t;return e=new He({props:{description:"",$$slots:{name:[jP],default:[KP]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&64|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function KP(o){let e=o[14](o[6].values()[0].cancelAt)+"",t;return{c(){t=W(e)},m(r,n){T(r,t,n)},p(r,n){n[0]&64&&e!==(e=r[14](r[6].values()[0].cancelAt)+"")&&oe(t,e)},d(r){r&&I(t)}}}function jP(o){let e;return{c(){e=C("span"),e.textContent="Status: Cancelled",w(e,"slot","name"),w(e,"class","mod-warning")},m(t,r){T(t,e,r)},p:Q,d(t){t&&I(e)}}}function YP(o){let e,t,r;return{c(){e=C("button"),e.textContent="Destroy",w(e,"class","mod-warning")},m(n,s){T(n,e,s),t||(r=ee(e,"click",(0,ht.debounce)(o[27])),t=!0)},p:Q,d(n){n&&I(e),t=!1,r()}}}function JP(o){let e,t;return{c(){e=C("button"),e.textContent="Destroy",e.disabled=t=!0,w(e,"class","mod-warning"),w(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,n){T(r,e,n)},p:Q,d(r){r&&I(e)}}}function XP(o){let e,t;function r(a,i){return i[0]&64&&(e=null),e==null&&(e=a[6].values().length>0&&!a[6].values()[0].cancelAt),e?JP:YP}let n=r(o,[-1,-1]),s=n(o);return{c(){s.c(),t=Te()},m(a,i){s.m(a,i),T(a,t,i)},p(a,i){n===(n=r(a,i))&&s?s.p(a,i):(s.d(1),s=n(a),s&&(s.c(),s.m(t.parentNode,t)))},d(a){a&&I(t),s.d(a)}}}function QP(o){let e,t,r,n,s,a,i,l,c,u,d,m,x,h,_,b,v,D,B;e=new Bl({props:{category:xn,categoryText:"Relay Servers",$$slots:{default:[kP]},$$scope:{ctx:o}}}),e.$on("goBack",o[23]);let A=o[0].owner&&qy(o);n=new et({props:{name:"Folders on this Relay Server"}});let F=Fe(o[9].values()),O=[];for(let V=0;V<F.length;V+=1)O[V]=Wy(Vy(o,F,V));let M=V=>P(O[V],1,1,()=>{O[V]=null});i=new He({props:{description:"",name:"",$$slots:{default:[FP]},$$scope:{ctx:o}}}),c=new et({props:{name:"Users",$$slots:{default:[RP]},$$scope:{ctx:o}}});let E=Fe(o[11].values().sort(Jy)),R=[];for(let V=0;V<E.length;V+=1)R[V]=Ky(zy(o,E,V));let G=V=>P(R[V],1,1,()=>{R[V]=null});m=new et({props:{name:"Sharing"}}),h=new He({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[UP]},$$scope:{ctx:o}}});let le=[BP,$P],j=[];function ae(V,Z){return V[7].owner?0:1}return b=ae(o,[-1,-1]),v=j[b]=le[b](o),{c(){z(e.$$.fragment),t=$(),A&&A.c(),r=$(),z(n.$$.fragment),s=$();for(let V=0;V<O.length;V+=1)O[V].c();a=$(),z(i.$$.fragment),l=$(),z(c.$$.fragment),u=$();for(let V=0;V<R.length;V+=1)R[V].c();d=$(),z(m.$$.fragment),x=$(),z(h.$$.fragment),_=$(),v.c(),D=Te()},m(V,Z){N(e,V,Z),T(V,t,Z),A&&A.m(V,Z),T(V,r,Z),N(n,V,Z),T(V,s,Z);for(let Ee=0;Ee<O.length;Ee+=1)O[Ee]&&O[Ee].m(V,Z);T(V,a,Z),N(i,V,Z),T(V,l,Z),N(c,V,Z),T(V,u,Z);for(let Ee=0;Ee<R.length;Ee+=1)R[Ee]&&R[Ee].m(V,Z);T(V,d,Z),N(m,V,Z),T(V,x,Z),N(h,V,Z),T(V,_,Z),j[b].m(V,Z),T(V,D,Z),B=!0},p(V,Z){let Ee={};if(Z[0]&1|Z[1]&33554432&&(Ee.$$scope={dirty:Z,ctx:V}),e.$set(Ee),V[0].owner?A?(A.p(V,Z),Z[0]&1&&L(A,1)):(A=qy(V),A.c(),L(A,1),A.m(r.parentNode,r)):A&&(we(),P(A,1,1,()=>{A=null}),_e()),Z[0]&570426880){F=Fe(V[9].values());let fe;for(fe=0;fe<F.length;fe+=1){let Ce=Vy(V,F,fe);O[fe]?(O[fe].p(Ce,Z),L(O[fe],1)):(O[fe]=Wy(Ce),O[fe].c(),L(O[fe],1),O[fe].m(a.parentNode,a))}for(we(),fe=F.length;fe<O.length;fe+=1)M(fe);_e()}let Re={};Z[1]&33554432&&(Re.$$scope={dirty:Z,ctx:V}),i.$set(Re);let Pe={};if(Z[0]&2176|Z[1]&33554432&&(Pe.$$scope={dirty:Z,ctx:V}),c.$set(Pe),Z[0]&268437632){E=Fe(V[11].values().sort(Jy));let fe;for(fe=0;fe<E.length;fe+=1){let Ce=zy(V,E,fe);R[fe]?(R[fe].p(Ce,Z),L(R[fe],1)):(R[fe]=Ky(Ce),R[fe].c(),L(R[fe],1),R[fe].m(d.parentNode,d))}for(we(),fe=E.length;fe<R.length;fe+=1)G(fe);_e()}let Ke={};Z[0]&16|Z[1]&33554432&&(Ke.$$scope={dirty:Z,ctx:V}),h.$set(Ke);let qe=b;b=ae(V,Z),b===qe?j[b].p(V,Z):(we(),P(j[qe],1,1,()=>{j[qe]=null}),_e(),v=j[b],v?v.p(V,Z):(v=j[b]=le[b](V),v.c()),L(v,1),v.m(D.parentNode,D))},i(V){if(!B){L(e.$$.fragment,V),L(A),L(n.$$.fragment,V);for(let Z=0;Z<F.length;Z+=1)L(O[Z]);L(i.$$.fragment,V),L(c.$$.fragment,V);for(let Z=0;Z<E.length;Z+=1)L(R[Z]);L(m.$$.fragment,V),L(h.$$.fragment,V),L(v),B=!0}},o(V){P(e.$$.fragment,V),P(A),P(n.$$.fragment,V),O=O.filter(Boolean);for(let Z=0;Z<O.length;Z+=1)P(O[Z]);P(i.$$.fragment,V),P(c.$$.fragment,V),R=R.filter(Boolean);for(let Z=0;Z<R.length;Z+=1)P(R[Z]);P(m.$$.fragment,V),P(h.$$.fragment,V),P(v),B=!1},d(V){V&&(I(t),I(r),I(s),I(a),I(l),I(u),I(d),I(x),I(_),I(D)),H(e,V),A&&A.d(V),H(n,V),ft(O,V),H(i,V),H(c,V),ft(R,V),H(m,V),H(h,V),j[b].d(V)}}}function Jy(o,e){return o.role==="Owner"&&e.role!=="Owner"?-1:o.role!=="Owner"&&e.role==="Owner"||o.user.name>e.user.name?1:-1}function ZP(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function eD(o,e,t){let r,n,s=Q,a=()=>(s(),s=Zt(O,re=>t(46,n=re)),O),i,l,c=Q,u=()=>(c(),c=Zt(D,re=>t(7,l=re)),D),d,m,x,h=Q,_=()=>(h(),h=Zt(F,re=>t(10,x=re)),F),b,v;o.$$.on_destroy.push(()=>s()),o.$$.on_destroy.push(()=>c()),o.$$.on_destroy.push(()=>h());let{relay:D}=e;u();let B=D.folders;ye(o,B,re=>t(9,m=re));let{plugin:A}=e,{sharedFolders:F}=e;_();let{relayRoles:O}=e;a();function M(re){if(!re)return"Active";let Ve=(0,ip.default)(),be=(0,ip.default)(re).diff(Ve,"days");return be<=0?"Subscription has ended":be===1?"Active for 1 more day":`Active for ${be} more days`}let E=l.subscriptions;ye(o,E,re=>t(6,i=re));let R=qn(i,re=>{if(re.values().length===0)return;let Ve=re.values()[0];return Ve.token||A.relayManager.getSubscriptionToken(Ve).then(K=>{Ve.token=K}),Ve});ye(o,R,re=>t(12,v=re));let G=n.filter(re=>re.relayId===D.id);ye(o,G,re=>t(11,b=re));let le=xe(!0);ye(o,le,re=>t(5,r=re));let j;tr(()=>{j&&j.value===""&&j.focus()});let ae=Nt();function V(re){return Ze(this,void 0,void 0,function*(){var Ve;if(!(!((Ve=A.loginManager)===null||Ve===void 0)&&Ve.user))return;let K={relay:re.id,quantity:10,user_email:A.loginManager.user.email},be=btoa(JSON.stringify(K)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(A.buildApiUrl(`/subscribe/${be}`),"_blank")})}function Z(re){return Ze(this,void 0,void 0,function*(){let Ve=re.token,K=re.id;window.open(A.buildApiUrl(`/subscriptions/${K}/manage?token=${Ve}`),"_blank")})}function Ee(re){return Ze(this,void 0,void 0,function*(){let Ve=re.token,K=re.id;window.open(A.buildApiUrl(`/subscriptions/${K}/cancel?token=${Ve}`),"_blank")})}function Re(){return Ze(this,void 0,void 0,function*(){A.relayManager.leaveRelay(D),ae("goBack",{clear:!0})})}function Pe(){return Ze(this,void 0,void 0,function*(){ae("goBack",{clear:!0})})}let Ke;A.relayManager.getRelayInvitationKey(D).then(re=>{t(4,Ke=re)});function qe(re,Ve,K){return Ze(this,void 0,void 0,function*(){let be=(0,ht.normalizePath)((0,Xy.join)(K,Ve));A.vault.getFolderByPath(be)===null&&(yield A.vault.createFolder(be));let ce=A.sharedFolders.new(be,re.guid,D.guid,!0);return ce.remote=re,A.sharedFolders.notifyListeners(),ce})}let fe=xe(!1);ye(o,fe,re=>t(8,d=re));let Ce=A.timeProvider.debounce(()=>{A.relayManager.updateRelay(D).then(()=>{fe.set(!1)})},500),te=re=>{new Vl(A.app,F,re,qe).open()};function ze(){le.set(ZP(j.value)),r&&j.value!==""&&(fe.set(!0),Ce())}function kt(){A.relayManager.destroyRelay(D),ae("goBack",{})}function Oe(re){A.relayManager.kick(re)}function pt(re,Ve){re&&ae("manageSharedFolder",{folder:re,relay:Ve,mount:!1})}function gt(re){let Ve=re.target;Ve.focus(),Ve.select(),navigator.clipboard.writeText(Ve.value).then(()=>new ht.Notice("Invite link copied")).catch(K=>{})}let Rt=new Nl(A.app,F,re=>Ze(void 0,void 0,void 0,function*(){let Ve=(0,ht.normalizePath)(re),K=F.find(Xe=>Xe.path==re);if(K){let Xe=yield A.relayManager.createRemoteFolder(K,D);K.remote=Xe,K.connect(),A.sharedFolders.notifyListeners();return}A.vault.getFolderByPath(Ve)===null&&(yield A.vault.createFolder(Ve));let be=Ei(),ce=A.sharedFolders.new((0,ht.normalizePath)(re),be,D.guid,!0),Je=yield A.relayManager.createRemoteFolder(ce,D);ce.remote=Je,A.sharedFolders.notifyListeners()})),Ko=(re,Ve)=>Ve.remote===re;function kr(){D.name=this.value,u(t(0,D))}function Ur(re){Or[re?"unshift":"push"](()=>{j=re,t(3,j)})}let bo=(re,Ve)=>Ve.remote===re;function jo(re){Xr.call(this,o,re)}let Lr=re=>{let Ve=x.find(K=>K.remote===re);Ve&&pt(Ve,re.relay)},Zr=re=>{te(re)},Yo=()=>{Rt.open()},sr=re=>{Oe(re)},it=()=>{Z(v)},vt=()=>{Ee(v)},eo=()=>{V(l)},pr=()=>{Re()};return o.$$set=re=>{"relay"in re&&u(t(0,D=re.relay)),"plugin"in re&&t(32,A=re.plugin),"sharedFolders"in re&&_(t(1,F=re.sharedFolders)),"relayRoles"in re&&a(t(2,O=re.relayRoles))},[D,F,O,j,Ke,r,i,l,d,m,x,b,v,B,M,E,R,G,le,V,Z,Ee,Re,Pe,fe,te,ze,kt,Oe,pt,gt,Rt,A,Ko,kr,Ur,bo,jo,Lr,Zr,Yo,sr,it,vt,eo,pr]}var lp=class extends J{constructor(e){super(),X(this,e,eD,QP,Y,{relay:0,plugin:32,sharedFolders:1,relayRoles:2},_P,[-1,-1])}},Js=lp;function tD(o){let e,t,r,n,s,a;return r=new Iu({}),{c(){e=C("div"),t=C("div"),z(r.$$.fragment),w(t,"class","clickable-icon"),w(t,"aria-label","Back"),w(t,"tabindex","0"),w(t,"role","button"),w(e,"class","modal-setting-nav-bar")},m(i,l){T(i,e,l),k(e,t),N(r,t,null),n=!0,s||(a=[ee(t,"click",o[0]),ee(t,"keypress",o[1])],s=!0)},p:Q,i(i){n||(L(r.$$.fragment,i),n=!0)},o(i){P(r.$$.fragment,i),n=!1},d(i){i&&I(e),H(r),s=!1,Le(a)}}}function rD(o){let e=Nt();function t(){e("goBack",{})}function r(n){n.key==="Escape"&&(e("goBack",{}),n.stopPropagation())}return[t,r]}var fp=class extends J{constructor(e){super(),X(this,e,rD,tD,Y,{})}},Qy=fp;var Xs=require("obsidian");function oD(o){let e=o[1].name+"",t;return{c(){t=W(e)},m(r,n){T(r,t,n)},p(r,n){n&2&&e!==(e=r[1].name+"")&&oe(t,e)},d(r){r&&I(t)}}}function nD(o){let e,t,r;return{c(){e=C("button"),e.textContent="Delete local",w(e,"class","mod-warning")},m(n,s){T(n,e,s),t||(r=ee(e,"click",(0,Xs.debounce)(o[13])),t=!0)},p:Q,d(n){n&&I(e),t=!1,r()}}}function sD(o){let e,t,r,n,s,a,i;return{c(){e=C("button"),t=W("Delete metadata"),w(e,"class",r=o[4]?"mod-disabled":"mod-warning"),e.disabled=n=!!o[4],w(e,"aria-label",s=o[4]?"Metadata is required for sharing.":"")},m(l,c){T(l,e,c),k(e,t),a||(i=ee(e,"click",(0,Xs.debounce)(o[14])),a=!0)},p(l,c){c&16&&r!==(r=l[4]?"mod-disabled":"mod-warning")&&w(e,"class",r),c&16&&n!==(n=!!l[4])&&(e.disabled=n),c&16&&s!==(s=l[4]?"Metadata is required for sharing.":"")&&w(e,"aria-label",s)},d(l){l&&I(e),a=!1,i()}}}function Zy(o){var n,s,a,i,l;let e,t,r=(((n=o[4])==null?void 0:n.owner)||((i=(a=(s=o[3])==null?void 0:s.remote)==null?void 0:a.creator)==null?void 0:i.id)===((l=o[0].relayManager.user)==null?void 0:l.id))&&eb(o);return{c(){r&&r.c(),e=Te()},m(c,u){r&&r.m(c,u),T(c,e,u),t=!0},p(c,u){var d,m,x,h,_;(d=c[4])!=null&&d.owner||((h=(x=(m=c[3])==null?void 0:m.remote)==null?void 0:x.creator)==null?void 0:h.id)===((_=c[0].relayManager.user)==null?void 0:_.id)?r?(r.p(c,u),u&25&&L(r,1)):(r=eb(c),r.c(),L(r,1),r.m(e.parentNode,e)):r&&(we(),P(r,1,1,()=>{r=null}),_e())},i(c){t||(L(r),t=!0)},o(c){P(r),t=!1},d(c){c&&I(e),r&&r.d(c)}}}function eb(o){let e,t,r,n;return e=new et({props:{name:"Remote Folder"}}),r=new He({props:{name:"Remove from relay",description:"Deletes the remote folder from the relay. Local files will be preserved.",$$slots:{default:[aD]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment),t=$(),z(r.$$.fragment)},m(s,a){N(e,s,a),T(s,t,a),N(r,s,a),n=!0},p(s,a){let i={};a&1048576&&(i.$$scope={dirty:a,ctx:s}),r.$set(i)},i(s){n||(L(e.$$.fragment,s),L(r.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),P(r.$$.fragment,s),n=!1},d(s){s&&I(t),H(e,s),H(r,s)}}}function aD(o){let e,t,r;return{c(){e=C("button"),e.textContent="Delete remote",w(e,"class","mod-destructive")},m(n,s){T(n,e,s),t||(r=ee(e,"click",(0,Xs.debounce)(o[9])),t=!0)},p:Q,d(n){n&&I(e),t=!1,r()}}}function iD(o){let e,t;return e=new He({props:{description:"This folder is tracking edits, but is not connected to a Relay Server."}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p:Q,i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function lD(o){let e,t;return e=new wr({props:{$$slots:{name:[uD],default:[fD]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&1048592&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function fD(o){let e,t;return e=new Wn({}),e.$on("settings",function(){dt((0,Xs.debounce)(o[16]))&&(0,Xs.debounce)(o[16]).apply(this,arguments)}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){o=r},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function cD(o){let e=o[4].name+"",t;return{c(){t=W(e)},m(r,n){T(r,t,n)},p(r,n){n&16&&e!==(e=r[4].name+"")&&oe(t,e)},d(r){r&&I(t)}}}function uD(o){let e,t;return e=new xn({props:{slot:"name",relay:o[4],$$slots:{default:[cD]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[15]),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&16&&(s.relay=r[4]),n&1048592&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function dD(o){let e,t,r,n,s,a,i,l,c,u,d,m,x,h,_;e=new Bl({props:{category:ho,categoryText:"Shared Folders",$$slots:{default:[oD]},$$scope:{ctx:o}}}),e.$on("goBack",o[7]),r=new et({props:{name:"Local folder"}}),s=new He({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[nD]},$$scope:{ctx:o}}}),i=new He({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[sD]},$$scope:{ctx:o}}});let b=o[4]&&Zy(o);u=new et({props:{name:"Relay Server"}});let v=[lD,iD],D=[];function B(A,F){return A[4]?0:1}return m=B(o,-1),x=D[m]=v[m](o),{c(){z(e.$$.fragment),t=$(),z(r.$$.fragment),n=$(),z(s.$$.fragment),a=$(),z(i.$$.fragment),l=$(),b&&b.c(),c=$(),z(u.$$.fragment),d=$(),x.c(),h=Te()},m(A,F){N(e,A,F),T(A,t,F),N(r,A,F),T(A,n,F),N(s,A,F),T(A,a,F),N(i,A,F),T(A,l,F),b&&b.m(A,F),T(A,c,F),N(u,A,F),T(A,d,F),D[m].m(A,F),T(A,h,F),_=!0},p(A,[F]){let O={};F&1048578&&(O.$$scope={dirty:F,ctx:A}),e.$set(O);let M={};F&1048576&&(M.$$scope={dirty:F,ctx:A}),s.$set(M);let E={};F&1048592&&(E.$$scope={dirty:F,ctx:A}),i.$set(E),A[4]?b?(b.p(A,F),F&16&&L(b,1)):(b=Zy(A),b.c(),L(b,1),b.m(c.parentNode,c)):b&&(we(),P(b,1,1,()=>{b=null}),_e());let R=m;m=B(A,F),m===R?D[m].p(A,F):(we(),P(D[R],1,1,()=>{D[R]=null}),_e(),x=D[m],x?x.p(A,F):(x=D[m]=v[m](A),x.c()),L(x,1),x.m(h.parentNode,h))},i(A){_||(L(e.$$.fragment,A),L(r.$$.fragment,A),L(s.$$.fragment,A),L(i.$$.fragment,A),L(b),L(u.$$.fragment,A),L(x),_=!0)},o(A){P(e.$$.fragment,A),P(r.$$.fragment,A),P(s.$$.fragment,A),P(i.$$.fragment,A),P(b),P(u.$$.fragment,A),P(x),_=!1},d(A){A&&(I(t),I(n),I(a),I(l),I(c),I(d),I(h)),H(e,A),H(r,A),H(s,A),H(i,A),b&&b.d(A),H(u,A),D[m].d(A)}}}function pD(o,e,t){let r,n,s=Q,a=()=>(s(),s=Zt(u,R=>t(17,n=R)),u),i;o.$$.on_destroy.push(()=>s());let{plugin:l}=e,{sharedFolder:c}=e,{sharedFolders:u}=e;a();let{relayRoles:d}=e,m=qn(n,R=>R.find(G=>G===c));ye(o,m,R=>t(3,r=R));let x=qn([m,d],([R,G])=>{var le;return(le=G.find(j=>{var ae;return j.relay===((ae=R==null?void 0:R.remote)===null||ae===void 0?void 0:ae.relay)}))===null||le===void 0?void 0:le.relay});ye(o,x,R=>t(4,i=R));let h;tr(()=>{!c&&h&&h.value===""&&h.focus()});let _=Nt();function b(){return Ze(this,void 0,void 0,function*(){_("goBack",{clear:!0})})}function v(R){R&&_("manageRelay",{relay:R})}function D(){return Ze(this,void 0,void 0,function*(){yield l.relayManager.deleteRemote(c),l.sharedFolders.notifyListeners()})}function B(){return Ze(this,void 0,void 0,function*(){r&&l.sharedFolders.delete(r),_("goBack",{clear:!0})})}function A(){let R=l.vault.getFolderByPath(c.path);R&&l.app.vault.trash(R,!1),_("goBack",{})}let F=()=>{A()},O=()=>{B()};function M(R){Xr.call(this,o,R)}let E=()=>{v(i)};return o.$$set=R=>{"plugin"in R&&t(0,l=R.plugin),"sharedFolder"in R&&t(1,c=R.sharedFolder),"sharedFolders"in R&&a(t(2,u=R.sharedFolders)),"relayRoles"in R&&t(12,d=R.relayRoles)},[l,c,u,r,i,m,x,b,v,D,B,A,d,F,O,M,E]}var cp=class extends J{constructor(e){super(),X(this,e,pD,dD,Y,{plugin:0,sharedFolder:1,sharedFolders:2,relayRoles:12})}},up=cp;function mD(o){Ae(o,"svelte-iv3x1u",".relay-version.svelte-iv3x1u{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-iv3x1u{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-iv3x1u{padding-left:48px !important;background-color:var(--color-red) !important}.system3-announcement.svelte-iv3x1u{color:var(--text-on-accent)}")}function hD(o){let e,t,r=o[0].networkStatus.status+"",n;return{c(){e=C("div"),t=C("span"),n=W(r),w(t,"class","system3-announcement svelte-iv3x1u"),w(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-iv3x1u")},m(s,a){T(s,e,a),k(e,t),k(t,n)},p(s,a){a&1&&r!==(r=s[0].networkStatus.status+"")&&oe(n,r)},i:Q,o:Q,d(s){s&&I(e)}}}function gD(o){let e,t;return e=new Qy({}),e.$on("goBack",o[9]),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p:Q,i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function xD(o){let e,t;return e=new yy({props:{plugin:o[0],$$slots:{default:[wD]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&1048577&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function yD(o){let e,t;return e=new Js({props:{plugin:o[0],relayRoles:o[3],relay:o[2],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageSharedFolder",o[7]),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&4&&(s.relay=r[2]),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function bD(o){let e,t;return e=new up({props:{plugin:o[0],relayRoles:o[3],sharedFolder:o[1],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageRelay",o[6]),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&2&&(s.sharedFolder=r[1]),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function wD(o){let e,t;return e=new go({props:{relays:o[4],plugin:o[0]}}),e.$on("manageRelay",o[6]),e.$on("manageSharedFolder",o[7]),e.$on("createRelay",o[8]),e.$on("joinRelay",o[11]),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function tb(o){let e,t=o[0].version+"",r;return{c(){e=C("span"),r=W(t),w(e,"class","relay-version svelte-iv3x1u")},m(n,s){T(n,e,s),k(e,r)},p(n,s){s&1&&t!==(t=n[0].version+"")&&oe(r,t)},d(n){n&&I(e)}}}function _D(o){let e,t,r,n,s,a,i,l,c,u=[gD,hD],d=[];function m(v,D){return v[2]||v[1]?0:v[0].networkStatus.status?1:-1}~(e=m(o,-1))&&(t=d[e]=u[e](o));let x=[bD,yD,xD],h=[];function _(v,D){return v[1]?0:v[2]?1:2}s=_(o,-1),a=h[s]=x[s](o);let b=o[0].manifest.version!==o[0].version&&tb(o);return{c(){t&&t.c(),r=$(),n=C("div"),a.c(),i=$(),b&&b.c(),l=Te(),w(n,"class","vertical-tab-content svelte-iv3x1u")},m(v,D){~e&&d[e].m(v,D),T(v,r,D),T(v,n,D),h[s].m(n,null),T(v,i,D),b&&b.m(v,D),T(v,l,D),c=!0},p(v,[D]){let B=e;e=m(v,D),e===B?~e&&d[e].p(v,D):(t&&(we(),P(d[B],1,1,()=>{d[B]=null}),_e()),~e?(t=d[e],t?t.p(v,D):(t=d[e]=u[e](v),t.c()),L(t,1),t.m(r.parentNode,r)):t=null);let A=s;s=_(v,D),s===A?h[s].p(v,D):(we(),P(h[A],1,1,()=>{h[A]=null}),_e(),a=h[s],a?a.p(v,D):(a=h[s]=x[s](v),a.c()),L(a,1),a.m(n,null)),v[0].manifest.version!==v[0].version?b?b.p(v,D):(b=tb(v),b.c(),b.m(l.parentNode,l)):b&&(b.d(1),b=null)},i(v){c||(L(t),L(a),c=!0)},o(v){P(t),P(a),c=!1},d(v){v&&(I(r),I(n),I(i),I(l)),~e&&d[e].d(v),h[s].d(),b&&b.d(v)}}}function vD(o,e,t){let r,{plugin:n}=e,{path:s=void 0}=e,a=n.app,i=n.relayManager,l=i.relayRoles,c=i.relays;ye(o,c,M=>t(15,r=M));let u=n.sharedFolders,d,m=go,x,h=[{component:go}],{close:_}=e;function b(M){if(t(2,x=void 0),t(1,d=void 0),M==="/"){t(14,m=go);return}let E=new URLSearchParams(M.split("?")[1]||""),R=E.get("id");if(M.startsWith("/relays")){R?(t(2,x=i.relays.find(G=>G.guid===R)),t(14,m=Js)):t(14,m=go);return}if(M.startsWith("/shared-folders")){if(R){t(1,d=u.find(le=>le.guid===R));let G=E.get("relay");G&&t(2,x=i.relays.get(G)),t(14,m=up)}return}}function v(M){h.push({currentRelay:x,sharedFolder:d,component:m}),t(2,x=M.detail.relay),t(1,d=void 0),t(14,m=Js)}function D(M){h.push({currentRelay:x,sharedFolder:d,component:m}),t(1,d=M.detail.folder),t(2,x=M.detail.relay)}function B(M){return Ze(this,void 0,void 0,function*(){h.push({currentRelay:x,sharedFolder:d,component:m}),t(2,x=yield n.relayManager.createRelay("")),t(14,m=Js)})}function A(M){if(M.detail.clear){h.length=0,t(2,x=void 0),t(1,d=void 0),t(14,m=go);return}let E=h.pop();if(E)for(;E;){if(!E.currentRelay&&!E.sharedFolder)t(2,x=E.currentRelay),t(1,d=E.sharedFolder),t(14,m=E.component);else if(E.sharedFolder&&u.has(E.sharedFolder)){t(2,x=E.currentRelay),t(1,d=E.sharedFolder),t(14,m=E.component);break}else if(E.currentRelay&&i.relays.get(E.currentRelay.id)){t(2,x=E.currentRelay),t(1,d=E.sharedFolder),t(14,m=E.component);break}E=h.pop()}else t(2,x=void 0),t(1,d=void 0),t(14,m=go)}function F(M){h.length=0,_()}function O(M){t(2,x=M.detail.relay),t(14,m=Js)}return o.$$set=M=>{"plugin"in M&&t(0,n=M.plugin),"path"in M&&t(12,s=M.path),"close"in M&&t(13,_=M.close)},o.$$.update=()=>{if(o.$$.dirty&4096){e:s&&b(s)}if(o.$$.dirty&32772){e:x&&!r.has(x.id)&&(t(2,x=void 0),t(14,m=go))}if(o.$$.dirty&2){e:d&&!u.has(d)&&(t(1,d=void 0),t(14,m=go))}if(o.$$.dirty&16390){e:(m||x||d)&&setTimeout(()=>{let M=document.querySelector(".vertical-tab-content");M&&(M.scrollTop=0)},0)}},[n,d,x,l,c,u,v,D,B,A,F,O,s,_,m,r]}var dp=class extends J{constructor(e){super(),X(this,e,vD,_D,Y,{plugin:0,path:12,close:13},mD)}},rb=dp;var ql=class extends ob.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new rb({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(t){var r;(r=this.component)==null||r.$set({path:t})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var cb=require("obsidian");var rr=class extends Error{constructor(e){var t,r,n,s;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,rr.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof rr||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(s=(n=(r=this.originalError)==null?void 0:r.cause)==null?void 0:n.message)!=null&&s.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},Wl=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function SD(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||kD,n=0;for(;n<o.length;){let s=o.indexOf("=",n);if(s===-1)break;let a=o.indexOf(";",n);if(a===-1)a=o.length;else if(a<s){n=o.lastIndexOf(";",s-1)+1;continue}let i=o.slice(n,s).trim();if(t[i]===void 0){let l=o.slice(s+1,a).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[i]=r(l)}catch(c){t[i]=l}}n=a+1}return t}function nb(o,e,t){let r=Object.assign({},t||{}),n=r.encode||LD;if(!Wl.test(o))throw new TypeError("argument name is invalid");let s=n(e);if(s&&!Wl.test(s))throw new TypeError("argument val is invalid");let a=o+"="+s;if(r.maxAge!=null){let i=r.maxAge-0;if(isNaN(i)||!isFinite(i))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(i)}if(r.domain){if(!Wl.test(r.domain))throw new TypeError("option domain is invalid");a+="; Domain="+r.domain}if(r.path){if(!Wl.test(r.path))throw new TypeError("option path is invalid");a+="; Path="+r.path}if(r.expires){if(!function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");a+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":a+="; Priority=Low";break;case"medium":a+="; Priority=Medium";break;case"high":a+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a}function kD(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function LD(o){return encodeURIComponent(o)}var ib;function Gl(o){if(o)try{let e=decodeURIComponent(ib(o.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function lb(o,e=0){let t=Gl(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}ib=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,n=0,s=0,a="";r=e.charAt(s++);~r&&(t=n%4?64*t+r:r,n++%4)?a+=String.fromCharCode(255&t>>(-2*n&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};var sb="pb_auth",Ka=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!lb(this.token)}get isAdmin(){return Gl(this.token).type==="admin"}get isAuthRecord(){return Gl(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=sb){let r=SD(e||"")[t]||"",n={};try{n=JSON.parse(r),(typeof n===null||typeof n!="object"||Array.isArray(n))&&(n={})}catch(s){}this.save(n.token||"",n.model||null)}exportToCookie(e,t=sb){var l,c;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=Gl(this.token);r.expires=n!=null&&n.exp?new Date(1e3*n.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let s={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},a=nb(t,JSON.stringify(s),e),i=typeof Blob!="undefined"?new Blob([a]).size:a.length;if(s.model&&i>4096){s.model={id:(l=s==null?void 0:s.model)==null?void 0:l.id,email:(c=s==null?void 0:s.model)==null?void 0:c.email};let u=["collectionId","username","verified"];for(let d in this.model)u.includes(d)&&(s.model[d]=this.model[d]);a=nb(t,JSON.stringify(s),e)}return a}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},mp=class extends Ka{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},Vo=class{constructor(e){this.client=e}},hp=class extends Vo{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,n,s,a){return a=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:n,duration:s}},a),this.client.send("/api/settings/apple/generate-client-secret",a)}},ja=class extends Vo{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(n=>{var s;return n.items=((s=n.items)==null?void 0:s.map(a=>this.decode(a)))||[],n})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var n;if(!((n=r==null?void 0:r.items)!=null&&n.length))throw new rr({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new rr({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(n=>this.decode(n))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],n=async s=>this.getList(s,e||500,t).then(a=>{let i=a.items;return r=r.concat(i),i.length==a.perPage?n(s+1):r});return n(1)}};function _r(o,e,t,r){let n=r!==void 0;return n||t!==void 0?n?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function pp(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var gp=class extends ja{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,a;return((s=this.client.authStore.model)==null?void 0:s.id)===n.id&&((a=this.client.authStore.model)==null?void 0:a.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s;return r&&((n=this.client.authStore.model)==null?void 0:n.id)===e&&((s=this.client.authStore.model)==null?void 0:s.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};s=_r("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",s,r,n);let a=s.autoRefreshThreshold;delete s.autoRefreshThreshold,s.autoRefresh||pp(this.client);let i=await this.client.send(this.baseCrudPath+"/auth-with-password",s);return i=this.authResponse(i),a&&function(c,u,d,m){pp(c);let x=c.beforeSend,h=c.authStore.model,_=c.authStore.onChange((b,v)=>{(!b||(v==null?void 0:v.id)!=(h==null?void 0:h.id)||(v!=null&&v.collectionId||h!=null&&h.collectionId)&&(v==null?void 0:v.collectionId)!=(h==null?void 0:h.collectionId))&&pp(c)});c._resetAutoRefresh=function(){_(),c.beforeSend=x,delete c._resetAutoRefresh},c.beforeSend=async(b,v)=>{var F;let D=c.authStore.token;if((F=v.query)!=null&&F.autoRefresh)return x?x(b,v):{url:b,sendOptions:v};let B=c.authStore.isValid;if(B&&lb(c.authStore.token,u))try{await d()}catch(O){B=!1}B||await m();let A=v.headers||{};for(let O in A)if(O.toLowerCase()=="authorization"&&D==A[O]&&c.authStore.token){A[O]=c.authStore.token;break}return v.headers=A,x?x(b,v):{url:b,sendOptions:v}}}(this.client,a,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},s))),i}async authRefresh(e,t){let r={method:"POST"};return r=_r("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=_r("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=_r("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",a,n,s),this.client.send(this.baseCrudPath+"/confirm-password-reset",a).then(()=>!0)}},ID=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function fb(o){if(o){o.query=o.query||{};for(let e in o)ID.includes(e)||(o.query[e]=o[e],delete o[e])}}var Kl=class extends Vo{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var a;if(!e)throw new Error("topic must be set.");let n=e;if(r){fb(r);let i="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));n+=(n.includes("?")?"&":"?")+i}let s=function(i){let l=i,c;try{c=JSON.parse(l==null?void 0:l.data)}catch(u){}t(c||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(s),this.isConnected?this.subscriptions[n].length===1?await this.submitSubscriptions():(a=this.eventSource)==null||a.addEventListener(n,s):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,s)}async unsubscribe(e){var r;let t=!1;if(e){let n=this.getSubscriptionsByTopic(e);for(let s in n)if(this.hasSubscriptionListeners(s)){for(let a of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,a);delete this.subscriptions[s],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let n in this.subscriptions)if((n+"?").startsWith(e)){t=!0;for(let s of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,s);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var s;let r=!1,n=this.getSubscriptionsByTopic(e);for(let a in n){if(!Array.isArray(this.subscriptions[a])||!this.subscriptions[a].length)continue;let i=!1;for(let l=this.subscriptions[a].length-1;l>=0;l--)this.subscriptions[a][l]===t&&(i=!0,delete this.subscriptions[a][l],this.subscriptions[a].splice(l,1),(s=this.eventSource)==null||s.removeEventListener(a,t));i&&(this.subscriptions[a].length||delete this.subscriptions[a],r||this.hasSubscriptionListeners(a)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let n in this.subscriptions)if((r=this.subscriptions[n])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let n in r)for(let s of r[n])s(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new rr(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},xp=class extends ja{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,a,i;return((s=this.client.authStore.model)==null?void 0:s.id)!==(n==null?void 0:n.id)||((a=this.client.authStore.model)==null?void 0:a.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s,a;return!r||((n=this.client.authStore.model)==null?void 0:n.id)!==e||((s=this.client.authStore.model)==null?void 0:s.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};return s=_r("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/auth-with-password",s).then(a=>this.authResponse(a))}async authWithOAuth2Code(e,t,r,n,s,a,i){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:n,createData:s}};return l=_r("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,a,i),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then(c=>this.authResponse(c))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(l=>l.name===t.provider);if(!r)throw new rr(new Error(`Missing or invalid provider "${t.provider}".`));let n=this.client.buildUrl("/api/oauth2-redirect"),s=new Kl(this.client),a=null;function i(){a==null||a.close(),s.unsubscribe()}return t.urlCallback||(a=ab(void 0)),new Promise(async(l,c)=>{var u;try{await s.subscribe("@oauth2",async h=>{let _=s.clientId;try{if(!h.state||_!==h.state)throw new Error("State parameters don't match.");let b=Object.assign({},t);delete b.provider,delete b.scopes,delete b.createData,delete b.urlCallback;let v=await this.authWithOAuth2Code(r.name,h.code,r.codeVerifier,n,t.createData,b);l(v)}catch(b){c(new rr(b))}i()});let d={state:s.clientId};(u=t.scopes)!=null&&u.length&&(d.scope=t.scopes.join(" "));let m=this._replaceQueryParams(r.authUrl+n,d);await(t.urlCallback||function(h){a?a.location.href=h:a=ab(h)})(m)}catch(d){i(),c(new rr(d))}})}async authRefresh(e,t){let r={method:"POST"};return r=_r("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(n=>this.authResponse(n))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=_r("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=_r("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",a,n,s),this.client.send(this.baseCollectionPath+"/confirm-password-reset",a).then(()=>!0)}async requestVerification(e,t,r){let n={method:"POST",body:{email:e}};return n=_r("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-verification",n).then(()=>!0)}async confirmVerification(e,t,r){let n={method:"POST",body:{token:e}};return n=_r("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then(()=>!0)}async requestEmailChange(e,t,r){let n={method:"POST",body:{newEmail:e}};return n=_r("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",n).then(()=>!0)}async confirmEmailChange(e,t,r,n){let s={method:"POST",body:{token:e,password:t}};return s=_r("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",s).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,n="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),n=e.substring(e.indexOf("?")+1));let s={},a=n.split("&");for(let i of a){if(i=="")continue;let l=i.split("=");s[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let i in t)t.hasOwnProperty(i)&&(t[i]==null?delete s[i]:s[i]=t[i]);n="";for(let i in s)s.hasOwnProperty(i)&&(n!=""&&(n+="&"),n+=encodeURIComponent(i.replace(/%20/g,"+"))+"="+encodeURIComponent(s[i].replace(/%20/g,"+")));return n!=""?r+"?"+n:r}};function ab(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new rr(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,n=window.innerHeight;e=e>r?r:e,t=t>n?n:t;let s=r/2-e/2,a=n/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+a+",left="+s+",resizable,menubar=no")}var yp=class extends ja{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},bp=class extends Vo{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new rr({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},wp=class extends Vo{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},_p=class extends Vo{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(e.collectionId||e.collectionName)),n.push(encodeURIComponent(e.id)),n.push(encodeURIComponent(t));let s=this.client.buildUrl(n.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let a=new URLSearchParams(r);s+=(s.includes("?")?"&":"?")+a}return s}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},vp=class extends Vo{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},jl=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new mp,this.admins=new gp(this),this.collections=new yp(this),this.files=new _p(this),this.logs=new bp(this),this.settings=new hp(this),this.realtime=new Kl(this),this.health=new wp(this),this.backups=new vp(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new xp(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let n=t[r];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=n===null?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",n)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let n=Object.assign({},await this.beforeSend(r,t));n.url!==void 0||n.options!==void 0?(r=n.url||r,t=n.options||t):Object.keys(n).length&&(t=n,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let n=this.serializeQueryParams(t.query);n&&(r+=(r.includes("?")?"&":"?")+n),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async n=>{let s={};try{s=await n.json()}catch(a){}if(this.afterSend&&(s=await this.afterSend(n,s)),n.status>=400)throw new rr({url:n.url,status:n.status,data:s});return s}).catch(n=>{throw new rr(n)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),fb(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let n=new AbortController;this.cancelControllers[r]=n,t.signal=n.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let n=this.normalizeFormDataValue(e[r]),s=Array.isArray(n)?n:[n];if(s.length)for(let a of s)t.append(r,a);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let n of r)if(typeof Blob!="undefined"&&n instanceof Blob||typeof File!="undefined"&&n instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let n=e[r],s=encodeURIComponent(r);if(Array.isArray(n))for(let a of n)t.push(s+"="+encodeURIComponent(a));else n instanceof Date?t.push(s+"="+encodeURIComponent(n.toISOString())):typeof n!==null&&typeof n=="object"?t.push(s+"="+encodeURIComponent(JSON.stringify(n))):t.push(s+"="+encodeURIComponent(n))}return t.join("&")}};var Yl=class extends Ka{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(n){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let n=r;typeof r!="string"&&(n=JSON.stringify(r)),window.localStorage.setItem(t,n)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var Jl=class extends Et{constructor(t,r,n,s){var i;super();this.beforeLogin=s;let a=Se("[Pocketbase]","debug");this.authStore=new Yl(`pocketbase_auth_${t}`),this.pb=new jl("https://auth.system3.md",this.authStore),this.pb.beforeSend=(l,c)=>(a(l,c),c.fetch=br,c.headers=Object.assign({},c.headers,{"Relay-Version":"0.4.6"}),{url:l,options:c}),this.refreshToken(),n.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(i=this.pb.authStore.model)!=null&&i.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).catch(l=>{l.status===404&&this.logout()}),Wt.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,n]=r.split("."),s=JSON.parse(atob(n)),a=new Date(s.exp*1e3),i=new Date,l=Math.ceil((a.getTime()-i.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:a.toLocaleString(),expiresIn:`${l} days`,userId:s.id,email:s.email})}))}setup(t){var r,n;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(r=t==null?void 0:t.meta)==null?void 0:r.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(n=t.meta)==null?void 0:n.rawUser}).then(()=>{this.notifyListeners()}).catch(s=>{this.log(s)}),!0):(this.notifyListeners(),!1)}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,cb.requestUrl)({url:"https://api.system3.md/whoami",method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}get hasUser(){return this.user!==void 0}makeUser(t,r){var n,s,a,i;return new Ul((n=t.model)==null?void 0:n.id,((s=t.model)==null?void 0:s.name)||(r==null?void 0:r.name),(a=t.model)==null?void 0:a.email,((i=t.model)==null?void 0:i.picture)||(r==null?void 0:r.picture),t.token)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}webviewIntercept(){let t=this.pb.buildUrl("/api/oauth2-redirect"),r="https:\\/\\/accounts\\.google\\.com\\/o\\/oauth2\\/auth";return new RegExp(`^${r}.*?[?&]redirect_uri=${encodeURIComponent(t)}`,"i")}async initiateManualOAuth2CodeFlow(t){this.beforeLogin();let n=(await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError})).authProviders[0],s=this.pb.buildUrl("/api/oauth2-redirect");return[n.authUrl+s,n,async a=>this.pb.collection("users").authWithOAuth2Code(n.name,a,n.codeVerifier,s,{fetch:t}).then(i=>(this.setup(i),i))]}async poll(t,r){let n=0,s=1e3;return new Promise((a,i)=>{let l=setInterval(()=>{if(n+=1,n>=30)return clearInterval(l),i(new Error(`Auth timeout: Timed out after ${n*s/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.state.slice(0,15)).then(c=>{if(c)return clearInterval(l),a(r(c.code))}).catch(c=>{})},s)})}async login(){this.beforeLogin();let t=await this.pb.collection("users").authWithOAuth2({provider:"google"});return this.setup(t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,n)=>{let s=()=>{this.loggedIn&&(this.off(s),r(!0)),r(!1)};this.on(s)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};var Ht=crypto;var xo=new TextEncoder,vr=new TextDecoder,T5=2**32;var ub=o=>{let e=o;typeof e=="string"&&(e=xo.encode(e));let t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))},Qr=o=>ub(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),db=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},Gn=o=>{let e=o;e instanceof Uint8Array&&(e=vr.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return db(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var Sp={};zf(Sp,{JOSEAlgNotAllowed:()=>Ja,JOSEError:()=>Mt,JOSENotSupported:()=>_t,JWEDecryptionFailed:()=>Xa,JWEInvalid:()=>Sr,JWKInvalid:()=>Ql,JWKSInvalid:()=>Zl,JWKSMultipleMatchingKeys:()=>ef,JWKSNoMatchingKey:()=>Qa,JWKSTimeout:()=>tf,JWSInvalid:()=>qo,JWSSignatureVerificationFailed:()=>Za,JWTClaimValidationFailed:()=>Ya,JWTExpired:()=>Xl,JWTInvalid:()=>or});var Mt=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},Ya=class extends Mt{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},Xl=class extends Mt{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},Ja=class extends Mt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},_t=class extends Mt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},Xa=class extends Mt{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},Sr=class extends Mt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},qo=class extends Mt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},or=class extends Mt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},Ql=class extends Mt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},Zl=class extends Mt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},Qa=class extends Mt{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},ef=class extends Mt{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},tf=class extends Mt{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},Za=class extends Mt{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var rf=Ht.getRandomValues.bind(Ht);function AD(o){return typeof o=="object"&&o!==null}function nr(o){if(!AD(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var VD=Symbol();var ZD,sf,Sb;(typeof navigator=="undefined"||!((Sb=(sf=navigator.userAgent)==null?void 0:sf.startsWith)!=null&&Sb.call(sf,"Mozilla/5.0 ")))&&(ZD="jose/v5.3.0");var Ip={};zf(Ip,{decode:()=>af,encode:()=>eA});var eA=Qr,af=Gn;function Cp(o){if(typeof o!="string")throw new or("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new or("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new or("Invalid JWT");if(!e)throw new or("JWTs must contain a payload");let r;try{r=af(e)}catch(s){throw new or("Failed to base64url decode the payload")}let n;try{n=JSON.parse(vr.decode(r))}catch(s){throw new or("Failed to parse the decoded payload as JSON")}if(!nr(n))throw new or("Invalid JWT Claims Set");return n}var Kn=class extends Error{constructor(e){super(e),this.name="[System3] Relay Error"}};function kb(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function tA(o){let e=Cp(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var lf=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=tA,this.maxConnections=t,this.refreshInterval=null}onRefresh(e){return new Promise((r,n)=>{let s=i=>{r(i)},a=i=>{this.removeFromRefreshQueue(e),n(i)};this.refresh(e,s,a)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=n=>{this.onTokenRefreshed(e,n),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let n=this.tokenMap.get(e),s=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...n,token:t,expiryTime:r}),s(t),this.log(`Token refreshed for ${n.friendlyName} (${e})`)}}onRefreshFailure(e){let t=this.tokenMap.get(e),r=(t==null?void 0:t.attempts)||0+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){let n=this._activePromises.get(e);if(n)return n;this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:0}),this.callbacks.set(e,r);let s=this.onRefresh(e).then(a=>(this.onTokenRefreshed(e,a),this._activePromises.delete(e),a)).catch(a=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),a});return this._activePromises.set(e,s),s}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new Kn("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let n=this.tokenMap.get(e);if(n.token&&this.isTokenValid(n))return this.callbacks.set(e,r),n.friendlyName=t,r(n.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(n.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),n=Array.from(this.tokenMap.entries()).sort((s,a)=>s[1].expiryTime-a[1].expiryTime);for(let[s,{friendlyName:a,expiryTime:i,attempts:l}]of n){if(!e(s))continue;let c=i-r,u="";c>0?u=`expires in ${kb(c-this.expiryMargin)}`:u="expired",t.push(`${s} (${a}): ${l} attempts, (${u})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${kb(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(){this.tokenMap.clear(),this.refreshQueue.clear()}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};function rA(o){return o.expiryTime||0}function oA(o,e){return(...t)=>e(o,...t)}async function nA(o,e,t,r){var c;let n=Se("[TokenStore][Refresh]","debug"),s=Se("[TokenStore][Refresh]","error");n(`${e}`);let a=Qt.decode(e),i;if(a instanceof Yr)i=JSON.stringify({docId:a.documentId,relay:a.relayId,folder:a.folderId});else if(a instanceof Oo)i=JSON.stringify({docId:a.folderId,relay:a.relayId,folder:a.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(c=o.user)==null?void 0:c.token}`,"Relay-Version":"0.4.6"};try{let u=await br("https://api.system3.md/token",{method:"POST",headers:l,body:i});if(!u.ok){n(u.status,await u.text()),r(Error(`Received status code ${u.status} from an API.`));return}let d=await u.json();t(d)}catch(u){s(u,i),r(u)}}var ff=class extends lf{constructor(e,t,r,n=5){super({log:Se("[LiveTokenStore]","debug"),refresh:oA(e,nA),getJwtExpiry:rA,getStorage:function(){return new Rs("TokenStore/"+r)},getTimeProvider:()=>t},n)}};var Lb=require("obsidian");var Tp=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Se("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,Lb.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"0.4.6"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json.status),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,this.onOffline.forEach(t=>t(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},Ib=Tp;function Pp(o){return typeof o.id=="string"}function sA(o){return typeof o.name=="string"}var Dp=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function Cb(o){return typeof o.aggregate_root=="object"}function Tb(o){return typeof o.acl=="object"}var ti=class{get aggregate_root(){}get acl(){}},cf=class extends ti{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}update(t){return this.user=t,this}},Ap=class extends ti{constructor(t,r,n){super();this.remoteFolder=t;this.relays=r;this.users=n}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get aggregate_root(){return["relays",this.remoteFolder.relay]}get acl(){return["relays",this.remoteFolder.relay]}},Ep=class{constructor(e,t,r){this.remoteFolders=e;this.relays=t;this.users=r;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new Ap(e,this.relays,this.users);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},Mp=class{constructor(e,t,r,n,s,a,i){this.relays=e;this.roles=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this.subscriptions=a;this.user=i;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new uf(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},Fp=class{constructor(e,t,r,n){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=n}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new Bp(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},Rp=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new Np(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},Op=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new cf(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},Up=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new Hp(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},$p=class extends Ro{constructor(t){super();this.collections=new Map,this.relationships=new Map;for(let r of t)this.collections.set(r.collectionName,r);Wt.set(this,"Store")}getCollection(t){let r=this.collections.get(t);if(!r)throw this.error("No collection found for",t),new Error("No collection found for "+t);return r}clear(){let t=Mr.getInstance();t.beginTransaction(),this.collections.forEach(r=>{r.clear()}),this.collections.clear(),this.relationships.clear(),t.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(t){return this.ingestBatch(t==null?void 0:t.items)}ingestBatch(t){if(t)return t.map(r=>this.ingest(r))}ingest(t){let r=Mr.getInstance();r.beginTransaction();let n=this._ingest(t);return r.commitTransaction(),n}_ingest(t){if(!t)return;let r,n=this.collections.get(t.collectionName);if(n?r=n.ingest(t):this.error("No collection found for record",t),Cb(r)){let s=r.aggregate_root;if(s){let a=t.id,i=this.relationships.get(s.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(s.join(":"),i)}}if(Tb(r)){let s=r.acl;if(s){let a=t.id,i=this.relationships.get(s.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(s.join(":"),i)}}if(t.expand)for(let[,s]of Object.entries(t.expand))Array.isArray(s)?this.ingestBatch(s):this.ingest(s);return r}delete(t){this.cascade(t.collectionName,t.id)}graphviz(){let t=`digraph G {
`;for(let[r,n]of this.collections)for(let s of n.items()){if(!Pp(s)){this.warn("record has no id",s);continue}let a=r+"_"+s.id;if(sA(s)&&(a=r+"_"+s.name),t+=`  ${r}_${s.id} [label="${a}"];
`,Pp(s)&&Cb(s)&&s.aggregate_root){let[i,l]=s.aggregate_root;t+=`  ${r}_${s.id} -> ${i}_${l};
`}if(Pp(s)&&Tb(s)&&s.acl){let[i,l]=s.acl;t+=`  ${r}_${s.id} -> ${i}_${l} [style=dotted];
`}}return t+="}",t}cascade(t,r){let n=this.collections.get(t),s=this.relationships.get([t,r].join(":")),a=Mr.getInstance();a.beginTransaction(),n&&(this.warn("cascade delete parent",t,r),n.delete(r)),this.relationships.delete([t,r].join(":"));for(let i of s||[]){let[l,c]=i.split(":");this.warn("cascade delete child",l,c),this.getCollection(l)&&this.cascade(l,c)}a.commitTransaction()}},Bp=class extends ti{constructor(t,r,n,s){super();this.users=n,this.roles=s,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return t}get aggregate_root(){return["relays",this.relayRole.relay]}get acl(){return["users",this.relayRole.user]}},Np=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get aggregate_root(){return["relays",this.relayInvitation.relay]}},Hp=class extends Et{constructor(t,r,n){super();this.subscription=t;this.relays=r;this.users=n}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get acl(){return["users",this.subscription.user]}},uf=class extends Et{constructor(t,r,n,s,a,i){super();this.relay=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this._subscriptions=a;this.user=i}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get userLimit(){return this.relay.user_limit}get role(){var n;let t=this.relay.creator===this.user.id,r=(n=this.relayRoles.find(s=>s.relayId===this.relay.id&&s.userId===this.user.id))==null?void 0:n.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get folders(){return this.remoteFolders.filter(t=>t.relay.id===this.id)}get subscriptions(){return this._subscriptions.filter(t=>t.relay.id===this.id)}get acl(){var r;let t=(r=this.relayRoles.find(n=>n.relayId===this.id&&n.userId===this.user.id))==null?void 0:r.id;if(t)return["relay_roles",t]}get provider(){return this.relay.provider}},df=class extends Ro{constructor(t){super();this.loginManager=t;this.destroyed=!1;this.pb=this.loginManager.pb,this.users=new yr("users"),this.relays=new yr("relays"),this.remoteFolders=new yr("remote folders"),this.relayInvitations=new yr("relay invitations"),this.relayRoles=new yr("relay roles"),this.roles=new yr("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new yr("subscriptions"),this._offLoginManager=this.loginManager.on(()=>{this.login()}),this.setUser(),this.user&&(Wt.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user||this.store)return;let t=new Dp(this.roles),r=new Op(this.users),n=new Mp(this.relays,this.roles,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user),s=new Fp(this.relayRoles,this.relays,this.users,this.roles),a=new Rp(this.relayInvitations,this.relays,this.roles),i=new Ep(this.remoteFolders,this.relays,this.users),l=new Up(this.subscriptions,this.relays,this.users);this.store=new $p([t,r,n,s,a,i,l])}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new cf(this.authUser),this.users.set(this.user.id,this.user))}login(){this.setUser(),this.buildGraph(),this.subscribe(),this.update()}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async getRelayInvitationKey(t){if(!this.pb)return"";let r=this.relayInvitations.find(n=>n.relay.id===t.id);return r!=null&&r.key?r.key:this.pb.collection("relay_invitations").getList(0,200).then(n=>{n.items.forEach(a=>{var i;(i=this.store)==null||i.ingest(a)});let s=this.relayInvitations.find(a=>a.relay.id===t.id);return s?s.key:""})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,n=await this.pb.send(r,{method:"POST"});if(n!==200)throw new Error("Token API failed");return n.json().token}async subscribe(){var n;if(!this.pb||!this.pb.authStore.isValid||((n=this.pb.authStore.model)==null?void 0:n.id)===void 0)return;let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"subscriptions",expand:["user","relay"]}],r=(s,a)=>{var i,l;this.debug(`[Event]: ${s}`,a.action,a.record),a.action==="delete"?(i=this.store)==null||i.delete(a.record):(l=this.store)==null||l.ingest(a.record)};for(let s of t)this.pb.collection(s.name).subscribe("*",a=>r(s.name,a),{expand:s.expand.join(","),fetch:br})}collection(t){this.pb}async update(){let t=(n,s={})=>{var a;return!this.pb||!this.pb.authStore.isValid||((a=this.pb.authStore.model)==null?void 0:a.id)===void 0?Promise.resolve([]):(typeof s=="function"&&(s=s(this.pb.authStore.model.id)),this.pb.collection(n).getFullList(s))};[t("users",n=>({filter:`id="${n}"`,expand:"relay_roles_via_user,relay_roles_via_user.relay,relay_roles_via_user.role"})),t("relay_roles",{expand:"user"}),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("subscriptions",{expand:"relay,user"})].forEach(async n=>{let s=await n;for(let a of s)!this.destroyed&&this.store&&this.store.ingest(a)})}async acceptInvitation(t){var s;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})});this.debug("[InviteAccept]",r);let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to accept invitation");return n}async createRelay(t){var a;let r=Aa(),n=await((a=this.pb)==null?void 0:a.collection("relays").create({guid:r,name:t,path:null}));if(!n)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let s=new uf(n,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user);return this.relays.set(s.id,s),s}async updateRelay(t){var s;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to update relay");return n}async deleteRemote(t){var n;t.remote=void 0;let r=this.remoteFolders.find(s=>s.guid===t.guid);return r?(await((n=this.pb)==null?void 0:n.collection("shared_folders").delete(r.id)),t.remote=void 0,!0):!1}async createRemoteFolder(t,r){var a,i;if(!this.pb)throw new Error("Failed to create folder");let n=await this.pb.collection("shared_folders").create({name:t.name,guid:t.guid,relay:r.id,creator:(a=this.user)==null?void 0:a.id,private:!1},{expand:"relay"}),s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("Failed to create folder");return s}async destroyRelay(t){var r,n;return(r=this.store)==null||r.cascade("relays",t.id),await((n=this.pb)==null?void 0:n.collection("relays").delete(t.id)),!0}async leaveRelay(t){var n,s;let r=this.relayRoles.find(a=>{var i;return a.userId===((i=this.user)==null?void 0:i.id)&&a.relayId===t.id});r?await((n=this.pb)==null?void 0:n.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(s=this.store)==null||s.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}destroy(){var t,r;this.destroyed=!0,this._offLoginManager&&this._offLoginManager(),(t=this.pb)==null||t.cancelAllRequests(),this.loginManager=null,this.pb=null,(r=this.store)==null||r.destroy(),this.authUser=null,this.store=null}};var Qw=require("obsidian");var Mb=require("obsidian");var Ab=require("obsidian");function aA(o){Ae(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function Pb(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function Db(o){let e,t,r,n=o[8]+"",s,a,i,l,c=o[8]+"",u,d,m,x,h,_,b,v,D,B,A,F;function O(){return o[6](o[8])}function M(){return o[7](o[8])}return{c(){e=C("div"),t=C("div"),r=C("div"),s=W(n),a=$(),i=C("div"),l=W("Toggle "),u=W(c),d=W(" on or off"),m=$(),x=C("div"),h=C("div"),_=C("input"),v=$(),D=C("div"),w(r,"class","setting-item-name"),w(i,"class","setting-item-description"),w(t,"class","setting-item-info"),w(_,"type","checkbox"),w(_,"tabindex","-1"),_.checked=b=o[9],w(D,"class","checkbox-toggle"),w(h,"role","checkbox"),w(h,"aria-checked",B=o[9]),w(h,"tabindex","0"),w(h,"class","checkbox-container svelte-4kkvmr"),Ye(h,"is-enabled",o[9]),w(x,"class","setting-item-control"),w(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(E,R){T(E,e,R),k(e,t),k(t,r),k(r,s),k(t,a),k(t,i),k(i,l),k(i,u),k(i,d),k(e,m),k(e,x),k(x,h),k(h,_),k(h,v),k(h,D),A||(F=[ee(h,"keypress",O),ee(h,"click",M)],A=!0)},p(E,R){o=E,R&2&&n!==(n=o[8]+"")&&oe(s,n),R&2&&c!==(c=o[8]+"")&&oe(u,c),R&2&&b!==(b=o[9])&&(_.checked=b),R&2&&B!==(B=o[9])&&w(h,"aria-checked",B),R&2&&Ye(h,"is-enabled",o[9])},d(E){E&&I(e),A=!1,Le(F)}}}function iA(o){let e,t,r,n,s,a,i,l,c,u=Fe(Object.entries(o[1])),d=[];for(let m=0;m<u.length;m+=1)d[m]=Db(Pb(o,u,m));return{c(){e=C("div"),t=C("h2"),t.textContent="Feature Flags",r=$();for(let m=0;m<d.length;m+=1)d[m].c();n=$(),s=C("div"),a=C("div"),i=C("button"),i.textContent="Apply",w(i,"aria-label","apply flag settings"),w(i,"tabindex","0"),w(a,"class","setting-item-control"),w(s,"class","setting-item"),w(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(m,x){T(m,e,x),k(e,t),k(e,r);for(let h=0;h<d.length;h+=1)d[h]&&d[h].m(e,null);k(e,n),k(e,s),k(s,a),k(a,i),l||(c=[ee(i,"click",function(){dt(o[0])&&o[0].apply(this,arguments)}),ee(i,"keypress",function(){dt(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(m,[x]){if(o=m,x&26){u=Fe(Object.entries(o[1]));let h;for(h=0;h<u.length;h+=1){let _=Pb(o,u,h);d[h]?d[h].p(_,x):(d[h]=Db(_),d[h].c(),d[h].m(e,n))}for(;h<d.length;h+=1)d[h].d(1);d.length=u.length}},i:Q,o:Q,d(m){m&&I(e),ft(d,m),l=!1,Le(c)}}}function lA(o,e,t){let r,n,{reload:s}=e,a=Gt.getInstance();ye(o,a,d=>t(5,n=d));function i(d){let m=!r[d];t(1,r[d]=m,r),a.setFlag(d,r[d])}function l(d){return d in r}tr(()=>{Object.keys(r).forEach(d=>{let m=document.getElementById(`toggle-${d}`);m&&(0,Ab.setIcon)(m,"check")})});let c=d=>{if(!l(d))throw new Error("Unexpected feature flag!");i(d)},u=d=>{if(!l(d))throw new Error("Unexpected feature flag!");i(d)};return o.$$set=d=>{"reload"in d&&t(0,s=d.reload)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(1,r=Object.assign({},n.flags))}},[s,r,a,i,l,n,c,u]}var zp=class extends J{constructor(e){super(),X(this,e,lA,iA,Y,{reload:0},aA)}},Eb=zp;var pf=class extends Mb.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new Eb({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Vb=require("obsidian");var Hb=require("obsidian");function Fb(o,e,t){let r=o.slice();return r[13]=e[t],r}function Rb(o,e,t){let r=o.slice();return r[16]=e[t],r}function fA(o){let e,t,r;return{c(){e=C("button"),e.textContent="Refresh"},m(n,s){T(n,e,s),t||(r=ee(e,"click",(0,Hb.debounce)(o[12])),t=!0)},p:Q,d(n){n&&I(e),t=!1,r()}}}function cA(o){let e=navigator.userAgent+"",t;return{c(){t=W(e)},m(r,n){T(r,t,n)},p:Q,d(r){r&&I(t)}}}function uA(o){let e;return{c(){e=W(o[1])},m(t,r){T(t,e,r)},p(t,r){r&2&&oe(e,t[1])},d(t){t&&I(e)}}}function dA(o){let e;return{c(){e=W(o[2])},m(t,r){T(t,e,r)},p(t,r){r&4&&oe(e,t[2])},d(t){t&&I(e)}}}function pA(o){let e;return{c(){e=W(o[3])},m(t,r){T(t,e,r)},p(t,r){r&8&&oe(e,t[3])},d(t){t&&I(e)}}}function mA(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=W(e)},m(r,n){T(r,t,n)},p(r,n){n&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&oe(t,e)},d(r){r&&I(t)}}}function Ob(o){let e,t=`${o[16]}`,r,n;return{c(){e=C("div"),r=W(t),n=$()},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&16&&t!==(t=`${s[16]}`)&&oe(r,t)},d(s){s&&I(e)}}}function hA(o){let e,t=Fe(Object.keys(o[4].cancelControllers)),r=[];for(let n=0;n<t.length;n+=1)r[n]=Ob(Rb(o,t,n));return{c(){e=C("div");for(let n=0;n<r.length;n+=1)r[n].c();w(e,"slot","description")},m(n,s){T(n,e,s);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(n,s){if(s&16){t=Fe(Object.keys(n[4].cancelControllers));let a;for(a=0;a<t.length;a+=1){let i=Rb(n,t,a);r[a]?r[a].p(i,s):(r[a]=Ob(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&I(e),ft(r,n)}}}function Ub(o){let e,t=`${o[13]}`,r,n;return{c(){e=C("div"),r=W(t),n=$()},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&32&&t!==(t=`${s[13]}`)&&oe(r,t)},d(s){s&&I(e)}}}function gA(o){let e,t=Fe(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Ub(Fb(o,t,n));return{c(){e=C("div");for(let n=0;n<r.length;n+=1)r[n].c();w(e,"slot","description")},m(n,s){T(n,e,s);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(n,s){if(s&32){t=Fe(n[5]);let a;for(a=0;a<t.length;a+=1){let i=Fb(n,t,a);r[a]?r[a].p(i,s):(r[a]=Ub(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&I(e),ft(r,n)}}}function xA(o){let e,t,r,n,s,a,i,l,c,u,d,m,x,h,_,b,v,D,B,A,F,O,M;return n=new et({props:{name:"Environment",$$slots:{default:[fA]},$$scope:{ctx:o}}}),a=new He({props:{name:"User Agent",description:"",$$slots:{default:[cA]},$$scope:{ctx:o}}}),l=new He({props:{name:"Fetch",description:"",$$slots:{default:[uA]},$$scope:{ctx:o}}}),u=new He({props:{name:"Response",description:"",$$slots:{default:[dA]},$$scope:{ctx:o}}}),m=new He({props:{name:"Blink Fetch",description:"",$$slots:{default:[pA]},$$scope:{ctx:o}}}),h=new He({props:{name:"Startup Time",description:"",$$slots:{default:[mA]},$$scope:{ctx:o}}}),b=new et({props:{name:"Connections"}}),D=new He({props:{name:"",description:"",$$slots:{description:[hA]},$$scope:{ctx:o}}}),A=new et({props:{name:"Log Files"}}),O=new He({props:{name:"",description:"",$$slots:{description:[gA]},$$scope:{ctx:o}}}),{c(){e=C("div"),e.textContent="Debug Info",t=$(),r=C("div"),z(n.$$.fragment),s=$(),z(a.$$.fragment),i=$(),z(l.$$.fragment),c=$(),z(u.$$.fragment),d=$(),z(m.$$.fragment),x=$(),z(h.$$.fragment),_=$(),z(b.$$.fragment),v=$(),z(D.$$.fragment),B=$(),z(A.$$.fragment),F=$(),z(O.$$.fragment),w(e,"class","modal-title"),w(r,"class","modal-content")},m(E,R){T(E,e,R),T(E,t,R),T(E,r,R),N(n,r,null),k(r,s),N(a,r,null),k(r,i),N(l,r,null),k(r,c),N(u,r,null),k(r,d),N(m,r,null),k(r,x),N(h,r,null),k(r,_),N(b,r,null),k(r,v),N(D,r,null),k(r,B),N(A,r,null),k(r,F),N(O,r,null),M=!0},p(E,[R]){let G={};R&524288&&(G.$$scope={dirty:R,ctx:E}),n.$set(G);let le={};R&524288&&(le.$$scope={dirty:R,ctx:E}),a.$set(le);let j={};R&524290&&(j.$$scope={dirty:R,ctx:E}),l.$set(j);let ae={};R&524292&&(ae.$$scope={dirty:R,ctx:E}),u.$set(ae);let V={};R&524296&&(V.$$scope={dirty:R,ctx:E}),m.$set(V);let Z={};R&524289&&(Z.$$scope={dirty:R,ctx:E}),h.$set(Z);let Ee={};R&524304&&(Ee.$$scope={dirty:R,ctx:E}),D.$set(Ee);let Re={};R&524320&&(Re.$$scope={dirty:R,ctx:E}),O.$set(Re)},i(E){M||(L(n.$$.fragment,E),L(a.$$.fragment,E),L(l.$$.fragment,E),L(u.$$.fragment,E),L(m.$$.fragment,E),L(h.$$.fragment,E),L(b.$$.fragment,E),L(D.$$.fragment,E),L(A.$$.fragment,E),L(O.$$.fragment,E),M=!0)},o(E){P(n.$$.fragment,E),P(a.$$.fragment,E),P(l.$$.fragment,E),P(u.$$.fragment,E),P(m.$$.fragment,E),P(h.$$.fragment,E),P(b.$$.fragment,E),P(D.$$.fragment,E),P(A.$$.fragment,E),P(O.$$.fragment,E),M=!1},d(E){E&&(I(e),I(t),I(r)),H(n),H(a),H(l),H(u),H(m),H(h),H(b),H(D),H(A),H(O)}}}function $b(){try{return Response.toString()}catch(o){return"undefined"}}function Bb(){try{return fetch.toString()}catch(o){return"undefined"}}function Nb(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function yA(o,e,t){let r,n,s,a,i,{plugin:l}=e,c=xe($b());ye(o,c,b=>t(2,n=b));let u=xe(Bb());ye(o,u,b=>t(1,r=b));let d=xe(Nb());ye(o,d,b=>t(3,s=b));let m=xe(l.loginManager.pb);ye(o,m,b=>t(4,a=b));let x=xe([]);ye(o,x,b=>t(5,i=b)),fl().then(b=>{x.set(b)});function h(){c.set($b()),u.set(Bb()),d.set(Nb()),m.set(l.loginManager.pb)}let _=()=>{h()};return o.$$set=b=>{"plugin"in b&&t(0,l=b.plugin)},[l,r,n,s,a,i,c,u,d,m,x,h,_]}var Vp=class extends J{constructor(e){super(),X(this,e,yA,xA,Y,{plugin:0})}},zb=Vp;var mf=class extends Vb.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new zb({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var dr=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var hf=class extends Et{constructor(t,r){super();this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.warn("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),n=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(n)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},yo=class extends Et{constructor(t,r){super();this.settings=t;this.patterns=[];this.destroyed=!1;this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new dr("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new dr(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new dr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let s=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([i])=>s.test(i)).reduce((i,[l,c])=>(i[l]=c,i),{})}let n=this.getNestedValue(t);return n===void 0?{}:n}async set(t){if(this.destroyed)throw new dr("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new dr("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let n=this.patterns.find(this.isWildcardPattern);if(n){if(this.path.length===1){let l=new RegExp(`^${n.wildcardPattern}$`),c={...r};return Object.entries(t).forEach(([u,d])=>{l.test(u)&&(c[u]=d)}),c}let s={...r},a=s;this.path.forEach(l=>{a[l]=a[l]||{},a=a[l]});let i=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(t).forEach(([l,c])=>{i.test(l)&&(a[l]=c)}),s}return this.setNestedValue(r,t)})}catch(r){let n=r instanceof Error?r.message:"Unknown error";throw new dr(`Failed to set value at path ${this.getPath()}: ${n}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new dr("Cannot use destroyed settings",this.getPath());let n=this.get(),s=t(n);!r&&JSON.stringify(n)===JSON.stringify(s)||await this.set(s)}async flush(){if(this.destroyed)throw new dr("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(i=>i),n=[],s=[],a=[];return r.forEach((i,l)=>{let c=i.match(/^\[(\w+)=(.+)\]$/),u=i.match(/^\((.+?)\)$/);if(c){let[,d,m]=c,x=l>0?s[l-1]:i.split("[")[0];a.push({type:"arrayMatch",key:d,value:m,level:l}),n.push(i),s.push(x)}else if(u){let[,d]=u;a.push({type:"wildcard",wildcardPattern:this.createPatternRegex(d),level:l}),n.push(i),s.push(i)}else n.push(i),s.push(i)}),[n,s,a]}getNestedValue(t){let r=t,n=this.patterns.find(this.isWildcardPattern);if(n&&this.path.length===1){let a=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(r).filter(([l])=>a.test(l)).reduce((l,[c,u])=>(l[c]=u,l),{})}let s=this.patterns[0];if((s==null?void 0:s.type)==="arrayMatch"){let a=this.basePath[0];if(!Array.isArray(r[a]))return;let i=r[a].find(c=>c[s.key]===s.value);if(!i)return;let l=this.basePath.slice(s.level+1);if(l.length>0){let c=i;for(let u of l){if(!c||typeof c!="object")return;c=c[u]}return c}return i}for(let a=0;a<this.basePath.length;a++){if(!r)return;r=r[this.basePath[a]]}return r}setNestedValue(t,r){let n={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];n[l]||(n[l]=[]);let c=n[l].findIndex(d=>d[s.key]===s.value),u=this.basePath.slice(s.level+1);if(c>=0)if(u.length>0){let d=n[l][c];for(let x=0;x<u.length-1;x++){let h=u[x];d[h]=d[h]||{},d=d[h]}let m=u[u.length-1];d[m]=r}else n[l][c]={...n[l][c],...r,[s.key]:s.value};else if(u.length>0){let d={[s.key]:s.value},m=d;for(let h=0;h<u.length-1;h++){let _=u[h];m[_]={},m=m[_]}let x=u[u.length-1];m[x]=r,n[l].push(d)}else n[l].push({...r,[s.key]:s.value});return n}let a=n;for(let l=0;l<this.basePath.length-1;l++){let c=this.basePath[l];a[c]=a[c]||{},a=a[c]}let i=this.basePath[this.basePath.length-1];return a[i]=r,n}getParent(){if(this.destroyed)throw new dr("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new yo(this.settings,t)}getChild(t,r){let n=[...this.path,t].join("/");return r?r(this.settings,n):(this.log("getChild",this.path,t,n,this.patterns),new yo(this.settings,n))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new dr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new dr("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(c=>c[n.key]!==n.value),r[l].length===0&&delete r[l]),r}let s=r,a=this.basePath.slice(0,-1);for(let l of a){if(!s[l])return r;s=s[l]}let i=this.basePath[this.basePath.length-1];return delete s[i],r})}subscribe(t){if(this.destroyed)throw new dr("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var qb=require("obsidian"),gf=class{notify(e){new qb.Notice(e)}},xf=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var Jp=require("url");var Zb=require("obsidian");var Xb=require("obsidian");function bA(o){Ae(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function Wb(o,e,t){let r=o.slice();return r[21]=e[t],r}function wA(o){let e,t,r,n,s,a,i,l,c,u,d,m,x;r=new He({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),i=new He({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[SA]},$$scope:{ctx:o}}});let h=o[4]&&Gb(o);return u=new He({props:{name:"",description:"",$$slots:{default:[LA]},$$scope:{ctx:o}}}),{c(){e=C("div"),t=C("div"),z(r.$$.fragment),n=$(),s=C("textarea"),a=$(),z(i.$$.fragment),l=$(),h&&h.c(),c=$(),z(u.$$.fragment),w(s,"placeholder","Describe the issue here..."),w(s,"class","svelte-jmqfac"),w(t,"class","form-content svelte-jmqfac"),w(e,"class","report-container svelte-jmqfac")},m(_,b){T(_,e,b),k(e,t),N(r,t,null),k(t,n),k(t,s),er(s,o[3]),k(t,a),N(i,t,null),k(t,l),h&&h.m(t,null),k(e,c),N(u,e,null),d=!0,m||(x=ee(s,"input",o[13]),m=!0)},p(_,b){b&8&&er(s,_[3]);let v={};b&16777232&&(v.$$scope={dirty:b,ctx:_}),i.$set(v),_[4]?h?(h.p(_,b),b&16&&L(h,1)):(h=Gb(_),h.c(),L(h,1),h.m(t,null)):h&&(we(),P(h,1,1,()=>{h=null}),_e());let D={};b&16777293&&(D.$$scope={dirty:b,ctx:_}),u.$set(D)},i(_){d||(L(r.$$.fragment,_),L(i.$$.fragment,_),L(h),L(u.$$.fragment,_),d=!0)},o(_){P(r.$$.fragment,_),P(i.$$.fragment,_),P(h),P(u.$$.fragment,_),d=!1},d(_){_&&I(e),H(r),H(i),h&&h.d(),H(u),m=!1,x()}}}function _A(o){let e;return{c(){e=C("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',w(e,"class","centered-message svelte-jmqfac")},m(t,r){T(t,e,r)},p:Q,i:Q,o:Q,d(t){t&&I(e)}}}function vA(o){let e,t,r;return t=new He({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=C("div"),z(t.$$.fragment),w(e,"class","centered-message svelte-jmqfac")},m(n,s){T(n,e,s),N(t,e,null),r=!0},p:Q,i(n){r||(L(t.$$.fragment,n),r=!0)},o(n){P(t.$$.fragment,n),r=!1},d(n){n&&I(e),H(t)}}}function SA(o){let e,t,r,n,s,a;return{c(){e=C("div"),t=C("input"),r=$(),n=C("div"),w(t,"type","checkbox"),w(t,"tabindex","-1"),t.checked=o[4],w(n,"class","checkbox-toggle"),w(e,"role","checkbox"),w(e,"aria-checked",o[4]),w(e,"tabindex","0"),w(e,"class","checkbox-container"),Ye(e,"is-enabled",o[4])},m(i,l){T(i,e,l),k(e,t),k(e,r),k(e,n),s||(a=[ee(e,"keypress",CA),ee(e,"click",o[14])],s=!0)},p(i,l){l&16&&(t.checked=i[4]),l&16&&w(e,"aria-checked",i[4]),l&16&&Ye(e,"is-enabled",i[4])},d(i){i&&I(e),s=!1,Le(a)}}}function Gb(o){let e,t;return e=new He({props:{name:"Logs",description:"",$$slots:{description:[kA]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&16777248&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Kb(o){let e,t=`${o[21]}
`,r,n;return{c(){e=C("div"),r=W(t),n=$()},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&32&&t!==(t=`${s[21]}
`)&&oe(r,t)},d(s){s&&I(e)}}}function kA(o){let e,t=Fe(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Kb(Wb(o,t,n));return{c(){e=C("div");for(let n=0;n<r.length;n+=1)r[n].c();w(e,"slot","description")},m(n,s){T(n,e,s);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(n,s){if(s&32){t=Fe(n[5]);let a;for(a=0;a<t.length;a+=1){let i=Wb(n,t,a);r[a]?r[a].p(i,s):(r[a]=Kb(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&I(e),ft(r,n)}}}function LA(o){let e,t,r,n;return{c(){e=C("button"),t=W("Send"),e.disabled=o[2]},m(s,a){T(s,e,a),k(e,t),r||(n=ee(e,"click",o[15]),r=!0)},p(s,a){a&4&&(e.disabled=s[2])},d(s){s&&I(e),r=!1,n()}}}function IA(o){let e,t,r,n,s,a,i=[vA,_A,wA],l=[];function c(u,d){return u[1]?0:u[2]&&!u[1]?1:2}return n=c(o,-1),s=l[n]=i[n](o),{c(){e=C("div"),e.textContent="Send Bug Report",t=$(),r=C("div"),s.c(),w(e,"class","modal-title"),w(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(u,d){T(u,e,d),T(u,t,d),T(u,r,d),l[n].m(r,null),a=!0},p(u,[d]){let m=n;n=c(u,d),n===m?l[n].p(u,d):(we(),P(l[m],1,1,()=>{l[m]=null}),_e(),s=l[n],s?s.p(u,d):(s=l[n]=i[n](u),s.c()),L(s,1),s.m(r,null))},i(u){a||(L(s),a=!0)},o(u){P(s),a=!1},d(u){u&&(I(e),I(t),I(r)),l[n].d()}}}function jb(){try{return Response.toString()}catch(o){return"undefined"}}function Yb(){try{return fetch.toString()}catch(o){return"undefined"}}function Jb(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var CA=()=>{};function TA(o,e,t){let r,n,s,a,i,l,{plugin:c}=e,u=xe(jb()),d=xe(Yb()),m=xe(Jb()),x=xe("");ye(o,x,E=>t(3,s=E));let h=xe(!1);ye(o,h,E=>t(4,a=E));let _=xe(!1),b=xe(!1);ye(o,b,E=>t(2,n=E));let v=xe(!1);ye(o,v,E=>t(1,r=E));let D=xe(c.loginManager.pb);ye(o,D,E=>t(6,l=E));let B=xe([]);ye(o,B,E=>t(5,i=E)),fl().then(E=>{B.set(E)});function A(){u.set(jb()),d.set(Yb()),m.set(Jb()),D.set(c.loginManager.pb)}function F(){s=this.value,x.set(s)}let O=()=>{let E=!a;h.set(E)},M=async()=>{var R;let E=`Bug Report

`;if(E+=JSON.stringify({userAgent:navigator.userAgent,manifest:c.manifest,user:(R=l==null?void 0:l.authStore.model)==null?void 0:R.id,loadTime:c.loadTime,description:s},null,2),E+=`

`,h){let G=await ex();E+=G}(0,Xb.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:E,headers:{"Content-Type":"text/plain"}}).then(()=>{v.set(!0)}),b.set(!0)};return o.$$set=E=>{"plugin"in E&&t(0,c=E.plugin)},[c,r,n,s,a,i,l,x,h,b,v,D,B,F,O,M]}var qp=class extends J{constructor(e){super(),X(this,e,TA,IA,Y,{plugin:0},bA)}},Qb=qp;var yf=class extends Zb.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Qb({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var lw=require("obsidian");async function ew(o){let{appId:e,filterByAppId:t,onProgress:r}=o,n=await window.indexedDB.databases(),s=n.length,a=[],i=0,l=0,c=0,u=0;for(let d of n)if(d.name){try{let m=await new Promise((x,h)=>{let _=indexedDB.open(d.name);_.onerror=()=>h(_.error),_.onsuccess=b=>x(b.target.result)});try{let x=Array.from(m.objectStoreNames);if(!x.includes("updates")||!x.includes("custom"))continue;let h=m.transaction(["updates","custom"],"readonly"),_=h.objectStore("updates"),b=h.objectStore("custom"),v=await new Promise(B=>{let A=b.get("appId");A.onsuccess=()=>B(A.result||"")});i++;let D=await new Promise((B,A)=>{let F=_.count();F.onsuccess=()=>B(F.result),F.onerror=()=>A(F.error)});if(l+=D,D>0){let B=0;if(await new Promise((A,F)=>{let O=_.openCursor();O.onsuccess=M=>{let E=M.target.result;if(E){let R=E.value instanceof Uint8Array?E.value.byteLength:JSON.stringify(E.value).length;B+=R,E.continue()}else A()},O.onerror=()=>F(O.error)}),c+=B,B>1024*1024&&(!t||v===e)){let A=await new Promise(M=>{let E=b.get("path");E.onsuccess=()=>M(E.result||"")}),F=await new Promise(M=>{let E=b.get("relay");E.onsuccess=()=>M(E.result||"")}),O=!d.name.startsWith(`${e}-relay`);a.push({slug:`${d.name}/${_.name}`,path:A,relay:F,appId:v||"unknown",count:D,estimatedSizeMB:Math.round(B/(1024*1024)*100)/100,isLegacy:O})}}}finally{m.close()}}catch(m){console.error(`Error processing database ${d.name}:`,m);continue}u++,r&&r(u/n.length*100)}return{totalStores:i,totalItems:l,totalSizeMB:Math.round(c/(1024*1024)*100)/100,databaseCount:s,largeStores:a.sort((d,m)=>m.estimatedSizeMB-d.estimatedSizeMB)}}async function tw(o){let[e,t]=o.split("/"),r=await new Promise((n,s)=>{let a=indexedDB.open(e);a.onerror=()=>s(a.error),a.onsuccess=()=>n(a.result)});try{let s=r.transaction(t,"readwrite").objectStore(t);await new Promise((a,i)=>{let l=s.clear();l.onsuccess=()=>a(),l.onerror=()=>i(l.error)})}catch(n){console.error(`Error deleting store: ${o}`,n)}finally{r.close()}}var B7=require("obsidian");function PA(o){Ae(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function rw(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function ow(o,e,t){let r=o.slice();return r[22]=e[t],r}function DA(o){let e,t,r,n,s,a=o[0].databaseCount.toLocaleString()+"",i,l,c,u,d,m,x,h,_=o[0].totalStores+"",b,v,D,B,A,F,O=o[0].totalItems.toLocaleString()+"",M,E,R,G,le,j,ae=o[0].totalSizeMB.toFixed(2)+"",V,Z,Ee,Re,Pe;function Ke(te,ze){if(te[0].databaseCount>45e3)return FA;if(te[0].databaseCount>4e4)return MA}let qe=Ke(o,-1),fe=qe&&qe(o),Ce=o[0].largeStores.length>0&&nw(o);return{c(){e=C("div"),t=C("div"),r=C("div"),r.textContent="Global Database Limit",n=$(),s=C("div"),i=W(a),l=W(" / 50,000"),c=$(),fe&&fe.c(),u=$(),d=C("div"),m=C("div"),m.textContent="Relay Databases",x=$(),h=C("div"),b=W(_),v=$(),D=C("div"),B=C("div"),B.textContent="Document Updates",A=$(),F=C("div"),M=W(O),E=$(),R=C("div"),G=C("div"),G.textContent="Total Size",le=$(),j=C("div"),V=W(ae),Z=W(" MB"),Ee=$(),Ce&&Ce.c(),Re=Te(),w(r,"class","system3-stat-label svelte-1n3w4sk"),w(s,"class","system3-stat-value svelte-1n3w4sk"),Ye(s,"system3-warning",o[0].databaseCount>4e4),Ye(s,"system3-critical",o[0].databaseCount>45e3),w(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),w(m,"class","system3-stat-label svelte-1n3w4sk"),w(h,"class","system3-stat-value svelte-1n3w4sk"),w(d,"class","system3-stat-item svelte-1n3w4sk"),w(B,"class","system3-stat-label svelte-1n3w4sk"),w(F,"class","system3-stat-value svelte-1n3w4sk"),w(D,"class","system3-stat-item svelte-1n3w4sk"),w(G,"class","system3-stat-label svelte-1n3w4sk"),w(j,"class","system3-stat-value svelte-1n3w4sk"),w(R,"class","system3-stat-item svelte-1n3w4sk"),w(e,"class","system3-summary-stats svelte-1n3w4sk")},m(te,ze){T(te,e,ze),k(e,t),k(t,r),k(t,n),k(t,s),k(s,i),k(s,l),k(t,c),fe&&fe.m(t,null),k(e,u),k(e,d),k(d,m),k(d,x),k(d,h),k(h,b),k(e,v),k(e,D),k(D,B),k(D,A),k(D,F),k(F,M),k(e,E),k(e,R),k(R,G),k(R,le),k(R,j),k(j,V),k(j,Z),T(te,Ee,ze),Ce&&Ce.m(te,ze),T(te,Re,ze),Pe=!0},p(te,ze){(!Pe||ze&1)&&a!==(a=te[0].databaseCount.toLocaleString()+"")&&oe(i,a),(!Pe||ze&1)&&Ye(s,"system3-warning",te[0].databaseCount>4e4),(!Pe||ze&1)&&Ye(s,"system3-critical",te[0].databaseCount>45e3),qe!==(qe=Ke(te,ze))&&(fe&&fe.d(1),fe=qe&&qe(te),fe&&(fe.c(),fe.m(t,null))),(!Pe||ze&1)&&_!==(_=te[0].totalStores+"")&&oe(b,_),(!Pe||ze&1)&&O!==(O=te[0].totalItems.toLocaleString()+"")&&oe(M,O),(!Pe||ze&1)&&ae!==(ae=te[0].totalSizeMB.toFixed(2)+"")&&oe(V,ae),te[0].largeStores.length>0?Ce?(Ce.p(te,ze),ze&1&&L(Ce,1)):(Ce=nw(te),Ce.c(),L(Ce,1),Ce.m(Re.parentNode,Re)):Ce&&(we(),P(Ce,1,1,()=>{Ce=null}),_e())},i(te){Pe||(L(Ce),Pe=!0)},o(te){P(Ce),Pe=!1},d(te){te&&(I(e),I(Ee),I(Re)),fe&&fe.d(),Ce&&Ce.d(te)}}}function AA(o){let e,t;return{c(){e=C("div"),t=W(o[5]),w(e,"class","system3-error-message svelte-1n3w4sk")},m(r,n){T(r,e,n),k(e,t)},p(r,n){n&32&&oe(t,r[5])},i:Q,o:Q,d(r){r&&I(e)}}}function EA(o){let e,t,r,n,s,a,i;return{c(){e=C("div"),t=C("div"),r=$(),n=C("div"),n.textContent="Analyzing Databases...",s=$(),a=C("div"),i=C("div"),w(t,"class","system3-loading-spinner svelte-1n3w4sk"),w(n,"class","loading-text"),w(i,"class","system3-progress-fill svelte-1n3w4sk"),ge(i,"width",o[4]+"%"),w(a,"class","system3-progress-bar svelte-1n3w4sk"),w(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,c){T(l,e,c),k(e,t),k(e,r),k(e,n),k(e,s),k(e,a),k(a,i)},p(l,c){c&16&&ge(i,"width",l[4]+"%")},i:Q,o:Q,d(l){l&&I(e)}}}function MA(o){let e;return{c(){e=C("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,w(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){T(t,e,r)},d(t){t&&I(e)}}}function FA(o){let e;return{c(){e=C("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,w(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){T(t,e,r)},d(t){t&&I(e)}}}function nw(o){let e,t,r,n;e=new et({props:{name:"Large Stores (>1MB)"}});let s=Fe(o[2]),a=[];for(let l=0;l<s.length;l+=1)a[l]=aw(rw(o,s,l));let i=l=>P(a[l],1,1,()=>{a[l]=null});return{c(){z(e.$$.fragment),t=$();for(let l=0;l<a.length;l+=1)a[l].c();r=Te()},m(l,c){N(e,l,c),T(l,t,c);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,c);T(l,r,c),n=!0},p(l,c){if(c&2052){s=Fe(l[2]);let u;for(u=0;u<s.length;u+=1){let d=rw(l,s,u);a[u]?(a[u].p(d,c),L(a[u],1)):(a[u]=aw(d),a[u].c(),L(a[u],1),a[u].m(r.parentNode,r))}for(we(),u=s.length;u<a.length;u+=1)i(u);_e()}},i(l){if(!n){L(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)L(a[c]);n=!0}},o(l){P(e.$$.fragment,l),a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)P(a[c]);n=!1},d(l){l&&(I(t),I(r)),H(e,l),ft(a,l)}}}function RA(o){let e,t,r,n,s;function a(){return o[17](o[22])}return{c(){e=C("div"),t=C("button"),t.textContent="Delete",r=$(),w(t,"class","mod-warning"),w(t,"title","Delete all data in this store"),w(e,"class","system3-actions svelte-1n3w4sk")},m(i,l){T(i,e,l),k(e,t),T(i,r,l),n||(s=ee(t,"click",a),n=!0)},p(i,l){o=i},d(i){i&&(I(e),I(r)),n=!1,s()}}}function sw(o){let e,t;return e=new He({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[RA]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&4&&(s.name=r[22].path||r[22].slug),n&4&&(s.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),n&33554436&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function aw(o){let e,t,r,n;e=new et({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let s=Fe(o[19]),a=[];for(let l=0;l<s.length;l+=1)a[l]=sw(ow(o,s,l));let i=l=>P(a[l],1,1,()=>{a[l]=null});return{c(){z(e.$$.fragment),t=$();for(let l=0;l<a.length;l+=1)a[l].c();r=Te()},m(l,c){N(e,l,c),T(l,t,c);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,c);T(l,r,c),n=!0},p(l,c){let u={};if(c&4&&(u.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(u),c&2052){s=Fe(l[19]);let d;for(d=0;d<s.length;d+=1){let m=ow(l,s,d);a[d]?(a[d].p(m,c),L(a[d],1)):(a[d]=sw(m),a[d].c(),L(a[d],1),a[d].m(r.parentNode,r))}for(we(),d=s.length;d<a.length;d+=1)i(d);_e()}},i(l){if(!n){L(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)L(a[c]);n=!0}},o(l){P(e.$$.fragment,l),a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)P(a[c]);n=!1},d(l){l&&(I(t),I(r)),H(e,l),ft(a,l)}}}function OA(o){let e,t,r,n,s,a,i,l,c,u,d,m,x,h,_,b,v,D=[EA,AA,DA],B=[];function A(F,O){return F[3]?0:F[5]?1:F[0]?2:-1}return~(x=A(o,-1))&&(h=B[x]=D[x](o)),{c(){e=C("div"),e.textContent="Relay database analysis",t=$(),r=C("div"),n=C("div"),s=C("div"),s.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,a=$(),i=C("div"),l=C("div"),c=C("input"),u=$(),d=C("div"),m=$(),h&&h.c(),w(e,"class","modal-title"),w(s,"class","setting-item-info"),w(c,"type","checkbox"),w(c,"tabindex","-1"),c.checked=o[1],w(d,"class","checkbox-toggle"),w(l,"role","checkbox"),w(l,"aria-checked",o[1]),w(l,"tabindex","0"),w(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),Ye(l,"is-enabled",o[1]),w(i,"class","setting-item-control"),w(n,"class","setting-item"),w(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(F,O){T(F,e,O),T(F,t,O),T(F,r,O),k(r,n),k(n,s),k(n,a),k(n,i),k(i,l),k(l,c),k(l,u),k(l,d),k(r,m),~x&&B[x].m(r,null),_=!0,b||(v=[ee(l,"keypress",o[15]),ee(l,"click",o[16])],b=!0)},p(F,[O]){(!_||O&2)&&(c.checked=F[1]),(!_||O&2)&&w(l,"aria-checked",F[1]),(!_||O&2)&&Ye(l,"is-enabled",F[1]);let M=x;x=A(F,O),x===M?~x&&B[x].p(F,O):(h&&(we(),P(B[M],1,1,()=>{B[M]=null}),_e()),~x?(h=B[x],h?h.p(F,O):(h=B[x]=D[x](F),h.c()),L(h,1),h.m(r,null)):h=null)},i(F){_||(L(h),_=!0)},o(F){P(h),_=!1},d(F){F&&(I(e),I(t),I(r)),~x&&B[x].d(),b=!1,Le(v)}}}function UA(o,e,t){let r,n,s,a,i,l;var c;let{plugin:u}=e,d=xe(!0);ye(o,d,F=>t(3,a=F));let m=xe(0);ye(o,m,F=>t(4,i=F));let x=xe(null);ye(o,x,F=>t(0,s=F));let h=xe(null);ye(o,h,F=>t(5,l=F));let _=!1;function b(){return Ze(this,void 0,void 0,function*(){d.set(!0),h.set(null);try{let F=yield ew({appId:u.appId,filterByAppId:!_,onProgress:O=>m.set(O)});x.set(F)}catch(F){h.set(`Analysis failed: ${F.message}`)}finally{d.set(!1)}})}function v(F){return Ze(this,void 0,void 0,function*(){try{yield tw(F),s&&fx(x,s.largeStores=s.largeStores.filter(O=>O.slug!==F),s)}catch(O){h.set(`Failed to delete ${F}: ${O.message}`)}})}tr(()=>{b()});let D=()=>{t(1,_=!_),b()},B=()=>{t(1,_=!_),b()},A=F=>v(F.slug);return o.$$set=F=>{"plugin"in F&&t(12,u=F.plugin)},o.$$.update=()=>{if(o.$$.dirty&8193){e:t(14,r=t(13,c=s==null?void 0:s.largeStores.reduce((F,O)=>{let M=O.relay||"local";return F[M]||(F[M]=[]),F[M].push(O),F},{}))!==null&&c!==void 0?c:{})}if(o.$$.dirty&16384){e:t(2,n=Object.entries(r).sort(([F],[O])=>F==="local"?-1:O==="local"?1:F.localeCompare(O)))}},[s,_,n,a,i,l,d,m,x,h,b,v,u,c,r,D,B,A]}var Wp=class extends J{constructor(e){super(),X(this,e,UA,OA,Y,{plugin:12},PA)}},iw=Wp;var bf=class extends lw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new iw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Ow=require("obsidian");var{Boolean:ww}=Nn;function $A(o){Ae(o,"svelte-18bqwhy",".file-name.svelte-18bqwhy{display:flex;align-items:center;gap:6px;font-size:0.9rem;flex:1;min-width:0}.details-container.svelte-18bqwhy{margin-left:auto;text-align:right;padding-left:8px;padding-right:8px}.details.svelte-18bqwhy{font-size:0.75rem;color:var(--text-muted)}.error-message.svelte-18bqwhy{color:var(--text-error);margin-top:2px;text-align:right}.more-files.svelte-18bqwhy{font-size:0.8rem;color:var(--text-muted);text-align:center}button.mod-warning.svelte-18bqwhy{display:flex;align-items:center;gap:4px;background-color:var(--background-modifier-error);color:var(--text-error)}.mod-primary{color:var(--interactive-accent)}.mod-success{color:var(--interactive-success)}.mod-warning{color:var(--text-warning)}.show-more-link.svelte-18bqwhy{color:var(--text-accent);cursor:pointer;font-size:0.8rem}.show-more-link.svelte-18bqwhy:hover{text-decoration:underline}")}function fw(o,e,t){let r=o.slice();return r[20]=e[t],r}function cw(o,e,t){let r=o.slice();return r[23]=e[t],r}function BA(o){return{c:Q,m:Q,p:Q,i:Q,o:Q,d:Q}}function NA(o){let e,t,r=Fe(bw(o[19].documents)),n=[];for(let a=0;a<r.length;a+=1)n[a]=gw(fw(o,r,a));let s=a=>P(n[a],1,1,()=>{n[a]=null});return{c(){for(let a=0;a<n.length;a+=1)n[a].c();e=Te()},m(a,i){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(a,i);T(a,e,i),t=!0},p(a,i){if(i&8311){r=Fe(bw(a[19].documents));let l;for(l=0;l<r.length;l+=1){let c=fw(a,r,l);n[l]?(n[l].p(c,i),L(n[l],1)):(n[l]=gw(c),n[l].c(),L(n[l],1),n[l].m(e.parentNode,e))}for(we(),l=r.length;l<n.length;l+=1)s(l);_e()}},i(a){if(!t){for(let i=0;i<r.length;i+=1)L(n[i]);t=!0}},o(a){n=n.filter(ww);for(let i=0;i<n.length;i+=1)P(n[i]);t=!1},d(a){a&&I(e),ft(n,a)}}}function uw(o){let e,t=yw(o[23].queueState.timestamp)+"",r;return{c(){e=W("\u2022 "),r=W(t)},m(n,s){T(n,e,s),T(n,r,s)},p(n,s){s&3&&t!==(t=yw(n[23].queueState.timestamp)+"")&&oe(r,t)},d(n){n&&(I(e),I(r))}}}function dw(o){let e,t=o[23].queueState.error+"",r;return{c(){e=C("div"),r=W(t),w(e,"class","error-message svelte-18bqwhy")},m(n,s){T(n,e,s),k(e,r)},p(n,s){s&3&&t!==(t=n[23].queueState.error+"")&&oe(r,t)},d(n){n&&I(e)}}}function pw(o){let e,t,r,n,s,a;t=new Ku({props:{size:14,class:"svg-icon lucide-refresh-cw"}});function i(){return o[10](o[23])}return{c(){e=C("button"),z(t.$$.fragment),r=W(`
							Retry`),w(e,"class","mod-warning svelte-18bqwhy")},m(l,c){T(l,e,c),N(t,e,null),k(e,r),n=!0,s||(a=ee(e,"click",i),s=!0)},p(l,c){o=l},i(l){n||(L(t.$$.fragment,l),n=!0)},o(l){P(t.$$.fragment,l),n=!1},d(l){l&&I(e),H(t),s=!1,a()}}}function HA(o){var x,h,_;let e,t,r=o[5](o[23]).text+"",n,s,a,i,l,c,u=((x=o[23].queueState)==null?void 0:x.timestamp)&&uw(o),d=((h=o[23].queueState)==null?void 0:h.error)&&dw(o),m=((_=o[23].queueState)==null?void 0:_.status)==="failed"&&pw(o);return{c(){e=C("div"),t=C("span"),n=W(r),s=$(),u&&u.c(),a=$(),d&&d.c(),i=$(),m&&m.c(),l=Te(),w(t,"class","details svelte-18bqwhy"),w(e,"class","details-container svelte-18bqwhy")},m(b,v){T(b,e,v),k(e,t),k(t,n),k(t,s),u&&u.m(t,null),k(t,a),d&&d.m(t,null),T(b,i,v),m&&m.m(b,v),T(b,l,v),c=!0},p(b,v){var D,B,A;(!c||v&3)&&r!==(r=b[5](b[23]).text+"")&&oe(n,r),(D=b[23].queueState)!=null&&D.timestamp?u?u.p(b,v):(u=uw(b),u.c(),u.m(t,a)):u&&(u.d(1),u=null),(B=b[23].queueState)!=null&&B.error?d?d.p(b,v):(d=dw(b),d.c(),d.m(t,null)):d&&(d.d(1),d=null),((A=b[23].queueState)==null?void 0:A.status)==="failed"?m?(m.p(b,v),v&3&&L(m,1)):(m=pw(b),m.c(),L(m,1),m.m(l.parentNode,l)):m&&(we(),P(m,1,1,()=>{m=null}),_e())},i(b){c||(L(m),c=!0)},o(b){P(m),c=!1},d(b){b&&(I(e),I(i),I(l)),u&&u.d(),d&&d.d(),m&&m.d(b)}}}function zA(o){let e,t=o[9].default,r=de(t,o,o[13],null),n=r||HA(o);return{c(){n&&n.c()},m(s,a){n&&n.m(s,a),e=!0},p(s,a){r?r.p&&(!e||a&8192)&&me(r,t,s,s[13],e?pe(t,s[13],a,null):he(s[13]),null):n&&n.p&&(!e||a&3)&&n.p(s,e?a:-1)},i(s){e||(L(n,s),e=!0)},o(s){P(n,s),e=!1},d(s){n&&n.d(s)}}}function VA(o){let e,t,r,n,s=o[23].path.split("/").pop()+"",a,i;var l=o[5](o[23]).icon;function c(u,d){return{props:{size:16,class:"svg-icon "+u[5](u[23]).iconClass}}}return l&&(t=$s(l,c(o))),{c(){e=C("span"),t&&z(t.$$.fragment),r=$(),n=C("span"),a=W(s),w(e,"slot","name"),w(e,"class","file-name svelte-18bqwhy")},m(u,d){T(u,e,d),t&&N(t,e,null),k(e,r),k(e,n),k(n,a),i=!0},p(u,d){if(d&3&&l!==(l=u[5](u[23]).icon)){if(t){we();let m=t;P(m.$$.fragment,1,0,()=>{H(m,1)}),_e()}l?(t=$s(l,c(u,d)),z(t.$$.fragment),L(t.$$.fragment,1),N(t,e,r)):t=null}else if(l){let m={};d&3&&(m.class="svg-icon "+u[5](u[23]).iconClass),t.$set(m)}(!i||d&3)&&s!==(s=u[23].path.split("/").pop()+"")&&oe(a,s)},i(u){i||(t&&L(t.$$.fragment,u),i=!0)},o(u){t&&P(t.$$.fragment,u),i=!1},d(u){u&&I(e),t&&H(t)}}}function mw(o){let e,t;return e=new wr({props:{$$slots:{name:[VA],default:[zA]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function hw(o){let e,t;return e=new wr({props:{$$slots:{name:[qA]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function qA(o){let e,t,r=xw(o[1](o[20]).remainingCount)+"",n,s,a=o[20].title.toLowerCase()+"",i,l,c,u,d,m,x,h;function _(){return o[11](o[20])}function b(...v){return o[12](o[20],...v)}return{c(){var v;e=C("span"),t=W("...and "),n=W(r),s=W(` more
					`),i=W(a),l=$(),c=C("span"),u=W("(show more)"),m=$(),w(c,"class","show-more-link svelte-18bqwhy"),w(c,"role","button"),w(c,"tabindex","0"),w(c,"aria-label",d=`Show ${((v=o[2][o[20].title])==null?void 0:v.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`),w(e,"slot","name"),w(e,"class","more-files svelte-18bqwhy")},m(v,D){T(v,e,D),k(e,t),k(e,n),k(e,s),k(e,i),k(e,l),k(e,c),k(c,u),k(e,m),x||(h=[ee(c,"click",_),ee(c,"keydown",b)],x=!0)},p(v,D){var B;o=v,D&3&&r!==(r=xw(o[1](o[20]).remainingCount)+"")&&oe(n,r),D&1&&a!==(a=o[20].title.toLowerCase()+"")&&oe(i,a),D&1&&d!==(d=`Show ${((B=o[2][o[20].title])==null?void 0:B.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`)&&w(c,"aria-label",d)},d(v){v&&I(e),x=!1,Le(h)}}}function gw(o){let e,t,r,n=o[1](o[20]).remainingCount>0,s,a;e=new et({props:{name:o[20].title}});let i=Fe(o[1](o[20]).visibleDocs),l=[];for(let d=0;d<i.length;d+=1)l[d]=mw(cw(o,i,d));let c=d=>P(l[d],1,1,()=>{l[d]=null}),u=n&&hw(o);return{c(){z(e.$$.fragment),t=$();for(let d=0;d<l.length;d+=1)l[d].c();r=$(),u&&u.c(),s=Te()},m(d,m){N(e,d,m),T(d,t,m);for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(d,m);T(d,r,m),u&&u.m(d,m),T(d,s,m),a=!0},p(d,m){let x={};if(m&1&&(x.name=d[20].title),e.$set(x),m&8291){i=Fe(d[1](d[20]).visibleDocs);let h;for(h=0;h<i.length;h+=1){let _=cw(d,i,h);l[h]?(l[h].p(_,m),L(l[h],1)):(l[h]=mw(_),l[h].c(),L(l[h],1),l[h].m(r.parentNode,r))}for(we(),h=i.length;h<l.length;h+=1)c(h);_e()}m&3&&(n=d[1](d[20]).remainingCount>0),n?u?(u.p(d,m),m&3&&L(u,1)):(u=hw(d),u.c(),L(u,1),u.m(s.parentNode,s)):u&&(we(),P(u,1,1,()=>{u=null}),_e())},i(d){if(!a){L(e.$$.fragment,d);for(let m=0;m<i.length;m+=1)L(l[m]);L(u),a=!0}},o(d){P(e.$$.fragment,d),l=l.filter(ww);for(let m=0;m<l.length;m+=1)P(l[m]);P(u),a=!1},d(d){d&&(I(t),I(r),I(s)),H(e,d),ft(l,d),u&&u.d(d)}}}function WA(o){let e;return{c(){e=C("div"),e.textContent="Loading...",w(e,"class","loading")},m(t,r){T(t,e,r)},p:Q,i:Q,o:Q,d(t){t&&I(e)}}}function GA(o){let e,t,r,n={ctx:o,current:null,token:null,hasCatch:!1,pending:WA,then:NA,catch:BA,value:19,blocks:[,,,]};return gu(t=o[0],n),{c(){e=Te(),n.block.c()},m(s,a){T(s,e,a),n.block.m(s,n.anchor=a),n.mount=()=>e.parentNode,n.anchor=e,r=!0},p(s,[a]){o=s,n.ctx=o,a&1&&t!==(t=o[0])&&gu(t,n)||_x(n,o,a)},i(s){r||(L(n.block),r=!0)},o(s){for(let a=0;a<3;a+=1){let i=n.blocks[a];P(i)}r=!1},d(s){s&&I(e),n.block.d(s),n.token=null,n=null}}}function xw(o){return new Intl.NumberFormat().format(o)}function yw(o){let e=new Date(o),r=new Date().getTime()-e.getTime(),n=Math.floor(r/(1e3*60));if(n<1)return"just now";if(n===1)return"1 minute ago";if(n<60)return`${n} minutes ago`;let s=Math.floor(n/60);if(s===1)return"1 hour ago";if(s<24)return`${s} hours ago`;let a=Math.floor(s/24);return a===1?"yesterday":`${a} days ago`}function bw(o){let e=o.filter(s=>{var a;return((a=s.queueState)===null||a===void 0?void 0:a.status)==="running"}),t=o.filter(s=>{var a;return((a=s.queueState)===null||a===void 0?void 0:a.status)==="failed"}),r=o.filter(s=>{var a;return((a=s.queueState)===null||a===void 0?void 0:a.status)==="pending"}),n=o.filter(s=>{var a;return((a=s.queueState)===null||a===void 0?void 0:a.status)==="completed"});return[e.length>0&&{title:"Active Files",documents:e},t.length>0&&{title:"Stuck Files",documents:t},r.length>0&&{title:"Queued Files",documents:r},n.length>0&&{title:"Completed Files",documents:n}].filter(Boolean)}function KA(o,e,t){let r,n,s,a,i,{$$slots:l={},$$scope:c}=e,{folder:u}=e,{backgroundSync:d}=e,m={"Active Files":{initialCount:1/0,incrementCount:100},"Stuck Files":{initialCount:1/0,incrementCount:100},"Queued Files":{initialCount:10,incrementCount:100},"Completed Files":{initialCount:5,incrementCount:100},default:{initialCount:1/0,incrementCount:100}},x=xe({}),h=qn(x,O=>M=>{let E=m[M.title]||m.default,R=O[M.title]||E.initialCount,G=M.documents.slice(0,R),le=M.documents.length-R;return{visibleCount:R,visibleDocs:G,remainingCount:le}});ye(o,h,O=>t(1,i=O));function _(O){let M=m[O]||m.default;x.update(E=>Object.assign(Object.assign({},E),{[O]:(E[O]||M.initialCount)+M.incrementCount}))}function b(O){return Ze(this,void 0,void 0,function*(){var M;let E=[],R=Array.from(O.docs.values());for(let G of R){let le=yield G.getOrigin(),j=yield G.getServerSynced(),ae={guid:G.guid,path:O.getPath(G.path),doc:G,origin:le||"unknown",serverSynced:j},V=Array.from(r).find(Re=>Re.guid===G.guid),Z=Array.from(n).find(Re=>Re.guid===G.guid),Ee=s.find(Re=>Re.guid===G.guid);if(V||Z||Ee){let Re=V||Z||Ee;ae.queueState={status:Re.status,type:"type"in Re?Re.type:"sync",error:"error"in Re?Re.error:void 0,timestamp:"timestamp"in Re?Re.timestamp:Date.now()}}else le==="local"&&!j?ae.queueState={status:"pending",type:"sync",timestamp:Date.now()}:j?ae.queueState={status:"completed",type:"sync",timestamp:Date.now()}:ae.queueState={status:"pending",type:"sync",timestamp:Date.now()};E.push(ae)}return{folder:O,documents:E,progress:((M=d.getGroupProgress(O))===null||M===void 0?void 0:M.percent)||0}})}function v(O){let{origin:M,serverSynced:E,queueState:R}=O,G=(R==null?void 0:R.status)||"completed",le=(R==null?void 0:R.type)||"sync";return M==="remote"&&!E&&G==="running"&&le==="download"?{text:"Downloading",description:"Initial acquisition",icon:Fu,iconClass:"mod-primary"}:M==="remote"&&!E&&G==="pending"&&le==="download"?{text:"Queued for Download",description:"Waiting to download",icon:Ba,iconClass:""}:M==="remote"&&!E&&G==="failed"&&le==="download"?{text:"Download stuck",description:"Needs retry",icon:Na,iconClass:"mod-warning"}:M==="local"&&!E&&G==="running"&&le==="sync"?{text:"Uploading",description:"First-time upload",icon:Zu,iconClass:"mod-primary"}:M==="local"&&!E&&G==="pending"&&le==="sync"?{text:"Queued for Upload",description:"Waiting to upload",icon:Ba,iconClass:""}:M==="local"&&!E&&G==="failed"&&le==="sync"?{text:"Upload stuck",description:"Needs retry",icon:Na,iconClass:"mod-warning"}:E&&G==="running"&&le==="sync"?{text:"Syncing",description:"Collaborative update",icon:ku,iconClass:"mod-primary"}:E&&G==="pending"&&le==="sync"?{text:"Queued for Sync",description:"Waiting to sync",icon:Ba,iconClass:""}:E&&G==="failed"&&le==="sync"?{text:"Sync stuck",description:"Needs retry",icon:Na,iconClass:"mod-warning"}:E&&G==="completed"?{text:"Complete",description:"Fully synchronized",icon:Du,iconClass:"mod-success"}:{text:"Unknown",description:"Status unknown",icon:$u,iconClass:""}}function D(O){return Ze(this,void 0,void 0,function*(){var M,E;let R={id:O.guid,guid:O.guid,path:O.path,timestamp:((M=O.queueState)===null||M===void 0?void 0:M.timestamp)||Date.now(),type:((E=O.queueState)===null||E===void 0?void 0:E.type)||"sync",status:"failed",sharedFolderGuid:O.doc.sharedFolder.guid};yield d.retryLogItem(R)})}let B=O=>D(O),A=O=>{_(O.title)},F=(O,M)=>M.key==="Enter"&&_(O.title);return o.$$set=O=>{"folder"in O&&t(7,u=O.folder),"backgroundSync"in O&&t(8,d=O.backgroundSync),"$$scope"in O&&t(13,c=O.$$scope)},o.$$.update=()=>{if(o.$$.dirty&256){e:r=new Set(d.activeSync.items())}if(o.$$.dirty&256){e:n=new Set(d.activeDownloads.items())}if(o.$$.dirty&256){e:s=d.getSyncLog()}if(o.$$.dirty&128){e:t(0,a=b(u))}},[a,i,m,h,_,v,D,u,d,l,B,A,F,c]}var Gp=class extends J{constructor(e){super(),X(this,e,KA,GA,Y,{folder:7,backgroundSync:8},$A)}},Kp=Gp;var{Map:jA}=Nn;function YA(o){Ae(o,"svelte-ztgdsf",".folder-header.svelte-ztgdsf{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;width:100%;text-align:left;color:inherit;font:inherit}.arrow.svelte-ztgdsf{margin-right:8px;font-size:0.8em;transition:transform 0.15s ease}.arrow.is-expanded.svelte-ztgdsf{transform:rotate(90deg)}.sync-stats.svelte-ztgdsf{margin-left:8px;display:flex;gap:4px}.tag.svelte-ztgdsf{font-size:0.7em;padding:2px 6px;border-radius:4px;background-color:var(--background-modifier-border);color:var(--text-muted)}.tag.mod-success.svelte-ztgdsf{background-color:var(--interactive-success);color:var(--text-on-accent)}.tag.mod-warning.svelte-ztgdsf{background-color:var(--text-warning);color:var(--text-on-accent)}.progress-container.svelte-ztgdsf{display:flex;align-items:center;margin-top:4px;width:100%}.progress-bar.svelte-ztgdsf{flex:1;height:6px;background-color:var(--background-modifier-border);border-radius:3px;overflow:hidden;margin-right:8px}.progress-value.svelte-ztgdsf{height:100%;background-color:var(--interactive-accent);border-radius:3px}.progress-text.svelte-ztgdsf{font-size:0.75rem;color:var(--text-muted)}")}function _w(o,e,t){let r=o.slice();r[25]=e[t];let n=r[4].get(r[25].guid);return r[26]=n,r}function vw(o){let e,t;return e=new et({props:{name:"Sync Status"}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Sw(o){let e,t;return e=new He({props:{name:o[11]?"Sync in Progress":o[10]?"Queued Files":"Sync Complete",description:`${o[2]} active \u2022 ${o[7]} stuck \u2022 ${o[3]} queued \u2022 ${o[8]} complete`,$$slots:{default:[QA]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&3072&&(s.name=r[11]?"Sync in Progress":r[10]?"Queued Files":"Sync Complete"),n&396&&(s.description=`${r[2]} active \u2022 ${r[7]} stuck \u2022 ${r[3]} queued \u2022 ${r[8]} complete`),n&536874496&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function kw(o){let e,t,r,n,s,a,i=[XA,JA],l=[];function c(u,d){return u[9]?0:1}return t=c(o,-1),r=l[t]=i[t](o),{c(){e=C("button"),r.c(),w(e,"class","mod-cta")},m(u,d){T(u,e,d),l[t].m(e,null),n=!0,s||(a=ee(e,"click",o[16]),s=!0)},p(u,d){let m=t;t=c(u,d),t!==m&&(we(),P(l[m],1,1,()=>{l[m]=null}),_e(),r=l[t],r||(r=l[t]=i[t](u),r.c()),L(r,1),r.m(e,null))},i(u){n||(L(r),n=!0)},o(u){P(r),n=!1},d(u){u&&I(e),l[t].d(),s=!1,a()}}}function JA(o){let e,t,r;return e=new Vu({props:{size:16,class:"svg-icon lucide-pause",style:"margin-right: 8px;"}}),{c(){z(e.$$.fragment),t=W(`
						Pause`)},m(n,s){N(e,n,s),T(n,t,s),r=!0},i(n){r||(L(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){n&&I(t),H(e,n)}}}function XA(o){let e,t,r;return e=new Wu({props:{size:16,class:"svg-icon lucide-play",style:"margin-right: 8px;"}}),{c(){z(e.$$.fragment),t=W(`
						Resume`)},m(n,s){N(e,n,s),T(n,t,s),r=!0},i(n){r||(L(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){n&&I(t),H(e,n)}}}function QA(o){let e,t,r=(o[11]||o[10])&&kw(o);return{c(){r&&r.c(),e=Te()},m(n,s){r&&r.m(n,s),T(n,e,s),t=!0},p(n,s){n[11]||n[10]?r?(r.p(n,s),s&3072&&L(r,1)):(r=kw(n),r.c(),L(r,1),r.m(e.parentNode,e)):r&&(we(),P(r,1,1,()=>{r=null}),_e())},i(n){t||(L(r),t=!0)},o(n){P(r),t=!1},d(n){n&&I(e),r&&r.d(n)}}}function ZA(o){let e=[],t=new jA,r,n,s=Fe(o[6]),a=i=>i[25].guid;for(let i=0;i<s.length;i+=1){let l=_w(o,s,i),c=a(l);t.set(c,e[i]=Dw(c,l))}return{c(){for(let i=0;i<e.length;i+=1)e[i].c();r=Te()},m(i,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(i,l);T(i,r,l),n=!0},p(i,l){l&32851&&(s=Fe(i[6]),we(),e=Sx(e,l,a,1,i,s,t,r.parentNode,vx,Dw,r,_w),_e())},i(i){if(!n){for(let l=0;l<s.length;l+=1)L(e[l]);n=!0}},o(i){for(let l=0;l<e.length;l+=1)P(e[l]);n=!1},d(i){i&&I(r);for(let l=0;l<e.length;l+=1)e[l].d(i)}}}function eE(o){let e,t,r,n;return e=new et({props:{$$slots:{name:[aE],default:[nE]},$$scope:{ctx:o}}}),r=new Kp({props:{folder:o[5],backgroundSync:o[0]}}),{c(){z(e.$$.fragment),t=$(),z(r.$$.fragment)},m(s,a){N(e,s,a),T(s,t,a),N(r,s,a),n=!0},p(s,a){let i={};a&536875040&&(i.$$scope={dirty:a,ctx:s}),e.$set(i);let l={};a&32&&(l.folder=s[5]),a&1&&(l.backgroundSync=s[0]),r.$set(l)},i(s){n||(L(e.$$.fragment,s),L(r.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),P(r.$$.fragment,s),n=!1},d(s){s&&I(t),H(e,s),H(r,s)}}}function Lw(o){let e,t,r,n,s,a=o[26].progress+"",i,l;return{c(){e=C("div"),t=C("div"),r=C("div"),n=$(),s=C("span"),i=W(a),l=W("%"),w(r,"class","progress-value svelte-ztgdsf"),ge(r,"width",o[26].progress+"%"),w(t,"class","progress-bar svelte-ztgdsf"),w(s,"class","progress-text svelte-ztgdsf"),w(e,"class","progress-container svelte-ztgdsf")},m(c,u){T(c,e,u),k(e,t),k(t,r),k(e,n),k(e,s),k(s,i),k(s,l)},p(c,u){u&80&&ge(r,"width",c[26].progress+"%"),u&80&&a!==(a=c[26].progress+"")&&oe(i,a)},d(c){c&&I(e)}}}function tE(o){let e,t=o[26]&&(o[26].running>0||o[26].failed>0)&&Lw(o);return{c(){t&&t.c(),e=Te()},m(r,n){t&&t.m(r,n),T(r,e,n)},p(r,n){r[26]&&(r[26].running>0||r[26].failed>0)?t?t.p(r,n):(t=Lw(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&I(e),t&&t.d(r)}}}function Iw(o){let e,t=o[26].running+"",r,n;return{c(){e=C("span"),r=W(t),n=W(" active"),w(e,"class","tag mod-success svelte-ztgdsf")},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&80&&t!==(t=s[26].running+"")&&oe(r,t)},d(s){s&&I(e)}}}function Cw(o){let e,t=o[26].failed+"",r,n;return{c(){e=C("span"),r=W(t),n=W(" stuck"),w(e,"class","tag mod-warning svelte-ztgdsf")},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&80&&t!==(t=s[26].failed+"")&&oe(r,t)},d(s){s&&I(e)}}}function Tw(o){let e,t=o[26].pending+"",r,n;return{c(){e=C("span"),r=W(t),n=W(" queued"),w(e,"class","tag svelte-ztgdsf")},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&80&&t!==(t=s[26].pending+"")&&oe(r,t)},d(s){s&&I(e)}}}function rE(o){var A,F,O;let e,t,r,n,s,a=o[25].name+"",i,l,c,u,d,m,x,h,_=((A=o[26])==null?void 0:A.running)>0&&Iw(o),b=((F=o[26])==null?void 0:F.failed)>0&&Cw(o),v=((O=o[26])==null?void 0:O.pending)>0&&Tw(o);function D(){return o[22](o[25])}function B(...M){return o[23](o[25],...M)}return{c(){e=C("div"),t=C("span"),r=W("\u25B6"),s=$(),i=W(a),l=$(),c=C("span"),_&&_.c(),u=$(),b&&b.c(),d=$(),v&&v.c(),w(t,"class",n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf"),w(c,"class","sync-stats svelte-ztgdsf"),w(e,"class","folder-header svelte-ztgdsf"),w(e,"role","button"),w(e,"tabindex","0"),w(e,"aria-expanded",m=!!o[1][o[25].guid])},m(M,E){T(M,e,E),k(e,t),k(t,r),k(e,s),k(e,i),k(e,l),k(e,c),_&&_.m(c,null),k(c,u),b&&b.m(c,null),k(c,d),v&&v.m(c,null),x||(h=[ee(e,"click",D),ee(e,"keydown",B)],x=!0)},p(M,E){var R,G,le;o=M,E&66&&n!==(n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf")&&w(t,"class",n),E&64&&a!==(a=o[25].name+"")&&oe(i,a),((R=o[26])==null?void 0:R.running)>0?_?_.p(o,E):(_=Iw(o),_.c(),_.m(c,u)):_&&(_.d(1),_=null),((G=o[26])==null?void 0:G.failed)>0?b?b.p(o,E):(b=Cw(o),b.c(),b.m(c,d)):b&&(b.d(1),b=null),((le=o[26])==null?void 0:le.pending)>0?v?v.p(o,E):(v=Tw(o),v.c(),v.m(c,null)):v&&(v.d(1),v=null),E&66&&m!==(m=!!o[1][o[25].guid])&&w(e,"aria-expanded",m)},d(M){M&&I(e),_&&_.d(),b&&b.d(),v&&v.d(),x=!1,Le(h)}}}function oE(o){let e,t;return e=new ho({props:{folder:o[25],$$slots:{default:[rE]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&536870994&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Pw(o){let e,t;return e=new Kp({props:{folder:o[25],backgroundSync:o[0]}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&1&&(s.backgroundSync=r[0]),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Dw(o,e){let t,r,n,s,a;r=new et({props:{$$slots:{name:[oE],default:[tE]},$$scope:{ctx:e}}});let i=e[1][e[25].guid]&&Pw(e);return{key:o,first:null,c(){t=Te(),z(r.$$.fragment),n=$(),i&&i.c(),s=Te(),this.first=t},m(l,c){T(l,t,c),N(r,l,c),T(l,n,c),i&&i.m(l,c),T(l,s,c),a=!0},p(l,c){e=l;let u={};c&536870994&&(u.$$scope={dirty:c,ctx:e}),r.$set(u),e[1][e[25].guid]?i?(i.p(e,c),c&66&&L(i,1)):(i=Pw(e),i.c(),L(i,1),i.m(s.parentNode,s)):i&&(we(),P(i,1,1,()=>{i=null}),_e())},i(l){a||(L(r.$$.fragment,l),L(i),a=!0)},o(l){P(r.$$.fragment,l),P(i),a=!1},d(l){l&&(I(t),I(n),I(s)),H(r,l),i&&i.d(l)}}}function Aw(o){let e,t,r,n,s,a=o[12].progress+"",i,l;return{c(){e=C("div"),t=C("div"),r=C("div"),n=$(),s=C("span"),i=W(a),l=W("%"),w(r,"class","progress-value svelte-ztgdsf"),ge(r,"width",o[12].progress+"%"),w(t,"class","progress-bar svelte-ztgdsf"),w(s,"class","progress-text svelte-ztgdsf"),w(e,"class","progress-container svelte-ztgdsf")},m(c,u){T(c,e,u),k(e,t),k(t,r),k(e,n),k(e,s),k(s,i),k(s,l)},p(c,u){u&4096&&ge(r,"width",c[12].progress+"%"),u&4096&&a!==(a=c[12].progress+"")&&oe(i,a)},d(c){c&&I(e)}}}function nE(o){let e,t=(o[12].running>0||o[12].failed>0)&&Aw(o);return{c(){t&&t.c(),e=Te()},m(r,n){t&&t.m(r,n),T(r,e,n)},p(r,n){r[12].running>0||r[12].failed>0?t?t.p(r,n):(t=Aw(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&I(e),t&&t.d(r)}}}function Ew(o){let e,t=o[12].running+"",r,n;return{c(){e=C("span"),r=W(t),n=W(" active"),w(e,"class","tag mod-success svelte-ztgdsf")},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&4096&&t!==(t=s[12].running+"")&&oe(r,t)},d(s){s&&I(e)}}}function Mw(o){let e,t=o[12].failed+"",r,n;return{c(){e=C("span"),r=W(t),n=W(" stuck"),w(e,"class","tag mod-warning svelte-ztgdsf")},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&4096&&t!==(t=s[12].failed+"")&&oe(r,t)},d(s){s&&I(e)}}}function Fw(o){let e,t=o[12].pending+"",r,n;return{c(){e=C("span"),r=W(t),n=W(" queued"),w(e,"class","tag svelte-ztgdsf")},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&4096&&t!==(t=s[12].pending+"")&&oe(r,t)},d(s){s&&I(e)}}}function sE(o){let e,t=o[5].name+"",r,n,s,a,i,l=o[12].running>0&&Ew(o),c=o[12].failed>0&&Mw(o),u=o[12].pending>0&&Fw(o);return{c(){e=C("div"),r=W(t),n=$(),s=C("span"),l&&l.c(),a=$(),c&&c.c(),i=$(),u&&u.c(),w(s,"class","sync-stats svelte-ztgdsf"),w(e,"class","folder-header svelte-ztgdsf")},m(d,m){T(d,e,m),k(e,r),k(e,n),k(e,s),l&&l.m(s,null),k(s,a),c&&c.m(s,null),k(s,i),u&&u.m(s,null)},p(d,m){m&32&&t!==(t=d[5].name+"")&&oe(r,t),d[12].running>0?l?l.p(d,m):(l=Ew(d),l.c(),l.m(s,a)):l&&(l.d(1),l=null),d[12].failed>0?c?c.p(d,m):(c=Mw(d),c.c(),c.m(s,i)):c&&(c.d(1),c=null),d[12].pending>0?u?u.p(d,m):(u=Fw(d),u.c(),u.m(s,null)):u&&(u.d(1),u=null)},d(d){d&&I(e),l&&l.d(),c&&c.d(),u&&u.d()}}}function aE(o){let e,t;return e=new ho({props:{folder:o[5],$$slots:{default:[sE]},$$scope:{ctx:o}}}),{c(){z(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&32&&(s.folder=r[5]),n&536875040&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function iE(o){let e,t,r,n,s,a,i=!o[5]&&vw(o),l=!o[5]&&Sw(o),c=[eE,ZA],u=[];function d(m,x){return m[5]&&m[12]?0:1}return n=d(o,-1),s=u[n]=c[n](o),{c(){e=C("div"),i&&i.c(),t=$(),l&&l.c(),r=$(),s.c(),w(e,"class","setting-item-container")},m(m,x){T(m,e,x),i&&i.m(e,null),k(e,t),l&&l.m(e,null),k(e,r),u[n].m(e,null),a=!0},p(m,[x]){m[5]?i&&(we(),P(i,1,1,()=>{i=null}),_e()):i?x&32&&L(i,1):(i=vw(m),i.c(),L(i,1),i.m(e,t)),m[5]?l&&(we(),P(l,1,1,()=>{l=null}),_e()):l?(l.p(m,x),x&32&&L(l,1)):(l=Sw(m),l.c(),L(l,1),l.m(e,r));let h=n;n=d(m,x),n===h?u[n].p(m,x):(we(),P(u[h],1,1,()=>{u[h]=null}),_e(),s=u[n],s?s.p(m,x):(s=u[n]=c[n](m),s.c()),L(s,1),s.m(e,null))},i(m){a||(L(i),L(l),L(s),a=!0)},o(m){P(i),P(l),P(s),a=!1},d(m){m&&I(e),i&&i.d(),l&&l.d(),u[n].d()}}}function lE(o,e,t){let r,n,s,a,i,l,c,u,d,m,x,{backgroundSync:h}=e,{sharedFolders:_}=e,{focusedFolderGuid:b}=e,v={},D=0,B=0,A=0,F=0,{activeSync:O,activeDownloads:M}=h;ye(o,O,j=>t(21,x=j)),ye(o,M,j=>t(20,m=j));function E(j){t(1,v[j]=!v[j],v),t(1,v),t(6,r),t(17,_)}function R(){l?h.resume():h.pause()}let G=j=>E(j.guid),le=(j,ae)=>ae.key==="Enter"&&E(j.guid);return o.$$set=j=>{"backgroundSync"in j&&t(0,h=j.backgroundSync),"sharedFolders"in j&&t(17,_=j.sharedFolders),"focusedFolderGuid"in j&&t(18,b=j.focusedFolderGuid)},o.$$.update=()=>{if(o.$$.dirty&131072){e:t(6,r=_.items().sort((j,ae)=>j.name.localeCompare(ae.name)))}if(o.$$.dirty&66){e:r.forEach(j=>{j.guid in v||t(1,v[j.guid]=!0,v)}),t(1,v),t(6,r),t(17,_)}if(o.$$.dirty&393216){e:t(5,n=b?_.items().find(j=>j.guid===b):void 0)}if(o.$$.dirty&3145793){e:t(4,s=new Map(r.map(j=>{var ae,V;return[j.guid,{progress:((ae=h.getGroupProgress(j))===null||ae===void 0?void 0:ae.percent)||0,running:[...x.items(),...m.items()].filter(Z=>Z.sharedFolder.guid===j.guid).length,failed:((V=h.syncGroups.get(j))===null||V===void 0?void 0:V.status)==="failed"?1:0,pending:[...h.pendingSyncs,...h.pendingDownloads].filter(Z=>Z.sharedFolder.guid===j.guid).length,completed:(()=>{let Z=h.syncGroups.get(j);return((Z==null?void 0:Z.completedSyncs)||0)+((Z==null?void 0:Z.completedDownloads)||0)})(),sharedFolder:j}]})))}if(o.$$.dirty&48){e:t(12,a=n?s.get(n.guid):void 0)}if(o.$$.dirty&1){e:t(19,i=h.getQueueStatus())}if(o.$$.dirty&524288){e:t(9,l=i.isPaused)}if(o.$$.dirty&524288){e:c=i.syncsActive>0||i.downloadsActive>0}if(o.$$.dirty&16){e:{let j=0,ae=0,V=0,Z=0;for(let Ee of s.values())j+=Ee.running,ae+=Ee.failed,V+=Ee.pending,Z+=Ee.completed;t(2,D=j),t(7,B=ae),t(3,A=V),t(8,F=Z)}}if(o.$$.dirty&4){e:t(11,u=D>0)}if(o.$$.dirty&8){e:t(10,d=A>0)}},[h,v,D,A,s,n,r,B,F,l,d,u,a,O,M,E,R,_,b,i,m,x,G,le]}var jp=class extends J{constructor(e){super(),X(this,e,lE,iE,Y,{backgroundSync:0,sharedFolders:17,focusedFolderGuid:18},YA)}},Rw=jp;var ri=class extends Ow.Modal{constructor(t,r,n,s){super(t);this.backgroundSync=r;this.sharedFolders=n;this.focusedFolderGuid=s}onOpen(){let{contentEl:t}=this;t.empty(),this.component=new Rw({target:t,props:{backgroundSync:this.backgroundSync,sharedFolders:this.sharedFolders,focusedFolderGuid:this.focusedFolderGuid,closeModal:()=>this.close()}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var wf=class extends Et{constructor(t,r){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.updateCheckInterval=null;this.releaseCheckInterval=null;this.updateInfo=null;this.githubReleases=[];this.lastReleaseCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.RELEASES_CHECK_INTERVAL=1e3*60*60}start(){this.checkForUpdates(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.checkForUpdates(),this.CHECK_INTERVAL),this.checkGitHubReleases(),this.releaseCheckInterval=this.timeProvider.setInterval(()=>this.checkGitHubReleases(),this.RELEASES_CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null),this.releaseCheckInterval!==null&&(this.timeProvider.clearInterval(this.releaseCheckInterval),this.releaseCheckInterval=null)}async checkForUpdates(){try{if(await this.checkGitHubReleases(),this.githubReleases.length===0)return this.debug("No releases found"),!1;let t=this.plugin.manifest.version,r=null;for(let s of this.githubReleases){let a=await this.fetchReleaseManifest(s,!1),i=await this.fetchReleaseManifest(s,!0);if(a&&a.version!==t){r={currentVersion:t,newVersion:a.version,repository:"No-Instructions/Relay",manifest:a},this.debug("Found stable update:",r);break}else if(i&&i.version!==t){r={currentVersion:t,newVersion:i.version,repository:"No-Instructions/Relay",manifest:i},this.debug("Found beta update:",r);break}}let n=this.updateInfo===null&&r!==null||this.updateInfo!==null&&r===null||this.updateInfo!==null&&r!==null&&this.updateInfo.newVersion!==r.newVersion;return this.updateInfo=r,n&&(this.debug("Update state changed, notifying listeners"),this.notifyListeners()),r!==null}catch(t){return this.error("Failed to check for updates:",t),!1}}getUpdateInfo(){return this.updateInfo}isUpdateAvailable(){return this.updateInfo!==null}async installUpdate(){if(!this.updateInfo)return this.debug("No updates available"),!1;let{currentVersion:t,newVersion:r,repository:n,manifest:s}=this.updateInfo;if(!r||!n||!s)return this.error("Update information is incomplete",this.updateInfo),this.updateInfo=null,this.notifyListeners(),!1;try{this.debug(`Installing update from v${t} to v${r}...`),this.debug("Installing plugin with parameters:",{repository:n,newVersion:r,manifest:s}),await this.plugin.app.plugins.installPlugin(n,r,s),this.updateInfo=null,this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let a="system3-relay",i=this.plugin.app.plugins;return await i.disablePlugin(a),await i.enablePlugin(a),!0}catch(a){return this.error("Failed to install update:",a),!1}}async checkGitHubReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<5*60*1e3&&this.githubReleases.length>0)return!0;this.lastReleaseCheck=t;let a=await br("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!a.ok)throw new Error(`GitHub API error: ${a.status}`);let i=await a.json();return this.debug("GitHub releases fetched:",i),this.githubReleases=i,this.notifyListeners(),!0}catch(t){return this.error("Failed to fetch GitHub releases:",t),!1}}async fetchGitHubReleases(){return this.githubReleases.length>0?this.githubReleases:(await this.checkGitHubReleases(),this.githubReleases)}async fetchReleaseManifest(t,r=!1){try{let n=r?"manifest-beta.json":"manifest.json",s=t.assets.find(l=>l.name===n);if(!s)return this.debug(`No ${n} found in release assets`),null;this.debug(`Fetching ${r?"beta":"stable"} manifest from release asset:`,s.browser_download_url);let a=await br(s.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!a.ok)throw new Error(`Failed to fetch manifest asset: ${a.status}`);let i=await a.json();return this.debug(`${r?"Beta":"Stable"} manifest fetched:`,i),i}catch(n){return this.error(`Failed to fetch ${r?"beta":"stable"} release manifest:`,n),null}}async fetchMainBranchManifests(){try{let t="No-Instructions",r="Relay",n=`https://raw.githubusercontent.com/${t}/${r}/main/manifest.json`,s=`https://raw.githubusercontent.com/${t}/${r}/main/manifest-beta.json`;this.debug(`Fetching stable manifest from: ${n}`),this.debug(`Fetching beta manifest from: ${s}`);let[a,i]=await Promise.all([br(n,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}}),br(s,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}})]),l=null;a.ok?(l=await a.json(),this.debug("Stable manifest fetched:",l)):this.debug(`Failed to fetch stable manifest: ${a.status}`);let c=null;return i.ok?(c=await i.json(),this.debug("Beta manifest fetched:",c)):this.debug(`Failed to fetch beta manifest: ${i.status}`),{stable:l,beta:c}}catch(t){return this.error("Failed to fetch main branch manifests:",t),null}}getGitHubReleases(){return this.githubReleases}destroy(){this.stop(),this.updateInfo=null,this.githubReleases=[],super.destroy()}};var Yw=require("obsidian");function fE(o){Ae(o,"svelte-1ne3zzp",'.modal-content.svelte-1ne3zzp.svelte-1ne3zzp{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-1ne3zzp.svelte-1ne3zzp{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-1ne3zzp.svelte-1ne3zzp{height:0.5rem}.checkbox-container.svelte-1ne3zzp.svelte-1ne3zzp{cursor:pointer}.loading-text.svelte-1ne3zzp.svelte-1ne3zzp,.no-releases-text.svelte-1ne3zzp.svelte-1ne3zzp{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-1ne3zzp.svelte-1ne3zzp{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-1ne3zzp.svelte-1ne3zzp{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-1ne3zzp.svelte-1ne3zzp:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-1ne3zzp.svelte-1ne3zzp{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-1ne3zzp.svelte-1ne3zzp{border-width:1px}.release-tag-item.update-available.svelte-1ne3zzp.svelte-1ne3zzp{border-width:1px}.release-tag-item.development-version.svelte-1ne3zzp.svelte-1ne3zzp{border-width:1px}.release-tag-item.main-branch-version.svelte-1ne3zzp.svelte-1ne3zzp{border-width:1px}.release-tag-item.beta-version.svelte-1ne3zzp.svelte-1ne3zzp{font-weight:bold}.release-tag-item.stable-version.svelte-1ne3zzp.svelte-1ne3zzp{font-weight:bold}.prerelease-badge.svelte-1ne3zzp.svelte-1ne3zzp{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-1ne3zzp.svelte-1ne3zzp{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-1ne3zzp.svelte-1ne3zzp{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-1ne3zzp.svelte-1ne3zzp{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-1ne3zzp.svelte-1ne3zzp{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-1ne3zzp.svelte-1ne3zzp{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-1ne3zzp.svelte-1ne3zzp{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-1ne3zzp h3.svelte-1ne3zzp{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-1ne3zzp.svelte-1ne3zzp{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-1ne3zzp.svelte-1ne3zzp{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-1ne3zzp.svelte-1ne3zzp{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-1ne3zzp.svelte-1ne3zzp{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-1ne3zzp.svelte-1ne3zzp{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-1ne3zzp.svelte-1ne3zzp{flex:1}.manifest-version-mismatch.svelte-1ne3zzp.svelte-1ne3zzp{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-1ne3zzp.svelte-1ne3zzp{font-size:1.2em}.release-changelog.svelte-1ne3zzp.svelte-1ne3zzp{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-header.svelte-1ne3zzp.svelte-1ne3zzp{font-weight:bold;margin-bottom:8px;color:var(--text-normal)}.release-changelog-content.svelte-1ne3zzp.svelte-1ne3zzp{background-color:var(--background-primary);padding:12px;border-radius:4px;overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-1ne3zzp.svelte-1ne3zzp{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-1ne3zzp.svelte-1ne3zzp{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-1ne3zzp.svelte-1ne3zzp{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-1ne3zzp.svelte-1ne3zzp{margin-bottom:12px}')}function Uw(o,e,t){let r=o.slice();return r[58]=e[t],r}function cE(o){let e,t,r,n,s,a;return{c(){e=C("div"),t=C("input"),r=$(),n=C("div"),w(t,"type","checkbox"),t.checked=o[2],w(n,"class","checkbox-toggle"),w(e,"class","checkbox-container svelte-1ne3zzp"),w(e,"role","checkbox"),w(e,"aria-checked",o[2]),w(e,"tabindex","0"),Ye(e,"is-enabled",o[2])},m(i,l){T(i,e,l),k(e,t),k(e,r),k(e,n),s||(a=[ee(e,"click",o[38]),ee(e,"keydown",o[39])],s=!0)},p(i,l){l[0]&4&&(t.checked=i[2]),l[0]&4&&w(e,"aria-checked",i[2]),l[0]&4&&Ye(e,"is-enabled",i[2])},d(i){i&&I(e),s=!1,Le(a)}}}function uE(o){let e,t,r,n=!o[8].some(o[37]),s,a,i,l=o[4]&&$w(o),c=o[5]&&Bw(o),u=n&&Nw(o),d=Fe(o[8]),m=[];for(let b=0;b<d.length;b+=1)m[b]=Hw(Uw(o,d,b));function x(b,v){if(b[11])return gE;if(b[13])return hE}let h=x(o,[-1,-1]),_=h&&h(o);return{c(){e=C("div"),l&&l.c(),t=$(),c&&c.c(),r=$(),u&&u.c(),s=$();for(let b=0;b<m.length;b+=1)m[b].c();a=$(),_&&_.c(),i=Te(),w(e,"class","release-tags-container svelte-1ne3zzp")},m(b,v){T(b,e,v),l&&l.m(e,null),k(e,t),c&&c.m(e,null),k(e,r),u&&u.m(e,null),k(e,s);for(let D=0;D<m.length;D+=1)m[D]&&m[D].m(e,null);T(b,a,v),_&&_.m(b,v),T(b,i,v)},p(b,v){if(b[4]?l?l.p(b,v):(l=$w(b),l.c(),l.m(e,t)):l&&(l.d(1),l=null),b[5]?c?c.p(b,v):(c=Bw(b),c.c(),c.m(e,r)):c&&(c.d(1),c=null),v[0]&256&&(n=!b[8].some(b[37])),n?u?u.p(b,v):(u=Nw(b),u.c(),u.m(e,s)):u&&(u.d(1),u=null),v[0]&201327872|v[1]&1){d=Fe(b[8]);let D;for(D=0;D<d.length;D+=1){let B=Uw(b,d,D);m[D]?m[D].p(B,v):(m[D]=Hw(B),m[D].c(),m[D].m(e,null))}for(;D<m.length;D+=1)m[D].d(1);m.length=d.length}h===(h=x(b,v))&&_?_.p(b,v):(_&&_.d(1),_=h&&h(b),_&&(_.c(),_.m(i.parentNode,i)))},d(b){b&&(I(e),I(a),I(i)),l&&l.d(),c&&c.d(),u&&u.d(),ft(m,b),_&&_.d(b)}}}function dE(o){let e;return{c(){e=C("div"),e.textContent="No matching releases found with the current filter",w(e,"class","no-releases-text svelte-1ne3zzp")},m(t,r){T(t,e,r)},p:Q,d(t){t&&I(e)}}}function pE(o){let e;return{c(){e=C("div"),e.textContent="No GitHub releases found",w(e,"class","no-releases-text svelte-1ne3zzp")},m(t,r){T(t,e,r)},p:Q,d(t){t&&I(e)}}}function mE(o){let e;return{c(){e=C("div"),e.textContent="Loading GitHub releases...",w(e,"class","loading-text svelte-1ne3zzp")},m(t,r){T(t,e,r)},p:Q,d(t){t&&I(e)}}}function $w(o){let e,t,r,n,s;return{c(){e=C("div"),t=C("div"),t.textContent="Beta",w(t,"class","tag-name svelte-1ne3zzp"),w(e,"class","release-tag-item main-branch-version beta-version svelte-1ne3zzp"),w(e,"role","tab"),w(e,"aria-selected",r=o[9]==="beta"),w(e,"tabindex","0")},m(a,i){T(a,e,i),k(e,t),n||(s=[ee(e,"click",o[40]),ee(e,"keydown",o[41])],n=!0)},p(a,i){i[0]&512&&r!==(r=a[9]==="beta")&&w(e,"aria-selected",r)},d(a){a&&I(e),n=!1,Le(s)}}}function Bw(o){let e,t,r,n,s;return{c(){e=C("div"),t=C("div"),t.textContent="Stable",w(t,"class","tag-name svelte-1ne3zzp"),w(e,"class","release-tag-item main-branch-version stable-version svelte-1ne3zzp"),w(e,"role","tab"),w(e,"aria-selected",r=o[9]==="stable"),w(e,"tabindex","0")},m(a,i){T(a,e,i),k(e,t),n||(s=[ee(e,"click",o[42]),ee(e,"keydown",o[43])],n=!0)},p(a,i){i[0]&512&&r!==(r=a[9]==="stable")&&w(e,"aria-selected",r)},d(a){a&&I(e),n=!1,Le(s)}}}function Nw(o){let e,t,r,n,s;return{c(){e=C("div"),t=C("div"),t.textContent="Dev",w(t,"class","tag-name svelte-1ne3zzp"),w(e,"class","release-tag-item development-version svelte-1ne3zzp"),w(e,"role","tab"),w(e,"aria-selected",r=o[9]==="development"),w(e,"tabindex","0")},m(a,i){T(a,e,i),k(e,t),n||(s=[ee(e,"click",o[44]),ee(e,"keydown",o[45])],n=!0)},p(a,i){i[0]&512&&r!==(r=a[9]==="development")&&w(e,"aria-selected",r)},d(a){a&&I(e),n=!1,Le(s)}}}function Hw(o){let e,t,r=o[58].tag_name+"",n,s,a,i,l,c;function u(){return o[46](o[58])}function d(...m){return o[47](o[58],...m)}return{c(){e=C("div"),t=C("div"),n=W(r),s=$(),w(t,"class","tag-name svelte-1ne3zzp"),w(e,"class",a="release-tag-item "+(o[26](o[58].tag_name)?"current-version":"")+" "+(o[27](o[58].tag_name)?"update-available":"")+" "+(Kw(o[58])?"pre-release":"")+" svelte-1ne3zzp"),w(e,"role","tab"),w(e,"aria-selected",i=o[10]===o[58].tag_name),w(e,"tabindex","0")},m(m,x){T(m,e,x),k(e,t),k(t,n),k(e,s),l||(c=[ee(e,"click",u),ee(e,"keydown",d)],l=!0)},p(m,x){o=m,x[0]&256&&r!==(r=o[58].tag_name+"")&&oe(n,r),x[0]&256&&a!==(a="release-tag-item "+(o[26](o[58].tag_name)?"current-version":"")+" "+(o[27](o[58].tag_name)?"update-available":"")+" "+(Kw(o[58])?"pre-release":"")+" svelte-1ne3zzp")&&w(e,"class",a),x[0]&1280&&i!==(i=o[10]===o[58].tag_name)&&w(e,"aria-selected",i)},d(m){m&&I(e),l=!1,Le(c)}}}function hE(o){let e,t,r,n,s,a,i;return{c(){e=C("div"),t=C("div"),r=W(o[13]),n=$(),s=C("button"),s.textContent="Close",w(t,"class","manifest-error-message svelte-1ne3zzp"),w(s,"class","manifest-close-btn svelte-1ne3zzp"),w(e,"class","manifest-error svelte-1ne3zzp")},m(l,c){T(l,e,c),k(e,t),k(t,r),k(e,n),k(e,s),a||(i=ee(s,"click",o[33]),a=!0)},p(l,c){c[0]&8192&&oe(r,l[13])},d(l){l&&I(e),a=!1,i()}}}function gE(o){var tt;let e,t,r,n,s,a,i=(tt=o[34](o[10]))==null?void 0:tt.prerelease,l,c,u,d,m,x,h,_,b,v,D,B,A,F,O,M,E,R=o[11].version+"",G,le,j=o[10]!==o[11].version&&!o[10].startsWith("v"+o[11].version),ae,V,Z,Ee,Re,Pe=o[11].name+"",Ke,qe,fe,Ce,te,ze,kt=o[11].author+"",Oe,pt,gt,Rt,Ko,kr,Ur=o[11].description+"",bo,jo,Lr,Zr,Yo,sr,it=o[11].isDesktopOnly?"Yes":"No",vt,eo,pr,re,Ve,K,be=o[11].minAppVersion+"",ce,Je=i&&zw(o),Xe=o[6][o[10]]==="beta-alias"&&Vw(o),zt=o[6][o[10]]==="stable-alias"&&qw(o);function oi(Ie,xt){if(xt[0]&1088&&(m=null),xt[0]&1024&&(x=null),m==null&&(m=!!((Ie[34](Ie[10])||Ie[6][Ie[10]]==="stable-alias"||Ie[6][Ie[10]]==="beta-alias")&&!Ie[26](Ie[10]))),m)return yE;if(x==null&&(x=!!Ie[26](Ie[10])),x)return xE}let Jo=oi(o,[-1,-1]),Ot=Jo&&Jo(o);function Vt(Ie,xt){return Ie[6][Ie[10]]==="stable-alias"||Ie[6][Ie[10]]==="beta-alias"||Ie[9]==="development"?vE:_E}let bn=Vt(o,[-1,-1]),ar=bn(o),Tt=j&&Ww(o);return{c(){e=C("div"),t=C("div"),r=C("h3"),n=W("Release Details: "),s=W(o[10]),a=$(),Je&&Je.c(),l=$(),Xe&&Xe.c(),c=$(),zt&&zt.c(),u=$(),d=C("div"),Ot&&Ot.c(),h=$(),_=C("div"),b=C("div"),b.textContent="Changelog:",v=$(),D=C("div"),ar.c(),B=$(),A=C("div"),F=C("div"),O=C("span"),O.textContent="Version:",M=$(),E=C("span"),G=W(R),le=$(),Tt&&Tt.c(),ae=$(),V=C("div"),Z=C("span"),Z.textContent="Name:",Ee=$(),Re=C("span"),Ke=W(Pe),qe=$(),fe=C("div"),Ce=C("span"),Ce.textContent="Author:",te=$(),ze=C("span"),Oe=W(kt),pt=$(),gt=C("div"),Rt=C("span"),Rt.textContent="Description:",Ko=$(),kr=C("span"),bo=W(Ur),jo=$(),Lr=C("div"),Zr=C("span"),Zr.textContent="isDesktopOnly:",Yo=$(),sr=C("span"),vt=W(it),eo=$(),pr=C("div"),re=C("span"),re.textContent="minAppVersion:",Ve=$(),K=C("span"),ce=W(be),w(r,"class","svelte-1ne3zzp"),w(d,"class","manifest-header-actions svelte-1ne3zzp"),w(t,"class","manifest-header svelte-1ne3zzp"),w(b,"class","release-changelog-header svelte-1ne3zzp"),w(D,"class","release-changelog-content svelte-1ne3zzp"),w(_,"class","release-changelog svelte-1ne3zzp"),w(O,"class","manifest-label svelte-1ne3zzp"),w(E,"class","manifest-value svelte-1ne3zzp"),w(F,"class","manifest-field svelte-1ne3zzp"),w(Z,"class","manifest-label svelte-1ne3zzp"),w(Re,"class","manifest-value svelte-1ne3zzp"),w(V,"class","manifest-field svelte-1ne3zzp"),w(Ce,"class","manifest-label svelte-1ne3zzp"),w(ze,"class","manifest-value svelte-1ne3zzp"),w(fe,"class","manifest-field svelte-1ne3zzp"),w(Rt,"class","manifest-label svelte-1ne3zzp"),w(kr,"class","manifest-value svelte-1ne3zzp"),w(gt,"class","manifest-field svelte-1ne3zzp"),w(Zr,"class","manifest-label svelte-1ne3zzp"),w(sr,"class","manifest-value svelte-1ne3zzp"),w(Lr,"class","manifest-field svelte-1ne3zzp"),w(re,"class","manifest-label svelte-1ne3zzp"),w(K,"class","manifest-value svelte-1ne3zzp"),w(pr,"class","manifest-field svelte-1ne3zzp"),w(A,"class","manifest-content svelte-1ne3zzp"),w(e,"class","manifest-container svelte-1ne3zzp")},m(Ie,xt){T(Ie,e,xt),k(e,t),k(t,r),k(r,n),k(r,s),k(r,a),Je&&Je.m(r,null),k(r,l),Xe&&Xe.m(r,null),k(r,c),zt&&zt.m(r,null),k(t,u),k(t,d),Ot&&Ot.m(d,null),k(e,h),k(e,_),k(_,b),k(_,v),k(_,D),ar.m(D,null),k(e,B),k(e,A),k(A,F),k(F,O),k(F,M),k(F,E),k(E,G),k(F,le),Tt&&Tt.m(F,null),k(A,ae),k(A,V),k(V,Z),k(V,Ee),k(V,Re),k(Re,Ke),k(A,qe),k(A,fe),k(fe,Ce),k(fe,te),k(fe,ze),k(ze,Oe),k(A,pt),k(A,gt),k(gt,Rt),k(gt,Ko),k(gt,kr),k(kr,bo),k(A,jo),k(A,Lr),k(Lr,Zr),k(Lr,Yo),k(Lr,sr),k(sr,vt),k(A,eo),k(A,pr),k(pr,re),k(pr,Ve),k(pr,K),k(K,ce)},p(Ie,xt){var wn;xt[0]&1024&&oe(s,Ie[10]),xt[0]&1024&&(i=(wn=Ie[34](Ie[10]))==null?void 0:wn.prerelease),i?Je||(Je=zw(Ie),Je.c(),Je.m(r,l)):Je&&(Je.d(1),Je=null),Ie[6][Ie[10]]==="beta-alias"?Xe||(Xe=Vw(Ie),Xe.c(),Xe.m(r,c)):Xe&&(Xe.d(1),Xe=null),Ie[6][Ie[10]]==="stable-alias"?zt||(zt=qw(Ie),zt.c(),zt.m(r,null)):zt&&(zt.d(1),zt=null),Jo===(Jo=oi(Ie,xt))&&Ot?Ot.p(Ie,xt):(Ot&&Ot.d(1),Ot=Jo&&Jo(Ie),Ot&&(Ot.c(),Ot.m(d,null))),bn===(bn=Vt(Ie,xt))&&ar?ar.p(Ie,xt):(ar.d(1),ar=bn(Ie),ar&&(ar.c(),ar.m(D,null))),xt[0]&2048&&R!==(R=Ie[11].version+"")&&oe(G,R),xt[0]&3072&&(j=Ie[10]!==Ie[11].version&&!Ie[10].startsWith("v"+Ie[11].version)),j?Tt||(Tt=Ww(Ie),Tt.c(),Tt.m(F,null)):Tt&&(Tt.d(1),Tt=null),xt[0]&2048&&Pe!==(Pe=Ie[11].name+"")&&oe(Ke,Pe),xt[0]&2048&&kt!==(kt=Ie[11].author+"")&&oe(Oe,kt),xt[0]&2048&&Ur!==(Ur=Ie[11].description+"")&&oe(bo,Ur),xt[0]&2048&&it!==(it=Ie[11].isDesktopOnly?"Yes":"No")&&oe(vt,it),xt[0]&2048&&be!==(be=Ie[11].minAppVersion+"")&&oe(ce,be)},d(Ie){Ie&&I(e),Je&&Je.d(),Xe&&Xe.d(),zt&&zt.d(),Ot&&Ot.d(),ar.d(),Tt&&Tt.d()}}}function zw(o){let e;return{c(){e=C("span"),e.textContent="Pre-release",w(e,"class","prerelease-badge svelte-1ne3zzp")},m(t,r){T(t,e,r)},d(t){t&&I(e)}}}function Vw(o){let e;return{c(){e=C("span"),e.textContent="Beta",w(e,"class","channel-badge beta-badge svelte-1ne3zzp")},m(t,r){T(t,e,r)},d(t){t&&I(e)}}}function qw(o){let e;return{c(){e=C("span"),e.textContent="Stable",w(e,"class","channel-badge stable-badge svelte-1ne3zzp")},m(t,r){T(t,e,r)},d(t){t&&I(e)}}}function xE(o){let e;return{c(){e=C("span"),e.textContent="Installed",w(e,"class","currently-installed svelte-1ne3zzp")},m(t,r){T(t,e,r)},p:Q,d(t){t&&I(e)}}}function yE(o){let e,t,r,n;function s(l,c){return l[12]===l[10]?wE:bE}let a=s(o,[-1,-1]),i=a(o);return{c(){e=C("button"),i.c(),w(e,"class","install-version-btn mod-cta svelte-1ne3zzp"),e.disabled=t=o[12]===o[10]||o[3]},m(l,c){T(l,e,c),i.m(e,null),r||(n=ee(e,"click",o[48]),r=!0)},p(l,c){a!==(a=s(l,c))&&(i.d(1),i=a(l),i&&(i.c(),i.m(e,null))),c[0]&5128&&t!==(t=l[12]===l[10]||l[3])&&(e.disabled=t)},d(l){l&&I(e),i.d(),r=!1,n()}}}function bE(o){let e;return{c(){e=W("Install")},m(t,r){T(t,e,r)},d(t){t&&I(e)}}}function wE(o){let e;return{c(){e=W("Installing...")},m(t,r){T(t,e,r)},d(t){t&&I(e)}}}function _E(o){var n,s;let e,t=(o[10]&&((s=(n=o[34](o[10]))==null?void 0:n.body)==null?void 0:s.replace(/\n/g,"<br/>"))||"No changelog available")+"",r;return{c(){e=new xl(!1),r=Te(),e.a=r},m(a,i){e.m(t,a,i),T(a,r,i)},p(a,i){var l,c;i[0]&1024&&t!==(t=(a[10]&&((c=(l=a[34](a[10]))==null?void 0:l.body)==null?void 0:c.replace(/\n/g,"<br/>"))||"No changelog available")+"")&&e.p(t)},d(a){a&&(I(r),e.d())}}}function vE(o){let e;function t(s,a){if(s[6][s[10]]==="stable-alias")return LE;if(s[6][s[10]]==="beta-alias")return kE;if(s[9]==="development")return SE}let r=t(o,[-1,-1]),n=r&&r(o);return{c(){n&&n.c(),e=Te()},m(s,a){n&&n.m(s,a),T(s,e,a)},p(s,a){r!==(r=t(s,a))&&(n&&n.d(1),n=r&&r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&I(e),n&&n.d(s)}}}function SE(o){let e;return{c(){e=C("p"),e.textContent="Current development version"},m(t,r){T(t,e,r)},d(t){t&&I(e)}}}function kE(o){let e;return{c(){e=C("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){T(t,e,r)},d(t){t&&I(e)}}}function LE(o){let e;return{c(){e=C("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){T(t,e,r)},d(t){t&&I(e)}}}function Ww(o){let e;return{c(){e=C("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-1ne3zzp">\u26A0\uFE0F</span>
								Version mismatch`,w(e,"class","manifest-version-mismatch svelte-1ne3zzp")},m(t,r){T(t,e,r)},d(t){t&&I(e)}}}function IE(o){let e,t,r,n,s,a,i,l,c;i=new wr({props:{name:"Show All Releases",$$slots:{default:[cE]},$$scope:{ctx:o}}});function u(x,h){return x[7]?mE:x[1].length===0?pE:x[8].length===0?dE:uE}let d=u(o,[-1,-1]),m=d(o);return{c(){e=C("div"),e.textContent="Release Manager",t=$(),r=C("div"),n=C("div"),s=$(),a=C("div"),z(i.$$.fragment),l=$(),m.c(),w(e,"class","modal-title"),w(n,"class","settings-spacer svelte-1ne3zzp"),w(a,"class","settings-container svelte-1ne3zzp"),w(r,"class","modal-content svelte-1ne3zzp")},m(x,h){T(x,e,h),T(x,t,h),T(x,r,h),k(r,n),k(r,s),k(r,a),N(i,a,null),k(r,l),m.m(r,null),c=!0},p(x,h){let _={};h[0]&4|h[1]&1073741824&&(_.$$scope={dirty:h,ctx:x}),i.$set(_),d===(d=u(x,h))&&m?m.p(x,h):(m.d(1),m=d(x),m&&(m.c(),m.m(r,null)))},i(x){c||(L(i.$$.fragment,x),c=!0)},o(x){P(i.$$.fragment,x),c=!1},d(x){x&&(I(e),I(t),I(r)),H(i),m.d()}}}var Gw="system3-relay";function Zs(o){return o.startsWith("v")?o.substring(1):o}function Kw(o){return(o==null?void 0:o.prerelease)===!0}function CE(o){return o.startsWith("v")&&(o=o.substring(1)),/^\d+\.\d+\.\d+$/.test(o)}function TE(o,e,t){let r,n,s,a,i,l,c,u,d,m,x,h,_,b,v,{plugin:D}=e,B=xe(D.manifest.version),A=xe(!1);ye(o,A,K=>t(50,u=K));let F=xe("");ye(o,F,K=>t(49,c=K));let O=xe(""),M=xe(!1);ye(o,M,K=>t(7,d=K));let E=xe(!1);ye(o,E,K=>t(2,l=K));let R=xe([]);ye(o,R,K=>t(8,m=K));let G=xe(null);ye(o,G,K=>t(11,_=K));let le=xe("");ye(o,le,K=>t(10,h=K));let j=xe(null),ae=xe(null);ye(o,ae,K=>t(13,v=K));let V=xe(!1),Z=xe(null);ye(o,Z,K=>t(5,a=K));let Ee=xe(null);ye(o,Ee,K=>t(4,s=K));let Re=xe(!1),Pe=!1,Ke=xe(null);ye(o,Ke,K=>t(12,b=K));let qe=D.app;function fe(K){let be=Zs(K),ce=Zs(D.version);return be===ce}function Ce(K){if(!u)return!1;let be=Zs(K),ce=Zs(c);return be===ce}let te=xe({});ye(o,te,K=>t(6,i=K));let ze=xe(null);ye(o,ze,K=>t(9,x=K)),tr(()=>{Oe(),kt(),ze.set("development"),G.set({version:D.manifest.version,name:D.manifest.name,author:D.manifest.author,description:D.manifest.description,isDesktopOnly:D.manifest.isDesktopOnly,minAppVersion:D.manifest.minAppVersion}),le.set(D.version)});function kt(){return Ze(this,void 0,void 0,function*(){Re.set(!0);try{let K=yield D.updateManager.fetchMainBranchManifests();K&&(Z.set(K.stable),Ee.set(K.beta))}catch(K){D.error("Error fetching main branch manifests:",K)}finally{Re.set(!1)}})}function Oe(){return Ze(this,void 0,void 0,function*(){M.set(!0);try{yield D.updateManager.checkGitHubReleases(),pt(l)}catch(K){D.error("Error refreshing GitHub releases:",K)}finally{M.set(!1)}})}function pt(K){K?R.set(r):R.set(r.filter(be=>{let ce=be.tag_name;return CE(ce)}))}function gt(K){return Ze(this,void 0,void 0,function*(){ae.set(null),i[K]!=="beta-alias"&&i[K]!=="stable-alias"&&ze.set(null),j.set(K);try{let be=kr(K);if(!be){ae.set(`Could not find release for ${K}`);return}let ce=yield D.updateManager.fetchReleaseManifest(be);ce?(G.set(ce),le.set(K),V.set(!1),te.update(Je=>Object.assign(Object.assign({},Je),{[K]:ce.version}))):ae.set(`Could not find manifest for ${K}`)}catch(be){D.error("Error fetching manifest:",be),ae.set(`Error fetching manifest: ${be.message||"Unknown error"}`)}finally{j.set(null)}})}function Rt(K){let be=K==="stable"?a:s;if(be){let ce=be.version;ze.set(K);let Je=r.find(Xe=>Zs(Xe.tag_name)===Zs(ce));Je?(K==="stable"?te.update(Xe=>Object.assign(Object.assign({},Xe),{[Je.tag_name]:"stable-alias"})):te.update(Xe=>Object.assign(Object.assign({},Xe),{[Je.tag_name]:"beta-alias"})),gt(Je.tag_name)):(G.set(be),le.set(ce),K==="stable"?te.update(Xe=>Object.assign(Object.assign({},Xe),{[ce]:"stable-alias"})):te.update(Xe=>Object.assign(Object.assign({},Xe),{[ce]:"beta-alias"})),V.set(!1))}else ae.set(`Could not find ${K} manifest`)}function Ko(){G.set(null),le.set(""),ae.set(null)}function kr(K){return r.find(be=>be.tag_name===K)}function Ur(K){return Ze(this,void 0,void 0,function*(){try{Ke.set(K);let be="No-Instructions/Relay",ce=kr(K);if(!ce)throw new Error(`Could not find release for ${K}`);let Je=yield D.updateManager.fetchReleaseManifest(ce);if(!Je)throw new Error(`Could not find manifest for ${K}`);t(3,Pe=!0),yield qe.plugins.installPlugin(be,K,Je),yield qe.plugins.disablePlugin(Gw),yield qe.plugins.enablePlugin(Gw)}catch(be){console.error(`Error installing version ${K}:`,be),D&&D.error(`Error installing version ${K}:`,be)}finally{D&&(t(3,Pe=!1),Ke.set(null))}})}let bo=K=>fe(K.tag_name),jo=()=>{E.update(K=>!K),pt(!l)},Lr=K=>{(K.key==="Enter"||K.key===" ")&&(E.update(be=>!be),pt(!l))},Zr=()=>Rt("beta"),Yo=K=>{(K.key==="Enter"||K.key===" ")&&Rt("beta")},sr=()=>Rt("stable"),it=K=>{(K.key==="Enter"||K.key===" ")&&Rt("stable")},vt=()=>{ze.set("development"),G.set({version:D.manifest.version,name:D.manifest.name,author:D.manifest.author,description:D.manifest.description,isDesktopOnly:D.manifest.isDesktopOnly,minAppVersion:D.manifest.minAppVersion}),le.set(D.version),V.set(!1)},eo=K=>{(K.key==="Enter"||K.key===" ")&&(ze.set("development"),G.set({version:D.manifest.version,name:D.manifest.name,author:D.manifest.author,description:D.manifest.description,isDesktopOnly:D.manifest.isDesktopOnly,minAppVersion:D.manifest.minAppVersion}),le.set(D.version),V.set(!1))},pr=K=>gt(K.tag_name),re=(K,be)=>{(be.key==="Enter"||be.key===" ")&&gt(K.tag_name)},Ve=()=>Ur(h);return o.$$set=K=>{"plugin"in K&&t(0,D=K.plugin)},o.$$.update=()=>{if(o.$$.dirty[0]&1){e:t(1,r=D.updateManager?D.updateManager.getGitHubReleases():[])}if(o.$$.dirty[0]&3){e:r&&r.length>0&&r.forEach(K=>Ze(void 0,void 0,void 0,function*(){try{let be=yield D.updateManager.fetchReleaseManifest(K);be&&te.update(ce=>Object.assign(Object.assign({},ce),{[K.tag_name]:be.version}))}catch(be){}}))}if(o.$$.dirty[0]&6){e:r&&r.length>0?pt(l):R.set([])}if(o.$$.dirty[0]&1){e:t(36,n=D.updateManager?D.updateManager.getUpdateInfo():null)}if(o.$$.dirty[0]&1|o.$$.dirty[1]&32){e:A.set(!!n&&n.newVersion!==D.manifest.version),n?(F.set(n.newVersion),O.set(n.repository)):(F.set(""),O.set(""))}},[D,r,l,Pe,s,a,i,d,m,x,h,_,b,v,A,F,M,E,R,G,le,ae,V,Z,Ee,Ke,fe,Ce,te,ze,pt,gt,Rt,Ko,kr,Ur,n,bo,jo,Lr,Zr,Yo,sr,it,vt,eo,pr,re,Ve]}var Yp=class extends J{constructor(e){super(),X(this,e,TE,IE,Y,{plugin:0},fE,[-1,-1])}},jw=Yp;var _f=class extends Yw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new jw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var PE={debugging:!1},DE={sharedFolders:[],...cl,...PE},vf=class extends Qw.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.4.6"}enableDebugging(t){ll(!0),console.warn("RelayInstances",Wt),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){ll(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return ll(r),t&&this.debugSettings.update(n=>({...n,debugging:r})),r}buildApiUrl(t){return"https://api.system3.md"+t}async onload(){this.appId=this.app.appId;let t=Ft.moment.now();Wt.set(this,"plugin"),this.timeProvider=new Ms,this.register(()=>{this.timeProvider.destroy()}),Qg(new xf(this.app.vault),this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new gf,this.toast=tx(this.notifier),this.debug=Se("[System 3][Relay]","debug"),this.log=Se("[System 3][Relay]","log"),this.warn=Se("[System 3][Relay]","warn"),this.error=Se("[System 3][Relay]","error"),this.settings=new hf(this,DE),await this.settings.load(),this.featureSettings=new yo(this.settings,"(enable*)"),this.debugSettings=new yo(this.settings,"(debugging)"),this.folderSettings=new yo(this.settings,"sharedFolders"),Gt.getInstance().setSettings(this.featureSettings),this.settingsTab=new ql(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new wf(this,this.timeProvider),this.debugSettings.subscribe(s=>{s.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Feature Flags",callback:()=>{let a=new pf(this.app,()=>{this.reload()});this.openModals.push(a),a.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let a=new yf(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let a=new mf(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-release-manager",name:"Release Manager",callback:()=>{let a=new _f(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze Database",callback:()=>{let a=new bf(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}}),this.addCommand({id:"show-sync-status",name:"Sync Status",callback:()=>{let a=new ri(this.app,this.backgroundSync,this.sharedFolders);this.openModals.push(a),a.open()}}),this.register(this.updateManager.subscribe(()=>{let a=this.updateManager.getUpdateInfo();this.debug("Update subscription triggered with:",a),a?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.manifest.version} \u2192 ${a.newVersion})`,callback:async()=>{await this.updateManager.installUpdate()}}),this.log(`Update available: v${this.manifest.version} \u2192 v${a.newVersion}`)):this.removeCommand("update-plugin")}))):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-sync-status"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.removeCommand("update-plugin"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))}),this.addCommand({id:"reload",name:"Reload Relay",callback:()=>{this.reload()}}),this.updateManager.start(),this.vault=this.app.vault;let n=this.vault.getName();this.fileManager=this.app.fileManager,this.loginManager=new Jl(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this)),this.relayManager=new df(this.loginManager),this.sharedFolders=new ml(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new ff(this.loginManager,this.timeProvider,n,3),this.networkStatus=new Ib(this.timeProvider,"https://api.system3.md/health?version=0.4.6"),this.backgroundSync=new Il(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new Ft.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new Pl(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),Jw.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(s=>s.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(qs,s=>new Tl(s)),this.registerEvent(this.app.workspace.on("file-menu",(s,a)=>{if(a instanceof Ft.TFolder){let i=this.sharedFolders.find(l=>l.path===a.path);if(!i)return;i.relayId&&s.addItem(l=>{l.setTitle(i.connected?"Disconnect":"Connect").setIcon("satellite").onClick(()=>{i.connected?(i.shouldConnect=!1,i.disconnect()):(i.shouldConnect=!0,i.connect()),this._liveViews.refresh("folder connection toggle")})}),s.addItem(l=>{l.setTitle("Folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${i.guid}&relay=${i.relayId}`)})}),i.relayId&&Fr().enableSyncModal&&s.addItem(l=>{l.setTitle("Sync Status").setIcon("list-checks").onClick(()=>{let c=new ri(this.app,this.backgroundSync,this.sharedFolders,i.guid);this.openModals.push(c),c.open()})}),Fr().enableSyncMenu&&i.relayId&&i.connected&&s.addItem(l=>{l.setTitle("Sync").setIcon("folder-sync").onClick(()=>{i.netSync()})})}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=Ft.moment.now()-t})}async reload(){let t=this.manifest.id,r=this.app.plugins;await r.disablePlugin(t),await r.enablePlugin(t)}_createSharedFolder(t,r,n,s){let a=new yo(this.settings,`sharedFolders/[guid=${r}]`);return a.flush(),new pl(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.backgroundSync,a,n,s)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,n,s;let t=this;try{if(this.webviewerPatched)return;let a=(n=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:n.webviewer;if(!((s=a==null?void 0:a.instance)!=null&&s.options)||!a.enabled){this.warn("Webviewer plugin not found or not initialized");return}let i=a.instance.options,l=Object.getOwnPropertyDescriptor(i,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(i,"openExternalURLs",{get(){var m;let d=window.event;if((d==null?void 0:d.type)==="open-url"&&((m=d==null?void 0:d.detail)!=null&&m.url)){let x=d.detail.url;for(let h of t.interceptedUrls)if(typeof h=="string"&&x.startsWith(h)||h instanceof RegExp&&h.test(x))return t.log("Intercepted webviewer, opening in default browser",d.detail.url),!1}return l.value},set(d){l.value=d},configurable:!0}),this.register(()=>{Object.defineProperty(i,"openExternalURLs",l)});let c=this.loginManager.webviewIntercept();this.debug("Intercepting Webviewer for URL pattern",c.source),this.interceptedUrls.push(c);let u=new RegExp("https://api.system3.md".replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",u.source),this.interceptedUrls.push(u),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(a){this.error("Failed to patch webviewer:",a)}}setup(){this.folderNavDecorations=new Ml(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=Se("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",c=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Se("[System 3][Relay][Vault]","log"),n=c=>{let u=c.error;u&&u instanceof Kn&&this.toast(u)};window.addEventListener("error",n,!0),this.register(()=>window.removeEventListener("error",n,!0));let s=c=>{c.reason instanceof Kn&&this.toast(c.reason)},a=c=>s(c);window.addEventListener("unhandledrejection",a,!0),this.register(()=>window.removeEventListener("unhandledrejection",a,!0)),this.registerEvent(this.app.vault.on("create",c=>{if(c instanceof Ft.TFolder)return;let u=this.sharedFolders.lookup(c.path);if(u){let d=u.getVirtualPath(c.path);if(!u.checkExtension(d))return;u.placeHold([d]).length>0?u.uploadDoc(d):u.whenReady().then(x=>{x.getFile(c.path)})}})),this.registerEvent(this.app.vault.on("delete",c=>{if(c instanceof Ft.TFolder){let d=this.sharedFolders.find(m=>m.path===c.path);d&&this.sharedFolders.delete(d);return}let u=this.sharedFolders.lookup(c.path);u&&(r("Delete",c.path),u.whenReady().then(d=>{d.deleteFile(c.path)}))})),this.registerEvent(this.app.vault.on("rename",(c,u)=>{if(c instanceof Ft.TFolder){let h=this.sharedFolders.find(_=>_.path==u);h&&(h.move(c.path),this.sharedFolders.update());return}let d=this.sharedFolders.lookup(u),m=this.sharedFolders.lookup(c.path),x=d||m;d&&m?(r("Rename",c.path,u),d.renameFile(c.path,u),m.renameFile(c.path,u),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):x&&(r("Rename",c.path,u),x.renameFile(c.path,u),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh())})),this.registerEvent(this.app.vault.on("modify",c=>{this.sharedFolders.lookup(c.path)&&(r("Modify",c.path),Fr().enableDesyncPill&&this.folderNavDecorations.quickRefresh(),this.app.metadataCache.trigger("resolve",c))}));let i=this,l=Ha(Ft.MarkdownView.prototype,{onUnloadFile(c){return function(u){return i._liveViews.wipe(),c.call(this,u)}}});this.register(l),this.patchWebviewer(),uo(Er.enableNewLinkFormat,()=>{let c=Ha(Ft.MetadataCache.prototype,{fileToLinktext(u){return function(d,m,x){if(i.sharedFolders.lookup(d.path)){x===void 0&&(x=!0);let _=d.extension==="md"&&x?d.basename:d.name,b=(0,Ft.normalizePath)(d.name),v=i.app.metadataCache.uniqueFileLookup.get(b.toLowerCase());if(v&&v.length===1&&v[0]===d)return _;{let D=d.extension==="md"&&x?d.path.slice(0,d.path.length-3):d.path,B=(0,Xw.relative)(m,D);return B==="../"+_?"./"+_:B}}return u.call(this,d,m,x)}}});this.register(c),this.backgroundSync.start()}),this.registerObsidianProtocolHandler("relay/settings/relays",async c=>{let u=c,d=new Jp.URLSearchParams({...u}).toString(),m=`/${u.action.split("/").slice(-1)}?${d}`;this.openSettings(m)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async c=>{let u=c,d=new Jp.URLSearchParams({...u}).toString(),m=`/${u.action.split("/").slice(-1)}?${d}`;this.openSettings(m)})}removeCommand(t){if((0,Ft.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,n=r.commands,s=`system3-relay:${t}`;(n.commands.hasOwnProperty(s)||r.hotkeyManager.removeDefaultHotkeys(s))&&(delete n.commands[s],delete n.editorCommands[s])}}onunload(){var t,r,n,s,a,i,l,c,u,d,m,x,h,_;(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(qs),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(n=this._liveViews)==null||n.destroy(),this._liveViews=null,(s=this.relayManager)==null||s.destroy(),this.relayManager=null,(a=this.tokenStore)==null||a.stop(),(i=this.tokenStore)==null||i.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(c=this.networkStatus)==null||c.stop(),(u=this.networkStatus)==null||u.destroy(),this.networkStatus=null,this.openModals.forEach(b=>{b.close()}),this.openModals.length=0,(d=this.sharedFolders)==null||d.destroy(),this.sharedFolders=null,(m=this.settingsTab)==null||m.destroy(),this.settingsTab=null,(x=this.loginManager)==null||x.destroy(),this.loginManager=null,(h=this.backgroundSync)==null||h.destroy(),this.backgroundSync=null,(_=this.app)==null||_.workspace.updateOptions(),this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,this.featureSettings.destroy(),this.featureSettings=null,this.interceptedUrls.length=0,Gt.destroy(),Mr.destroy(),this.notifier=null,this.toast=null,ox(),nu()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

moment/moment.js:
  (*! moment.js *)
  (*! version : 2.29.4 *)
  (*! authors : Tim Wood, Iskren Chernev, Moment.js contributors *)
  (*! license : MIT *)
  (*! momentjs.com *)

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-up-down.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-check-big.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-help.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/clock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/download.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/info.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/message-square-heart.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/pause.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/play.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/refresh-cw.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/triangle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/upload.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */